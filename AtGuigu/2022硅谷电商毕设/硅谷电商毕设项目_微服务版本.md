## ç›®å½•

*   [ç¡…è°·ç”µå•†æ¯•è®¾é¡¹ç›®\_å¾®æœåŠ¡ç‰ˆæœ¬](#ç¡…è°·ç”µå•†æ¯•è®¾é¡¹ç›®_å¾®æœåŠ¡ç‰ˆæœ¬)

    *   *   [ä¸€ã€å‰è¨€](#ä¸€å‰è¨€)

        *   [äºŒã€å¿«é€Ÿäº†è§£](#äºŒå¿«é€Ÿäº†è§£)

        *   [ä¸‰ã€å¾®æœåŠ¡ç¯å¢ƒæ­å»º](#ä¸‰å¾®æœåŠ¡ç¯å¢ƒæ­å»º)

        *   [å››ã€é¡¹ç›®å¿«é€Ÿéƒ¨ç½²](#å››é¡¹ç›®å¿«é€Ÿéƒ¨ç½²)

        *   [äº”ã€é¡¹ç›®åŸºç¡€æ­å»º](#äº”é¡¹ç›®åŸºç¡€æ­å»º)

        *   [å…­ã€å•†åŸå‰ç«¯æœåŠ¡å¼€å‘](#å…­å•†åŸå‰ç«¯æœåŠ¡å¼€å‘)

        *   [ä¸ƒã€åå°ç®¡ç†æœåŠ¡å¼€å‘](#ä¸ƒåå°ç®¡ç†æœåŠ¡å¼€å‘)

        *   [å…«ã€å¼€å‘ç¯å¢ƒæ­å»º](#å…«å¼€å‘ç¯å¢ƒæ­å»º)

        *   [ä¹ã€æŠ€æœ¯æ™®åŠ](#ä¹æŠ€æœ¯æ™®åŠ)

# ç¡…è°·ç”µå•†æ¯•è®¾é¡¹ç›®\_å¾®æœåŠ¡ç‰ˆæœ¬

***

### ä¸€ã€å‰è¨€

> ä½ æ˜¯ä¸æ˜¯éœ€è¦ä¸€ä¸ªæ•™ç¨‹æ—¶é•¿è¾ƒçŸ­,å¾®æœåŠ¡æŠ€æœ¯æ ˆè¾ƒå…¨ç”µå•†é¡¹ç›®ï¼Œå……å½“æ¯•ä¸šè®¾è®¡æˆ–è€…è¿›è¡Œå¾®æœåŠ¡**å…¥é—¨é¡¹ç›®ç»ƒä¹ **ï¼                                                                                                                    æœ¬æ¬¡è¯¾ç¨‹**æŠ€æœ¯å…¨é¢**ã€springbootã€mybatis-plusã€å¾®æœåŠ¡å…¨å®¶æ¡¶ã€ç¼“å­˜ã€å¼‚æ­¥æ¶ˆæ¯ã€æœç´¢ç­‰æŠ€æœ¯æ ˆã€‘ï¼Œ**åŠŸèƒ½é½å…¨**ã€é”€å”®å‰ç«¯å’Œåå°ç®¡ç†åŠŸèƒ½ã€‘ï¼Œå¹¶ä¸”ä»£ç å®Œæ•´!  ä¹Ÿå¯¹é¡¹ç›®ç»“æ„å’ŒåŠŸèƒ½ç‚¹è¿›è¡Œä¼˜åŒ–,å‡å°‘å†—ä½™**ä¸šåŠ¡**é¡¹ç›®ï¼è®©ä½ åœ¨**æœ€å¿«çš„æ—¶é—´**å®Œæˆæ¯•è®¾é¡¹ç›®å¼€å‘å’Œå¾®æœåŠ¡å…¥é—¨ç»ƒä¹ ï¼

***

### äºŒã€å¿«é€Ÿäº†è§£

*   **é¡¹ç›®ç®€ä»‹**

    **B2C**æ¨¡å¼ç”µå•†é¡¹ç›®ï¼ŒåŒ…å«å®Œæ•´çš„é”€å”®å‰å°å’Œç”µå•†ç®¡ç†åå°ï¼

    å‰å°éƒ¨åˆ†ä¸»è¦é€šè¿‡æµè§ˆå™¨è®¿é—®ï¼Œç”¨æˆ·å¯ä»¥ç™»å½•ï¼Œæµè§ˆå•†å“ï¼Œä»¥åŠæ·»åŠ è´­ç‰©è½¦å’Œè®¢å•ç”Ÿæˆç­‰åŠŸèƒ½ï¼Œå®Œæˆè´­ç‰©è½¦ï¼

    åå°éƒ¨åˆ†ä¸»è¦ç®¡ç†å‘˜ç™»å½•ï¼Œå¯¹å‰å°ç”¨æˆ·ï¼Œç±»åˆ«ï¼Œå•†å“ä»¥åŠè®¢å•ç­‰æ•°æ®ç»´æŠ¤ï¼

    åŠŸèƒ½é½å…¨ï¼Œå¹¶é’ˆå¯¹äººç¾¤ï¼Œè¿›è¡Œäº†é¡¹ç›®è°ƒæ•´ï¼Œç æ‰äº†éƒ¨åˆ†å†—ä½™ä¸šåŠ¡ï¼Œå­¦ä¹ å‘¨æœŸæ›´çŸ­ï¼Œæ›´å¿«é€Ÿçš„å­¦ä¹ å’ŒæŒæ¡é¡¹ç›®ï¼

    æœ¬é¡¹ç›®å‰ç«¯èµ„æ–™æ¥è‡ªäºäº’è”ç½‘å¼€æºé¡¹ç›®ï¼ŒæŠ€æœ¯åˆ†äº«ï¼Œåˆ†äº«å¿«ä¹ï¼

*   **é¡¹ç›®äº®ç‚¹**

    *   æ•™æ¡ˆé½å…¨ï¼Œä»£ç å’Œç‰©æ–™å®Œæ•´ï¼Œåœ¨çº¿ç‰ˆæœ¬**ä¸€ä¸ªé“¾æ¥**æå®šå…¨éƒ¨

    *   æŠ€æœ¯æ ˆå…¨é¢ï¼Œè§†é¢‘ç²¾ç‚¼ï¼Œè®©åœ¨**æ›´çŸ­æ—¶é—´**ã€**æ›´å¿«çš„å…¥é—¨**å¾®æœåŠ¡

    *   åå°**å¾®æœåŠ¡æŠ€æœ¯**å¼€å‘ï¼Œå¹¶åŠ å…¥**ç¼“å­˜**å’Œ**æœç´¢**ä»¥åŠ**æ¶ˆæ¯é˜Ÿåˆ—**æŠ€æœ¯æ ˆ

    *   å‰ç«¯æŠ€æœ¯æ–°é¢–ï¼Œä½¿ç”¨**vue+elementui+node+layui**ç»„åˆ

    *   æ–‡ä»¶å­˜å‚¨ä½¿ç”¨äº†é˜¿é‡ŒOSSæŠ€æœ¯ï¼Œç¯å¢ƒå®‰è£…ä½¿ç”¨DockeræŠ€æœ¯

    *   é¡¹ç›®**åŠŸèƒ½å…¨é¢**ã€**éš¾åº¦é€‚ä¸­**ï¼Œ**æ¯•è®¾**å’Œå¾®æœåŠ¡**å…¥é—¨è‰¯å“**

    *   ä»é›¶å¼€å§‹ï¼Œæ¶‰åŠæ–°æŠ€æœ¯ä¸“é—¨æ™®åŠè®²è§£ï¼Œ**å­¦ä¹ é—¨æ§›ä½**

*   **æ ¸å¿ƒæŠ€æœ¯æ ˆ**

    åå°æŠ€æœ¯

    | æŠ€æœ¯ç‚¹                 | ç‰ˆæœ¬å·           |
    | ------------------- | ------------- |
    | springboot          | 2.3.9.RELEASE |
    | springcloud         | Hoxton.SR10   |
    | springcloud alibaba | 2.2.5.RELEASE |
    | spring cache        | 2.3.9.RELEASE |
    | rabbitmq            | 5.9.0         |
    | elasticsearch       | 7.12.1        |
    | druid               | 1.2.5         |
    | mybatis-plus        | 3.5.2         |
    | lombok              | 1.18.24       |

    å‰ç«¯æŠ€æœ¯

    | æŠ€æœ¯ç‚¹        | ç‰ˆæœ¬å·     |
    | ---------- | ------- |
    | vue        | 2.6.10  |
    | node       | 1.14.16 |
    | element-ui | 2.13.0  |
    | layui      | 2.9+    |
    | axios      | 0.19.0  |
    | vuex       | 3.1.2   |

*   **å¼€å‘ç¯å¢ƒéœ€æ±‚**

    | å¼€å‘å·¥å…·  | ç‰ˆæœ¬å·    | å¤‡æ³¨       |
    | ----- | ------ | -------- |
    | jdk   | 1.8.19 | 1.8+å³å¯   |
    | idea  | 2019   | æ— é™åˆ¶      |
    | maven | 3.6.3  | 3+å³å¯     |
    | mysql | 5.7.25 | æ¨è8.0+ç‰ˆæœ¬ |

*   **é¡¹ç›®è¿è¡Œæ•ˆæœå›¾**

    *   å‰å°é¦–é¡µ

        ![](image/image_MdFjzakIm0.png)

    *   å‰å°ç”¨æˆ·æ¨¡å—

        ![](image/image_5pjtAVggTF.png)

    *   å‰å°å•†å“æ¨¡å—

        ![](image/image_JIcCVmoFEa.png)

    *   å‰å°è¯¦æƒ…æ¨¡å—

        ![](image/image_HW0A5T2ABp.png)

    *   å‰å°æœè—æ¨¡å—

        ![](image/image_x3FVfzhXe4.png)

    *   å‰å°è´­ç‰©è½¦æ¨¡å—

        ![](image/image_Vf55fFm9uk.png)

    *   å‰å°åœ°å€æ¨¡å—

        ![](image/image_Fr380GzAwF.png)

    *   å‰å°è®¢å•æ¨¡å—

        ![](image/image_sjcPcdOrlW.png)

    *   **åå°ç™»å½•æ¨¡å—**

        ![](image/image_h9ivtLGDqn.png)

    *   **åå°ç”¨æˆ·æ¨¡å—**

        ![](image/image_jsRUgutxNS.png)

    *   **åå°åˆ†ç±»ç®¡ç†**

        ![](image/image_U1hSGqTCvi.png)

    *   **åå°å•†å“ç®¡ç†**

        ![](image/image_G1Lj4cqYCl.png)

    *   **åå°è®¢å•ç®¡ç†**

        ![](image/image__jBG8SvjCk.png)

*   **å†…ç½®åŠŸèƒ½è¯¦è§£**

    *   **å•†åŸå‰å°**

        *   **ç”¨æˆ·æ¨¡å—ï¼š** ç™»å½•ã€æ³¨å†Œã€ è´¦å·æ£€æŸ¥

        *   **è½®æ’­æ¨¡å—ï¼š** è½®æ’­å›¾å±•ç¤º

        *   **å•†å“æ¨¡å—ï¼š** çƒ­é—¨å•†å“ã€ç±»åˆ«å•†å“ã€å…¨éƒ¨å•†å“ã€å•ç±»åˆ«å•†å“ã€å•†å“è¯¦æƒ…ã€å•†å“å›¾ç‰‡è¯¦æƒ…ã€å•†å“æœç´¢åŠŸ

        *   **ç±»åˆ«æ¨¡å—ï¼š** ç±»åˆ«å±•ç¤º

        *   **åœ°å€æ¨¡å—ï¼š** åœ°å€æ·»åŠ ã€åœ°å€åˆ é™¤ã€åœ°å€å±•ç¤º

        *   **æ”¶è—æ¨¡å—ï¼š** æ”¶è—æ·»åŠ ã€æ”¶è—å±•ç¤ºã€æ”¶è—åˆ é™¤

        *   **è´­ç‰©æ¨¡å—ï¼š** è´­ç‰©è½¦æ·»åŠ ã€è´­ç‰©è½¦ä¿®æ”¹ã€è´­ç‰©è½¦å±•ç¤ºã€è´­ç‰©è½¦åˆ é™¤

        *   **è®¢å•æ¨¡å—ï¼š** è®¢å•ç”Ÿæˆã€è®¢å•å±•ç¤º

        *   **æ€§èƒ½æ¨¡å—ï¼š** ç¼“å­˜å®ç°ã€æœç´¢å®ç°ã€æœç´¢åŒæ­¥ã€æœç´¢æ·»åŠ ã€æœç´¢åˆ é™¤

    *   **å•†åŸåå°**

        *   **ç”¨æˆ·æ¨¡å—ï¼š** ç”¨æˆ·å±•ç¤ºã€ç”¨æˆ·æ·»åŠ ã€ç”¨æˆ·ç¼–è¾‘ã€ç”¨æˆ·åˆ é™¤

        *   **ç±»åˆ«æ¨¡å—ï¼š** ç±»åˆ«å±•ç¤ºã€ç±»åˆ«æ·»åŠ ã€ç±»åˆ«ä¿®æ”¹ã€ç±»åˆ«åˆ é™¤

        *   **å•†å“æ¨¡å—ï¼š** å•†å“æ·»åŠ ã€å•†å“å±•ç¤ºã€å•†å“æœç´¢ã€å•†å“ä¿®æ”¹ã€å•†å“åˆ é™¤

        *   **è®¢å•æ¨¡å—ï¼š** è®¢å•å±•ç¤º

    *   æ€»ä½“ç»Ÿè®¡

        ```ybsz
        title æœåŠ¡  12 d0 red
        title æ¨¡å—  13 blue
        title åŠŸèƒ½ç‚¹ 42 green
        title æ•°æ®è¡¨ 8  gold
    
        ```

*   **æ•°æ®åº“E-Rå›¾**

    ![](image/image_vk77NFQf-H.png)

*   **é¡¹ç›®æœåŠ¡æ¶æ„å›¾**

    ![](image/image_8O9l2tSh2W.png)

### ä¸‰ã€å¾®æœåŠ¡ç¯å¢ƒæ­å»º

*   **äº‘æœåŠ¡è´­ä¹°å’Œä½¿ç”¨**

    æç¤ºï¼šæœ¬åœ°å®‰è£…Linuxè™šæ‹Ÿæœºä¹Ÿå¯ä»¥ï¼Œä½¿ç”¨äº‘æœåŠ¡å™¨æ›´åŠ ç®€å•ï¼

    ç³»ç»Ÿï¼šcentos 7+ ç‰ˆæœ¬å³å¯

    æ€§èƒ½ï¼šæ¨è2æ ¸2GBå†…å­˜ä»¥åŠä»¥ä¸Š

    é˜¿é‡Œäº‘ï¼š[https://ecs-buy.aliyun.com/wizard/#/prepay/cn-beijing?fromDomain=true](https://ecs-buy.aliyun.com/wizard/#/prepay/cn-beijing?fromDomain=true "https://ecs-buy.aliyun.com/wizard/#/prepay/cn-beijing?fromDomain=true")

    è…¾è®¯äº‘ï¼š[https://buy.cloud.tencent.com/cvm?tab=lite\&templateCreateMode=createLt](https://buy.cloud.tencent.com/cvm?tab=lite\&templateCreateMode=createLt "https://buy.cloud.tencent.com/cvm?tab=lite\&templateCreateMode=createLt")

    æ³¨æ„ï¼šä¸€å®šè¦åˆ†é…å…¬ç½‘IPï¼Œå¸¦å®½1MBå³å¯

    æ³¨æ„ï¼šéœ€è¦å¼€é€šå¤–éƒ¨è®¿é—®ç«¯å£å·ï¼Œå‰æœŸ1-65535éƒ½å¯æ‰“å¼€

*   **finalshellå®‰è£…å’Œä½¿ç”¨**

    *   FinallShellä»‹ç»

        > finalshellæ˜¯è¿œç¨‹æœåŠ¡è¿æ¥å·¥å…·ï¼Œå®ƒèƒ½å¸®åŠ©ç”¨æˆ·å¿«é€Ÿçš„è¿æ¥æœåŠ¡å™¨ï¼Œè€Œä¸”ç•Œé¢è®¾è®¡ååˆ†çš„ç®€æ´æ“ä½œéå¸¸çš„ç®€å•,è€Œä¸”å…è´¹ä½¿ç”¨ï¼

    *   FinallShellå®‰è£…

        > å®‰è£…ä¸€åˆ‡æ­£å¸¸ï¼ç›´æ¥ä¸‹ä¸€æ­¥å³å¯ï¼

        ![](image/image_LdHisLal4a.png)

    *   FinalShellè¿æ¥

        ![](image/image_S16heMH7iI.png)

    *   FinalShellä½¿ç”¨

        ![](image/image_enxCLejdHc.png)

*   **dockerä½¿ç”¨**

    *   dockerä»‹ç»

        ![](image/image_UJAm_falUT.png)

        Docker æ˜¯ä¸€ä¸ªå¼€æºçš„åº”ç”¨å®¹å™¨å¼•æ“ï¼ŒåŸºäº [Go è¯­è¨€](https://www.runoob.com/go/go-tutorial.html "Go è¯­è¨€") å¹¶éµä» Apache2.0 åè®®å¼€æºã€‚

        Docker å¯ä»¥è®©å¼€å‘è€…æ‰“åŒ…ä»–ä»¬çš„åº”ç”¨ä»¥åŠä¾èµ–åŒ…åˆ°ä¸€ä¸ªè½»é‡çº§ã€å¯ç§»æ¤çš„å®¹å™¨ä¸­ï¼Œç„¶åå‘å¸ƒåˆ°ä»»ä½•æµè¡Œçš„ Linux æœºå™¨ä¸Šï¼Œä¹Ÿå¯ä»¥å®ç°è™šæ‹ŸåŒ–ã€‚

        ç™½è¯è§£é‡Šï¼šdockerå¯ä»¥ç†è§£æˆæ˜¯æ‰‹æœºä¸­çš„åº”ç”¨å¸‚åœºï¼Œæœ‰äº†åº”ç”¨å¸‚åœºï¼Œå°±ä¸ç”¨è‡ªå·±ä¸€ä¸ªä¸€ä¸ªç™¾åº¦æœç´¢è½¯ä»¶å¹¶ä¸‹è½½äº†ï¼Œç›´æ¥åœ¨åº”ç”¨å¸‚åœºä¸­å¯ä»¥ä¸€é”®ä¸‹è½½ï¼

        ç™½è¯ä½œç”¨ï¼šdockerå¸®åŠ©æˆ‘ä»¬å®‰è£…å¾®æœåŠ¡å¼€å‘éœ€è¦çš„ä¸­é—´ä»¶ï¼Œä½¿ç”¨ç®€å•çš„å‘½ä»¤æ§åˆ¶dockerå®‰è£…å³å¯ï¼Œä¸éœ€è¦è‡ªå·±æ‰‹åŠ¨å®‰è£…ï¼

    *   dockerå®‰è£…

        1.  æ¸…ç©ºåŸæœ‰ç»„ä»¶æ®‹ç•™

            > ä¹‹å‰å®‰è£…è¿‡æ—§ç‰ˆæœ¬ï¼Œä½¿ç”¨ä¸€ä¸‹å‘½ä»¤å¯ä»¥å¸è½½ï¼

            ```docker
            yum remove docker \
                              docker-client \
                              docker-client-latest \
                              docker-common \
                              docker-latest \
                              docker-latest-logrotate \
                              docker-logrotate \
                              docker-selinux \
                              docker-engine-selinux \
                              docker-engine \
                              docker-ce
            ```

        2.  è®¾ç½®dockerä»“åº“

            > åœ¨æ–°ä¸»æœºä¸Šé¦–æ¬¡å®‰è£… Docker Engine-Community ä¹‹å‰ï¼Œéœ€è¦è®¾ç½® Docker ä»“åº“ã€‚ä¹‹åï¼Œæ‚¨å¯ä»¥ä»ä»“åº“å®‰è£…å’Œæ›´æ–° Docker.                                                                                    å®‰è£…æ‰€éœ€çš„è½¯ä»¶åŒ…ã€‚yum-utils æä¾›äº† yum-config-manager ï¼Œå¹¶ä¸” device mapper å­˜å‚¨é©±åŠ¨ç¨‹åºéœ€è¦ device-mapper-persistent-data å’Œ lvm2ã€‚

            ```docker
            yum install -y yum-utils \
                       device-mapper-persistent-data \
                       lvm2 --skip-broken
            ```

        3.  é…ç½®yumé˜¿é‡Œé•œåƒ

            ```docker
            # è®¾ç½®dockeré•œåƒæº
            yum-config-manager \
                --add-repo \
                https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
                
            sed -i 's/download.docker.com/mirrors.aliyun.com\/docker-ce/g' /etc/yum.repos.d/docker-ce.repo

            yum makecache fast
            ```

        4.  å®‰è£…docker

            > docker-ceä¸ºç¤¾åŒºå…è´¹ç‰ˆæœ¬ã€‚ç¨ç­‰ç‰‡åˆ»ï¼Œdockerå³å¯å®‰è£…æˆåŠŸã€‚

            ```docker
            yum install -y docker-ce
            ```

        5.  å¯åŠ¨docker

            1.  å…³é—­é˜²ç«å¢™

                > dockeræ¶‰åŠç«¯å£æ˜ å°„ï¼Œå»ºè®®å…ˆå…³é—­é˜²ç«å¢™ï¼Œé¿å…ç«¯å£å±è”½ï¼

                ```bash
                # å…³é—­
                systemctl stop firewalld
                # ç¦æ­¢å¼€æœºå¯åŠ¨é˜²ç«å¢™
                systemctl disable firewalld
                ```

            2.  å¯åŠ¨å’Œåœæ­¢docker

                ```bash
                systemctl start docker  # å¯åŠ¨dockeræœåŠ¡
        
                systemctl stop docker  # åœæ­¢dockeræœåŠ¡
        
                systemctl restart docker  # é‡å¯dockeræœåŠ¡
        
                docker -v
        
                ```

        6.  é…ç½®dockeré˜¿é‡Œé•œåƒ

            > æ›´æ–°dockerå¯¹åº”çš„ä»“åº“ï¼Œä¸ºé˜¿é‡Œé•œåƒï¼Œæå‡ä¸‹è½½é€Ÿåº¦ï¼

            ```bash
            sudo mkdir -p /etc/docker
            sudo tee /etc/docker/daemon.json <<-'EOF'
            {
              "registry-mirrors": ["https://as08lme3.mirror.aliyuncs.com"]
            }
            EOF
            sudo systemctl daemon-reload
            sudo systemctl restart docker
            ```

    *   dockeråŸºæœ¬æ¦‚å¿µ

        *   **é•œåƒï¼ˆImageï¼‰**ï¼šDocker é•œåƒï¼ˆImageï¼‰ï¼Œå°±ç›¸å½“äºæ˜¯ä¸€ä¸ª root æ–‡ä»¶ç³»ç»Ÿã€‚æ¯”å¦‚å®˜æ–¹é•œåƒ ubuntu:16.04 å°±åŒ…å«äº†å®Œæ•´çš„ä¸€å¥— Ubuntu16.04 æœ€å°ç³»ç»Ÿçš„ root æ–‡ä»¶ç³»ç»Ÿã€‚

            è½¯ä»¶çš„å®‰è£…åŒ…

        *   **å®¹å™¨ï¼ˆContainerï¼‰**ï¼šé•œåƒï¼ˆImageï¼‰å’Œå®¹å™¨ï¼ˆContainerï¼‰çš„å…³ç³»ï¼Œå°±åƒæ˜¯é¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡ä¸­çš„ç±»å’Œå®ä¾‹ä¸€æ ·ï¼Œé•œåƒæ˜¯é™æ€çš„å®šä¹‰ï¼Œå®¹å™¨æ˜¯é•œåƒè¿è¡Œæ—¶çš„å®ä½“ã€‚å®¹å™¨å¯ä»¥è¢«åˆ›å»ºã€å¯åŠ¨ã€åœæ­¢ã€åˆ é™¤ã€æš‚åœç­‰ã€‚

            å®‰è£…åŒ…å®‰è£…ä»¥åçš„è¿è¡Œç¨‹åº

        *   **ä»“åº“ï¼ˆRepositoryï¼‰**ï¼šä»“åº“å¯çœ‹æˆä¸€ä¸ªä»£ç æ§åˆ¶ä¸­å¿ƒï¼Œç”¨æ¥ä¿å­˜é•œåƒã€‚

            å­˜æ”¾å®‰è£…åŒ…çš„ä»“åº“

            <http://hub.docker.com> æŸ¥çœ‹é•œåƒ

            æˆ‘ä»¬çš„ç›®æ ‡ï¼Œå°±æ˜¯ä»ä»“åº“æ‹‰å»é•œåƒï¼Œå¯åŠ¨è¿è¡Œæˆå®¹å™¨ï¼Œå³å¯ï¼

    *   dockeré•œåƒåŸºæœ¬å‘½ä»¤

        *   åŸºæœ¬å‘½ä»¤

            ![](image/image_0vLxFKlK3_.png)

        *   åŸºæœ¬ç»ƒä¹ 

            1.  æ‹‰å»nginxé•œåƒ

                è¾“å…¥ï¼š <http://hub.docker.com>

                æœç´¢ï¼šnginx

                ```bash
                docker pull nginx //é»˜è®¤ æœ€æ–° latest
                docker pull nginx:ç‰ˆæœ¬å·

                docker images æŸ¥çœ‹ç‰ˆæœ¬
                ```

            2.  é•œåƒå¤‡ä»½å’ŒåŠ è½½

                > ä½¿ç”¨saveå’Œloadè¿›è¡Œé•œåƒæœ¬åœ°å¤‡ä»½å’Œé•œåƒåŠ è½½ï¼

                ```bash
                docker save é•œåƒå -o /è¾“å‡ºçš„ä½ç½®
                docker load -i /è¾“å…¥çš„é•œåƒæ–‡ä»¶
                ```

    *   dockerå®¹å™¨ç›¸å…³å‘½ä»¤

        *   åŸºæœ¬å‘½ä»¤

            ![](image/image_wSUrslU0oL.png)

        *   åŸºæœ¬ç»ƒä¹ 

            > è¿è¡Œnginxå®¹å™¨ï¼Œå¹¶è¿›è¡Œè®¿é—®

            ```bash
            docker run --name containerName -p 80:80 -d nginx


            docker run ï¼šåˆ›å»ºå¹¶è¿è¡Œä¸€ä¸ªå®¹å™¨
            --name : ç»™å®¹å™¨èµ·ä¸€ä¸ªåå­—ï¼Œæ¯”å¦‚å«åšmn
            -p ï¼šå°†å®¿ä¸»æœºç«¯å£ä¸å®¹å™¨ç«¯å£æ˜ å°„ï¼Œå†’å·å·¦ä¾§æ˜¯å®¿ä¸»æœºç«¯å£ï¼Œå³ä¾§æ˜¯å®¹å™¨ç«¯å£
            -dï¼šåå°è¿è¡Œå®¹å™¨
            nginxï¼šé•œåƒåç§°ï¼Œä¾‹å¦‚nginx



            ```
    
    *   dockeræ•°æ®å·
    
        *   ç›´æ¥æ“ä½œæ“ä½œæ•°æ®
    
            æ­¥éª¤ä¸€ï¼šè¿›å…¥å®¹å™¨ï¼Œä¿®æ”¹å®¹å™¨æ‰§è¡Œå‘½ä»¤
    
            ```bash
            docker exec -it å®¹å™¨å bash 
    
            å‘½ä»¤è§£è¯»ï¼š
              docker exec ï¼šè¿›å…¥å®¹å™¨å†…éƒ¨ï¼Œæ‰§è¡Œä¸€ä¸ªå‘½ä»¤
              -it : ç»™å½“å‰è¿›å…¥çš„å®¹å™¨åˆ›å»ºä¸€ä¸ªæ ‡å‡†è¾“å…¥ã€è¾“å‡ºç»ˆç«¯ï¼Œå…è®¸æˆ‘ä»¬ä¸å®¹å™¨äº¤äº’
              mn ï¼šè¦è¿›å…¥çš„å®¹å™¨çš„åç§°
              bashï¼šè¿›å…¥å®¹å™¨åæ‰§è¡Œçš„å‘½ä»¤ï¼Œbashæ˜¯ä¸€ä¸ªlinuxç»ˆç«¯äº¤äº’å‘½ä»¤
    
            ```
    
            æ­¥éª¤äºŒï¼šæŸ¥æ‰¾nginxå¯¹åº”å­˜å‚¨htmlä½ç½®
    
            ```bash
            è¿›å…¥nginxçš„HTMLæ‰€åœ¨ç›®å½• /usr/share/nginx/html
    
            cd /usr/share/nginx/html
    
            ```
    
            æ­¥éª¤ä¸‰ï¼šä¿®æ”¹index.htmlå†…å®¹
    
            > ä¸æ”¯æŒvi, nginxé•œåƒåªä¼šæ‰“åŒ…éœ€è¦çš„æ ‡å‡†å‘½ä»¤
    
            ```bash
            sed -i 's#Welcome to nginx#Nginxæ˜¯æœ€å¿«çš„æœåŠ¡å™¨ï¼#g' index.html
            sed -i 's#<head>#<head><meta charset="utf-8">#g' index.html
            ```
    
            æ€»ç»“ï¼š
    
            ä¿®æ”¹å®¹å™¨å†…æ•°æ®ï¼Œæ¯”è¾ƒç¹ç
    
            éœ€è¦è¿›å…¥åï¼Œä¿®æ”¹
    
            è¿˜ä¼šæœ‰å‘½ä»¤é™åˆ¶
    
        *   å‘½ä»¤æ•°æ®æ“ä½œ
    
            *   ä»‹ç»
    
                æ•°æ®å·ï¼ˆvolumeï¼‰æ˜¯ä¸€ä¸ªè™šæ‹Ÿç›®å½•ï¼ŒæŒ‡å‘å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸­çš„æŸä¸ªç›®å½•ã€‚
    
            *   åŸºæœ¬å‘½ä»¤
    
                ```bash
                æ•°æ®å·æ“ä½œçš„åŸºæœ¬è¯­æ³•å¦‚ä¸‹ï¼š
                docker volume [COMMAND]
                å‘½ä»¤å¦‚ä¸‹ï¼š
    
                create  åˆ›å»ºä¸€ä¸ªvolume
                inspect  æ˜¾ç¤ºä¸€ä¸ªæˆ–å¤šä¸ªvolumeçš„ä¿¡æ¯
                ls    åˆ—å‡ºæ‰€æœ‰çš„volume
                prune    åˆ é™¤æœªä½¿ç”¨çš„volume
                rm    åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªæŒ‡å®šçš„volume
    
                åˆ›å»ºå®¹å™¨ï¼Œå¹¶å…³æ³¨æ•°æ®å·è¯­æ³•
                  docker run \
                  --name mn \
                  -v html:/root/html \
                  -p 8080:80
                  nginx \
                  
                docker run ï¼šå°±æ˜¯åˆ›å»ºå¹¶è¿è¡Œå®¹å™¨
                -- name mn ï¼šç»™å®¹å™¨èµ·ä¸ªåå­—å«mn
                -v html:/root/htm ï¼šæŠŠhtmlæ•°æ®å·æŒ‚è½½åˆ°å®¹å™¨å†…çš„/root/htmlè¿™ä¸ªç›®å½•ä¸­
                -p 8080:80 ï¼šæŠŠå®¿ä¸»æœºçš„8080ç«¯å£æ˜ å°„åˆ°å®¹å™¨å†…çš„80ç«¯å£
                nginx ï¼šé•œåƒåç§°
    
                ```
    
            *   æ•°æ®å·ç»ƒä¹ 
    
                > å®‰è£…nginxå®¹å™¨ï¼Œå¹¶ä¸”å°†htmlæ–‡ä»¶å¤¹å…³è”åˆ°volumeä¸Šï¼
    
                ```bash
                åˆ›å»ºå®¹å™¨å¹¶æŒ‚è½½æ•°æ®å·åˆ°å®¹å™¨å†…çš„HTMLç›®å½•
    
                docker run --name mn -v html:/usr/share/nginx/html -p 80:80 -d nginx
    
                è¿›å…¥htmlæ•°æ®å·æ‰€åœ¨ä½ç½®ï¼Œå¹¶ä¿®æ”¹HTMLå†…å®¹
    
                # æŸ¥çœ‹htmlæ•°æ®å·çš„ä½ç½®
                docker volume inspect html
                # è¿›å…¥è¯¥ç›®å½•
                cd /var/lib/docker/volumes/html/_data
                # ä¿®æ”¹æ–‡ä»¶
                vi index.html
    
                ```
    
    *   docker Composeå®‰è£…
    
        > å®‰è£…docker composeï¼Œä¸ºäº†åæœŸå¿«é€Ÿè¿›è¡Œå¾®æœåŠ¡é›†ç¾¤éƒ¨ç½²ï¼
    
        *   å¯¼å…¥compseæ–‡ä»¶
    
            [docker-compose](file/docker-compose__8Sf3lx7B4)
    
            æ³¨æ„ï¼š å°†æ–‡ä»¶ä¸Šä¼ åˆ° /usr/local/binæ–‡ä»¶å¤¹
    
        *   ä¿®æ”¹è®¿é—®æƒé™
    
            ```bash
            # ä¿®æ”¹æƒé™
            chmod +x /usr/local/bin/docker-compose
            ```
    
        *   ä¸‹è½½è‡ªåŠ¨è¡¥å…¨å‘½ä»¤
    
            ```bash
            echo "199.232.68.133 raw.githubusercontent.com" >> /etc/hosts
    
            # è¡¥å…¨å‘½ä»¤
            curl -L https://raw.githubusercontent.com/docker/compose/1.29.1/contrib/completion/bash/docker-compose > /etc/bash_completion.d/docker-compose
            ```

*   **mysqlå®‰è£…**

    *   mysqlä»‹ç»

    *   é•œåƒæ‹‰å–

        ```bash
        docker pull mysql
        ```

    *   å®¹å™¨è¿è¡Œ

        ```bash
        docker run --name mysql -v /mysql/conf:/etc/mysql/conf.d -e MYSQL_ROOT_PASSWORD=root -d mysql --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci
        ```

    *   è¿æ¥æµ‹è¯•

        ```bash
        docker exec -it å®¹å™¨å bash
    
        mysql -uroot -på¯†ç è¿æ¥å³å¯
        ```

*   **rabbitmqå®‰è£…**

    *   ä»‹ç»

        **RabbitMQ**æ˜¯å®ç°äº†é«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®ï¼ˆAMQPï¼‰çš„å¼€æºæ¶ˆæ¯ä»£ç†è½¯ä»¶ï¼ˆäº¦ç§°é¢å‘æ¶ˆæ¯çš„ä¸­é—´ä»¶ï¼‰ã€‚RabbitMQæœåŠ¡å™¨æ˜¯ç”¨[Erlang](https://baike.baidu.com/item/Erlang?fromModule=lemma_inlink "Erlang")è¯­è¨€ç¼–å†™çš„ï¼Œè€Œé›†ç¾¤å’Œæ•…éšœè½¬ç§»æ˜¯æ„å»ºåœ¨[å¼€æ”¾ç”µä¿¡å¹³å°](https://baike.baidu.com/item/å¼€æ”¾ç”µä¿¡å¹³å°?fromModule=lemma_inlink "å¼€æ”¾ç”µä¿¡å¹³å°")æ¡†æ¶ä¸Šçš„ã€‚æ‰€æœ‰ä¸»è¦çš„[ç¼–ç¨‹è¯­è¨€](https://baike.baidu.com/item/ç¼–ç¨‹è¯­è¨€/9845131?fromModule=lemma_inlink "ç¼–ç¨‹è¯­è¨€")å‡æœ‰ä¸ä»£ç†æ¥å£é€šè®¯çš„[å®¢æˆ·ç«¯](https://baike.baidu.com/item/å®¢æˆ·ç«¯/101081?fromModule=lemma_inlink "å®¢æˆ·ç«¯")åº“ã€‚

    *   å®‰è£…

        å¯¼å…¥é•œåƒå‹ç¼©æ–‡ä»¶

        åŠ è½½é•œåƒ

        ```yaml
        docker load -i mq.tar
        ```

        å¯åŠ¨å®¹å™¨

        ```yaml
        docker run \
         -e RABBITMQ_DEFAULT_USER=root \
         -e RABBITMQ_DEFAULT_PASS=123456 \
         --name mq \
         --hostname mq1 \
         -p 15672:15672 \
         -p 5672:5672 \
         -d \
         rabbitmq:3-management
        ```

    *   åŸºæœ¬ä½¿ç”¨

        å¤–éƒ¨è®¿é—®ï¼š http\://ip:15672    è¾“å…¥è´¦å·å’Œå¯†ç å³å¯

*   **rediså®‰è£…**

    *   redisä»‹ç»

        > Redis æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„key-valueæ•°æ®åº“ã€‚ redisçš„å‡ºç°ï¼Œå¾ˆå¤§ç¨‹åº¦è¡¥å¿äº†MySQLè¿™ç±»key/valueå­˜å‚¨çš„ä¸è¶³ï¼Œåœ¨éƒ¨ åˆ†åœºåˆå¯ä»¥å¯¹å…³ç³»æ•°æ®åº“èµ·åˆ°å¾ˆå¥½çš„è¡¥å……ä½œç”¨ã€‚å®ƒæä¾›äº†Javaï¼ŒC/C++ï¼ŒC#ï¼ŒPHPï¼ŒJavaScriptï¼ŒPerlï¼ŒObject-Cï¼ŒPythonï¼ŒRubyï¼ŒErlangç­‰å®¢æˆ·ç«¯ï¼Œä½¿ç”¨å¾ˆæ–¹ä¾¿

    *   rediså®‰è£…

        *   ä¸‹è½½é•œåƒ

            ```bash
            docker pull redis
            ```

        *   å¯åŠ¨å®¹å™¨

            ```bash
             docker run --name myredis -p 6379:6379 -d redis redis-server --appendonly yes
             # åˆ›å»ºå’Œå¯åŠ¨å®¹å™¨
             redis-server --appendonly yes è®¾ç½®æŒä¹…åŒ–æ‰‹æ®µ
    
            ```

    *   reidsæµ‹è¯•

        ```bash
         docker exec -it myredis redis-cli
         
         set name tom
         get name

        ```

    *   å®‰è£…rediså¯è§†åŒ–å®¢æˆ·ç«¯

        *   ä¸‹è½½å®¢æˆ·ç«¯

        *   è¿æ¥æŸ¥çœ‹

            ![](image/image_JyAgj5xAlY.png)

*   **elasticsearchå®‰è£…**

    *   å¯¼å…¥é•œåƒåˆ°è™šæ‹Ÿæœº

        **kibanaå¤ªå¤§ï¼Œæ— æ³•ä¸Šä¼ ï¼Œåœ¨èµ„æ–™ä¸­ä¸‹è½½å¹¶ä¸Šä¼ ï¼**

    *   &#x20;é…ç½®ç½‘ç»œ

        > es æœç´¢æ•°æ®åº“ã€‘å’Œkibana ã€å¯è§†åŒ–å·¥å…·ã€‘å®¹å™¨äº’è”ï¼

        ```xml
        docker network create es-net
        ```

    *   åŠ è½½é•œåƒ

        ```xml
        # éœ€è¦è¿›å…¥åˆ°å¯¹åº”å­˜å‚¨æ–‡ä»¶çš„ä½ç½®
        # å¯¼å…¥æ•°æ®
        docker load -i es.tar
        docker load -i kibana.tar

        ```

    *   å¯åŠ¨å®¹å™¨

        å•ç‚¹eså®¹å™¨è¿è¡Œ

        ```xml
        docker run -d \
          --name es \
            -e "ES_JAVA_OPTS=-Xms512m -Xmx512m" \
            -e "discovery.type=single-node" \
            -v es-data:/usr/share/elasticsearch/data \
            -v es-plugins:/usr/share/elasticsearch/plugins \
            --privileged \
            --network es-net \
            -p 9200:9200 \
            -p 9300:9300 \
        elasticsearch:7.12.1
        ```

        åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ï¼š[http://ipåœ°å€:9200](http://192.168.150.101:9200 "http://ipåœ°å€:9200") å³å¯çœ‹åˆ°elasticsearchçš„å“åº”ç»“æœï¼

        å•ç‚¹è¿è¡Œkibana! æä¾›æ•°æ®å¯è§†åŒ–ï¼

        ```xml
        docker run -d \
        --name kibana \
        -e ELASTICSEARCH_HOSTS=http://es:9200 \
        --network=es-net \
        -p 5601:5601  \
        kibana:7.12.1
        ```

        æ­¤æ—¶ï¼Œåœ¨æµè§ˆå™¨è¾“å…¥åœ°å€è®¿é—®ï¼š[http://ipåœ°å€:5601](http://192.168.150.101:5601 "http://ipåœ°å€:5601")ï¼Œå³å¯çœ‹åˆ°ç»“æœï¼

        æ‰“å¼€DevToolsï¼Œè¿›è¡Œesåº“æ“ä½œï¼

    *   **é…ç½®ik\[ä¸­æ–‡]åˆ†è¯å™¨**

        ```xml
        docker volume inspect es-plugins
        ç»“æœï¼š
        [
            {
                "CreatedAt": "2022-05-06T10:06:34+08:00",
                "Driver": "local",
                "Labels": null,
                "Mountpoint": "/var/lib/docker/volumes/es-plugins/_data",
                "Name": "es-plugins",
                "Options": null,
                "Scope": "local"
            }
        ]

        å°†ikè§£å‹ï¼Œå¯¼å…¥åˆ°_dataä¸‹

        docker restart es å³å¯ï¼
        ```

    *   è®¿é—®æµ‹

        http\://ip:5601

        ![](image/image_HTlL8iR8_5.png)

        ```java
        POST /_analyze
        {
          "analyzer": "standard",
          "text": "ä»Šå¤©å¤©æ°”å¤ªå¥½äº†ï¼very goodï¼"
        }
        
        //ä½¿ç”¨ikåˆ†è¯å™¨ï¼Œè¿›è¡Œä¸­æ–‡åˆ†è¯ï¼
        
        POST /_analyze
        {
          "analyzer": "ik_smart",
          "text": "ä»Šå¤©å¤©æ°”å¤ªå¥½äº†ï¼very goodï¼"
        }
        
        POST /_analyze
        {
          "analyzer": "ik_max_word",
          "text": "ä»Šå¤©å¤©æ°”å¤ªå¥½äº†ï¼very goodï¼"
        }
        
        ```

### å››ã€é¡¹ç›®å¿«é€Ÿéƒ¨ç½²

*   **å¿«é€Ÿéƒ¨ç½²ç¯å¢ƒç¯å¢ƒ**

    > å¦‚æœç¯å¢ƒä¸ä¼šå®‰è£…ï¼Œè¯·å…ˆå­¦ä¹ ç¯å¢ƒå®‰è£…æ•™ç¨‹

    ```sql
    JDK >= 1.8 (æ¨è1.8ç‰ˆæœ¬) 
    Mysql >= 5.7.25+ (æ¨è8.0.25ç‰ˆæœ¬) 
    Maven >= 3.0+ (æ¨è3.6.3ç‰ˆæœ¬)
    ```

*   **æ•°æ®åº“è„šæœ¬å¯¼å…¥**

    è„šæœ¬æ–‡ä»¶ï¼š

    ```sql
    # å°†æ•°æ®åº“è„šæœ¬å¤åˆ¶åˆ°æŸç›˜ç¬¦ä¸‹ï¼Œæ–¹ä¾¿å¯¼å…¥ï¼
    # æ‰§è¡Œæ•°æ®åº“è„šæœ¬å¯¼å…¥å‘½ä»¤ï¼æ³¨æ„ä¹±ç é—®é¢˜ï¼
    # æ­¥éª¤1:ä½¿ç”¨cmdå‘½ä»¤çª—å£ç™»å½•mysqlï¼Œé˜²æ­¢å¯¼å…¥ä¹±ç é—®é¢˜
    mysql -uè´¦å· -på¯†ç  --default-character-set=utf8  å›è½¦
    # æ­¥éª¤2:å¯¼å…¥æ•°æ®æ–‡ä»¶ æ³¨æ„ï¼Œè¦å†™ä½ è‡ªå·±çš„æ–‡ä»¶åœ°å€
    source d:\store.sql  å›è½¦  
    # æ­¥éª¤3: æŸ¥çœ‹æ•°æ®åº“
    show databases;
    ```

*   **æ³¨å†Œä¸­å¿ƒæ­å»º**

    > æœ¬é¡¹ç›®æ­å»ºå•æœºæ³¨å†Œä¸­å¿ƒï¼Œéé›†ç¾¤æ­å»ºï¼

    *   linuxæ­å»º

        *   å‡†å¤‡ç‰©æ–™

            [jdk8.tar.gz](file/jdk8.tar_I3KRBaPbdj.gz)

            [nacos-server-1.4.4.tar.gz](file/nacos-server-1.4.4.tar_b97rG__a_P.gz)

        *   ä¸Šä¼ åˆ°LinuxæœåŠ¡å™¨

            å°†ä»¥ä¸Šç‰©æ–™ä¸Šä¼ åˆ°æœåŠ¡å™¨çš„ä»»æ„ä½ç½®ï¼

        *   å®‰è£…jdk

            è§£å‹jdkæ–‡ä»¶

            ```bash
            ä¾‹å¦‚ï¼š åœ¨/uer/localä¸‹
            è¿›å…¥æ–‡ä»¶å¤¹
            cd /usr/local
            è§£å‹å³å¯
            tar -xvf æ–‡ä»¶å
            ```

            é‡å‘½å

            ```bash
            mv æ–‡ä»¶å¤¹å java
            ```

            é…ç½®ç¯å¢ƒå˜é‡

            ```bash
            export JAVA_HOME=/usr/local/java
            export PATH=$PATH:$JAVA_HOME/bin
            ```

            é‡å¯é…ç½®å³å¯

            ```bash
            source /etc/profile
            ```

        *   å®‰è£…nacos

            è§£å‹nacosæ–‡ä»¶

            ```bash
            ä¾‹å¦‚ï¼š åœ¨/uer/localä¸‹
            è¿›å…¥æ–‡ä»¶å¤¹
            cd /usr/local
            è§£å‹å³å¯
            tar -xvf æ–‡ä»¶å
            ```

            åˆ é™¤ä¸¤ä¸ªå®‰è£…åŒ…

            ```bash
            rm -rf å®‰è£…åŒ…åç§°
            ```

            è¿›å…¥nacos/bin

            ```bash
            cd /æ–‡ä»¶å¤¹å
            ```

        *   å¯åŠ¨å’Œåœæ­¢

            ```bash
            Linux
            å•æœºæ¨¡å¼å¯åŠ¨
            sh startup.sh -m standalone
            å…³é—­
            sh shutdown.sh
            
            Window
            cmd startup.cmd -m standalone
            å…³é—­
            cmd shutdown.cmd
            
            è®¿é—®åœ°å€ï¼š
            http://ip:8848/nacos
            
            é»˜è®¤ï¼šè´¦å· nacos å¯†ç  nacos


            ```
    
    *   windowæ­å»º
    
        *   æ–‡ä»¶å¤¹è§£å‹
    
            [nacos-server-1.4.4.zip](file/nacos-server-1.4.4_i8mhEnHb9F.zip)
    
        *   å¯åŠ¨å’Œåœæ­¢å³å¯
    
            ```bash
            startup.cmd -m standalone
    
            shutdown.cmd
    
            è®¿é—®åœ°å€æœªæœ¬æœºï¼Œè´¦å·å¯†ç å’ŒLinuxä¸€è‡´ï¼
            ```
    
    *   åŸºäºdockeræ­å»º
    
        *   æ‹‰å–é•œåƒ
    
            ```bash
            docker pull nacos/nacos-server
    
            ```
    
        *   å¯åŠ¨å®¹å™¨
    
            ```bash
            docker run --name nacos-quick -e MODE=standalone -p 8848:8848 -d nacos/nacos-server:latest
            ```
    
        *   è®¿é—®å³å¯
    
            http\://ipåœ°å€ï¼š8848/nacos&#x20;
    
            è¾“å…¥è´¦å·ï¼š nacos å¯†ç  nacos

*   **ç¨‹åºä»£ç å¯¼å…¥**

    *   è§£å‹ä»£ç æ–‡ä»¶

    *   ideaå¯¼å…¥æ–‡ä»¶

        ![](image/image_dIraWkAySr.png)

    *   é€‰ä¸­é¡¹ç›®æ–‡ä»¶

        é€‰ä¸­ä»¥åï¼Œä¸€ç›´next,æœ€åfinishå³å¯

        ![](image/image_27bI3neAhq.png)

    *   mavenä¾èµ–åŠ è½½

        > è¿™æ˜¯å…¶ä»–é¡¹ç›®çš„ç»“æ„å›¾ï¼Œä½†æ˜¯éƒ½æ˜¯ä¸€æ ·çš„ï¼ç­‰åŠ è½½å®Œæ¯•ï¼åˆ«ç€æ€¥ï¼å‰æœŸä¼šä¸‹å¾ˆå¤šä¸œè¥¿ï¼

        ![](https://docimg4.docs.qq.com/image/RCaPNXgujtRRufLvlWJckQ.png?w=1280\&h=766.0083782166367)

    *   ç¼–è¯‘mavenå·¥ç¨‹

        ç­‰å¾…æ­¥éª¤1ï¼Œæ‰§è¡Œå®Œæ¯•ä»¥åæ‰§è¡Œæ­¥éª¤2

        ![](image/image_4ytMQIhdYO.png)

*   **é¡¹ç›®ä»£ç ç»“æ„**

    ```java
    b2c-cloud-store
      â”œâ”€â”€store-admin  //åå°ç®¡ç†æœåŠ¡ 
      â”œâ”€â”€store-common-feign //é€šç”¨å·¥å…·æ¨¡å—
      â”œâ”€â”€store-front-carousel //è½®æ’­å›¾æœåŠ¡
      â”œâ”€â”€store-front-cart //è´­ç‰©è½¦æœåŠ¡
      â”œâ”€â”€store-front-category //ç±»åˆ«æœåŠ¡
      â”œâ”€â”€store-front-collect //æ”¶è—æœåŠ¡
      â”œâ”€â”€store-front-order //è®¢å•æœåŠ¡
      â”œâ”€â”€store-front-product //å•†å“æœåŠ¡
      â”œâ”€â”€store-front-user //å‰å°ç”¨æˆ·æœåŠ¡
      â”œâ”€â”€store-gateway //ç½‘å…³æœåŠ¡
      â”œâ”€â”€store-search //æœç´¢æœåŠ¡
      â”œâ”€â”€store-static-oss //é™æ€èµ„æºæœåŠ¡    
    â”œâ”€â”€pom.xml //mavenä¾èµ–é…ç½®æ–‡ä»¶ä½ç½®
    â”œâ”€â”€target  //mavenæ„å»ºåäº§ç”Ÿæ–‡ä»¶

    ```

*   **é¡¹ç›®é…ç½®ä¿®æ”¹**

    *   ä¿®æ”¹æ•°æ®åº“è¿æ¥ä¿¡æ¯&#x20;

        æ³¨æ„ï¼šè¦ä¿®æ”¹æ•°æ®åº“åç§°ï¼Œæ”¹ä¸ºå¯¹åº”çš„åº“

        &#x20;url: jdbc:mysql://127.0.0.1:3306/store\_admin?useSSL=false\&useUnicode=true\&characterEncoding=UTF-8

        ä¾‹å¦‚ï¼šcarouselæœåŠ¡ store\_carousel | productæœåŠ¡ store\_product

        ![](image/image_oW9ulg18MB.png)

    *   rabbitMQé…ç½®æ”¹æˆä½ çš„åœ°å€

        ç«¯å£å·å’Œvirtual-hostä¸éœ€è¦ä¿®æ”¹

        ![](image/image_eTto4ursBj.png)

    *   cacheç¼“å­˜ä¸­redisçš„åœ°å€

        ![](image/image_kNsSXOztZK.png)

    *   nacosæ³¨å†Œä¸­å¿ƒåœ°å€ä¿®æ”¹

        æ³¨æ„ï¼šæ¯ä¸ªæœåŠ¡çš„é…ç½®éƒ½éœ€è¦ä¿®æ”¹ï¼Œåˆ«è½ä¸‹ï¼

        ![](image/image_7MDLN05qWv.png)

*   **é¡¹ç›®å¯åŠ¨å’Œè®¿é—®**

    *   åå°é¡¹ç›®å¯åŠ¨

        ```xml
          â”œâ”€â”€store-admin  //åå°ç®¡ç†æœåŠ¡ 
          â”œâ”€â”€store-front-carousel //è½®æ’­å›¾æœåŠ¡
          â”œâ”€â”€store-front-cart //è´­ç‰©è½¦æœåŠ¡
          â”œâ”€â”€store-front-category //ç±»åˆ«æœåŠ¡
          â”œâ”€â”€store-front-collect //æ”¶è—æœåŠ¡
          â”œâ”€â”€store-front-order //è®¢å•æœåŠ¡
          â”œâ”€â”€store-front-product //å•†å“æœåŠ¡
          â”œâ”€â”€store-front-user //å‰å°ç”¨æˆ·æœåŠ¡
          â”œâ”€â”€store-gateway //ç½‘å…³æœåŠ¡
          â”œâ”€â”€store-search //æœç´¢æœåŠ¡
          â”œâ”€â”€store-static-oss //é™æ€èµ„æºæœåŠ¡ 
          
          æŒ‰ç…§ä¸Šé¢é¡ºåºå³å¯ï¼Œã€ä¾æ¬¡æ‰“å¼€æœåŠ¡ä¸‹ã€‘java/æ ¹åŒ…/XxxApplication
          æ‰§è¡Œmainæ–¹æ³•å³å¯ï¼
          
          æ³¨æ„ï¼šstore-search ä¸èƒ½æ—©äºgatewayå’ŒproductæœåŠ¡
        ```

        ![](image/image_R4PF4HjdQX.png)

    *   å•†åŸåå°è®¿é—®åœ°å€

        http\://localhost:3000/admin

        è´¦å·ï¼šadmin123 å¯†ç ï¼šadmin123

*   **å‡†å¤‡å‰ç«¯é¡¹ç›®ç¯å¢ƒ**

    *   ä»‹ç»

        æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯å‰åç«¯åˆ†ç¦»é¡¹ç›®ï¼Œå‰ç«¯ç‹¬ç«‹è¿è¡Œçš„ç¨‹åºï¼

        éœ€è¦å®‰è£…nodeï¼Œå¯åŠ¨å‰ç«¯ä»£ç ï¼

    *   å®‰è£…node

        [http://nodejs.cn/download/](http://nodejs.cn/download/ "http://nodejs.cn/download/")  å®˜æ–¹ä¸‹è½½åœ°å€

        macç”µè„‘è‡ªè¡Œä¸‹è½½ï¼

        æ³¨æ„ï¼šå°½é‡é€‰æ‹©æ­¤ç‰ˆæœ¬ï¼Œå·²æµ‹è¯•node 18 ç‰ˆæœ¬ä¸å…¼å®¹ï¼

        æ³¨æ„ï¼šå¦‚æœä¹‹å‰è¯¯åˆ è¿‡ç³»ç»Ÿpathç¯å¢ƒå˜é‡ï¼Œéœ€è¦è¡¥å…¨ï¼Œå¦åˆ™æ— æ³•å¯åŠ¨ï¼

        **åŒå‡»å®‰è£…å³å¯**

        å®‰è£…æˆåŠŸä»¥åï¼šå¯ä»¥ä½¿ç”¨ cmd **node -v** æµ‹è¯•ï¼

        ä»¥ä¸‹ä»£è¡¨æˆåŠŸï¼ å¦‚æœå‡ºç°ä¸æ˜¯å†…éƒ¨æˆ–è€…å¤–éƒ¨å‘½ä»¤ï¼Œå°†nodeå®‰è£…åœ°å€é…ç½®é…ç½®åˆ°ç¯å¢ƒå˜é‡pathä¸­ï¼

        ![](image/image_azrsw7f3X5.png)

    *   ä¸‹è½½ä¾èµ–åŒ…

        æ‰“å¼€cmdé»‘çª—å£ï¼š win+r æˆ–è€… ğŸ”  cmd&#x20;

        ```xml
        #å®‰è£…vue-cli å…¨å±€å®‰è£…
        npm install vue-cli -g
        #å®‰è£…webpack å…¨å±€å®‰è£…
        npm install webpack -g

        # å› ä¸ºæ²¡æœ‰é…ç½®å›½å†…é•œåƒï¼Œå®‰è£…ä¼šæ…¢ä¸€ç‚¹ï¼Œè€å¿ƒç­‰å¾…ï¼
        # å¦‚æœå®‰è£…å¤±è´¥ï¼Œ ctrl+c é‡æ–°å®‰è£…å³å¯
        ```

    *   ä¿®æ”¹è¿æ¥åå°åœ°å€

        [vue-store-master.zip](file/vue-store-master_UZkq2aPlFL.zip)

        ä¸‹è½½å‰ç«¯ç¨‹åºï¼ŒğŸ‘†å‹ç¼©åŒ…ï¼Œä¸‹è½½å®Œä»¥åéšä¾¿è§£å‹å³å¯ï¼

        å‰ç«¯é¡¹ç›® `vue-store-master\src\global.js`  || `vue-store-master\vue.config.js` æ–‡ä»¶ä¸ºæ›´æ”¹è®¿é—®çš„åç«¯æœåŠ¡å™¨åœ°å€æ–‡ä»¶, å†…å®¹å¦‚ä¸‹:

        å¦‚æœæœ¬åœ°éƒ¨ç½²åå°ç¨‹åºï¼Œä¸ç”¨ä¿®æ”¹ï¼é»˜è®¤å°±æ˜¯æœ¬åœ°ï¼ç«¯å£å·3000ï¼

        ```xml
        module.exports = {
          publicPath: './',
          devServer: {
            open: true,
            proxy: {
              '/api': {
                // æ”¹ä¸ºè‡ªå·±çš„æœåŠ¡å™¨åœ°å€å³å¯ï¼
                target: 'http://localhost:3000/', // æœ¬åœ°åç«¯åœ°å€
                //target: 'http://106.15.179.105:3000/', // çº¿ä¸Šåç«¯åœ°å€
                changeOrigin: true, //å…è®¸è·¨åŸŸ
                pathRewrite: {
                  '^/api': ''
                }
              }
            }
          }
        }
        ```

    *   ç¼–è¯‘å’Œè¿è¡Œ

        ![](image/image_ULy_o4ZPx7.png)

        ```xml
        # æ³¨æ„ æ³¨æ„ æ³¨æ„ å¿…é¡»åˆ°å‰ç«¯æ ¹è·¯å¾„ä¸‹æ‰§è¡Œï¼
        # åœ¨çº¿å®‰è£…å‰ç«¯é¡¹ç›®è¿è¡Œæ‰€éœ€ä¾èµ–åŒ…
        # ç¼–è¯‘å‘½ä»¤åªéœ€è¦è¾“å…¥ä¸€æ¬¡å³å¯ï¼
        npm install

        # è¿è¡Œå‘½ä»¤æ¯æ¬¡éƒ½éœ€è¦æ‰“å¼€å‰ç«¯ç¨‹åºéƒ½éœ€è¦ï¼åˆ«å¿˜äº†ï¼
        # è¿è¡Œå‰ç«¯é¡¹ç›®å‘½ä»¤, æ‰§è¡Œè¿™ä¸ªå‘½ä»¤å¿…é¡»åœ¨admin-uiæ–‡ä»¶å¤¹å†…æ‰§è¡Œ.
        npm run serve
        ```

    *   è®¿é—®æµ‹è¯•

        *   å•†åŸå‰ç«¯è®¿é—®åœ°å€

            http\://localhost:8080 &#x20;

### äº”ã€é¡¹ç›®åŸºç¡€æ­å»º

*   **å·¥ç¨‹æ­å»º**

    *   åˆ›å»ºçˆ¶å·¥ç¨‹

        b2c-cloud-store

    *   å¯¼å…¥ä¾èµ–é…ç½®

        ```xml
        <?xml version="1.0" encoding="UTF-8"?>
        <project xmlns="http://maven.apache.org/POM/4.0.0"
                 xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                 xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
            <modelVersion>4.0.0</modelVersion>
        
            <groupId>com.atguigu</groupId>
            <artifactId>b2c_cloud_store</artifactId>
            <version>1.0.0</version>
            <packaging>pom</packaging>


            <parent>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-starter-parent</artifactId>
                <version>2.3.9.RELEASE</version>
                <relativePath/>
            </parent>
    
            <properties>
                <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
                <project.reporting.outputEncoding>UTF-8</project.reporting.outputEncoding>
                <java.version>1.8</java.version>
                <spring-cloud.version>Hoxton.SR10</spring-cloud.version>
                <mysql.version>5.1.47</mysql.version>
                <mybatis.version>2.1.1</mybatis.version>
                <druid.version>1.2.5</druid.version>
                <mybatis-plus.version>3.5.2</mybatis-plus.version>
    
            </properties>


            <!-- spring cloud å’Œ spring cloud alibaba å’Œ mybatis ç›¸å…³ä¾èµ–ç®¡ç†-->
            <dependencyManagement>
    
                <dependencies>
                    <!-- springCloud -->
                    <dependency>
                        <groupId>org.springframework.cloud</groupId>
                        <artifactId>spring-cloud-dependencies</artifactId>
                        <version>${spring-cloud.version}</version>
                        <type>pom</type>
                        <scope>import</scope>
                    </dependency>
                    <!--nacosçš„ç®¡ç†ä¾èµ–-->
                    <dependency>
                        <groupId>com.alibaba.cloud</groupId>
                        <artifactId>spring-cloud-alibaba-dependencies</artifactId>
                        <version>2.2.5.RELEASE</version>
                        <type>pom</type>
                        <scope>import</scope>
                    </dependency>
                    <!-- mysqlé©±åŠ¨ -->
                    <dependency>
                        <groupId>mysql</groupId>
                        <artifactId>mysql-connector-java</artifactId>
                        <version>${mysql.version}</version>
                    </dependency>
                    <!--mybatis-->
                    <dependency>
                        <groupId>org.mybatis.spring.boot</groupId>
                        <artifactId>mybatis-spring-boot-starter</artifactId>
                        <version>${mybatis.version}</version>
                    </dependency>
    
                    <dependency>
                        <groupId>com.baomidou</groupId>
                        <artifactId>mybatis-plus-boot-starter</artifactId>
                        <version>${mybatis-plus.version}</version>
                    </dependency>
    
                    <dependency>
                        <groupId>com.alibaba</groupId>
                        <artifactId>druid-spring-boot-starter</artifactId>
                        <version>${druid.version}</version>
                    </dependency>
    
                </dependencies>
    
            </dependencyManagement>


            <!-- åç»­å­è«å¤¸å¯èƒ½éœ€è¦çš„ä¾èµ– -->
        <!--    <dependency>-->
        <!--        <groupId>org.springframework.boot</groupId>-->
        <!--        <artifactId>spring-boot-starter-web</artifactId>-->
        <!--    </dependency>-->
    
            <!-- nacos æ³¨å†Œä¸­å¿ƒå®¢æˆ·ç«¯ä¾èµ–åŒ… -->
        <!--    <dependency>-->
        <!--        <groupId>com.alibaba.cloud</groupId>-->
        <!--        <artifactId>spring-cloud-starter-alibaba-nacos-discovery</artifactId>-->
        <!--    </dependency>-->
        <!--    &lt;!&ndash;nacos é…ç½®ä¸­å¿ƒé…ç½®ç®¡ç†ä¾èµ–&ndash;&gt;-->
        <!--    <dependency>-->
        <!--        <groupId>com.alibaba.cloud</groupId>-->
        <!--        <artifactId>spring-cloud-starter-alibaba-nacos-config</artifactId>-->
        <!--    </dependency>-->
             <!-- feignä¾èµ– -->
        <!--    <dependency>-->
        <!--        <groupId>org.springframework.cloud</groupId>-->
        <!--        <artifactId>spring-cloud-starter-openfeign</artifactId>-->
        <!--    </dependency>-->
    
              <!-- feignç›¸å…³ä¾èµ– -->
        <!--    <dependency>-->
        <!--        <groupId>io.github.openfeign</groupId>-->
        <!--        <artifactId>feign-httpclient</artifactId>-->
        <!--    </dependency>-->
    
            <!--ç½‘å…³gatewayä¾èµ–-->
        <!--    <dependency>-->
        <!--        <groupId>org.springframework.cloud</groupId>-->
        <!--        <artifactId>spring-cloud-starter-gateway</artifactId>-->
        <!--    </dependency>-->


            <!-- lomboké€šç”¨ä¾èµ–å¼•å…¥ -->
            <dependencies>
                <dependency>
                    <groupId>org.projectlombok</groupId>
                    <artifactId>lombok</artifactId>
                </dependency>
            </dependencies>
    
        </project>
    
        ```
    
    *   **å‘½åå’Œä½¿ç”¨è§„èŒƒ**
    
        *   ä¸‰å±‚æ¶æ„å‘½åè§„èŒƒ
    
            1.  æ§åˆ¶å±‚  æœåŠ¡ç®€ç§°Controller
    
            2.  ä¸šåŠ¡å±‚  æœåŠ¡ç®€ç§° Service | æœåŠ¡ç®€ç§°ServiceImpl
    
            3.  æ˜ å°„å±‚  æœåŠ¡ç®€ç§° Mapper
    
        *   æœåŠ¡åç§°å‘½åè§„èŒƒ
    
            1.  å‰å°ç¨‹åº  store-front-åŠŸèƒ½å
    
            2.  åå°ç¨‹åº  store-admin
    
            3.  é€šç”¨ç¨‹åº  store-è‡ªå®šä¹‰
    
            4.  æœåŠ¡åç§°  æ¨¡å—å-service

*   **ç½‘å…³æœåŠ¡æ­å»º**

    *   åˆ›å»ºæ¨¡å—

        store-gateway

    *   å¯¼å…¥ä¾èµ–

        ```xml

        <dependencies>
        <!--        ç½‘å…³gatewayä¾èµ–-->
            <dependency>
                <groupId>org.springframework.cloud</groupId>
                <artifactId>spring-cloud-starter-gateway</artifactId>
            </dependency>
        <!--         nacos æ³¨å†Œä¸­å¿ƒå®¢æˆ·ç«¯ä¾èµ–åŒ…-->
            <dependency>
                <groupId>com.alibaba.cloud</groupId>
                <artifactId>spring-cloud-starter-alibaba-nacos-discovery</artifactId>
            </dependency>
            <!--nacos é…ç½®ä¸­å¿ƒé…ç½®ç®¡ç†ä¾èµ–-->
            <dependency>
                <groupId>com.alibaba.cloud</groupId>
                <artifactId>spring-cloud-starter-alibaba-nacos-config</artifactId>
            </dependency>
        </dependencies>
        ```

    *   æ·»åŠ é…ç½®

        *   bootstrap.yml

            ```bash
            server:
              port: 3000 # å‰ç«¯é»˜è®¤è®¿é—®ç«¯å£å·ä¸º3000
              servlet:
                context-path: / # å‰ç«¯é»˜è®¤è®¿é—®çš„æ ¹è·¯å¾„
            spring:
              application:
                name: gateway-service  # ç¨‹åºåå°±æ˜¯æœåŠ¡å
              cloud:
                nacos:
                  # å¦‚æœæ³¨å†Œä¸­å¿ƒä¸åœ¨æœ¬æœº,éœ€è¦ç§»åˆ°æœ¬ä½ç½®,å¦åˆ™ä¸€è‡´æŸ¥æ‰¾æœ¬åœ°:8848ç«¯å£!
                  server-addr: 124.221.70.206:8848 #æ³¨å†Œä¸­å¿ƒ
            ```

        *   application.yml

            ```bash
            # é…ç½®ç½‘å…³
            spring:
              cloud:
                gateway:
                  routes:
                    - id: user-service
                      uri: lb://user-service
                      predicates:
                        - Path=/user/**  # è®¿é—®userè·¯å¾„è½¬å‘ç”¨æˆ·æœåŠ¡
                    - id: product-service # æ­¤åç§°éšæ„å®šä¹‰
                      uri: lb://product-service #ä½¿ç”¨è´Ÿè½½å‡è¡¡,è°ƒç”¨æœåŠ¡å,è¿™æ˜¯æœåŠ¡å
                      predicates:
                        - Path=/product/** # è®¿é—®productç›¸å…³,è½¬å‘åˆ°productæœåŠ¡
            ```

    *   åˆ›å»ºå¯åŠ¨ç±»

        åŒ…ï¼šcom.atguigu.gateway

        ```bash
        package com.atguigu.gateway;
        
        import org.springframework.boot.SpringApplication;
        import org.springframework.boot.autoconfigure.SpringBootApplication;
        
        /**
         * projectName: b2c_cloud_store
         *
         * @author: èµµä¼Ÿé£
         * description: å¯åŠ¨ç±»
         */
        @SpringBootApplication
        public class GatewayApplication {
        
            public static void main(String[] args) {
                SpringApplication.run(GatewayApplication.class,args);
            }
        
        }
        
        ```

### å…­ã€å•†åŸå‰ç«¯æœåŠ¡å¼€å‘

*   **é€šç”¨æœåŠ¡**

    *   ä»‹ç»

        > åˆ›å»ºä¸€ä¸ªé€šç”¨æœåŠ¡ï¼Œç”¨äºå­˜æ”¾pojoï¼Œvo,param,utils,feignçš„æ¥å£ï¼Œä»¥åŠé€šç”¨é…ç½®ç±»å’Œé…ç½®æ–‡ä»¶ï¼ä¸»è¦æ˜¯é¿å…é‡å¤å£°æ˜å’Œäº’ç›¸ä¾èµ–ï¼ä½†æ˜¯å¯èƒ½ä¼šé€ æˆå°‘é‡çš„å†—ä½™ï¼

        ![](image/image_QSzm9sSfDV.png)

    *   åˆ›å»ºæ¨¡å—

        æ¨¡å—åç§°ï¼š store-commons

    *   å¯¼å…¥ä¾èµ–

        ```xml
         <dependencies>
            <!-- feignä¾èµ– -->
            <dependency>
                <groupId>org.springframework.cloud</groupId>
                <artifactId>spring-cloud-starter-openfeign</artifactId>
            </dependency>

            <dependency>
                <groupId>com.baomidou</groupId>
                <artifactId>mybatis-plus-boot-starter</artifactId>
            </dependency>

            <!-- https://mvnrepository.com/artifact/com.fasterxml.jackson.core/jackson-databind -->
            <dependency>
                <groupId>com.fasterxml.jackson.core</groupId>
                <artifactId>jackson-databind</artifactId>
            </dependency>

            <!-- ç¼“å­˜ä¾èµ– -->
            <!--spring-cache-->
            <dependency>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-starter-cache</artifactId>
            </dependency>
            <dependency>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-starter-data-redis</artifactId>
            </dependency>
            <!-- redisè¿æ¥æ± -->
            <dependency>
                <groupId>redis.clients</groupId>
                <artifactId>jedis</artifactId>
            </dependency>

            <dependency>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-starter-web</artifactId>
            </dependency>

            <!--AMQPä¾èµ–ï¼ŒåŒ…å«RabbitMQ-->
            <dependency>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-starter-amqp</artifactId>
            </dependency>
            
            <!-- https://mvnrepository.com/artifact/org.hibernate.validator/hibernate-validator -->
            <dependency>
                <groupId>org.hibernate.validator</groupId>
                <artifactId>hibernate-validator</artifactId>
                <version>6.2.0.Final</version>
            </dependency>
            <!-- https://mvnrepository.com/artifact/org.hibernate.validator/hibernate-validator-annotation-processor -->
            <dependency>
                <groupId>org.hibernate.validator</groupId>
                <artifactId>hibernate-validator-annotation-processor</artifactId>
                <version>6.2.0.Final</version>
            </dependency>
        </dependencies>
        ```

    *   å‡†å¤‡åŒ…ç»“æ„

        ![](image/image_7f4y1cftuQ.png)

    *   å¯¼å…¥å·¥å…·ç±»

        [MD5Util.java](file/MD5Util_GbunFuRj4r.java)

        [R.java](file/R_uFpJyZqxjJ.java)

        ä¸‹è½½ä»¥ä¸Šä¸¤ä¸ªå·¥å…·ç±»ï¼Œå¯¼å…¥åˆ°utilsåŒ…ä¸‹ï¼

    *   éƒ¨ç½²mavenæœ¬åœ°ä»“åº“

        ![](image/image_7lJIlki_6o.png)

*   **ç”¨æˆ·æœåŠ¡**

    *   **ä»‹ç»**

        > å•†åŸç”¨æˆ·æ¨¡å—ï¼ ä¸»è¦æ¶‰åŠç”¨æˆ·ç™»å½•ï¼Œæ³¨å†Œå’Œè´¦å·æ£€æŸ¥åŠŸèƒ½ï¼åŒ…å«ç”¨æˆ·åœ°å€ç®¡ç†åŠŸèƒ½å®ç°ï¼

    *   **æœåŠ¡æ­å»º**

        *   å¯¼å…¥æ•°æ®åº“

            ```sql
            # å°†æ•°æ®åº“è„šæœ¬å¤åˆ¶åˆ°æŸç›˜ç¬¦ä¸‹ï¼Œæ–¹ä¾¿å¯¼å…¥ï¼
            # æ‰§è¡Œæ•°æ®åº“è„šæœ¬å¯¼å…¥å‘½ä»¤ï¼æ³¨æ„ä¹±ç é—®é¢˜ï¼
            # æ­¥éª¤1:ä½¿ç”¨cmdå‘½ä»¤çª—å£ç™»å½•mysqlï¼Œé˜²æ­¢å¯¼å…¥ä¹±ç é—®é¢˜
            mysql -uè´¦å· -på¯†ç  --default-character-set=utf8  å›è½¦
            # æ­¥éª¤2:å¯¼å…¥æ•°æ®æ–‡ä»¶ æ³¨æ„ï¼Œè¦å†™ä½ è‡ªå·±çš„æ–‡ä»¶åœ°å€
            source d:\store_user.sql  å›è½¦  
            # æ­¥éª¤3: æŸ¥çœ‹æ•°æ®åº“
            show databases;
            ```

        *   åˆ›å»ºæœåŠ¡

            æ¨¡å—åï¼š store-front-user

        *   å¯¼å…¥ä¾èµ–

            ```xml
            <dependencies>
              <dependency>
                  <groupId>org.springframework.boot</groupId>
                  <artifactId>spring-boot-starter-web</artifactId>
              </dependency>
              <dependency>
                  <groupId>mysql</groupId>
                  <artifactId>mysql-connector-java</artifactId>
              </dependency>
              <!--mybatis-->
              <dependency>
                  <groupId>org.mybatis.spring.boot</groupId>
                  <artifactId>mybatis-spring-boot-starter</artifactId>
              </dependency>
              <!-- nacoså®¢æˆ·ç«¯ä¾èµ–åŒ… -->
              <dependency>
                  <groupId>com.alibaba.cloud</groupId>
                  <artifactId>spring-cloud-starter-alibaba-nacos-discovery</artifactId>
              </dependency>
              <!--feignå®¢æˆ·ç«¯ä¾èµ–-->
              <dependency>
                  <groupId>org.springframework.cloud</groupId>
                  <artifactId>spring-cloud-starter-openfeign</artifactId>
              </dependency>
              <!--å¼•å…¥HttpClientä¾èµ–-->
              <dependency>
                  <groupId>io.github.openfeign</groupId>
                  <artifactId>feign-httpclient</artifactId>
              </dependency>

              <dependency>
                  <groupId>com.alibaba</groupId>
                  <artifactId>druid-spring-boot-starter</artifactId>
              </dependency>

              <!-- æ­¤å¤„æ˜¯ä½ çš„store_commonæ¨¡å—çš„gav,å¦‚æœä¸ä¸€è‡´,éœ€è¦æ”¹è¿›,æ³¨æ„,éœ€è¦æ”¾å…¥mavenæœ¬åœ°åº“!-->
              <dependency>
                  <artifactId>store-commons</artifactId>
                  <groupId>com.atguigu</groupId>
                  <version>1.0.0</version>
              </dependency>
              
            </dependencies>
            ```

        *   å£°æ˜é…ç½®

            *   bootstrap.yml

                ```yaml
                spring:
                  application:
                    name: user-service
                  cloud:
                    nacos:
                      server-addr: 124.221.70.206:8848
                server:
                  port: 3001
                ```

            *   application.yml

                ```yaml
                spring:
                  # è¿æ¥æ± é…ç½®
                  datasource:
                    url: jdbc:mysql://localhost:3306/store_user?useSSL=false&useUnicode=true&characterEncoding=UTF-8
                    username: root
                    password: 123456
                    driver-class-name: com.mysql.jdbc.Driver
                    type: com.alibaba.druid.pool.DruidDataSource
                mybatis-plus:
                  mapper-locations: classpath:mappers/*.xml
                  configuration:
                    map-underscore-to-camel-case: true
                    auto-mapping-behavior: full
                    lazy-loading-enabled: true
                    aggressive-lazy-loading: false
                  type-aliases-package: com.atguigu.pojo #è®¾ç½®åˆ«å
                ribbon:
                  eager-load:
                    enabled: true #å¼€å¯é¥¥é¥¿åŠ è½½æå‡ç¬¬ä¸€æ¬¡è®¿é—®é€Ÿåº¦
                    clients:
                      - user-service #æŒ‡å®šå¼€å¯æœåŠ¡
                feign:
                  httpclient:
                    enabled: true  # å¼€å¯httpClientå¼€å…³,å¯åŠ¨è¿æ¥æ± ,æå‡feignè¿æ¥æ•ˆç‡!
                    max-connections: 200  #æœ€å¤§è¿æ¥æ•°é‡
                    max-connections-per-route: 50  #å•è·¯å¾„æœ€å¤§è¿æ¥æ•°
    
                ```

        *   åˆ›å»ºå¯åŠ¨ç±»

            ```java
            import org.springframework.cloud.openfeign.EnableFeignClients;
    
            /**
             * projectName: b2c_cloud_store
             *
             * description: å¯åŠ¨ç±»
             */
            @MapperScan(basePackages = "com.atguigu.user.mapper")
            @SpringBootApplication
            public class FrontUserApplication {
    
                public static void main(String[] args) {
                    SpringApplication.run(FrontUserApplication.class,args);
                }
    
            }
    
            ```

    *   **åŠŸèƒ½å®ç°**

        *   è´¦å·æ£€æŸ¥æ¥å£

            1.  æ¥å£åˆ†æ

                è¯·æ±‚URLï¼š/user/check

                è¯·æ±‚æ–¹å¼ï¼šPOST

                è¯·æ±‚ç±»å‹:  JSON

                å‚æ•°è¯´æ˜ï¼š

                {userName:"è¦æ£€æŸ¥çš„è´¦å·"}

                | å‚æ•°       | æ˜¯å¦å¿…é€‰ | ç±»å‹     | è¯´æ˜  |
                | -------- | ---- | ------ | --- |
                | userName | æ˜¯    | string | ç”¨æˆ·å |

                è¿”å›ç»“æœï¼š

                ```json
                # åˆ†æè¿”å›ç»“æœï¼Œå¦‚ä½•æ ¹æ®æ•°æ®åº“æŸ¥è¯¢ï¼Œè¿”å›å¯¹åº”çš„ç»“æœï¼ 
                {
                  "code": "001", //001å°±æ˜¯æˆåŠŸ å¯ç”¨çš„å«ä¹‰   004è´¦å·ä¸å¯ç”¨
                  //004æ˜¯é”™è¯¯ç 
                  "msg": "ç”¨æˆ·åä¸å­˜åœ¨ï¼Œå¯ä»¥æ³¨å†Œ"   //è¿”å›çš„æç¤ºè¯­  å›ºå®šçš„æ ¼å¼ï¼ åå°å’Œå‰ç«¯çº¦å®šçš„æ ¼å¼ï¼
                }
                ```

            2.  åŠŸèƒ½åˆ†æ

                1.  æ£€æŸ¥è´¦å·æ˜¯å¦ä¸ºnullï¼Œå¦‚æœä¸ºnullï¼Œç›´æ¥è¿”å›å¤±è´¥ï¼

                2.  ä¸ä¸ºnullï¼Œè¿›è¡Œæ•°æ®åº“æŸ¥è¯¢æ˜¯å¦å­˜åœ¨

                3.  å­˜åœ¨ï¼Œè¿”å›è´¦å·ä¸å¯ç”¨

                4.  ä¸å­˜åœ¨ï¼Œè¿”å›è´¦å·å¯ç”¨å³å¯

            3.  åŠŸèƒ½å®ç°

                1.  ç”¨æˆ·å®ä½“ç±» \[é€šç”¨æ¨¡å—]

                    ```java
                    @Data
                    @TableName("user")
                    public class User implements Serializable {

                        public static final Long serialVersionUID = 1L;

                        @JsonProperty("user_id") //jacksonçš„æ³¨è§£,ç”¨äºè¿›è¡Œå±æ€§æ ¼å¼åŒ–!
                        @TableId(type =  IdType.AUTO)
                        private Integer userId;

                        @Length(min = 6)
                        private String userName;
                          //å¿½ç•¥å±æ€§ ä¸ç”Ÿæˆjson ä¸æ¥å—jsonæ•°æ®  @JsonIgnore
                          // @JsonInclude(JsonInclude.Include.NON_NULL)  + null å½“è¿™ä¸ªå€¼ä¸ä¸ºnullçš„æ—¶å€™ç”Ÿæˆjson,ä¸ºnullä¸ç”Ÿæˆ
                          // ä¸å½±å“æ¥æ”¶json
                        @JsonInclude(JsonInclude.Include.NON_NULL)
                        @NotBlank
                        private String password;

                        @JsonInclude(JsonInclude.Include.NON_NULL)
                        @NotBlank
                        private String userPhonenumber;
                    }

                    ```

                2.  æ¥æ”¶å‚æ•°Param \[é€šç”¨æ¨¡å—]

                    ```java
                    /**
                     * projectName: b2c-store
                     * <p>
                     * description: æ¥æ”¶å‰ç«¯å‚æ•°çš„param
                     * TODO: è¦ä½¿ç”¨jsr 303çš„æ³¨è§£ è¿›è¡Œå‚æ•°æ ¡éªŒ!
                     * @NotBlank å­—ç¬¦ä¸² ä¸èƒ½ä¸ºnull å’Œ ç©ºå­—ç¬¦ä¸² ""
                     * @NotNull  å­—ç¬¦ä¸² ä¸èƒ½ä¸ºnull
                     * @NotEmpty é›†åˆç±»å‹ é›†åˆé•¿åº¦ä¸èƒ½ä¸º0
                     */
                    @Data
                    public class UserCheckParam {

                        @NotBlank
                        private String userName; //æ³¨æ„: å‚æ•°åç§°è¦ç­‰äºå‰ç«¯ä¼ é€’çš„JSON keyçš„åç§°!
                    }

                    ```

                3.  controller

                    ```java
                     /**
                       * æ£€æŸ¥è´¦å·æ˜¯å¦å¯ç”¨çš„æ¥å£
                       * @param userCheckParam æ¥æ”¶æ£€æŸ¥çš„è´¦å·å®ä½“ å†…éƒ¨æœ‰å‚æ•°æ ¡éªŒæ³¨è§£
                       * @param result è·å–æ ¡éªŒç»“æœçš„å®ä½“å¯¹è±¡
                       * @return è¿”å›å°è£…ç»“æœRå¯¹è±¡å³å¯
                       */
                      @PostMapping("check")
                      public R check(@RequestBody @Validated UserCheckParam userCheckParam, BindingResult result){

                          //æ£€æŸ¥æ˜¯å¦ç¬¦åˆæ£€éªŒæ³¨è§£çš„è§„åˆ™  ç¬¦åˆ false  ä¸ç¬¦åˆ true
                          boolean b = result.hasErrors();

                          if (b){
                              return R.fail("è´¦å·ä¸ºnull,ä¸å¯ä½¿ç”¨!");
                          }

                          return userservice.check(userCheckParam);
                      }

                    ```

                4.  service

                    ```java
                    /**
                     * æ£€æŸ¥è´¦å·æ˜¯å¦å¯ç”¨ä¸šåŠ¡
                     *
                     * @param userCheckParam è´¦å·å‚æ•° å·²ç»æ ¡éªŒå®Œæ¯•
                     * @return æ£€æŸ¥ç»“æœ 001  004
                     */
                    @Override
                    public R check(UserCheckParam userCheckParam) {

                        //å‚æ•°å°è£…
                        QueryWrapper<User> queryWrapper = new QueryWrapper<>();
                        queryWrapper.eq("user_name",userCheckParam.getUserName());
                        //æ•°æ®åº“æŸ¥è¯¢
                        Long total = userMapper.selectCount(queryWrapper);
                        //æŸ¥è¯¢ç»“æœå¤„ç†
                        if (total == 0){
                            //æ•°æ®åº“ä¸­ä¸å­˜åœ¨,å¯ç”¨
                            log.info("UserServiceImpl.checkä¸šåŠ¡ç»“æŸï¼Œç»“æœ:{}","è´¦å·å¯ä»¥ä½¿ç”¨!");
                            return R.ok("è´¦å·ä¸å­˜åœ¨,å¯ä»¥ä½¿ç”¨!");
                        }

                        log.info("UserServiceImpl.checkä¸šåŠ¡ç»“æŸï¼Œç»“æœ:{}","è´¦å·ä¸å¯ä½¿ç”¨!");

                        return R.fail("è´¦å·å·²ç»å­˜åœ¨,ä¸å¯æ³¨å†Œ!");
                    }

                    ```

                5.  mapper

                    ```java
                    public interface UserMapper extends BaseMapper<User> {
                    }
                    ```

        *   è´¦å·æ³¨å†Œæ¥å£

            1.  æ¥å£åˆ†æ

                **è¯·æ±‚URLï¼š**/user/register

                **è¯·æ±‚æ–¹å¼ï¼š** POST

                **å‚æ•°è¯´æ˜ï¼š** JSON

                {userName:root,password:123456}

                | å‚æ•°              | æ˜¯å¦å¿…é€‰ | ç±»å‹     | è¯´æ˜       |
                | --------------- | ---- | ------ | -------- |
                | userName        | æ˜¯    | string | ç”¨æˆ·å      |
                | password        | æ˜¯    | string | å¯†ç ï¼Œå¯†ç æ˜¯æ˜æ–‡ |
                | userPhonenumber | æ˜¯    | string | ç”¨æˆ·ç”µè¯     |

                è¿”å›ç»“æœï¼š

                ```json
                {
                  code: '001', æˆåŠŸ / 004  å¤±è´¥
                  msg: 'æ³¨å†ŒæˆåŠŸ'
                }
                ```

            2.  ä¸šåŠ¡åˆ†æ

                1.  æ ¹æ®è´¦å·å¯†ç è¿›è¡Œç”¨æˆ·æ•°æ®æ’å…¥

                2.  æ³¨æ„åšå¥½éç©ºæ ¡éªŒ

                3.  æ³¨æ„éœ€è¦åšå¥½å¯†ç åŠ å¯†ï¼Œæ­¤å¤„éœ€è¦åŠ ç›å¤„ç†

                4.  æ’å…¥ä¹‹å‰éœ€è¦åˆ¤æ–­è´¦å·æ˜¯å¦å·²ç»æ’å…¥

                5.  æ’å…¥æˆåŠŸä»¥åè¿›è¡Œæ•°æ®ç»“æœåˆ¤æ–­

            3.  åŠŸèƒ½å®ç°

                1.  ç”¨æˆ·å¸¸é‡

                    ```java
                    public class UserConstants {

                        /**
                         * ç”¨æˆ·ç™»å½•æ³¨å†Œçš„ç›!
                         */
                        public static final String USER_SLAT = "b2cstore";
                    }
                    ```

                2.  ä¿®æ”¹userpojo

                    ```java
                    @Data
                    @TableName("user")
                    public class User implements Serializable {

                        public static final Long serialVersionUID = 1L;

                        @JsonProperty("user_id") //jacksonçš„æ³¨è§£,ç”¨äºè¿›è¡Œå±æ€§æ ¼å¼åŒ–!
                        @TableId(type =  IdType.AUTO)
                        private Integer userId;

                        @Length(min = 6)
                        private String userName;
                          //å¿½ç•¥å±æ€§ ä¸ç”Ÿæˆjson ä¸æ¥å—jsonæ•°æ®  @JsonIgnore
                          // @JsonInclude(JsonInclude.Include.NON_NULL)  + null å½“è¿™ä¸ªå€¼ä¸ä¸ºnullçš„æ—¶å€™ç”Ÿæˆjson,ä¸ºnullä¸ç”Ÿæˆ
                          // ä¸å½±å“æ¥æ”¶json
                        @JsonInclude(JsonInclude.Include.NON_NULL)
                        @NotBlank
                        private String password;

                        @JsonInclude(JsonInclude.Include.NON_NULL)
                        @NotBlank
                        private String userPhonenumber;
                    }
                    ```

                3.  controller

                    ```java
                    @PostMapping("register")
                    public R register(@RequestBody @Validated User user,BindingResult result){

                        if (result.hasErrors()){
                            //å¦‚æœå­˜åœ¨å¼‚å¸¸,è¯æ˜è¯·æ±‚å‚æ•°ä¸ç¬¦åˆæ³¨è§£è¦æ±‚
                            return  R.fail("å‚æ•°å¼‚å¸¸,ä¸å¯æ³¨å†Œ!");
                        }

                        return userservice.register(user);
                    }
                    ```

                4.  service

                    ```java
                     /**
                     * æ³¨å†Œä¸šåŠ¡
                     *   2. æ£€æŸ¥è´¦å·æ˜¯å¦å­˜åœ¨
                     *   1. å¯†ç åŠ å¯†å¤„ç†
                     *   3. æ’å…¥æ•°æ®åº“æ•°æ®
                     *   4. è¿”å›ç»“æœå°è£…
                     * @param user å‚æ•°å·²ç»æ ¡éªŒ,ä½†æ˜¯å¯†ç æ˜¯æ˜æ–‡!
                     * @return ç»“æœ 001 004
                     */
                    @Override
                    public R register(User user) {

                        //1.æ£€æŸ¥è´¦å·æ˜¯å¦å­˜åœ¨
                        QueryWrapper<User> queryWrapper = new QueryWrapper<>();
                        queryWrapper.eq("user_name",user.getUserName());
                        //æ•°æ®åº“æŸ¥è¯¢
                        Long total = userMapper.selectCount(queryWrapper);

                        if (total > 0){
                            log.info("UserServiceImpl.registerä¸šåŠ¡ç»“æŸï¼Œç»“æœ:{}","è´¦å·å­˜åœ¨,æ³¨å†Œå¤±è´¥!");
                            return R.fail("è´¦å·å·²ç»å­˜åœ¨,ä¸å¯æ³¨å†Œ!");
                        }
                        //2.å¯†ç åŠ å¯†å¤„ç†,æ³¨æ„è¦åŠ ç›
                        /**
                         * MD5 ä¸€ç§ä¸å¯é€†è½¬åŠ å¯†æ–¹å¼, åªèƒ½åŠ å¯†ä¸èƒ½è§£å¯†!
                         *     å›ºå®šçš„æ˜æ–‡åŠ å¯†ä»¥åçš„å¯†æ–‡æ˜¯å›ºå®š!
                         *     123456  --> åŠ å¯† ---> 1111111
                         *     æ³¨å†Œæ˜¯åŠ å¯†ä»¥åå­˜åœ¨å¯†æ–‡!
                         *     ç™»å½•å®åŠ å¯†ä»¥å,ç”¨å¯†æ–‡è¿›è¡Œæ•°æ®åº“å¯¹æ¯”!
                         * MD5å¯ä»¥æš´åŠ›ç ´è§£:
                         *     ç©·ä¸¾æ³•
                         *     ç®€å•çš„å­—ç¬¦ä¸²éƒ½æ˜¯ä¸å®‰å…¨!
                         *     æç¤ºç”¨æˆ·å¯†ç å¤æ‚åº¦!
                         *     åŠ ç›å¤„ç†    ç”¨æˆ·çš„å¯†ç  1 + å­—ç¬¦ä¸²[ç›] 9999 = 10000
                         */

                        String newPwd = MD5Util.encode(user.getPassword() + UserConstants.USER_SLAT);
                        user.setPassword(newPwd);

                        //3.æ’å…¥æ•°æ®åº“æ•°æ®
                        int rows = userMapper.insert(user);
                        //4.è¿”å›å°è£…ç»“æœ
                        if (rows == 0){
                            log.info("UserServiceImpl.registerä¸šåŠ¡ç»“æŸï¼Œç»“æœ:{}","æ•°æ®æ’å…¥å¤±è´¥!æ³¨å†Œå¤±è´¥!");
                            return R.fail("æ³¨å†Œå¤±è´¥!è¯·ç¨åå†è¯•!");
                        }

                        log.info("UserServiceImpl.registerä¸šåŠ¡ç»“æŸï¼Œç»“æœ:{}","æ³¨å†ŒæˆåŠŸ!");

                        return R.ok("æ³¨å†ŒæˆåŠŸ!");
                    }
                    ```

                5.  mapper

        *   è´¦å·ç™»å½•æ¥å£

            1.  æ¥å£ä»‹ç»

                è¯·æ±‚URLï¼š/user/login

                è¯·æ±‚æ–¹å¼ï¼šPOST

                è¯·æ±‚ç±»å‹: JSON

                å‚æ•°è¯´æ˜ï¼š

                {userName:è´¦å·,password:å¯†ç }&#x20;

                | å‚æ•°       | æ˜¯å¦å¿…é€‰ | ç±»å‹     | è¯´æ˜                |
                | -------- | ---- | ------ | ----------------- |
                | userName | æ˜¯    | string | ç”¨æˆ·å,ç™»å½•è´¦å·!         |
                | password | æ˜¯    | string | å¯†ç ,æ³¨æ„æ˜¯æ˜æ–‡!åŠ å¯†éœ€è¦è‡ªå·±å¤„ç† |

                è¿”å›ç¤ºä¾‹:

                ```json
                {
                  //codeçº¦å®šå¥½çš„æ•°æ®çŠ¶æ€å­—æ®µ  001 æˆåŠŸ
                  "code": "001",
                  //ä¸åŒçš„æ¥å£å¯èƒ½ä¸åŒï¼å¾…ä¼šçš„å…·ä½“æ•°æ®
                  "data": {
                    "user_id": 1,
                    "userName": "admin"
                  },
                  //æç¤ºè¯­ msg
                  "msg": "ç™»å½•æˆåŠŸ"
                }
                å¤±è´¥ï¼004
                ```

            2.  ä¸šåŠ¡ä»‹ç»

                1.  è¿›è¡Œè´¦å·å’Œå¯†ç éç©ºæ ¡éªŒ

                2.  å¯†ç åŠ å¯†å¤„ç†

                3.  è´¦å·å¯†ç è¿›è¡Œæ•°æ®åº“æŸ¥è¯¢

                4.  åˆ¤æ–­æŸ¥è¯¢ç»“æœï¼Œè¿›è¡ŒRå°è£…

                5.  æ³¨æ„ï¼šå¯†ç ä¸ºäº†å®‰å…¨ï¼Œä¸è¿”å›

                6.  æ³¨æ„ï¼šè¿”å›çš„æ•°æ®jsonçš„key

                7.  éœ€è¦ä½¿ç”¨jacksonæ³¨è§£æ ¼å¼åŒ–jsonçš„key

            3.  åŠŸèƒ½å®ç°

                1.  param

                    ```java
                    @Data
                    public class UserLoginParam {

                        @NotBlank
                        private String userName;
                        @NotBlank
                        private String password;
                    }
                    ```

                2.  controller

                    ```java
                    @PostMapping("login")
                    public R login(@RequestBody @Validated UserLoginParam userLoginParam,BindingResult result){

                        if (result.hasErrors()){
                            //å¦‚æœå­˜åœ¨å¼‚å¸¸,è¯æ˜è¯·æ±‚å‚æ•°ä¸ç¬¦åˆæ³¨è§£è¦æ±‚
                            return  R.fail("å‚æ•°å¼‚å¸¸,ä¸å¯ç™»å½•!");
                        }

                        return userservice.login(userLoginParam);
                    }
                    ```

                3.  service

                    ```java
                    /**
                     * ç™»å½•ä¸šåŠ¡
                     *   1. å¯†ç çš„åŠ å¯†å’ŒåŠ ç›å¤„ç†
                     *   2. è´¦å·å’Œå¯†ç è¿›è¡Œæ•°æ®åº“æŸ¥è¯¢.è¿”å›ä¸€ä¸ªå®Œæ•´çš„æ•°æ®åº“userå¯¹è±¡
                     *   3. åˆ¤æ–­è¿”å›ç»“æœ
                     * @param userLoginParam è´¦å·å’Œå¯†ç  å·²ç»æ ¡éªŒ ä½†æ˜¯å¯†ç æ˜¯æ˜æ–‡!
                     * @return ç»“æœ 001 004
                     */
                    @Override
                    public R login(UserLoginParam userLoginParam) {

                        //1.å¯†ç å¤„ç†
                        String newPwd = MD5Util.encode(userLoginParam.getPassword() + UserConstants.USER_SLAT);

                        //2.æ•°æ®åº“æŸ¥è¯¢
                        QueryWrapper<User> queryWrapper = new QueryWrapper<>();
                        queryWrapper.eq("user_name",userLoginParam.getUserName());
                        queryWrapper.eq("password",newPwd);

                        User user = userMapper.selectOne(queryWrapper);

                        //3.ç»“æœå¤„ç†
                        if (user == null) {
                            log.info("UserServiceImpl.loginä¸šåŠ¡ç»“æŸï¼Œç»“æœ:{}","è´¦å·å’Œå¯†ç é”™è¯¯!");
                            return R.fail("è´¦å·æˆ–è€…å¯†ç é”™è¯¯!");
                        }

                        log.info("UserServiceImpl.loginä¸šåŠ¡ç»“æŸï¼Œç»“æœ:{}","ç™»å½•æˆåŠŸ!");
                        //ä¸è¿”å›passwordå±æ€§!
                        user.setPassword(null);
                        return R.ok("ç™»å½•æˆåŠŸ!",user);
                    }

                    ```

                4.  pojo \[store-commons]

                    æ³¨æ„ï¼šéœ€è¦é‡æ–°è°ƒç”¨maven clean install

                    ```java
                    @TableName("user")
                    @Data
                    public class User implements Serializable {
        
                        public static final Long serialVersionUID = 1L;
        
                        @TableId(type = IdType.AUTO)
                        @JsonProperty("user_id")
                        private Integer userId;
                        private String  userName;
                        @JsonInclude(JsonInclude.Include.NON_NULL)
                        private String  password;
                        @JsonInclude(JsonInclude.Include.NON_NULL)
                        private String  userPhonenumber;
                    }
                    ```

        *   åœ°å€æŸ¥çœ‹æ¥å£

            1.  æ¥å£åˆ†æ

                **è¯·æ±‚URLï¼š**/user/address/list

                **è¯·æ±‚æ–¹å¼ï¼š** POST

                **å‚æ•°è¯´æ˜ï¼š** JSON

                | å‚æ•°       | æ˜¯å¦å¿…é€‰ | ç±»å‹  | è¯´æ˜    |
                | -------- | ---- | --- | ----- |
                | user\_id | æ˜¯    | int | ç”¨æˆ·idå€¼ |

                è¿”å›ç»“æœï¼š

                ```json
                {
                  code: '001', æˆåŠŸ / 004  å¤±è´¥
                  data:[
                     {
                        "id": 1,
                        "address": "è¯¦ç»†åœ°å€",
                        "linkman": "èµµä¼Ÿé£",
                        "phone": "18514592456",
                        "userId": 12
                    }
                  ]
                }
                ```

            2.  ä¸šåŠ¡åˆ†æ

                1.  æ ¹æ®ä¼ é€’çš„ç”¨æˆ·ID,å‚æ•°å¨‡è‰³

                2.  æŸ¥è¯¢ç”¨æˆ·çš„åœ°å€ä¿¡æ¯

                3.  å°è£…è¿”å›å³å¯

            3.  åŠŸèƒ½å®ç°

                1.  param \[store-commons]

                    ```java
                    /**
                     * projectName: b2c-store
                     * <p>
                     * description: åœ°å€ç»“åˆå‚æ•°æ¥æ”¶
                     */
                    @Data
                    public class AddressListParam {

                        @NotNull
                        @JsonProperty("user_id")
                        private Integer userId;
                    }
                    ```

                2.  æ·»åŠ pojo \[store-commons]

                    ```java
                    @Data
                    @TableName("address")
                    public class Address implements Serializable {

                        public static final Long serialVersionUID = 1L;

                        @TableId(type = IdType.AUTO)
                        private Integer id;
                        @NotBlank
                        private String linkman;
                        @NotBlank
                        private String phone;
                        @NotBlank
                        private String address;
                        @NotNull
                        @TableField("user_id")
                        private Integer userId;
                    }
                    ```

                3.  controller

                    ```java
                     @PostMapping("list")
                    public R list(@RequestBody @Validated AddressListParam addressListParam, BindingResult result){

                        if (result.hasErrors()){

                            return R.fail("å‚æ•°å¼‚å¸¸,æŸ¥è¯¢å¤±è´¥!");
                        }

                        return  addressService.list(addressListParam.getUserId());
                    }
                    ```

                4.  service

                    ```java

                    @Autowired
                    private AddressMapper addressMapper;/**
                     * æ ¹æ®ç”¨æˆ·idæŸ¥è¯¢ åœ°å€æ•°æ®!
                     *   1.ç›´æ¥è¿›è¡Œæ•°æ®åº“æŸ¥è¯¢
                     *   2.ç»“æœå°è£…å³å¯
                     * @param userId ç”¨æˆ·id å·²ç»æ ¡éªŒå®Œæ¯•
                     * @return 001 004
                     */
                    @Override
                    public R list(Integer userId) {

                        //1,å°è£…æŸ¥è¯¢å‚æ•°
                        QueryWrapper<Address> queryWrapper = new QueryWrapper<>();
                        queryWrapper.eq("user_id",userId);
                        List<Address> addressList = addressMapper.selectList(queryWrapper);

                        //2.ç»“æœå°è£…
                        R ok = R.ok("æŸ¥è¯¢æˆåŠŸ", addressList);
                        log.info("AddressServiceImpl.listä¸šåŠ¡ç»“æŸï¼Œç»“æœ:{}",ok);
                        return ok;
                    }

                    ```

                5.  mapper

                    ```java
                    /**
                     * projectName: b2c-store
                     * <p>
                     * description: åœ°å€æ•°æ®åº“è®¿é—®mapperæ¥å£
                     */
                    public interface AddressMapper extends BaseMapper<Address> {
                    }
                    ```

        *   åœ°å€æ·»åŠ æ¥å£

            1.  æ¥å£åˆ†æ

                **è¯·æ±‚URLï¼š**/user/address/save

                **è¯·æ±‚æ–¹å¼ï¼š** POST

                **å‚æ•°è¯´æ˜ï¼š** JSON

                | å‚æ•°          | æ˜¯å¦å¿…é€‰ | ç±»å‹     | è¯´æ˜   |
                | ----------- | ---- | ------ | ---- |
                | add.address | æ˜¯    | string | è¯¦ç»†åœ°å€ |
                | add.linkman | æ˜¯    | string | è”ç³»äºº  |
                | add.phone   | æ˜¯    | string | æ‰‹æœºå·  |
                | user\_id    | æ˜¯    | int    | ç”¨æˆ·ID |

                è¿”å›ç»“æœï¼š

                ```json
                {
                  "code": "001",
                  "data": [
                     {
                        "id": 1,
                        "address": "è¯¦ç»†åœ°å€",
                        "linkman": "èµµä¼Ÿé£",
                        "phone": "18514592456",
                        "user_id": 12
                    },
                      {
                        "id": 2,
                        "address": "è¯¦ç»†åœ°å€",
                        "linkman": "èµµä¼Ÿé£",
                        "phone": "18514592456",
                        "user_id": 12
                    }
                  ]
                }
                ```

            2.  ä¸šåŠ¡åˆ†æ

                1.  è¿›è¡Œåœ°å€æ•°æ®ä¿å­˜

                2.  ä¿å­˜æˆåŠŸè¿”å›æœ€æ–°åœ°å€ä¿¡æ¯

            3.  åŠŸèƒ½å®ç°

                1.  controller

                    ```java
                    /**
                     * æ’å…¥åœ°å€æ•°æ®,æ’å…¥æˆåŠŸä»¥å,è¦è¿”å›æ–°çš„æ•°æ®é›†åˆ!
                     *
                     * @param address åœ°å€æ•°æ®å·²ç»æ ¡éªŒå®Œæ¯•å“¦!
                     * @return æ•°æ®é›†åˆ
                     */
                    @Override
                    public R save(Address address) {

                        //1.æ’å…¥æ•°æ®
                        int rows = addressMapper.insert(address);
                        //2.æ’å…¥æˆåŠŸ
                        if (rows == 0){
                            log.info("AddressServiceImpl.saveä¸šåŠ¡ç»“æŸï¼Œç»“æœ:{}","åœ°å€å¤±è´¥!");
                            return R.fail("æ’å…¥åœ°å€å¤±è´¥!");
                        }
                        //å¤ç”¨æŸ¥è¯¢ä¸šåŠ¡
                        return list(address.getUserId());
                    }
                    ```

                2.  service

                    ```java
                    /**
                     * æ’å…¥åœ°å€æ•°æ®,æ’å…¥æˆåŠŸä»¥å,è¦è¿”å›æ–°çš„æ•°æ®é›†åˆ!
                     *
                     * @param address åœ°å€æ•°æ®å·²ç»æ ¡éªŒå®Œæ¯•å“¦!
                     * @return æ•°æ®é›†åˆ
                     */
                    @Override
                    public R save(Address address) {
        
                        //1.æ’å…¥æ•°æ®
                        int rows = addressMapper.insert(address);
                        //2.æ’å…¥æˆåŠŸ
                        if (rows == 0){
                            log.info("AddressServiceImpl.saveä¸šåŠ¡ç»“æŸï¼Œç»“æœ:{}","åœ°å€å¤±è´¥!");
                            return R.fail("æ’å…¥åœ°å€å¤±è´¥!");
                        }
                        //å¤ç”¨æŸ¥è¯¢ä¸šåŠ¡
                        return list(address.getUserId());
                    }
                    ```

        *   åœ°å€åˆ é™¤æ¥å£

            1.  æ¥å£åˆ†æ

                **è¯·æ±‚URLï¼š**/user/address/remove

                **è¯·æ±‚æ–¹å¼ï¼š** POST

                **å‚æ•°è¯´æ˜ï¼š** JSON

                | å‚æ•° | æ˜¯å¦å¿…é€‰ | ç±»å‹      | è¯´æ˜       |
                | -- | ---- | ------- | -------- |
                | id | æ˜¯    | inetger | è¦åˆ é™¤çš„åœ°å€id |

                è¿”å›ç»“æœï¼š

                ```json
                {
                  code: '001', æˆåŠŸ / 004  å¤±è´¥
                  msg:"åˆ é™¤æç¤º!"
                }
                ```

            2.  ä¸šåŠ¡åˆ†æ

                1.  æ ¹æ®ä¼ å…¥çš„åœ°å€idï¼Œåˆ é™¤åœ°å€ä¿¡æ¯

                2.  åˆ é™¤ä»¥åï¼Œç»“æœåˆ¤æ–­ï¼Œç»™äºˆè¿”å›ç»“æœå°è£…

            3.  åŠŸèƒ½å®ç°

                1.  param

                    ```java
                    @Data
                    public class AddressRemoveParam {

                        @NotNull
                        private Integer id;
                    }
                    ```

                2.  controller

                    ```java
                    @PostMapping("remove")
                    public R remove(@RequestBody @Validated AddressRemoveParam addressRemoveParam,BindingResult result){

                        if (result.hasErrors()){

                            return R.fail("å‚æ•°å¼‚å¸¸,åˆ é™¤å¤±è´¥!");
                        }

                        return addressService.remove(addressRemoveParam.getId());
                    }
                    ```

                3.  service

                    ```java
                    /**
                     *
                     * TODO:
                     *   1.å®šä¹‰æ¥æ”¶å‚æ•°çš„param å¹¶ä¸”æ·»åŠ å‚æ•°æ ¡éªŒæ³¨è§£
                     *   2.å®šä¹‰controller
                     *   3.å®šä¹‰service
                     *   4.å®šä¹‰mapper
                     *
                     * æ ¹æ®id åˆ é™¤åœ°å€æ•°æ®
                     *
                     * @param id åœ°å€id
                     * @return ç»“æœ 001  004
                     */
                    @Override
                    public R remove(Integer id) {
            
                        int rows = addressMapper.deleteById(id);
            
                        if (rows == 0){
                            log.info("AddressServiceImpl.removeä¸šåŠ¡ç»“æŸï¼Œç»“æœ:{}","åœ°å€åˆ é™¤å¤±è´¥");
                            return R.fail("åˆ é™¤åœ°å€æ•°æ®å¤±è´¥!");
                        }
            
                        log.info("AddressServiceImpl.removeä¸šåŠ¡ç»“æŸï¼Œç»“æœ:{}","åœ°å€åˆ é™¤æˆåŠŸ!");
            
                        return R.ok("åœ°å€åˆ é™¤æˆåŠŸ!");
                    }
                    ```

    *   **postmanæµ‹è¯•**

    *   **å‰ç«¯è¿è°ƒ**

*   **é™æ€èµ„æºæœåŠ¡**

    *   ä»‹ç»

        > é™æ€èµ„æºå­˜å‚¨å’Œé™æ€èµ„æºå¤–éƒ¨è®¿é—®æœåŠ¡ï¼

    *   æœåŠ¡æ­å»º

        *   åˆ›å»ºæ¨¡å—

            æ¨¡å—åï¼šstore-static-oss

        *   å¯¼å…¥ä¾èµ–

            æ³¨æ„ï¼šå¯¼å…¥é™æ€èµ„æºéœ€è¦çš„ä¾èµ–

            ```xml
            <dependencies>
                  <dependency>
                      <groupId>org.springframework.boot</groupId>
                      <artifactId>spring-boot-starter-web</artifactId>
                  </dependency>

                  <!-- nacoså®¢æˆ·ç«¯ä¾èµ–åŒ… -->
                  <dependency>
                      <groupId>com.alibaba.cloud</groupId>
                      <artifactId>spring-cloud-starter-alibaba-nacos-discovery</artifactId>
                  </dependency>

              </dependencies>
            ```

        *   å¯¼å…¥é™æ€èµ„æº

            [public.zip](file/public_beDHZ5nqew.zip)

            è§£å‹ï¼Œæ”¾åœ¨resourcesåŒ…ä¸‹å³å¯

        *   æ·»åŠ é…ç½®æ–‡ä»¶

            *   bootstrap.yml

                ```yaml
                spring:
                  application:
                    name: static-service
                  cloud:
                    nacos:
                      server-addr: 124.221.70.206:8848
                server:
                  port: 3002
                ```

            *   application.yml

                ```yaml
                spring:
                  mvc:
                  # é…ç½®é™æ€èµ„æºå¯ä»¥è¢«è®¿é—®ï¼
                    static-path-pattern: /public/**
                  resources:
                    static-locations: classpath:/public/
                ```

        *   æ·»åŠ å¯åŠ¨ç±»

            ```java
            @SpringBootApplication
            public class StaticOssApplication {

                public static void main(String[] args) {
                    SpringApplication.run(StaticOssApplication.class,args);
                }

            }
            ```

        *   ä¿®æ”¹ç½‘å…³é…ç½®

            ä½ç½®ï¼š store\_gateway/application.yml

            ```java
            # é…ç½®ç½‘å…³
            spring:
              cloud:
                gateway:
                  routes:
                    - id: user-service
                      uri: lb://user-service
                      predicates:
                        - Path=/user/**  # è®¿é—®userè·¯å¾„è½¬å‘ç”¨æˆ·æœåŠ¡
                    - id: product-service # æ­¤åç§°éšæ„å®šä¹‰
                      uri: lb://product-service #ä½¿ç”¨è´Ÿè½½å‡è¡¡,è°ƒç”¨æœåŠ¡å,è¿™æ˜¯æœåŠ¡å
                      predicates:
                        - Path=/product/** # è®¿é—®productç›¸å…³,è½¬å‘åˆ°productæœåŠ¡
                    # é™æ€èµ„æºå¯¹åº”çš„æœåŠ¡
                    - id: static-service
                      uri: lb://static-service #é™æ€èµ„æºå¤„ç†ä»¥åŠossä¸Šä¼ æœåŠ¡!
                      predicates:
                        - Path=/public/**
            ```

        *   é‡å¯æœåŠ¡

            æ³¨æ„ï¼è¦é‡å¯ä¿®æ”¹é…ç½®æ–‡ä»¶çš„æœåŠ¡ï¼

*   **è½®æ’­å›¾æœåŠ¡**

    *   ä»‹ç»

        > é¦–é¡µè½®æ’­å›¾å¹¿å‘Šå›¾ç‰‡å±•ç¤ºï¼Œç‚¹å‡»å›¾ç‰‡å¯ä»¥è·³è½¬åˆ°å•†å“å±•ç¤ºè¯¦æƒ…ï¼

    *   æœåŠ¡æ­å»º

        *   å¯¼å…¥æ•°æ®åº“

            [store\_carousel.sql](file/store_carousel_v0hH_C7nIZ.sql)

            ```sql
            # å°†æ•°æ®åº“è„šæœ¬å¤åˆ¶åˆ°æŸç›˜ç¬¦ä¸‹ï¼Œæ–¹ä¾¿å¯¼å…¥ï¼
            # æ‰§è¡Œæ•°æ®åº“è„šæœ¬å¯¼å…¥å‘½ä»¤ï¼æ³¨æ„ä¹±ç é—®é¢˜ï¼
            # æ­¥éª¤1:ä½¿ç”¨cmdå‘½ä»¤çª—å£ç™»å½•mysqlï¼Œé˜²æ­¢å¯¼å…¥ä¹±ç é—®é¢˜
            mysql -uè´¦å· -på¯†ç  --default-character-set=utf8  å›è½¦
            # æ­¥éª¤2:å¯¼å…¥æ•°æ®æ–‡ä»¶ æ³¨æ„ï¼Œè¦å†™ä½ è‡ªå·±çš„æ–‡ä»¶åœ°å€
            source d:\store_carousel.sql  å›è½¦  
            # æ­¥éª¤3: æŸ¥çœ‹æ•°æ®åº“
            show databases;
            ```

        *   åˆ›å»ºæœåŠ¡

            æ¨¡å—åï¼š store-front-carousel

        *   å¯¼å…¥ä¾èµ–

            ```xml
            <dependency>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-starter-web</artifactId>
            </dependency>
            <dependency>
                <groupId>mysql</groupId>
                <artifactId>mysql-connector-java</artifactId>
            </dependency>
            <!--mybatis-->
            <dependency>
                <groupId>org.mybatis.spring.boot</groupId>
                <artifactId>mybatis-spring-boot-starter</artifactId>
            </dependency>
            <!-- nacoså®¢æˆ·ç«¯ä¾èµ–åŒ… -->
            <dependency>
                <groupId>com.alibaba.cloud</groupId>
                <artifactId>spring-cloud-starter-alibaba-nacos-discovery</artifactId>
            </dependency>
            <!--feignå®¢æˆ·ç«¯ä¾èµ–-->
            <dependency>
                <groupId>org.springframework.cloud</groupId>
                <artifactId>spring-cloud-starter-openfeign</artifactId>
            </dependency>
            <!--å¼•å…¥HttpClientä¾èµ–-->
            <dependency>
                <groupId>io.github.openfeign</groupId>
                <artifactId>feign-httpclient</artifactId>
            </dependency>

            <dependency>
                <groupId>com.baomidou</groupId>
                <artifactId>mybatis-plus-boot-starter</artifactId>
            </dependency>

            <dependency>
                <groupId>com.alibaba</groupId>
                <artifactId>druid-spring-boot-starter</artifactId>
            </dependency>

            <!-- æ­¤å¤„æ˜¯ä½ çš„store_common_feignæ¨¡å—çš„gav,å¦‚æœä¸ä¸€è‡´,éœ€è¦æ”¹è¿›,æ³¨æ„,éœ€è¦æ”¾å…¥mavenæœ¬åœ°åº“!-->
            <dependency>
                <artifactId>store-commons</artifactId>
                <groupId>com.atguigu</groupId>
                <version>1.0.0</version>
            </dependency>
            ```

        *   å£°æ˜é…ç½®

            bootstrap.yml

            ```yaml
            spring:
              application:
                name: carousel-service
              cloud:
                nacos:
                  server-addr: 124.221.70.206:8848
            server:
              port: 3003
            ```

            application.yml

            ```yaml
            spring:
              # è¿æ¥æ± é…ç½®
              datasource:
                url: jdbc:mysql://localhost:3306/store_carousel?useSSL=false
                username: root
                password: 123456
                driver-class-name: com.mysql.jdbc.Driver
                type: com.alibaba.druid.pool.DruidDataSource
            mybatis-plus:
              mapper-locations: classpath:mappers/*.xml
              configuration:
                map-underscore-to-camel-case: true
                auto-mapping-behavior: full
                lazy-loading-enabled: true
                aggressive-lazy-loading: false
              type-aliases-package: com.atguigu.pojo #è®¾ç½®åˆ«å
            ribbon:
              eager-load:
                enabled: true #å¼€å¯é¥¥é¥¿åŠ è½½æå‡ç¬¬ä¸€æ¬¡è®¿é—®é€Ÿåº¦
                clients:
                  - carousel-service #æŒ‡å®šå¼€å¯æœåŠ¡
            feign:
              httpclient:
                enabled: true  # å¼€å¯httpClientå¼€å…³,å¯åŠ¨è¿æ¥æ± ,æå‡feignè¿æ¥æ•ˆç‡!
                max-connections: 200  #æœ€å¤§è¿æ¥æ•°é‡
                max-connections-per-route: 50  #å•è·¯å¾„æœ€å¤§è¿æ¥æ•°

            ```

        *   åˆ›å»ºå¯åŠ¨ç±»

            ```java
            @SpringBootApplication
            @MapperScan(basePackages = "com.atguigu.carousel.mapper")
            public class CarouselApplication {

                public static void main(String[] args) {
                    SpringApplication.run(CarouselApplication.class,args);
                }
            }
            ```

        *   ä¿®æ”¹ç½‘å…³é…ç½®

            ä½ç½®ï¼šstore-gateway/application.yml

            ```yaml
            - id: carousel-service  # è½®æ’­å›¾æœåŠ¡
              uri: lb://carousel-service #é™æ€èµ„æºå¤„ç†ä»¥åŠossä¸Šä¼ æœåŠ¡!
              predicates:
                - Path=/carousel/**
            ```

    *   åŠŸèƒ½å®ç°

        *   è½®æ’­å›¾å±•ç¤ºæ¥å£

            *   æ¥å£åˆ†æ

                è¯·æ±‚URLï¼š/carousel/list

                è¯·æ±‚æ–¹å¼ï¼šPOST

                è¯·æ±‚ç±»å‹:  JSON

                å‚æ•°è¯´æ˜ï¼š

                | å‚æ•° | æ˜¯å¦å¿…é€‰ | ç±»å‹ | è¯´æ˜ |
                | -- | ---- | -- | -- |

                è¿”å›ç»“æœï¼š

                ```json
                # åˆ†æè¿”å›ç»“æœï¼Œå¦‚ä½•æ ¹æ®æ•°æ®åº“æŸ¥è¯¢ï¼Œè¿”å›å¯¹åº”çš„ç»“æœï¼ 
                {"code":"001",
                  "data":[
                   {"carousel_id":1,
                   "imgPath":"public/imgs/cms_1.jpg",
                   "describes":"123456",
                   "priority":10,
                   "product_id":1}]
                }   
                ```

            *   ä¸šåŠ¡åˆ†æ

                *   æŸ¥è¯¢æ•°æ®åº“ä¸­è½®æ’­å›¾æ•°æ®

                *   æŸ¥è¯¢ä¼˜å…ˆçº§æœ€é«˜çš„å…­å¼ å›¾ç‰‡

                *   éœ€è¦è¿”å›å…³è”çš„å•†å“IDï¼Œç‚¹å‡»å¯ä»¥è§¦å‘å¹¿å‘Šå•†å“

            *   åŠŸèƒ½å®ç°

                1.  å®šä¹‰pojo \[store-common-feign]

                    ```java
                    @Data
                    @TableName("carousel")
                    public class Carousel  implements Serializable {

                        public static final Long serialVersionUID = 1L;

                        @TableId(type = IdType.AUTO)
                        @JsonProperty("carousel_id")
                        private Integer carouselId;
                        private String  imgPath;
                        private String  describes;
                        @JsonProperty("product_id")
                        private Integer productId;
                        //ä¼˜å…ˆçº§
                        private Integer priority;

                    }
                    ```

                2.  controller

                    ```java
                    /**
                     * æŸ¥è¯¢é¦–é¡µæ•°æ®,æŸ¥è¯¢ä¼˜å…ˆçº§æœ€é«˜çš„å››æ¡
                     * @return
                     */
                    @PostMapping("list")
                    public Object list(){

                        return  carouselService.list();
                    }
                    ```

                3.  service

                    ```java
                    @Slf4j
                    @Service
                    public class CarouselServiceImpl implements CarouselService {
        
                        @Autowired
                        private CarouselMapper carouselMapper;
        
                        /**
                         * æŸ¥è¯¢ä¼˜å…ˆçº§æœ€é«˜çš„å››æ¡è½®æ’­å›¾æ•°æ®
                         *
                         * @return
                         */
                        @Override
                        public Object list() {
                            //å£°æ˜æ•°é‡
                            int limit = 4 ; //è‡³å¤šæŸ¥è¯¢å››æ¡
        
                            //æŸ¥è¯¢æ•°æ®åº“
                            IPage<Carousel> iPage = new Page<>(1,limit);
                            QueryWrapper<Carousel> carouselQueryWrapper = new QueryWrapper<>();
                            carouselQueryWrapper.orderByDesc("priority");
                            IPage<Carousel> page = carouselMapper.selectPage(iPage, carouselQueryWrapper);
        
                            List<Carousel> carouselList = page.getRecords();
                           
                            return R.ok(carouselList);
                        }
                    }
                    ```

        *   å•†å“è¯¦æƒ…æ¥å£

            > å±•ç¤ºè½®æ’­å›¾å•†å“æ˜¾ç¤ºï¼Œåœ¨å•†å“æœåŠ¡ä¸­å®ç°ï¼

    *   postmanæµ‹è¯•

    *   å‰ç«¯è¿è°ƒ

*   **å•†å“æœåŠ¡**

    *   ä»‹ç»

        > å•†å“ç›¸å…³åŠŸèƒ½å®ç°ï¼

    *   æœåŠ¡æ­å»º

        *   å¯¼å…¥æ•°æ®åº“

            [store\_product.sql](file/store_product_CuygTtBA4a.sql)

            ```java
            # å°†æ•°æ®åº“è„šæœ¬å¤åˆ¶åˆ°æŸç›˜ç¬¦ä¸‹ï¼Œæ–¹ä¾¿å¯¼å…¥ï¼
            # æ‰§è¡Œæ•°æ®åº“è„šæœ¬å¯¼å…¥å‘½ä»¤ï¼æ³¨æ„ä¹±ç é—®é¢˜ï¼
            # æ­¥éª¤1:ä½¿ç”¨cmdå‘½ä»¤çª—å£ç™»å½•mysqlï¼Œé˜²æ­¢å¯¼å…¥ä¹±ç é—®é¢˜
            mysql -uè´¦å· -på¯†ç  --default-character-set=utf8  å›è½¦
            # æ­¥éª¤2:å¯¼å…¥æ•°æ®æ–‡ä»¶ æ³¨æ„ï¼Œè¦å†™ä½ è‡ªå·±çš„æ–‡ä»¶åœ°å€
            source d:\store_product.sql  å›è½¦  
            # æ­¥éª¤3: æŸ¥çœ‹æ•°æ®åº“
            show databases;
            ```

        *   åˆ›å»ºæœåŠ¡

            æ¨¡å—ï¼šstore-front-product

        *   å¯¼å…¥ä¾èµ–

            ```xml
            <dependencies>
                <dependency>
                    <groupId>org.springframework.boot</groupId>
                    <artifactId>spring-boot-starter-web</artifactId>
                </dependency>
                <dependency>
                    <groupId>mysql</groupId>
                    <artifactId>mysql-connector-java</artifactId>
                </dependency>
                <!--mybatis-->
                <dependency>
                    <groupId>org.mybatis.spring.boot</groupId>
                    <artifactId>mybatis-spring-boot-starter</artifactId>
                </dependency>
                <!-- nacoså®¢æˆ·ç«¯ä¾èµ–åŒ… -->
                <dependency>
                    <groupId>com.alibaba.cloud</groupId>
                    <artifactId>spring-cloud-starter-alibaba-nacos-discovery</artifactId>
                </dependency>
                <!--feignå®¢æˆ·ç«¯ä¾èµ–-->
                <dependency>
                    <groupId>org.springframework.cloud</groupId>
                    <artifactId>spring-cloud-starter-openfeign</artifactId>
                </dependency>
                <!--å¼•å…¥HttpClientä¾èµ–-->
                <dependency>
                    <groupId>io.github.openfeign</groupId>
                    <artifactId>feign-httpclient</artifactId>
                </dependency>

                <dependency>
                    <groupId>com.baomidou</groupId>
                    <artifactId>mybatis-plus-boot-starter</artifactId>
                </dependency>

                <dependency>
                    <groupId>com.alibaba</groupId>
                    <artifactId>druid-spring-boot-starter</artifactId>
                </dependency>

                <!-- æ­¤å¤„æ˜¯ä½ çš„store_common_feignæ¨¡å—çš„gav,å¦‚æœä¸ä¸€è‡´,éœ€è¦æ”¹è¿›,æ³¨æ„,éœ€è¦æ”¾å…¥mavenæœ¬åœ°åº“!-->
                <dependency>
                    <artifactId>store-commons</artifactId>
                    <groupId>com.atguigu</groupId>
                    <version>1.0.0</version>
                </dependency>

            </dependencies>
            ```

        *   å£°æ˜é…ç½®

            *   bootstrap.yml

                ```yaml
                spring:
                  application:
                    name: product-service
                  cloud:
                    nacos:
                      server-addr: 124.221.70.206:8848
                server:
                  port: 3004
                ```

            *   application.yml

                ```yaml
                spring:
                  # è¿æ¥æ± é…ç½®
                  datasource:
                    url: jdbc:mysql://localhost:3306/store_product?useSSL=false
                    username: root
                    password: 123456
                    driver-class-name: com.mysql.jdbc.Driver
                    type: com.alibaba.druid.pool.DruidDataSource
                    
                mybatis-plus:
                  mapper-locations: classpath:mappers/*.xml
                  configuration:
                    map-underscore-to-camel-case: true
                    auto-mapping-behavior: full
                    lazy-loading-enabled: true
                    aggressive-lazy-loading: false
                  type-aliases-package: com.atguigu.pojo #è®¾ç½®åˆ«å
                  
                ribbon:
                  eager-load:
                    enabled: true #å¼€å¯é¥¥é¥¿åŠ è½½æå‡ç¬¬ä¸€æ¬¡è®¿é—®é€Ÿåº¦
                    clients:
                      - product-service #æŒ‡å®šå¼€å¯æœåŠ¡
                feign:
                  httpclient:
                    enabled: true  # å¼€å¯httpClientå¼€å…³,å¯åŠ¨è¿æ¥æ± ,æå‡feignè¿æ¥æ•ˆç‡!
                    max-connections: 200  #æœ€å¤§è¿æ¥æ•°é‡
                    max-connections-per-route: 50  #å•è·¯å¾„æœ€å¤§è¿æ¥æ•°
                ```

        *   åˆ›å»ºå¯åŠ¨ç±»

            *   åˆ›å»ºå¯åŠ¨ç±»

                ```java
                /**
                 * projectName: b2c-cloud-store
                 *
                 * @author: èµµä¼Ÿé£
                 * description: å¯åŠ¨ç±»
                 */
                @SpringBootApplication
                @MapperScan(basePackages = "com.atguigu.product.mapper")
                public class ProductApplication {

                    public static void main(String[] args) {
                        SpringApplication.run(ProductApplication.class,args);
                    }
                    
                }

                ```

            *   é…ç½®åˆ†é¡µæ’ä»¶ ç›´æ¥æ·»åŠ åˆ°å¯åŠ¨ç±»ä¸­å³å¯

                ```java


                /**
                 * æ–°çš„åˆ†é¡µæ’ä»¶,ä¸€ç¼“å’ŒäºŒç¼“éµå¾ªmybatisçš„è§„åˆ™,éœ€è¦è®¾ç½® MybatisConfiguration#useDeprecatedExecutor = false é¿å…ç¼“å­˜å‡ºç°é—®é¢˜(è¯¥å±æ€§ä¼šåœ¨æ—§æ’ä»¶ç§»é™¤åä¸€åŒç§»é™¤)
                 */
                @Bean
                public MybatisPlusInterceptor mybatisPlusInterceptor() {
                    MybatisPlusInterceptor interceptor = new MybatisPlusInterceptor();
                    interceptor.addInnerInterceptor(new PaginationInnerInterceptor(DbType.MYSQL));
                    return interceptor;
                }



                ```
    
        *   æ·»åŠ ç½‘å…³é…ç½®
    
            ```yaml
            - id: product-service # æ­¤åç§°éšæ„å®šä¹‰
              uri: lb://product-service #ä½¿ç”¨è´Ÿè½½å‡è¡¡,è°ƒç”¨æœåŠ¡å,è¿™æ˜¯æœåŠ¡å
              predicates:
                - Path=/product/** # è®¿é—®productç›¸å…³,è½¬å‘åˆ°productæœåŠ¡
            ```
    
    *   åŠŸèƒ½å®ç°
    
        *   **é¦–é¡µç±»åˆ«æ¥å£**
    
            *   **æ¥å£åˆ†æ**
    
                **è¯·æ±‚URLï¼š**/product/promo
    
                **è¯·æ±‚æ–¹å¼ï¼š** POST
    
                è¯·æ±‚ç±»å‹:   JSON
    
                **å‚æ•°è¯´æ˜ï¼š**
    
                { categoryNameï¼šâ€œæ‰‹æœºâ€ }  &#x20;
    
                | å‚æ•°           | æ˜¯å¦å¿…é€‰ | ç±»å‹     | è¯´æ˜     |
                | ------------ | ---- | ------ | ------ |
                | categoryName | æ˜¯    | string | å•†å“ç±»åˆ«åç§° |
    
                è¿”å›ç¤ºä¾‹:
    
                ```java
                {
                 "code":"001",
                    //è¿”å›æ•°æ®æœ€å¤š7ä¸ª
                 "data":[{"product_id":1,
                 "product_name":"Redmi K30",
                 "category_id":1,"product_title":"120Hzæµé€Ÿå±ï¼Œ
                 å…¨é€Ÿçƒ­çˆ±","product_intro":"120Hzé«˜å¸§ç‡æµé€Ÿå±/
                  ç´¢å°¼6400ä¸‡å‰åå…­æ‘„ / 6.67'å°å­”å¾„å…¨é¢å± / 
                  æœ€é«˜å¯é€‰8GB+256GBå¤§å­˜å‚¨ / é«˜é€šéªé¾™730Gå¤„ç†å™¨ /
                   3Då››æ›²é¢ç»ç’ƒæœºèº« / 4500mAh+27Wå¿«å…… / 
                   å¤šåŠŸèƒ½NFC",
                   "product_picture":"public/imgs/phone
                   /Redmi-k30.png","product_price":2000,
                   "product_selling_price":1599,
                   "product_num":10,"product_sales":0},
                   {"product_id":2,"product_name":"Redmi K30 5G","category_id":1,"product_title":"åŒæ¨¡5G,120Hzæµé€Ÿå±","product_intro":"åŒæ¨¡5G / ä¸‰è·¯å¹¶å‘ / é«˜é€šéªé¾™765G / 7nm 5Gä½åŠŸè€—å¤„ç†å™¨ / 120Hzé«˜å¸§ç‡æµé€Ÿå± / 6.67'å°å­”å¾„å…¨é¢å± / ç´¢å°¼6400ä¸‡å‰åå…­æ‘„ / æœ€é«˜å¯é€‰8GB+256GBå¤§å­˜å‚¨ / 4500mAh+30Wå¿«å…… / 3Då››æ›²é¢ç»ç’ƒæœºèº« / å¤šåŠŸèƒ½NFC","product_picture":"public/imgs/phone/Redmi-k30-5G.png","product_price":2599,"product_selling_price":2599,"product_num":10,"product_sales":0},{"product_id":3,"product_name":"å°ç±³CC9 Pro","category_id":1,"product_title":"1äº¿åƒç´ ,äº”æ‘„å››é—ª","product_intro":"1äº¿åƒç´ ä¸»æ‘„ / å…¨åœºæ™¯äº”æ‘„åƒå¤´ / å››é—ªå…‰ç¯ / 3200ä¸‡è‡ªæ‹ / 10 å€æ··åˆå…‰å­¦å˜ç„¦ï¼Œ50å€æ•°å­—å˜ç„¦ / 5260mAh â¼¤ç”µï¥¾ / æ ‡é… 30Wç–¾é€Ÿå¿«å…… / â¼©ç±³â¾¸æ¬¾è¶…è–„å±ä¸‹æŒ‡çº¹ / å¾·å›½è±èŒµä½è“å…‰è®¤è¯ / å¤šåŠŸèƒ½NFC / çº¢å¤–ä¸‡èƒ½é¥æ§ / 1216è¶…çº¿æ€§æ‰¬å£°å™¨","product_picture":"public/imgs/phone/Mi-CC9.png","product_price":2799,"product_selling_price":2599,"product_num":20,"product_sales":0},{"product_id":4,"product_name":"Redmi 8","category_id":1,"product_title":"5000mAhè¶…é•¿ç»­èˆª","product_intro":"5000mAhè¶…é•¿ç»­èˆª / é«˜é€šéªé¾™439å…«æ ¸å¤„ç†å™¨ / 4GB+64GB","product_picture":"public/imgs/phone/Redmi-8.png","product_price":799,"product_selling_price":699,"product_num":20,"product_sales":0},{"product_id":5,"product_name":"Redmi 8A","category_id":1,"product_title":"5000mAhè¶…é•¿ç»­èˆª","product_intro":"5000mAhè¶…é•¿ç»­èˆª / é«˜é€šéªé¾™439å…«æ ¸å¤„ç†å™¨ / 4GB+64GB / 1200ä¸‡AIåç½®ç›¸æœº","product_picture":"public/imgs/phone/Redmi-8A.png","product_price":599,"product_selling_price":699,"product_num":20,"product_sales":0},{"product_id":6,"product_name":"Redmi Note8 Pro","category_id":1,"product_title":"6400ä¸‡å…¨åœºæ™¯å››æ‘„","product_intro":"6400ä¸‡å››æ‘„å°é‡‘åˆšæ‹ç…§æ–°æ——èˆ°è¶…å¼ºè§£æåŠ›ï¼Œè¶…éœ‡æ’¼","product_picture":"public/imgs/phone/Redmi-Note8-pro.png","product_price":1399,"product_selling_price":1199,"product_num":20,"product_sales":0},{"product_id":7,"product_name":"Redmi Note8","category_id":1,"product_title":"åƒå…ƒ4800ä¸‡å››æ‘„","product_intro":"åƒå…ƒ4800ä¸‡å››æ‘„ | é«˜é€šéªé¾™665 | å°é‡‘åˆšå“è´¨ä¿è¯","product_picture":"public/imgs/phone/Redmi-Note8.png","product_price":999,"product_selling_price":999,"product_num":20,"product_sales":0}]}
                ```
    
            *   **ä¸šåŠ¡åˆ†æ**
    
                1.  æ ¹æ®ä¼ å…¥çš„ç±»åˆ«åç§°ï¼Œè¿›è¡Œå•†å“åç§°æŸ¥è¯¢
    
                2.  æœ€å¤šæŸ¥è¯¢7æ¡æ•°æ®
    
                3.  æŸ¥è¯¢é”€å”®é‡æœ€å¤šçš„å•†å“ä¿¡æ¯
    
            *   åŠŸèƒ½å®ç°
    
                1.  param \[store-commons]
    
                    ```java
                    /**
                     * projectName: b2c-store
                     * <p>
                     * description: ç±»åˆ«çƒ­é—¨å•†å“å‚æ•°æ¥æ”¶
                     */
                    @Data
                    public class ProductPromoParam {
    
                        @NotBlank
                        private String categoryName;
                    }
                    ```
    
                2.  pojo \[store-commons]
    
                    ```java
                    @Data
                    @TableName("product")
                    public class Product implements Serializable {
    
                        public static final Long serialVersionUID = 1L;
    
                        @TableId(type = IdType.AUTO)
                        @JsonProperty("product_id")
                        private Integer productId;
    
                        @JsonProperty("product_name")
                        private String productName;
    
                        @JsonProperty("category_id")
                        private String categoryId;
    
                        /**
                         * æ‰‹æœºtitle
                         */
                        @JsonProperty("product_title")
                        private String productTitle;
    
                        /**
                         * æ‰‹æœºä¿¡æ¯æè¿°
                         */
                        @JsonProperty("product_intro")
                        private String productIntro;
    
                        @JsonProperty("product_picture")
                        private String productPicture;
    
                        /**
                         * å•†å“ä»·æ ¼
                         */
                        @JsonProperty("product_price")
                        private Double productPrice;
    
                        /**
                         * å”®å–ä»·æ ¼
                         */
                        @JsonProperty("product_selling_price")
                        private Double productSellingPrice;
    
                        /**
                         * å•†å“åº“å­˜
                         */
                        @JsonProperty("product_num")
                        private int productNum;
    
                        /**
                         * å·²å–æ•°é‡
                         */
                        @JsonProperty("product_sales")
                        private int productSales;


                    }
                    ```
    
                3.  feignClient \[store-commons]
    
                    ```java
                    /**
                     * projectName: b2c-store
                     * <p>
                     * description: ç±»åˆ«çš„è°ƒç”¨æ¥å£
                     */
                    @FeignClient("category-service")
                    public interface CategoryClient {
    
                        @GetMapping("/category/promo/{categoryName}")
                        R byName(@PathVariable String categoryName);
    
                    }
    
                    ```
    
                4.  controller
    
                    ```java
                    @RestController
                    @RequestMapping("product")
                    public class ProductController {
    
                        @Autowired
                        private ProductService productService;
    
                        @PostMapping("/promo")
                        public R promo(@RequestBody @Validated ProductPromoParam productPromoParam, BindingResult result){
    
                            if (result.hasErrors()){
                                return R.fail("æ•°æ®æŸ¥è¯¢å¤±è´¥!");
                            }
    
                            return  productService.promo(productPromoParam.getCategoryName());
                        }
    
                    }
    
                    ```
    
                5.  service
    
                    ```java
                    @Service
                    @Slf4j
                    public class ProductServiceImpl implements ProductService {


                        //å¼•å…¥feignå®¢æˆ·ç«¯éœ€è¦,åœ¨å¯åŠ¨ç±»æ·»åŠ é…ç½®æ³¨è§£
                        @Autowired
                        private CategoryClient categoryClient;
    
                        @Autowired
                        private ProductMapper productMapper;
                        /**
                         * å•ç±»åˆ«åç§° æŸ¥è¯¢çƒ­é—¨å•†å“ è‡³å¤š7æ¡æ•°æ®
                         *    1. æ ¹æ®ç±»åˆ«åç§° è°ƒç”¨ feignå®¢æˆ·ç«¯è®¿é—®ç±»åˆ«æœåŠ¡è·å–ç±»åˆ«çš„æ•°æ®
                         *    2. æˆåŠŸ ç»§ç»­æ ¹æ®ç±»åˆ«idæŸ¥è¯¢å•†å“æ•°æ®  [çƒ­é—¨ é”€å”®é‡å€’åº æŸ¥è¯¢7]
                         *    3. ç»“æœå°è£…å³å¯
                         * @param categoryName ç±»åˆ«åç§°
                         * @return r
                         */
                        @Override
                        public R promo(String categoryName) {
    
                            R r = categoryClient.byName(categoryName);
    
                            if (r.getCode().equals(R.FAIL_CODE)) {
                                log.info("ProductServiceImpl.promoä¸šåŠ¡ç»“æŸï¼Œç»“æœ:{}","ç±»åˆ«æŸ¥è¯¢å¤±è´¥!");
                                return r;
                            }
                            
                            // ç±»åˆ«æœåŠ¡ä¸­ data = category --- feign {json}  ----- productæœåŠ¡ LinkedHashMap jackson
    
                            LinkedHashMap<String,Object>  map = (LinkedHashMap<String, Object>) r.getData();
    
                            Integer categoryId = (Integer) map.get("categoryId");
                            //å°è£…æŸ¥è¯¢å‚æ•°
                            QueryWrapper<Product> queryWrapper = new QueryWrapper<>();
                            queryWrapper.eq("category_id",categoryId);
                            queryWrapper.orderByDesc("product_sales");
    
                            IPage<Product> page = new Page<>(1,7);
    
                            //è¿”å›çš„æ˜¯åŒ…è£…æ•°æ®! å†…éƒ¨æœ‰å¯¹åº”çš„å•†å“é›†åˆ,ä¹Ÿæœ‰åˆ†é¡µçš„å‚æ•° ä¾‹å¦‚: æ€»æ¡æ•° æ€»é¡µæ•°ç­‰ç­‰
                            page = productMapper.selectPage(page, queryWrapper);
    
                            List<Product> productList = page.getRecords(); //æŒ‡å®šé¡µçš„æ•°æ®
                            long total = page.getTotal(); //è·å–æ€»æ¡æ•°
    
                            log.info("ProductServiceImpl.promoä¸šåŠ¡ç»“æŸï¼Œç»“æœ:{}",productList);
    
                            return R.ok("æ•°æ®æŸ¥è¯¢æˆåŠŸ",productList);
                        }
                    }
    
                    ```
    
                6.  mapper
    
                    ```java
                    public interface ProductMapper extends BaseMapper<Product> {
                    }
                    ```
    
                7.  ProductApplication
    
                    ```java
                    @SpringBootApplication
                    @MapperScan(basePackages = "com.atguigu.product.mapper")
                    //å¼€å¯feignå®¢æˆ·ç«¯,å¼•å…¥å¯¹åº”çš„å®¢æˆ·ç«¯
                    @EnableFeignClients(clients = {CategoryClient.class})
                    public class ProductApplication {
    
                        public static void main(String[] args) {
                            SpringApplication.run(ProductApplication.class,args);
                        }
                        
                        /**
                         * æ–°çš„åˆ†é¡µæ’ä»¶,ä¸€ç¼“å’ŒäºŒç¼“éµå¾ªmybatisçš„è§„åˆ™,éœ€è¦è®¾ç½® MybatisConfiguration#useDeprecatedExecutor = false é¿å…ç¼“å­˜å‡ºç°é—®é¢˜(è¯¥å±æ€§ä¼šåœ¨æ—§æ’ä»¶ç§»é™¤åä¸€åŒç§»é™¤)
                         */
                        @Bean
                        public MybatisPlusInterceptor mybatisPlusInterceptor() {
                            MybatisPlusInterceptor interceptor = new MybatisPlusInterceptor();
                            interceptor.addInnerInterceptor(new PaginationInnerInterceptor(DbType.MYSQL));
                            return interceptor;
                        }
    
                    }
                    ```
    
        *   **é¦–é¡µçƒ­é—¨æ¥å£**
    
            *   æ¥å£åˆ†æ
    
                **è¯·æ±‚URLï¼š**/product/hots
    
                **è¯·æ±‚æ–¹å¼ï¼š** POST
    
                è¯·æ±‚ç±»å‹:   JSON
    
                **å‚æ•°è¯´æ˜ï¼š**
    
                { categoryNameï¼š\[â€œæ‰‹æœºâ€] }  &#x20;
    
                | å‚æ•°           | æ˜¯å¦å¿…é€‰ | ç±»å‹     | è¯´æ˜     |
                | ------------ | ---- | ------ | ------ |
                | categoryName | æ˜¯    | string | å•†å“ç±»åˆ«åç§° |
    
                è¿”å›ç¤ºä¾‹:
    
                ```java
                {
                 "code":"001",
                    //è¿”å›æ•°æ®æœ€å¤š7ä¸ª
                 "data":[{"product_id":1,
                 "product_name":"Redmi K30",
                 "category_id":1,"product_title":"120Hzæµé€Ÿå±ï¼Œ
                 å…¨é€Ÿçƒ­çˆ±","product_intro":"120Hzé«˜å¸§ç‡æµé€Ÿå±/
                  ç´¢å°¼6400ä¸‡å‰åå…­æ‘„ / 6.67'å°å­”å¾„å…¨é¢å± / 
                  æœ€é«˜å¯é€‰8GB+256GBå¤§å­˜å‚¨ / é«˜é€šéªé¾™730Gå¤„ç†å™¨ /
                   3Då››æ›²é¢ç»ç’ƒæœºèº« / 4500mAh+27Wå¿«å…… / 
                   å¤šåŠŸèƒ½NFC",
                   "product_picture":"public/imgs/phone
                   /Redmi-k30.png","product_price":2000,
                   "product_selling_price":1599,
                   "product_num":10,"product_sales":0},
                   {"product_id":2,"product_name":"Redmi K30 5G","category_id":1,"product_title":"åŒæ¨¡5G,120Hzæµé€Ÿå±","product_intro":"åŒæ¨¡5G / ä¸‰è·¯å¹¶å‘ / é«˜é€šéªé¾™765G / 7nm 5Gä½åŠŸè€—å¤„ç†å™¨ / 120Hzé«˜å¸§ç‡æµé€Ÿå± / 6.67'å°å­”å¾„å…¨é¢å± / ç´¢å°¼6400ä¸‡å‰åå…­æ‘„ / æœ€é«˜å¯é€‰8GB+256GBå¤§å­˜å‚¨ / 4500mAh+30Wå¿«å…… / 3Då››æ›²é¢ç»ç’ƒæœºèº« / å¤šåŠŸèƒ½NFC","product_picture":"public/imgs/phone/Redmi-k30-5G.png","product_price":2599,"product_selling_price":2599,"product_num":10,"product_sales":0},{"product_id":3,"product_name":"å°ç±³CC9 Pro","category_id":1,"product_title":"1äº¿åƒç´ ,äº”æ‘„å››é—ª","product_intro":"1äº¿åƒç´ ä¸»æ‘„ / å…¨åœºæ™¯äº”æ‘„åƒå¤´ / å››é—ªå…‰ç¯ / 3200ä¸‡è‡ªæ‹ / 10 å€æ··åˆå…‰å­¦å˜ç„¦ï¼Œ50å€æ•°å­—å˜ç„¦ / 5260mAh â¼¤ç”µï¥¾ / æ ‡é… 30Wç–¾é€Ÿå¿«å…… / â¼©ç±³â¾¸æ¬¾è¶…è–„å±ä¸‹æŒ‡çº¹ / å¾·å›½è±èŒµä½è“å…‰è®¤è¯ / å¤šåŠŸèƒ½NFC / çº¢å¤–ä¸‡èƒ½é¥æ§ / 1216è¶…çº¿æ€§æ‰¬å£°å™¨","product_picture":"public/imgs/phone/Mi-CC9.png","product_price":2799,"product_selling_price":2599,"product_num":20,"product_sales":0},{"product_id":4,"product_name":"Redmi 8","category_id":1,"product_title":"5000mAhè¶…é•¿ç»­èˆª","product_intro":"5000mAhè¶…é•¿ç»­èˆª / é«˜é€šéªé¾™439å…«æ ¸å¤„ç†å™¨ / 4GB+64GB","product_picture":"public/imgs/phone/Redmi-8.png","product_price":799,"product_selling_price":699,"product_num":20,"product_sales":0},{"product_id":5,"product_name":"Redmi 8A","category_id":1,"product_title":"5000mAhè¶…é•¿ç»­èˆª","product_intro":"5000mAhè¶…é•¿ç»­èˆª / é«˜é€šéªé¾™439å…«æ ¸å¤„ç†å™¨ / 4GB+64GB / 1200ä¸‡AIåç½®ç›¸æœº","product_picture":"public/imgs/phone/Redmi-8A.png","product_price":599,"product_selling_price":699,"product_num":20,"product_sales":0},{"product_id":6,"product_name":"Redmi Note8 Pro","category_id":1,"product_title":"6400ä¸‡å…¨åœºæ™¯å››æ‘„","product_intro":"6400ä¸‡å››æ‘„å°é‡‘åˆšæ‹ç…§æ–°æ——èˆ°è¶…å¼ºè§£æåŠ›ï¼Œè¶…éœ‡æ’¼","product_picture":"public/imgs/phone/Redmi-Note8-pro.png","product_price":1399,"product_selling_price":1199,"product_num":20,"product_sales":0},{"product_id":7,"product_name":"Redmi Note8","category_id":1,"product_title":"åƒå…ƒ4800ä¸‡å››æ‘„","product_intro":"åƒå…ƒ4800ä¸‡å››æ‘„ | é«˜é€šéªé¾™665 | å°é‡‘åˆšå“è´¨ä¿è¯","product_picture":"public/imgs/phone/Redmi-Note8.png","product_price":999,"product_selling_price":999,"product_num":20,"product_sales":0}]}
                ```
    
            *   ä¸šåŠ¡åˆ†æ
    
                *   çƒ­é—¨ç±»åˆ«å•†å“æŸ¥è¯¢
    
                *   ä¼ å…¥çš„ç±»åˆ«åç§°æ•°é‡ä¸ç¡®å®š
    
                *   æœ€å¤šæŸ¥è¯¢7æ¡
    
                *   éœ€è¦è°ƒç”¨ç±»åˆ«æœåŠ¡ï¼Œå°†ç±»åˆ«åç§°è½¬æˆID
    
            *   åŠŸèƒ½å®ç°
    
                1.  feignClientæ›´æ–°
    
                    ```java
                    @FeignClient("category-service")
                    public interface CategoryClient {
    
                        @GetMapping("/category/promo/{categoryName}")
                        R byName(@PathVariable String categoryName);
    
                        @PostMapping("/category/hots")
                        R hots(@RequestBody ProductHotParam productHotParam);
                    }
                    ```
    
                2.  controller
    
                    ```java
                    @PostMapping("hots")
                    public R hots(@RequestBody @Validated ProductHotParam productHotParam,BindingResult result){
    
                        if (result.hasErrors()){
                            return R.fail("æ•°æ®æŸ¥è¯¢å¤±è´¥!");
                        }
    
                        return productService.hots(productHotParam);
                    }
                    ```
    
                3.  service
    
                    ```java
                    /**
                     * å¤šç±»åˆ«çƒ­é—¨å•†å“æŸ¥è¯¢ æ ¹æ®ç±»åˆ«åç§°é›†åˆ! è‡³å¤šæŸ¥è¯¢7æ¡!
                     *   1. è°ƒç”¨ç±»åˆ«æœåŠ¡
                     *   2. ç±»åˆ«é›†åˆidæŸ¥è¯¢å•†å“
                     *   3. ç»“æœé›†å°è£…å³å¯
                     * @param productHotParam ç±»åˆ«åç§°é›†åˆ
                     * @return r
                     */
                    @Override
                    public R hots(ProductHotParam productHotParam) {
    
                        R r = categoryClient.hots(productHotParam);
    
                        if(r.getCode().equals(R.FAIL_CODE)){
                            log.info("ProductServiceImpl.hotsä¸šåŠ¡ç»“æŸï¼Œç»“æœ:{}",r.getMsg());
                            return r;
                        }
    
                        List<Object> ids = (List<Object>) r.getData();
    
                        //è¿›è¡Œå•†å“æ•°æ®æŸ¥è¯¢
                        QueryWrapper<Product> queryWrapper = new QueryWrapper<>();
                        queryWrapper.in("category_id",ids);
                        queryWrapper.orderByDesc("product_sales");
    
                        IPage<Product> page = new Page<>(1,7);
    
                        page = productMapper.selectPage(page,queryWrapper);
    
                        List<Product> records = page.getRecords();
    
                        R ok = R.ok("å¤šç±»åˆ«çƒ­é—¨å•†å“æŸ¥è¯¢æˆåŠŸ!", records);
    
                        log.info("ProductServiceImpl.hotsä¸šåŠ¡ç»“æŸï¼Œç»“æœ:{}",ok);
    
                        return ok;
                    }
                    ```
    
                4.  ProductApplication
    
                    ä¸Šé¢æ¥å£å·²ç»å¼•å…¥categoryClient
    
        *   **ç±»åˆ«ä¿¡æ¯æ¥å£**
    
            1.  æ¥å£åˆ†æ
    
                è¯·æ±‚URLï¼š/product/catetory/list
    
                è¯·æ±‚æ–¹å¼ï¼šPOST
    
                è¯·æ±‚ç±»å‹: JSON
    
                å‚æ•°è¯´æ˜ï¼š
    
                è¿”å›ç¤ºä¾‹:
    
                ```java
                {
                  "code": "001",
                  "data": [
                    {
                      "category_id": 1,
                      "category_name": "æ‰‹æœº"
                    },
                    {
                      "category_id": 2,
                      "category_name": "ç”µè§†æœº"
                    },
                    {
                      "category_id": 3,
                      "category_name": "ç©ºè°ƒ"
                    }
                  ]
                }
                ```
    
            2.  ä¸šåŠ¡åˆ†æ
    
                1.  è°ƒç”¨å•†å“æœåŠ¡
    
                2.  éœ€è¦å•†å“æœåŠ¡è°ƒç”¨ç±»åˆ«æœåŠ¡
    
            3.  ä»£ç å®ç°
    
                1.  feignClient
    
                    ```java
                    @GetMapping("/category/list")
                    R list();
                    ```
    
                2.  controller
    
                    ```java
                    @PostMapping("category/list")
                    public R clist(){
    
                        return productService.clist();
                    }
                    ```
    
                3.  service
    
                    ```java
                    /**
                     * æŸ¥è¯¢ç±»åˆ«å•†å“é›†åˆ
                     *
                     * @return
                     */
                    @Override
                    public R clist() {
                        R r = categoryClient.list();
                        log.info("ProductServiceImpl.clistä¸šåŠ¡ç»“æŸï¼Œç»“æœ:{}",r);
    
                        return r;
                    }
                    ```
    
                4.  æ³¨æ„ï¼šéœ€è¦ä¿®æ”¹promoä¸šåŠ¡æ–¹æ³•
    
                    ```java
                    LinkedHashMap<String,Object>  map = (LinkedHashMap<String, Object>) r.getData();
    
                    Integer categoryId = (Integer) map.get("category_id");
                    ```
    
        *   **ç±»åˆ«å•†å“æ¥å£**
    
            1.  æ¥å£åˆ†æ
    
                è¯·æ±‚URLï¼š/product/bycategory
    
                è¯·æ±‚æ–¹å¼ï¼šPOST
    
                è¯·æ±‚ç±»å‹:  JSON
    
                å‚æ•°è¯´æ˜ï¼š
    
                > {"categoryID":\[5,6,7,8],"currentPage":1,"pageSize":15}
    
                | å‚æ•°          | æ˜¯å¦å¿…é€‰ | ç±»å‹      | è¯´æ˜       |
                | ----------- | ---- | ------- | -------- |
                | categoryID  | æ˜¯    | int \[] | ç±»åˆ«idæ•°ç»„é›†åˆ |
                | currentPage | æ˜¯    | int     | é¡µæ•°       |
                | pageSize    | æ˜¯    | int     | é¡µå®¹é‡      |
    
                è¿”å›ç»“æœï¼š
    
                ```java
                {
                  code:"001",
                  data:[{å•†å“æ•°æ®}],
                  total:20 //æ€»æ•°é‡
                }
                ```
    
            2.  ä¸šåŠ¡åˆ†æ
    
                1.  è·å–åˆ—åˆ«é›†åˆï¼åŠ¨æ€åˆ¤æ–­æ˜¯å¦æ·»åŠ æ¡ä»¶
    
                2.  å°è£…åˆ†é¡µå‚æ•°
    
                3.  è¿›è¡Œæ•°æ®æŸ¥è¯¢
    
                4.  æŸ¥è¯¢å®Œæ¯•è¿›è¡Œç»“æœå°è£…
    
                5.  è€ƒè™‘ï¼šå¤ç”¨é—®é¢˜ï¼Œè·å–å…¨éƒ¨å•†å“ä¹Ÿæ˜¯åŒæ ·å‚æ•°ï¼Œåªä¸è¿‡ç±»åˆ«IDé›†åˆä¸ºemptyé›†åˆï¼
    
            3.  åŠŸèƒ½å®ç°
    
                1.  å®šä¹‰æ¥å—å‚æ•°param
    
                    > å› ä¸ºæ­¤param å…¶ä»–æ¨¡å—ä¸ä¼šé€šç”¨ï¼Œæ‰€ä»¥å®šä¹‰åœ¨å•†å“æœåŠ¡ä¸­ï¼
    
                    ```java
                    @Data
                    public class ProductParamInteger {
    
                        private List<Integer> categoryID;
                        private int currentPage = 1; //é»˜è®¤å€¼
                        private int pageSize = 15; //é»˜è®¤å€¼
    
                    }
                    ```
    
                2.  controller
    
                    ```java
                    /**
                     * ç±»åˆ«æŸ¥è¯¢
                     * @param productParamInteger
                     * @return
                     */
                    @PostMapping("bycategory")
                    public Object byCategory(@RequestBody ProductParamInteger productParamInteger){
    
                        return productService.byCategory(productParamInteger);
                    }
                    ```
    
                3.  service
    
                    ```java
                    /**
                     * ç±»åˆ«å•†å“æŸ¥è¯¢ å‰ç«¯ä¼ é€’ç±»åˆ«é›†åˆ
                     *
                     * @param productParamInteger
                     * @return
                     */
                    @Override
                    public Object byCategory(ProductParamInteger productParamInteger) {
    
                        //1.æ‹†åˆ†è¯·æ±‚å‚æ•°
                        List<Integer> categoryID = productParamInteger.getCategoryID();
                        int currentPage = productParamInteger.getCurrentPage();
                        int pageSize = productParamInteger.getPageSize();
                        //2.è¯·æ±‚æ¡ä»¶å°è£…
                        QueryWrapper<Product> productQueryWrapper = new QueryWrapper<>();
                        if (categoryID != null && categoryID.size() > 0){
                            productQueryWrapper.in("category_id",categoryID);
                        }
                        IPage<Product> page = new Page<>(currentPage,pageSize);
                        //3.æ•°æ®æŸ¥è¯¢
                        IPage<Product> iPage = productMapper.selectPage(page, productQueryWrapper);
                        //4.ç»“æœå°è£…
                        List<Product> productList = iPage.getRecords();
                        long total = iPage.getTotal();
    
                        R ok = R.ok(null, productList, total);
    
                        log.info("ProductServiceImpl.byCategoryä¸šåŠ¡ç»“æŸï¼Œç»“æœ:{}",ok);
                        return ok;
                    }
                    ```
    
        *   **å…¨éƒ¨å•†å“æ¥å£**
    
            1.  æ¥å£åˆ†æ
    
                è¯·æ±‚URLï¼š/product/all
    
                è¯·æ±‚æ–¹å¼ï¼šPOST
    
                è¯·æ±‚ç±»å‹:  JSON
    
                å‚æ•°è¯´æ˜ï¼š
    
                > {"categoryID":\[],"currentPage":1,"pageSize":15}
    
                | å‚æ•°          | æ˜¯å¦å¿…é€‰ | ç±»å‹      | è¯´æ˜       |
                | ----------- | ---- | ------- | -------- |
                | categoryID  | æ˜¯    | int \[] | ç±»åˆ«idæ•°ç»„é›†åˆ |
                | currentPage | æ˜¯    | int     | é¡µæ•°       |
                | pageSize    | æ˜¯    | int     | é¡µå®¹é‡      |
    
                è¿”å›ç»“æœï¼š
    
                ```java
                {
                  code:"001",
                  data:[{å•†å“æ•°æ®}],
                  total:20 //æ€»æ•°é‡
                }
                ```
    
            2.  ä¸šåŠ¡åˆ†æ
    
                1.  åˆ†é¡µå…¨éƒ¨å•†å“æŸ¥è¯¢
    
                2.  ç±»åˆ«é›†åˆä¸ºnull
    
                3.  å¯ä»¥å¤ç”¨ç±»åˆ«æ•°æ®æŸ¥è¯¢
    
            3.  åŠŸèƒ½å®ç°
    
                1.  controller
    
                    ```java
                    /**
                     * æŸ¥è¯¢å…¨éƒ¨å•†å“,å¯ä»¥å¤ç”¨ä¸šåŠ¡!
                     * @param productParamInteger
                     * @return
                     */
                    @PostMapping("all")
                    public Object all(@RequestBody ProductParamInteger productParamInteger){
    
                        return productService.all(productParamInteger);
                    }
                    ```
    
                2.  service
    
                    ```java
                    /**
                     * å…¨éƒ¨å•†å“æŸ¥è¯¢,å¯ä»¥è¿›è¡Œç±»åˆ«é›†åˆæ•°æ®æŸ¥è¯¢ä¸šåŠ¡å¤ç”¨
                     *
                     * @param productParamInteger
                     * @return
                     */
                    @Override
                    public Object all(ProductParamInteger productParamInteger) {
    
                        return byCategory(productParamInteger);
                    }
                    ```
    
        *   **å•†å“è¯¦æƒ…æ¥å£**
    
            1.  æ¥å£åˆ†æ
    
                è¯·æ±‚URLï¼š/product/detail
    
                è¯·æ±‚æ–¹å¼ï¼šPOST
    
                è¯·æ±‚ç±»å‹: JSON
    
                å‚æ•°è¯´æ˜ï¼š
    
                > {"productID":10}
    
                | å‚æ•°        | æ˜¯å¦å¿…é€‰ | ç±»å‹  | è¯´æ˜          |
                | --------- | ---- | --- | ----------- |
                | productID | æ˜¯    | int | å•†å“id,æŸ¥è¯¢å•†å“è¯¦æƒ… |
    
                è¿”å›ç»“æœï¼š
    
                ```sql
                {
                  "code": "001",
                  "data": 
                    {
                      "product_id": 10,
                      "product_name": "å°ç±³å…¨é¢å±ç”µè§†E55A",
                      "category_id": 2,
                      "product_title": "å…¨é¢å±è®¾è®¡ï¼Œäººå·¥æ™ºèƒ½è¯­éŸ³",
                      "product_intro": "å…¨é¢å±è®¾è®¡ | å†…ç½®å°çˆ±åŒå­¦ | 4K + HDR | æœæ¯”DTS | PatchWall | æµ·é‡å†…å®¹ | 2GB + 8GBå¤§å­˜å‚¨ | 64ä½å››æ ¸å¤„ç†å™¨",
                      "product_picture": "public/imgs/appliance/MiTv-E55A.png",
                      "product_price": 2099,
                      "product_selling_price": 1899,
                      "product_num": 10,
                      "product_sales": 0
                    }
                }
                ```
    
            2.  ä¸šåŠ¡åˆ†æ
    
                1.  æ ¹æ®å•†å“IDæŸ¥è¯¢å•†å“è¯¦æƒ…
    
                2.  æŸ¥è¯¢å®Œæ¯•è¿›è¡Œç»“æœå°è£…
    
            3.  åŠŸèƒ½å®ç°
    
                1.  controller
    
                    ```java
                    @PostMapping("detail")
                    public Object detail(@RequestBody Map<String,Integer> param){
                        Integer productID = param.get("productID");
                        return productService.detail(productID);
                    }
                    ```
    
                2.  service
    
                    ```java
                    /**
                     * æŸ¥è¯¢å•†å“è¯¦æƒ…
                     *
                     * @param productID å•†å“id
                     * @return
                     */
                    @Override
                    public Object detail(Integer productID) {
    
                        Product product = productMapper.selectById(productID);
    
                        R ok = R.ok(product);
                        
                        log.info("ProductServiceImpl.detailä¸šåŠ¡ç»“æŸï¼Œç»“æœ:{}",ok);
                        
                        return ok;
                    }
                    ```
    
        *   **å•†å“å›¾ç‰‡æ¥å£**
    
            1.  æ¥å£åˆ†æ
    
                è¯·æ±‚URLï¼š/product/pictures
    
                è¯·æ±‚æ–¹å¼ï¼šPOST
    
                è¯·æ±‚ç±»å‹: JSON
    
                å‚æ•°è¯´æ˜ï¼š
    
                > {"productID":10}
    
                | å‚æ•°        | æ˜¯å¦å¿…é€‰ | ç±»å‹  | è¯´æ˜          |
                | --------- | ---- | --- | ----------- |
                | productID | æ˜¯    | int | å•†å“id,æŸ¥è¯¢å•†å“è¯¦æƒ… |
    
                è¿”å›ç»“æœï¼š
    
                ```json
                {
                  "code": "001",
                  "data": [
                    {
                      "id": 42,
                      "product_id": 10,
                      "product_picture": "public/imgs/phone/picture/MiTv-E55A-1.jpg",
                      "intro": null
                    },
                    {
                      "id": 43,
                      "product_id": 10,
                      "product_picture": "public/imgs/phone/picture/MiTv-E55A-2.jpg",
                      "intro": null
                    },
                    {
                      "id": 44,
                      "product_id": 10,
                      "product_picture": "public/imgs/phone/picture/MiTv-E55A-3.jpg",
                      "intro": null
                    },
                    {
                      "id": 45,
                      "product_id": 10,
                      "product_picture": "public/imgs/phone/picture/MiTv-E55A-4.jpg",
                      "intro": null
                    }
                  ]
                }
                ```
    
            2.  ä¸šåŠ¡åˆ†æ
    
                1.  æ ¹æ®ä¼ å…¥çš„å•†å“IDï¼ŒæŸ¥è¯¢å•†å“å›¾ç‰‡
    
            3.  åŠŸèƒ½å®ç°
    
                1.  pojo \[store-common-feign]
    
                    ```java
                    @Data
                    @TableName("product_picture")
                    public class Picture implements Serializable {
    
                        public static final Long serialVersionUID = 1L;
    
                        @TableId(type= IdType.AUTO)
                        private Integer id;
                        @JsonProperty("product_id")
                        private Integer productId;
                        @JsonProperty("product_picture")
                        private String  productPicture;
                        private String  intro;
                    }
                    ```
    
                2.  controller
    
                    ```java
                    @PostMapping("pictures")
                    public Object productPictures(@RequestBody Map<String,Integer> param){
                        Integer productID = param.get("productID");
                        return productService.pictures(productID);
                    }
                    ```
    
                3.  service
    
                    ```java
                    /**
                     * æŸ¥è¯¢å•†å“å›¾ç‰‡
                     *
                     * @param productID
                     * @return
                     */
                    @Override
                    public Object pictures(Integer productID) {
                        
                        //å‚æ•°å°è£…
                        QueryWrapper<Picture> queryWrapper = new QueryWrapper<>();
                        queryWrapper.eq("product_id",productID);
                        //æ•°æ®åº“æŸ¥è¯¢
                        List<Picture> pictureList = pictureMapper.selectList(queryWrapper);
                        //ç»“æœå°è£…
                        R r = R.ok(pictureList);
                        
                        log.info("ProductServiceImpl.picturesä¸šåŠ¡ç»“æŸï¼Œç»“æœ:{}",r);
    
                        return r;
                    }
    
                    ```
    
                4.  mapper
    
                    ```java
                    public interface PictureMapper extends BaseMapper<Picture> {
                    }
                    ```
    
        *   **å•†å“æœç´¢æ¥å£**
    
            *   åŠŸèƒ½åˆ†æ
    
                ![](image/image_uGNaiOp-ID.png)
    
            *   æ¥å£åˆ†æ
    
                è¯·æ±‚URLï¼š/product/search
    
                è¯·æ±‚æ–¹å¼ï¼šPOST
    
                è¯·æ±‚ç±»å‹:  JSON
    
                å‚æ•°è¯´æ˜ï¼š
    
                > {"search":"å…³é”®å­—","currentPage":1,"pageSize":15}
    
                | å‚æ•°          | æ˜¯å¦å¿…é€‰ | ç±»å‹      | è¯´æ˜       |
                | ----------- | ---- | ------- | -------- |
                | categoryID  | æ˜¯    | int \[] | ç±»åˆ«idæ•°ç»„é›†åˆ |
                | currentPage | æ˜¯    | int     | é¡µæ•°       |
                | pageSize    | æ˜¯    | int     | é¡µå®¹é‡      |
    
                è¿”å›ç»“æœï¼š
    
                ```java
                {
                  code:"001",
                  data:[{å•†å“æ•°æ®}],
                  total:20 //æ€»æ•°é‡
                }
                ```
    
            *   ä¸šåŠ¡ä»‹ç»
    
                *   æ ¹æ®å…³é”®å­—è¿›è¡Œå•†å“æŸ¥è¯¢
    
                *   å•†å“æŸ¥è¯¢è°ƒç”¨æœç´¢æœåŠ¡è¿›è¡ŒæŸ¥è¯¢
    
            *   åŠŸèƒ½å®ç°
    
                *   å®šä¹‰æœç´¢Client \[store-commons]
    
                    ```java
                    @FeignClient(name = "search-service")
                    public interface SearchClient {
    
                        /**
                         * æœç´¢æœåŠ¡ å•†å“æŸ¥è¯¢
                         * @param productParamsSearch
                         * @return
                         */
                        @PostMapping("/search/product")
                        R search(@RequestBody ProductParamsSearch productParamsSearch);
    
                    }
                    ```
    
                *   ä¿®æ”¹å¯åŠ¨ç±»
    
                    ```java
                    @SpringBootApplication
                    @MapperScan(basePackages = "com.atguigu.product.mapper")
                    //å¼€å¯feignå®¢æˆ·ç«¯,å¼•å…¥å¯¹åº”çš„å®¢æˆ·ç«¯
                    @EnableFeignClients(clients = {CategoryClient.class, SearchClient.class})
                    public class ProductApplication {
    
                        public static void main(String[] args) {
                            SpringApplication.run(ProductApplication.class,args);
                        }
    
                    }
    
                    ```
    
                *   controller
    
                    ```java
                    @PostMapping("search")
                    public Object search(@RequestBody ProductParamsSearch productParamsSearch){
    
                        return productService.search(productParamsSearch);
                    }
    
                    ```
    
                *   service
    
                    ```java
                    /**
                     * å…³é”®å­—å•†å“æœç´¢
                     *
                     * @param productParamsSearch
                     * @return
                     */
                    @Cacheable(value = "list.product",key = "#productParamsSearch.search+'-'+#productParamsSearch.pageSize+'-'+#productParamsSearch.currentPage")
                    @Override
                    public Object search(ProductParamsSearch productParamsSearch) {
    
                        R r = searchClient.search(productParamsSearch);
    
                        log.info("ProductServiceImpl.searchä¸šåŠ¡ç»“æŸï¼Œç»“æœ:{}",r);
                        return r;
                    }
                    ```
    
    *   postmanæµ‹è¯•
    
    *   å‰ç«¯è”è°ƒ

*   **ç±»åˆ«æœåŠ¡**

    *   ä»‹ç»

        > ç±»åˆ«æ•°æ®æ“ä½œæœåŠ¡

    *   æœåŠ¡æ­å»º

        *   å¯¼å…¥æ•°æ®åº“

            [store\_category.sql](file/store_category_ukd_ygn4f1.sql)

            ```java
            # å°†æ•°æ®åº“è„šæœ¬å¤åˆ¶åˆ°æŸç›˜ç¬¦ä¸‹ï¼Œæ–¹ä¾¿å¯¼å…¥ï¼
            # æ‰§è¡Œæ•°æ®åº“è„šæœ¬å¯¼å…¥å‘½ä»¤ï¼æ³¨æ„ä¹±ç é—®é¢˜ï¼
            # æ­¥éª¤1:ä½¿ç”¨cmdå‘½ä»¤çª—å£ç™»å½•mysqlï¼Œé˜²æ­¢å¯¼å…¥ä¹±ç é—®é¢˜
            mysql -uè´¦å· -på¯†ç  --default-character-set=utf8  å›è½¦
            # æ­¥éª¤2:å¯¼å…¥æ•°æ®æ–‡ä»¶ æ³¨æ„ï¼Œè¦å†™ä½ è‡ªå·±çš„æ–‡ä»¶åœ°å€
            source d:\store_category.sql  å›è½¦  
            # æ­¥éª¤3: æŸ¥çœ‹æ•°æ®åº“
            show databases;
            ```

        *   åˆ›å»ºæœåŠ¡

            æ¨¡å—åï¼š store-front-category

        *   å¯¼å…¥ä¾èµ–

            ```xml
            <dependencies>
              <dependency>
                  <groupId>org.springframework.boot</groupId>
                  <artifactId>spring-boot-starter-web</artifactId>
              </dependency>
              <dependency>
                  <groupId>mysql</groupId>
                  <artifactId>mysql-connector-java</artifactId>
              </dependency>
              <!--mybatis-->
              <dependency>
                  <groupId>org.mybatis.spring.boot</groupId>
                  <artifactId>mybatis-spring-boot-starter</artifactId>
              </dependency>
              <!-- nacoså®¢æˆ·ç«¯ä¾èµ–åŒ… -->
              <dependency>
                  <groupId>com.alibaba.cloud</groupId>
                  <artifactId>spring-cloud-starter-alibaba-nacos-discovery</artifactId>
              </dependency>
              <!--feignå®¢æˆ·ç«¯ä¾èµ–-->
              <dependency>
                  <groupId>org.springframework.cloud</groupId>
                  <artifactId>spring-cloud-starter-openfeign</artifactId>
              </dependency>
              <!--å¼•å…¥HttpClientä¾èµ–-->
              <dependency>
                  <groupId>io.github.openfeign</groupId>
                  <artifactId>feign-httpclient</artifactId>
              </dependency>

              <dependency>
                  <groupId>com.baomidou</groupId>
                  <artifactId>mybatis-plus-boot-starter</artifactId>
              </dependency>

              <dependency>
                  <groupId>com.alibaba</groupId>
                  <artifactId>druid-spring-boot-starter</artifactId>
              </dependency>

              <!-- æ­¤å¤„æ˜¯ä½ çš„store_common_feignæ¨¡å—çš„gav,å¦‚æœä¸ä¸€è‡´,éœ€è¦æ”¹è¿›,æ³¨æ„,éœ€è¦æ”¾å…¥mavenæœ¬åœ°åº“!-->
              <dependency>
                  <artifactId>store-commons</artifactId>
                  <groupId>com.atguigu</groupId>
                  <version>1.0.0</version>
              </dependency>

            </dependencies>
            ```

        *   å£°æ˜é…ç½®

            *   bootstrap.yml

                ```yaml
                spring:
                  application:
                    name: category-service
                  cloud:
                    nacos:
                      server-addr: 124.221.70.206:8848
                server:
                  port: 3005
                ```

            *   application.yml

                ```yaml
                spring:
                  # è¿æ¥æ± é…ç½®
                  datasource:
                    url: jdbc:mysql://localhost:3306/store_category?useSSL=false
                    username: root
                    password: 123456
                    driver-class-name: com.mysql.jdbc.Driver
                    type: com.alibaba.druid.pool.DruidDataSource
                mybatis-plus:
                  mapper-locations: classpath:mappers/*.xml
                  configuration:
                    map-underscore-to-camel-case: true
                    auto-mapping-behavior: full
                    lazy-loading-enabled: true
                    aggressive-lazy-loading: false
                  type-aliases-package: com.atguigu.pojo #è®¾ç½®åˆ«å
                ribbon:
                  eager-load:
                    enabled: true #å¼€å¯é¥¥é¥¿åŠ è½½æå‡ç¬¬ä¸€æ¬¡è®¿é—®é€Ÿåº¦
                    clients:
                      - category-service #æŒ‡å®šå¼€å¯æœåŠ¡
                feign:
                  httpclient:
                    enabled: true  # å¼€å¯httpClientå¼€å…³,å¯åŠ¨è¿æ¥æ± ,æå‡feignè¿æ¥æ•ˆç‡!
                    max-connections: 200  #æœ€å¤§è¿æ¥æ•°é‡
                    max-connections-per-route: 50  #å•è·¯å¾„æœ€å¤§è¿æ¥æ•°
                ```

        *   åˆ›å»ºå¯åŠ¨ç±»

            ```java
            /**
             * projectName: b2c-cloud-store
             *
             * @author: èµµä¼Ÿé£
             * description: å¯åŠ¨ç±»
             */
            @SpringBootApplication
            @MapperScan(basePackages = "com.atguigu.category.mapper")
            public class CategoryApplication {

                public static void main(String[] args) {
                    SpringApplication.run(CategoryApplication.class,args);
                }
                
                
                /**
                 * æ–°çš„åˆ†é¡µæ’ä»¶,ä¸€ç¼“å’ŒäºŒç¼“éµå¾ªmybatisçš„è§„åˆ™,éœ€è¦è®¾ç½® MybatisConfiguration#useDeprecatedExecutor = false é¿å…ç¼“å­˜å‡ºç°é—®é¢˜(è¯¥å±æ€§ä¼šåœ¨æ—§æ’ä»¶ç§»é™¤åä¸€åŒç§»é™¤)
                 */
                @Bean
                public MybatisPlusInterceptor mybatisPlusInterceptor() {
                    MybatisPlusInterceptor interceptor = new MybatisPlusInterceptor();
                    interceptor.addInnerInterceptor(new PaginationInnerInterceptor(DbType.MYSQL));
                    return interceptor;
                }
                
            }
            ```

        *   æ·»åŠ ç½‘å…³é…ç½®

            ä¿®æ”¹ä½ç½®ï¼šstore-gateway/application.yml

            ```yaml
            - id: category-service  # ç±»åˆ«æœåŠ¡
              uri: lb://category-service 
              predicates:
                - Path=/category/**
            ```

    *   åŠŸèƒ½å®ç°

        *   ç±»åˆ«åˆ—è¡¨æ¥å£

            1.  æ¥å£ä»‹ç»

                è¯·æ±‚URLï¼š/category/list

                è¯·æ±‚æ–¹å¼ï¼šget

                è¯·æ±‚ç±»å‹:   æ— 

                å‚æ•°è¯´æ˜ï¼š&#x20;

                | å‚æ•° | æ˜¯å¦å¿…é€‰ | ç±»å‹ | è¯´æ˜ |
                | -- | ---- | -- | -- |

                è¿”å›ç»“æœï¼š

                ```json
                {
                  "code": "001",
                  "data": [
                    {
                      "category_id": 1,
                      "category_name": "æ‰‹æœº"
                    },
                    {
                      "category_id": 2,
                      "category_name": "ç”µè§†æœº"
                    },
                    {
                      "category_id": 3,
                      "category_name": "ç©ºè°ƒ"
                    }
                  ]
                }
                ```

            2.  åŠŸèƒ½ä»‹ç»

                1.  æ­¤æ¥å£æä¾›**å•†å“æœåŠ¡è¿›è¡Œç±»åˆ«æŸ¥è¯¢è°ƒç”¨**

                2.  æˆ‘ä»¬åªéœ€è¦è¿”å›ç±»åˆ«æ•°æ®é›†åˆå³å¯

            3.  åŠŸèƒ½å®ç°

                1.  pojoä¿®æ”¹

                    ä½ç½®ï¼š store-common

                    ```java
                    @Data
                    @TableName("category")
                    public class Category implements Serializable {
                        
                        public static final Long serialVersionUID = 1L;
                        
                        @TableId(type = IdType.AUTO)
                        @JsonProperty("category_id")
                        private Integer categoryId;
                        @JsonProperty("category_name")
                        private String  categoryName;
                    }
                    ```

                2.  controller

                    ```java
                    @GetMapping("list")
                    public R list(){

                        return categoryService.list();
                    }
                    ```

                3.  service

                    ```java
                    /**
                     * æŸ¥è¯¢ç±»åˆ«æ•°æ®,è¿›è¡Œè¿”å›!
                     *
                     * @return r ç±»åˆ«æ•°æ®é›†åˆ
                     */
                    @Override
                    public R list() {

                        List<Category> categoryList = categoryMapper.selectList(null);
                        R ok = R.ok("ç±»åˆ«å…¨éƒ¨æ•°æ®æŸ¥è¯¢æˆåŠŸ!", categoryList);
                        log.info("CategoryServiceImpl.listä¸šåŠ¡ç»“æŸï¼Œç»“æœ:{}",ok);
                        return ok;
                    }
                    ```

                4.  mapper

                    ```java
                    public interface CategoryMapper  extends BaseMapper<Category> {
                    }
                    ```

        *   ç±»åˆ«è¯¦æƒ…æ¥å£

            1.  æ¥å£ä»‹ç»

                è¯·æ±‚URLï¼š/category/{categoryName}

                è¯·æ±‚æ–¹å¼ï¼šget

                è¯·æ±‚ç±»å‹:   è·¯å¾„å‚æ•°

                å‚æ•°è¯´æ˜ï¼š&#x20;

                | å‚æ•°           | æ˜¯å¦å¿…é€‰ | ç±»å‹     | è¯´æ˜   |
                | ------------ | ---- | ------ | ---- |
                | categoryName | æ˜¯    | string | ç±»åˆ«åç§° |

                è¿”å›ç»“æœï¼š

                ```json
                # åˆ†æè¿”å›ç»“æœï¼Œå¦‚ä½•æ ¹æ®æ•°æ®åº“æŸ¥è¯¢ï¼Œè¿”å›å¯¹åº”çš„ç»“æœï¼ 
                {
                 code:"001"
                 data:{category_id:1,category_name:"ç±»åˆ«å"}
                }
                ```

            2.  åŠŸèƒ½ä»‹ç»

                1.  æ ¹æ®ç±»åˆ«åç§°ï¼ŒæŸ¥è¯¢ç±»åˆ«ä¿¡æ¯

                2.  è·¯å¾„æ–¹å¼è¿›è¡Œå‚æ•°ä¼ é€’

                3.  å¦‚æœç±»åˆ«åç§°ä¸ºnullï¼Œç»™äºˆä¸€ä¸ªé»˜è®¤å€¼ã€æ‰‹æœºã€‘ç±»åˆ«

                4.  è¿”å›æ˜¯ç±»åˆ«å¯¹è±¡

            3.  åŠŸèƒ½å®ç°

                1.  category \[store-commons

                    ```java
                    @TableName("category")
                    @Data
                    public class Category {

                        @TableId(type = IdType.AUTO)
                        private Integer categoryId;
                        private String  categoryName;
                    }
                    ```

                2.  controller

                    ```java
                    @RestController
                    @RequestMapping("category")
                    public class CategoryController {

                        @Autowired
                        private CategoryService categoryService;

                        @GetMapping("/promo/{categoryName}")
                        public R byName(@PathVariable String categoryName){

                            if (StringUtils.isEmpty(categoryName)){
                                return R.fail("ç±»åˆ«åç§°ä¸ºnull,æ— æ³•æŸ¥è¯¢ç±»åˆ«æ•°æ®!");
                            }

                            return categoryService.byName(categoryName);
                        }

                    }
                    ```

                3.  service

                    ```java
                    @Service
                    @Slf4j
                    public class CategoryServiceImpl implements CategoryService {
        
                        @Autowired
                        private CategoryMapper categoryMapper;
        
                        /**
                         * æ ¹æ®ç±»åˆ«åç§°,æŸ¥è¯¢ç±»åˆ«å¯¹è±¡
                         *
                         * @param categoryName
                         * @return
                         */
                        @Override
                        public R byName(String categoryName) {
        
                            //å°è£…æŸ¥è¯¢å‚æ•°
                            QueryWrapper<Category> categoryQueryWrapper = new QueryWrapper<>();
                            categoryQueryWrapper.eq("category_name",categoryName);
                            //æŸ¥è¯¢æ•°æ®åº“
                            Category category = categoryMapper.selectOne(categoryQueryWrapper);
                            //ç»“æœå°è£…
                            if (category == null){
                                log.info("CategoryServiceImpl.byNameä¸šåŠ¡ç»“æŸï¼Œç»“æœ:ç±»åˆ«æŸ¥è¯¢å¤±è´¥");
                                return R.fail("ç±»åˆ«æŸ¥è¯¢å¤±è´¥!");
                            }
                            log.info("CategoryServiceImpl.byNameä¸šåŠ¡ç»“æŸï¼Œç»“æœ:{}","ç±»åˆ«æŸ¥è¯¢æˆåŠŸ");
                            return R.ok("ç±»åˆ«æŸ¥è¯¢æˆåŠŸ!",category);
                        }
                    }
                    ```

        *   å¤šç±»åˆ«æ¥å£

            1.  æ¥å£ä»‹ç»

                è¯·æ±‚URLï¼š/category/names

                è¯·æ±‚æ–¹å¼ï¼špost

                è¯·æ±‚ç±»å‹:   JSON

                å‚æ•°è¯´æ˜ï¼š&#x20;

                { categoryName:\["ç±»åˆ«åç§°","ç±»åˆ«åç§°"] }

                | å‚æ•°           | æ˜¯å¦å¿…é€‰ | ç±»å‹         | è¯´æ˜     |
                | ------------ | ---- | ---------- | ------ |
                | categoryName | æ˜¯    | string \[] | ç±»åˆ«åç§°é›†åˆ |

                è¿”å›ç»“æœï¼š

                ```json
                # åˆ†æè¿”å›ç»“æœï¼Œå¦‚ä½•æ ¹æ®æ•°æ®åº“æŸ¥è¯¢ï¼Œè¿”å›å¯¹åº”çš„ç»“æœï¼ 
                {
                 code:"001"
                 data:[1,2,3,4]
                }
                ```

            2.  ä¸šåŠ¡ä»‹ç»

                1.  æ ¹æ®ç±»åˆ«åç§°ï¼ŒæŸ¥è¯¢ç±»åˆ«IDé›†åˆ

                2.  è¯¥ä¸šåŠ¡ä¸»è¦è¢«å•†å“ä¸šåŠ¡è°ƒç”¨

                3.  ç”¨äºå¤šç±»åˆ«çƒ­é—¨å•†å“æŸ¥è¯¢

            3.  ä»£ç å®ç°

                1.  å£°æ˜paramå¯¹è±¡\[store-common]

                    > å£°æ˜paramç”¨äºæ¥å—è¯·æ±‚å‚æ•°

                    ```java
                    /**
                     * projectName: b2c-store
                     * <p>
                     * description: çƒ­é—¨å•†å“å‚æ•°æ¥æ”¶å¯¹è±¡
                     */
                    @Data
                    public class ProductHotParam {

                        @NotEmpty
                        private List<String> categoryName;
                    }

                    ```

                2.  controller

                    ```java
                    /**
                     * çƒ­é—¨ç±»åˆ«idæŸ¥è¯¢!
                     * @param productHotParam
                     * @param result
                     * @return
                     */
                    @PostMapping("hots")
                    public R hotsCategory(@RequestBody @Validated ProductHotParam productHotParam, BindingResult result){

                        if (result.hasErrors()){
                            return R.fail("ç±»åˆ«é›†åˆæŸ¥è¯¢å¤±è´¥!");
                        }

                        return categoryService.hotsCategory(productHotParam);
                    }
                    ```

                3.  serivice

                    ```java
                    /**
                     * æ ¹æ®ä¼ å…¥çš„çƒ­é—¨ç±»åˆ«åç§°é›†åˆ!è¿”å›ç±»åˆ«å¯¹åº”çš„idé›†åˆ
                     *
                     * @param productHotParam
                     * @return
                     */
                    @Override
                    public R hotsCategory(ProductHotParam productHotParam) {
            
                        //å°è£…æŸ¥è¯¢å‚æ•°
                        QueryWrapper<Category> queryWrapper = new QueryWrapper<>();
                        queryWrapper.in("category_name",productHotParam.getCategoryName());
                        queryWrapper.select("category_id");
            
                        //æŸ¥è¯¢æ•°æ®åº“
                        List<Object> ids = categoryMapper.selectObjs(queryWrapper);
            
                        R ok = R.ok("ç±»åˆ«é›†åˆæŸ¥è¯¢æˆåŠŸ", ids);
                        log.info("CategoryServiceImpl.hotsCategoryä¸šåŠ¡ç»“æŸï¼Œç»“æœ:{}",ok);
                        return ok;
                    }
                    ```

    *   postmanæµ‹è¯•

    *   å‰ç«¯è¿è°ƒ

*   **æœç´¢æœåŠ¡**

    *   ä»‹ç»

        > ä½¿ç”¨elasticsearchæŠ€æœ¯å®ç°å•†å“æœç´¢åŠŸèƒ½ï¼Œç›¸å¯¹mysqlï¼Œæ•ˆç‡æ›´é«˜ï¼Œåˆ†è¯æŸ¥æ‰¾æ›´åˆç†ï¼

    *   æœåŠ¡æ­å»º

        *   åˆ›å»ºæœåŠ¡

            æ¨¡å—åï¼šstore-search

        *   å¯¼å…¥ä¾èµ–

            çˆ¶å·¥ç¨‹ä¸­ï¼Œå£°æ˜esä¾èµ–ç‰ˆæœ¬ï¼š

            <**elasticsearch.version**>7.12.1\</**elasticsearch.version**>

            ```xml
             <dependencies>
                  <dependency>
                      <groupId>org.springframework.boot</groupId>
                      <artifactId>spring-boot-starter-web</artifactId>
                  </dependency>
                  <dependency>
                      <groupId>mysql</groupId>
                      <artifactId>mysql-connector-java</artifactId>
                  </dependency>
                  <!--mybatis-->
                  <dependency>
                      <groupId>org.mybatis.spring.boot</groupId>
                      <artifactId>mybatis-spring-boot-starter</artifactId>
                  </dependency>
                  <!-- nacoså®¢æˆ·ç«¯ä¾èµ–åŒ… -->
                  <dependency>
                      <groupId>com.alibaba.cloud</groupId>
                      <artifactId>spring-cloud-starter-alibaba-nacos-discovery</artifactId>
                  </dependency>
                  <!--feignå®¢æˆ·ç«¯ä¾èµ–-->
                  <dependency>
                      <groupId>org.springframework.cloud</groupId>
                      <artifactId>spring-cloud-starter-openfeign</artifactId>
                  </dependency>
                  <!--å¼•å…¥HttpClientä¾èµ–-->
                  <dependency>
                      <groupId>io.github.openfeign</groupId>
                      <artifactId>feign-httpclient</artifactId>
                  </dependency>

                  <dependency>
                      <groupId>com.baomidou</groupId>
                      <artifactId>mybatis-plus-boot-starter</artifactId>
                  </dependency>

                  <dependency>
                      <groupId>com.alibaba</groupId>
                      <artifactId>druid-spring-boot-starter</artifactId>
                  </dependency>

                  <!-- æ­¤å¤„æ˜¯ä½ çš„store_common_feignæ¨¡å—çš„gav,å¦‚æœä¸ä¸€è‡´,éœ€è¦æ”¹è¿›,æ³¨æ„,éœ€è¦æ”¾å…¥mavenæœ¬åœ°åº“!-->
                  <dependency>
                      <artifactId>store-commons</artifactId>
                      <groupId>com.atguigu</groupId>
                      <version>1.0.0</version>
                  </dependency>

                  <!--AMQPä¾èµ–ï¼ŒåŒ…å«RabbitMQ-->
                  <dependency>
                      <groupId>org.springframework.boot</groupId>
                      <artifactId>spring-boot-starter-amqp</artifactId>
                  </dependency>

                  <!-- å¯¼å…¥esä¾èµ– -->
                  <dependency>
                      <groupId>org.elasticsearch.client</groupId>
                      <artifactId>elasticsearch-rest-high-level-client</artifactId>
                  </dependency>

            </dependencies>
            ```

        *   å£°æ˜é…ç½®

            *   bootstrap.yml

                ```yaml
                spring:
                  application:
                    name: search-service
                  cloud:
                    nacos:
                      server-addr: 124.221.70.206:8848
                server:
                  port: 3007
                ```

            *   application.yml

                ```yaml
                ribbon:
                  eager-load:
                    enabled: true #å¼€å¯é¥¥é¥¿åŠ è½½æå‡ç¬¬ä¸€æ¬¡è®¿é—®é€Ÿåº¦
                    clients:
                      - search-service #æŒ‡å®šå¼€å¯æœåŠ¡
                feign:
                  httpclient:
                    enabled: true  # å¼€å¯httpClientå¼€å…³,å¯åŠ¨è¿æ¥æ± ,æå‡feignè¿æ¥æ•ˆç‡!
                    max-connections: 200  #æœ€å¤§è¿æ¥æ•°é‡
                    max-connections-per-route: 50  #å•è·¯å¾„æœ€å¤§è¿æ¥æ•°
                ```

        *   é…ç½®å¯åŠ¨ç±»

            ```java
            //æ’é™¤è‡ªåŠ¨å¯¼å…¥æ•°æ®åº“é…ç½®,å¦è€…å‡ºç°ä¸ºé…ç½®è¿æ¥æ± ä¿¡æ¯å¼‚å¸¸
            @SpringBootApplication(exclude = {
                    DataSourceAutoConfiguration.class,
                    DataSourceTransactionManagerAutoConfiguration.class,
                    DruidDataSourceAutoConfigure.class ,
                    HibernateJpaAutoConfiguration.class}).
            public class SearchApplication {

                public static void main(String[] args) {
                    System.out.println("SearchApplication.main-----");
                    SpringApplication.run(SearchApplication.class,args);
                    System.out.println("SearchApplication.main+++++");
                }
            }

            ```

        *   æ·»åŠ ç½‘å…³é…ç½®

            store-gatewayä¸­ï¼Œæ·»åŠ ç½‘å…³é…ç½®

            ```yaml
            - id: search-service  # ç±»åˆ«æœåŠ¡
              uri: lb://search-service
              predicates:
                - Path=/search/**
            ```

    *   åŠŸèƒ½å®ç°

        *   **åŒæ­¥æ•°æ®**

            *   åŒæ­¥æ•°æ®æ—¶æœº

                ![](image/image_s0xciGQKGX.png)

                1.  ç›‘æ§æŸ¥è¯¢æœåŠ¡å¯åŠ¨

                2.  **æ¯æ¬¡å¯åŠ¨ï¼Œè¿›è¡Œesæ•°æ®æ•´ä½“æ›´æ–°**

                3.  å•†åŸåå°ç®¡ç†å•†å“ä¿®æ”¹åˆ é™¤æ·»åŠ ï¼Œå‡ºå‘æ›´æ–°

            *   å®šä¹‰å•†å“æœåŠ¡è¿”å›æ•°æ®æ¥å£ã€store-front-productã€‘

                *   æ¥å£åˆ†æ

                    è¯·æ±‚URLï¼š/product/list

                    è¯·æ±‚æ–¹å¼ï¼šget

                    è¯·æ±‚ç±»å‹:   æ— 

                    å‚æ•°è¯´æ˜ï¼š&#x20;

                    | å‚æ•° | æ˜¯å¦å¿…é€‰ | ç±»å‹ | è¯´æ˜ |
                    | -- | ---- | -- | -- |

                    è¿”å›ç»“æœï¼š

                    ```json
                    # åˆ†æè¿”å›ç»“æœï¼Œå¦‚ä½•æ ¹æ®æ•°æ®åº“æŸ¥è¯¢ï¼Œè¿”å›å¯¹åº”çš„ç»“æœï¼ 
                    [
                      {å•†å“json}
                    ] 
                    ```

                *   controller

                    ```java
                    /**
                     * æŸ¥è¯¢å…¨éƒ¨å•†å“ä¿¡æ¯,ä¾›searchæœåŠ¡æ›´æ–°
                     * @return
                     */
                    @GetMapping("list")
                    public List<Product> list(){
                        
                        return productService.list();
                    }
                    ```

                *   service

                    ```java
                    /**
                     * æŸ¥è¯¢å…¨éƒ¨å•†å“ä¿¡æ¯
                     *
                     * @return
                     */
                    @Override
                    public List<Product> list() {
                
                        List<Product> products = productMapper.selectList(null);
                
                        return products;
                    }
                    ```

            *   å®šä¹‰å•†å“feignClient ã€store-common-feignã€‘

                ```java
                /**
                 * projectName: b2c-cloud-store
                 *
                 * @author: èµµä¼Ÿé£
                 * description:å•†å“å®¢æˆ·ç«¯
                 */
                @FeignClient(value = "product-service")
                public interface ProductClient {

                    /**
                     * å•†å“å…¨éƒ¨æ•°æ®è°ƒç”¨
                     * @return
                     */
                    @GetMapping("/product/list")
                    List<Product> list();
                }
                ```

            *   å‡†å¤‡dslè¯­å¥

                å‡†å¤‡å•†å“ç´¢å¼•åˆ›å»ºDSLè¯­å¥ï¼

                å°†å•†å“åï¼Œæ ‡é¢˜ä»¥åŠè¯¦ç»†æè¿°ï¼Œæ·»åŠ åˆ°allå­—æ®µï¼Œç›´æ¥ä½¿ç”¨allå­—æ®µæœç´¢å³å¯!

                ä¸åœ¨å•ç‹¬è¿›è¡Œæœç´¢,æé«˜æŸ¥è¯¢æ•ˆç‡!

                ```json
                # åˆ é™¤ç´¢å¼•ç»“æ„
                DELETE /product


                # åˆ›å»ºå•†å“ç´¢å¼•!
                # æ ¹æ®å¤šåˆ—æœç´¢æ€§èƒ½è¾ƒå·®,ç»„æˆæˆä¸€åˆ—æœç´¢æé«˜æ€§èƒ½
                PUT /product
                {
                  "mappings": {
                    "properties": {
                      "productId":{
                        "type": "integer"
                      },
                      "productName":{
                        "type": "text",
                        "analyzer": "ik_smart",
                        "copy_to": "all"
                      },
                      "categoryId":{
                        "type": "integer"
                      },
                      "productTitle":{
                        "type": "text",
                        "analyzer": "ik_smart",
                        "copy_to": "all"
                      },
                      "productIntro":{
                        "type":"text",
                        "analyzer": "ik_smart",
                        "copy_to": "all"
                      },
                      "productPicture":{
                        "type": "keyword",
                        "index": false
                      },
                      "productPrice":{
                        "type": "double",
                        "index": true
                      },
                      "productSellingPrice":{
                        "type": "double"
                      },
                      "productNum":{
                        "type": "integer"
                      },
                      "productSales":{
                        "type": "integer"
                      },
                      "all":{
                        "type": "text",
                        "analyzer": "ik_max_word"
                      }
                    }
                  }
                }



                #æŸ¥è¯¢ç´¢å¼•
                GET /product/_mapping
    
                #å…¨éƒ¨æŸ¥è¯¢
    
                GET /product/_search
                {
                  "query": {
                      "match_all": {
                        
                      }
                  }
                }
    
                #å…³é”®å­—æŸ¥è¯¢
    
                GET /product/_search
                {
                  "query": {
                     "match": {
                       "all": "æœ€å¥½"
                     }
                  }
    
                }


                # å…³é”®å­— å’Œ æ·»åŠ åˆ†é¡µ
                GET /product/_search
                {
                  "query": {
                     "match": {
                       "all": "æœ€å¥½"
                     }
                  },
                  "from": 0,
                  "size": 1
    
                }



                # æ·»åŠ æ•°æ®
                POST /product/_doc/1
                {
                  "productId":1,
                  "productName":"é›·ç¢§",
                  "productTitle":"æœ€å¥½çš„ç¢³é…¸é¥®æ–™",
                  "categoryId":1,
                  "productIntro":"ç¡«é…¸+ç…¤ç‚­åˆ¶å“æœ€å¥½çš„äº§å“!",
                  "productPicture":"http://www.baidu.com",
                  "productPrice":10.5,
                  "productSellingPrice":6.0,
                  "productNum":10,
                  "productSales":5
                }
    
                # åˆ é™¤æ•°æ®
                DELETE /product/_doc/1
    
                ```
    
            *   å®šä¹‰å•†å“DOCæ¨¡å‹ã€store-common-feignã€‘
    
                ä¿®æ”¹Product
    
                ```java
                @Data
                @NoArgsConstructor
                @AllArgsConstructor
                @TableName("product")
                @JsonIgnoreProperties(ignoreUnknown = true)
                public class Product implements Serializable {
    
                    public static final Long serialVersionUID = 1L;
    
                    @TableId(type = IdType.AUTO)
                    @JsonProperty("product_id")
                    private Integer productId;
    
                    @JsonProperty("product_name")
                    private String productName;
    
                    @JsonProperty("category_id")
                    private String categoryId;
    
                    /**
                     * æ‰‹æœºtitle
                     */
                    @JsonProperty("product_title")
                    private String productTitle;
    
                    /**
                     * æ‰‹æœºä¿¡æ¯æè¿°
                     */
                    @JsonProperty("product_intro")
                    private String productIntro;
    
                    @JsonProperty("product_picture")
                    private String productPicture;
    
                    /**
                     * å•†å“ä»·æ ¼
                     */
                    @JsonProperty("product_price")
                    private Double productPrice;
    
                    /**
                     * å”®å–ä»·æ ¼
                     */
                    @JsonProperty("product_selling_price")
                    private Double productSellingPrice;
    
                    /**
                     * å•†å“åº“å­˜
                     */
                    @JsonProperty("product_num")
                    private int productNum;
    
                    /**
                     * å·²å–æ•°é‡
                     */
                    @JsonProperty("product_sales")
                    private int productSales;


                }
                ```
    
                æ·»åŠ ProductDoc
    
                ```java
                @Data
                @NoArgsConstructor
                public class ProductDoc extends Product {
    
                    /**
                     * ç”¨äºæ¨¡ç³ŠæŸ¥è¯¢å­—æ®µ,ç”±å•†å“å,æ ‡é¢˜å’Œæè¿°ç»„æˆ
                     */
                    private String all;
    
                    public ProductDoc(Product product) {
                        super(product.getProductId(),product.getProductName(),
                                product.getCategoryId(),product.getProductTitle(),
                                product.getProductIntro(),product.getProductPicture(),
                                product.getProductPrice(),product.getProductSellingPrice(),
                                product.getProductNum(),product.getProductSales());
                        this.all = product.getProductName()+product.getProductTitle()+product.getProductIntro();
                    }
                }
    
                ```
    
            *   å¯¼å…¥æ•°æ®
    
                æ·»åŠ é…ç½®ç±»
    
                ```java
                /**
                 * projectName: b2c-cloud-store
                 *
                 * @author: èµµä¼Ÿé£
                 * description: æ¶ˆæ¯é˜Ÿåˆ—é…ç½®
                 */
                @Configuration
                public class SearchConfiguration {
    
                    /**
                     * mqåºåˆ—åŒ–æ–¹å¼ï¼Œé€‰æ‹©jsonï¼
                     * @return
                     */
                    @Bean
                    public MessageConverter messageConverter(){
    
                        return new Jackson2JsonMessageConverter();
                    }
                    
                    /**
                     * eså®¢æˆ·ç«¯æ·»åŠ åˆ°iocå®¹å™¨
                     * @return
                     */
                    @Bean
                    public RestHighLevelClient restHighLevelClient(){
                        RestHighLevelClient client =
                                new RestHighLevelClient(
                                        RestClient.builder(HttpHost.create("http://124.221.70.206:9200")));
    
                        return client;
                    }
                }
                ```
    
                ä¿®æ”¹å¯åŠ¨ç±»
    
                ```java
                @SpringBootApplication(exclude={DataSourceAutoConfiguration.class})
                @EnableFeignClients(clients = ProductClient.class)
                public class SearchApplication {
    
                    public static void main(String[] args) {
                        SpringApplication.run(SearchApplication.class,args);
                    }
                }
                ```
    
                ç¨‹åºå¯åŠ¨ç›‘æ§
    
                ```java
                /**
                 * projectName: b2c-cloud-store
                 *
                 * @author: èµµä¼Ÿé£
                 * description: ç›‘æ§ç¨‹åºå¯åŠ¨,åˆå§‹åŒ–esæ•°æ®
                 */
                @Slf4j
                @Component
                public class ApplicationRunListener implements ApplicationRunner {


                    @Autowired
                    private RestHighLevelClient client;
    
                    @Autowired
                    private ProductClient productClient;
    
                    private String createIndex = "{\n" +
                            "  \"mappings\": {\n" +
                            "    \"properties\": {\n" +
                            "      \"productId\":{\n" +
                            "        \"type\": \"integer\"\n" +
                            "      },\n" +
                            "      \"productName\":{\n" +
                            "        \"type\": \"text\",\n" +
                            "        \"analyzer\": \"ik_smart\",\n" +
                            "        \"copy_to\": \"all\"\n" +
                            "      },\n" +
                            "      \"categoryId\":{\n" +
                            "        \"type\": \"integer\"\n" +
                            "      },\n" +
                            "      \"productTitle\":{\n" +
                            "        \"type\": \"text\",\n" +
                            "        \"analyzer\": \"ik_smart\",\n" +
                            "        \"copy_to\": \"all\"\n" +
                            "      },\n" +
                            "      \"productIntro\":{\n" +
                            "        \"type\":\"text\",\n" +
                            "        \"analyzer\": \"ik_smart\",\n" +
                            "        \"copy_to\": \"all\"\n" +
                            "      },\n" +
                            "      \"productPicture\":{\n" +
                            "        \"type\": \"keyword\",\n" +
                            "        \"index\": false\n" +
                            "      },\n" +
                            "      \"productPrice\":{\n" +
                            "        \"type\": \"double\",\n" +
                            "        \"index\": true\n" +
                            "      },\n" +
                            "      \"productSellingPrice\":{\n" +
                            "        \"type\": \"double\"\n" +
                            "      },\n" +
                            "      \"productNum\":{\n" +
                            "        \"type\": \"integer\"\n" +
                            "      },\n" +
                            "      \"productSales\":{\n" +
                            "        \"type\": \"integer\"\n" +
                            "      },\n" +
                            "      \"all\":{\n" +
                            "        \"type\": \"text\",\n" +
                            "        \"analyzer\": \"ik_max_word\"\n" +
                            "      }\n" +
                            "    }\n" +
                            "  }\n" +
                            "}";


                    @Override
                    public void run(ApplicationArguments args) throws Exception {
                       //æ•°æ®åº“æ•°æ®åˆå§‹åŒ–
                        //æŸ¥è¯¢å…¨éƒ¨æ•°æ®
                        List<Product> list = productClient.list();
    
                        //åˆ¤æ–­æ˜¯å¦å­˜åœ¨productç´¢å¼•
                        GetIndexRequest getIndexRequest = new GetIndexRequest("product");
                        boolean exists = client.indices().exists(getIndexRequest, RequestOptions.DEFAULT);


                        if (!exists){
                            //ä¸å­˜åœ¨,åˆ›å»ºæ–°ç´¢å¼•
                            CreateIndexRequest createIndexRequest = new CreateIndexRequest("product");
                            createIndexRequest.source(createIndex, XContentType.JSON);
                            client.indices().create(createIndexRequest,RequestOptions.DEFAULT);
                        }
    
                        //åˆ é™¤å…¨éƒ¨æ•°æ®
                        DeleteByQueryRequest deleteIndexRequest = new DeleteByQueryRequest("product");
                        deleteIndexRequest.setQuery(QueryBuilders.matchAllQuery());
                        client.deleteByQuery(deleteIndexRequest,RequestOptions.DEFAULT);


â€‹                        

                        //æ’å…¥å…¨éƒ¨æ•°æ®
                        BulkRequest bulkRequest = new BulkRequest();
                        ObjectMapper objectMapper = new ObjectMapper();
                        for (Product product : list) {
                            ProductDoc productDoc = new ProductDoc(product);
    
                            bulkRequest.add(new IndexRequest("product")
                                                .id(productDoc.getProductId().toString())
                                                .source(objectMapper.writeValueAsString(productDoc),XContentType.JSON));
                        }
    
                        client.bulk(bulkRequest,RequestOptions.DEFAULT);
    
                        log.info("ApplicationRunListener.runä¸šåŠ¡ç»“æŸï¼Œå®Œæˆæ•°æ®æ›´æ–°!");
    
                    }
                }
                ```
    
        *   æœç´¢åŠŸèƒ½
    
            *   æ¥å£åˆ†æ
    
                è¯·æ±‚URLï¼š/search/product
    
                è¯·æ±‚æ–¹å¼ï¼šPOST
    
                è¯·æ±‚ç±»å‹:  JSON
    
                å‚æ•°è¯´æ˜ï¼š
    
                > {"search":"å…³é”®å­—","currentPage":1,"pageSize":15}
    
                | å‚æ•°          | æ˜¯å¦å¿…é€‰ | ç±»å‹     | è¯´æ˜    |
                | ----------- | ---- | ------ | ----- |
                | search      | æ˜¯    | string | æœç´¢å…³é”®å­— |
                | currentPage | æ˜¯    | int    | é¡µæ•°    |
                | pageSize    | æ˜¯    | int    | é¡µå®¹é‡   |
    
                è¿”å›ç»“æœï¼š
    
                ```java
                {
                  code:"001",
                  data:[{å•†å“æ•°æ®}],
                  total:20 //æ€»æ•°é‡
                }
                ```
    
            *   ä¸šåŠ¡åˆ†æ
    
                1.  æ ¹æ®å…³é”®å­—å’Œåˆ†é¡µå‚æ•°ï¼Œè¿›è¡Œesç´¢å¼•æŸ¥è¯¢
    
                2.  å°†ç»“æœå°è£…åˆ°Rä¸­ï¼Œè¿”å›å•†å“æœåŠ¡å³å¯
    
            *   åŠŸèƒ½å®ç°
    
                1.  å®šä¹‰æŸ¥è¯¢Param \[store-common-feign]
    
                    ```java
                    @Data
                    public class ProductParamsSearch {
    
                        private String search;
                        private int    currentPage = 1;
                        private int    pageSize = 15;
    
                        /**
                         * è¿ç®—åˆ†é¡µèµ·å§‹å€¼
                         * @return
                         */
                        public int getFrom(){
                            return (currentPage-1)*pageSize;
                        }
    
                        /**
                         * è¿”å›æŸ¥è¯¢å€¼
                         * @return
                         */
                        public int getSize(){
                            return pageSize;
                        }
                    }
                    ```
    
                2.  controller
    
                    ```java
                    @RestController
                    @RequestMapping("search")
                    public class SearchController {
    
                        @Autowired
                        private SearchService searchService;
    
                        @PostMapping("product")
                        public R productList(@RequestBody ProductParamsSearch productParamsSearch) throws JsonProcessingException {


                            return searchService.search(productParamsSearch);
                        }
    
                    }
                    ```
    
                3.  service
    
                    ```java
                    @Autowired
                    private RestHighLevelClient client;
    
                    /**
                     * å•†å“æœç´¢
                     * @param productParamsSearch
                     * @return
                     */
                    @Override
                    public R search(ProductParamsSearch productParamsSearch) throws JsonProcessingException {
    
                        SearchRequest searchRequest = new SearchRequest("product");
    
                        if (StringUtils.isEmpty(productParamsSearch.getSearch())){
                            //å¦‚æœä¸ºnull,æŸ¥è¯¢å…¨éƒ¨
                            searchRequest.source().query(QueryBuilders.matchAllQuery());
                        }else{
                            //ä¸ä¸ºç©º allå­—æ®µè¿›è¡Œæœç´¢
                            searchRequest.source().query(QueryBuilders.matchQuery("all",productParamsSearch.getSearch()));
                        }
    
                        //è®¾ç½®åˆ†é¡µå‚æ•°
                        searchRequest.source().from(productParamsSearch.getFrom());
                        searchRequest.source().size(productParamsSearch.getSize());
    
                        SearchResponse response = null;
                        try {
                            response = client.search(searchRequest, RequestOptions.DEFAULT);
                        } catch (IOException e) {
                            throw  new RuntimeException(e);
                        }
    
                        //ç»“æœé›†è§£æ
                        //è·å–é›†ä¸­çš„ç»“æœ
                        SearchHits hits = response.getHits();
                        //è·å–ç¬¦åˆçš„æ•°é‡
                        long total = hits.getTotalHits().value;
    
                        SearchHit[] items = hits.getHits();
    
                        List<Product> productList = new ArrayList<>();
                        ObjectMapper objectMapper = new ObjectMapper();
    
                        for (SearchHit item : items) {
                            //è·å–å•æŒ‘jsonæ•°æ®
                            String json = item.getSourceAsString();
                            Product product = objectMapper.readValue(json, Product.class);
                            productList.add(product);
                        }
    
                        return R.ok(null,productList,total);
                    }
                    ```
    
                4.  SearchClient \[store-common-feign]
    
                    ```java
                    @FeignClient(name = "search-service")
                    public interface SearchClient {
    
                        /**
                         * æœç´¢æœåŠ¡ å•†å“æŸ¥è¯¢
                         * @param productParamsSearch
                         * @return
                         */
                        @PostMapping("/search/product")
                        R search(@RequestBody ProductParamsSearch productParamsSearch);
    
                    }
                    ```
    
                5.  **å•†å“æœåŠ¡ï¼Œå®Œæˆæœç´¢æ¥å£ï¼**
    
        *   rabbitmqé…ç½®
    
            *   ä¸šåŠ¡éœ€æ±‚
    
                1.  å¯¹eså•†å“æ•°æ®è¿›è¡Œåˆ é™¤ã€æ·»åŠ (è¦†ç›–æ›´æ–°)åœºæ™¯æ¶ˆæ¯é€šä¿¡
    
                2.  åå°ç®¡ç†æ¨¡å—æ·»åŠ ï¼Œä¿®æ”¹å•†å“å‘é€æ›´æ–°æŒ‡ä»¤
    
                3.  åå°ç®¡ç†åˆ é™¤åˆ é™¤å•†å“å‘é€åˆ é™¤æŒ‡ä»¤
    
                4.  ç›‘å¬æ¶ˆæ¯ï¼Œå®ç°esçš„æ•°æ®æ›´æ–°å’Œåˆ é™¤
    
            *   äº¤æ¢æœºå’Œæ¶ˆæ¯keyå…³ç³»
    
                ![](image/image_0LbNmD3acb.png)
    
            *   store-commonså£°æ˜mqé…ç½®
    
                *   ä»‹ç»
    
                    > ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—çš„æœåŠ¡é…ç½®å…¨ä¸€è‡´ï¼Œæ‰€ä»¥å£°æ˜åˆ°é€šç”¨æ¨¡å—ï¼Œéœ€è¦ä½¿ç”¨çš„æœåŠ¡ï¼Œåªéœ€è¦å¯¼å…¥æ­¤æ¨¡å—ï¼Œæ¿€æ´»é…ç½®å³å¯ï¼
    
                *   application-mq.yml
    
                    ```yaml
                    spring:
                      rabbitmq:
                        host: 124.221.70.206
                        port: 5672
                        virtual-host: /
                        username: root
                        password: 123456
                        listener:
                          simple:
                            prefetch: 1   # é¢„å…ˆåˆ†é…1ä¸ª èƒ½è€…å¤šåŠ³
                    ```
    
                *   ä¿®æ”¹application.yml
    
                    ```json
                    spring:
                      profiles:
                        active: mq  # æ¿€æ´»é…ç½®
                    ```
    
            *   rabbité…ç½®é…ç½®ç±»
    
                é…ç½®ç¤ºä¾‹
    
                ```java
                /**
                 * æ¼”ç¤ºï¼Œæ³¨è§£æ–¹å¼ï¼Œåœ¨æ¶ˆæ¯æ¶ˆè´¹è€…ä½ç½®å®Œæˆ äº¤æ¢æœºé˜Ÿåˆ—å…³ç³»ç»‘å®šï¼
                 * @param data
                 */
                @RabbitListener(bindings = @QueueBinding(
                        value = @Queue(name = "insert.queue"),
                        exchange = @Exchange("topic.ex"),
                        key = "insert.product"
                ))
                public void insert(Map data){
                    System.out.println("SpringRabbitListener.insert");
                    System.out.println("data = [" + data + "]");
                }
                ```
    
        *   æ›´æ–°æ•°æ®
    
            ```java
            @Component
            public class RabbitMQListener {


                @Autowired
                private RestHighLevelClient client;
    
                /**
                 * æ›´æ–°å’Œæ’å…¥æ•°æ®åŒä¸€ä¸ª!
                 */
                @RabbitListener(bindings = @QueueBinding(
                        value = @Queue(name = "insert.queue"),
                        exchange = @Exchange("topic.ex"),
                        key = "insert.product"
                ))
                public void insert(Product product) throws IOException {
    
                    IndexRequest indexRequest = new IndexRequest("product")
                            .id(product.getProductId().toString());
    
                    ProductDoc productDoc = new ProductDoc(product);
    
                    ObjectMapper objectMapper = new ObjectMapper();
                    String json  = objectMapper.writeValueAsString(productDoc);
    
                    indexRequest.source(json, XContentType.JSON);
                    
                    client.index(indexRequest, RequestOptions.DEFAULT);
    
                }
             }   
    
            ```
    
        *   åˆ é™¤æ•°æ®
    
            ```java
            /**
               * åˆ é™¤æ•°æ®
               * @param productId
               */
              @RabbitListener(bindings = @QueueBinding(
                      value = @Queue(name = "delete.queue"),
                      exchange = @Exchange("topic.ex"),
                      key = "delete.product"
              ))
              public void remove(Integer productId) throws IOException {
    
                  DeleteRequest request = new DeleteRequest("product")
                          .id(productId.toString());
                  
                  client.delete(request,RequestOptions.DEFAULT);
              }
            ```
    
    *   postmanæµ‹è¯•
    
    *   å‰ç«¯è¿è°ƒ

*   **æœåŠ¡ç¼“å­˜è®¾è®¡**

    *   **ç¼“å­˜å¿…è¦æ€§**

        ![](image/image_QXuZ6PBWXq.png)

        **æ€»çš„æ¥è¯´ï¼Œæ¶‰åŠæŸ¥è¯¢åœºæ™¯éƒ½å¯ä»¥è€ƒè™‘ä½¿ç”¨ç¼“å­˜ä¼˜åŒ–æ€§èƒ½ï¼š1ã€æŸ¥æ•°æ®åº“2ã€è¯»å–æ–‡ä»¶3ã€ç½‘ç»œè®¿é—®ï¼Œç‰¹åˆ«æ˜¯è°ƒç”¨ç¬¬ä¸‰æ–¹æœåŠ¡æŸ¥è¯¢æ¥å£ï¼**

        **æ³¨æ„ï¼šå¹¶ä¸æ˜¯ç¼“å­˜è®¾è®¡çš„å¤šï¼Œæ€§èƒ½å°±ä¸€å®šå¥½ï¼Œå¯¹æ›´æ–°é¢‘ç¹çš„æ•°æ®ï¼Œä¸æ¨èç¼“å­˜ï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§æ˜¯ç¼“å­˜çš„å‰æï¼**

        ä¸€è‡´æ€§è§£é‡Šï¼šç¼“å­˜æ•°æ®å’Œæ•°æ®åº“æ•°æ®ä¸€è‡´ï¼Œé¿å…è„ï¼ˆé”™è¯¯ï¼‰æ•°æ®ï¼

    *   **å¤šæœåŠ¡ç¼“å­˜é…ç½®**

        *   å¯¼å…¥é…ç½®ç±»

            store-common-feign

            ```java
            /**
             * projectName: b2c-cloud-store
             *
             * @author: èµµä¼Ÿé£
             * description: ç¼“å­˜é…ç½®ç±» æ”¾ç½®é…ç½®çš„æ–¹æ³•,å­æ¨¡æ¿ç»§æ‰¿å’Œå¤ç”¨
             */
            public class CacheConfiguration {


                //é…ç½®ç¼“å­˜manager
                @Bean
                @Primary  //åŒç±»å‹,å¤šä¸ªbean,é»˜è®¤ç”Ÿæ•ˆ! é»˜è®¤ç¼“å­˜æ—¶é—´1å°æ—¶!  å¯ä»¥é€‰æ‹©!
                public RedisCacheManager cacheManagerHour(RedisConnectionFactory redisConnectionFactory){
    
                    RedisCacheConfiguration instanceConfig = instanceConfig(1 * 3600L);//ç¼“å­˜æ—¶é—´1å°æ—¶
    
                    //æ„å»ºç¼“å­˜å¯¹è±¡
                    return RedisCacheManager.builder(redisConnectionFactory)
                            .cacheDefaults(instanceConfig)
                            .transactionAware()
                            .build();
                }
    
                //ç¼“å­˜ä¸€å¤©é…ç½®
                @Bean
                public RedisCacheManager cacheManagerDay(RedisConnectionFactory redisConnectionFactory){
    
                    RedisCacheConfiguration instanceConfig = instanceConfig(24 * 3600L);//ç¼“å­˜æ—¶é—´1å°æ—¶
    
                    //æ„å»ºç¼“å­˜å¯¹è±¡
                    return RedisCacheManager.builder(redisConnectionFactory)
                            .cacheDefaults(instanceConfig)
                            .transactionAware()
                            .build();
                }


                /**
                 * å®ä¾‹åŒ–å…·ä½“çš„ç¼“å­˜é…ç½®!
                 *    è®¾ç½®ç¼“å­˜æ–¹å¼JSON
                 *    è®¾ç½®ç¼“å­˜æ—¶é—´ å•ä½ç§’
                 * @param ttl
                 * @return
                 */
                private RedisCacheConfiguration instanceConfig(Long ttl){
    
                    //è®¾ç½®jacksonåºåˆ—åŒ–å·¥å…·
                    Jackson2JsonRedisSerializer<Object> jackson2JsonRedisSerializer
                            = new Jackson2JsonRedisSerializer<Object>(Object.class);
    
                    //å¸¸è§jacksonçš„å¯¹è±¡æ˜ å°„å™¨,å¹¶è®¾ç½®ä¸€äº›åŸºæœ¬å±æ€§
                    ObjectMapper objectMapper = new ObjectMapper();
                    objectMapper.disable(SerializationFeature.WRITE_DATES_AS_TIMESTAMPS);
                    objectMapper.registerModule(new JavaTimeModule());
                    objectMapper.configure(MapperFeature.USE_ANNOTATIONS,false);
                    objectMapper.setSerializationInclusion(JsonInclude.Include.NON_NULL);
                    objectMapper.activateDefaultTyping(LaissezFaireSubTypeValidator.instance,
                            ObjectMapper.DefaultTyping.NON_FINAL, JsonTypeInfo.As.PROPERTY);
    
                    jackson2JsonRedisSerializer.setObjectMapper(objectMapper);
    
                    return RedisCacheConfiguration.defaultCacheConfig()
                            .entryTtl(Duration.ofSeconds(ttl)) //è®¾ç½®ç¼“å­˜æ—¶é—´
                            .disableCachingNullValues()
                            .serializeValuesWith(RedisSerializationContext.SerializationPair.fromSerializer(jackson2JsonRedisSerializer));
                }
    
            }
    
            ```
    
        *   å£°æ˜ç¼“å­˜é…ç½®
    
            application-cache.yml
    
            æŒ‡å®šç¯å¢ƒé…ç½®å˜é‡ï¼Œåº”ç”¨æ¨¡å—åªéœ€è¦æ¿€æ´»ï¼Œä¸ç”¨é‡å¤å†™ï¼
    
            ```yaml
            spring:
              cache:
                type: redis
              redis:
                host: 124.221.70.206
                port: 6379
                jedis: # è®¾ç½®Redisè¿æ¥æ± 
                  pool:
                    max-wait: 2000ms
                    min-idle: 2
                    max-idle: 8
                    max-active: 10
            ```
    
        *   ç”Ÿæ•ˆæœåŠ¡æ¿€æ´»cacheé…ç½®
    
            ä½¿ç”¨ç¼“å­˜çš„æ¨¡å—å’ŒæœåŠ¡
    
            ```yaml
            spring:
              # è¿æ¥æ± é…ç½®
              datasource:
                url: jdbc:mysql://localhost:3306/store_product?useSSL=false
                username: root
                password: 123456
                driver-class-name: com.mysql.jdbc.Driver
                type: com.alibaba.druid.pool.DruidDataSource
              profiles:
                active: cache  #æ¿€æ´»store-commonæ¨¡å—çš„ç¼“å­˜é…ç½®
            ```
    
        *   ç”Ÿæ•ˆæœåŠ¡å³æˆé…ç½®ç±»
    
            ```java
            @Configuration
            public class ProductConfiguration extends CacheConfiguration {
            ```
    
    *   **å•†å“æœåŠ¡ç¼“å­˜è®¾è®¡**
    
        *   å•ç±»åˆ«åçƒ­é—¨å•†å“ç¼“å­˜
    
            ```java
            æ¶‰åŠæ¥å£ï¼š/product/promo
            ç¼“å­˜æ—¶é—´ï¼š1å°æ—¶
            ç¼“å­˜åˆ†åŒºï¼šlist.product #æ–¹ä¾¿åæœŸæ‰¹é‡ç§»é™¤
            ç¼“å­˜key: ç±»åˆ«å
            å¤‡æ³¨ï¼š
                 è¿™ç§é›†åˆç¼“å­˜ï¼Œå½“åå°ç®¡ç†ä¿®æ”¹å•†å“çš„æ—¶å€™ï¼Œéœ€è¦æ¸…ç©ºï¼ï¼
    
            ```
    
        *   å¤šç±»åˆ«åçƒ­é—¨å•†å“ç¼“å­˜
    
            ```java
            æ¶‰åŠæ¥å£ï¼š/product/hots
            ç¼“å­˜æ—¶é—´ï¼š1å°æ—¶
            ç¼“å­˜åˆ†åŒºï¼šlist.product #æ–¹ä¾¿åæœŸæ‰¹é‡ç§»é™¤
            ç¼“å­˜key: ç±»åˆ«åé›†åˆ
            å¤‡æ³¨ï¼š
                 è¿™ç§é›†åˆç¼“å­˜ï¼Œå½“ä¿®æ”¹å•†å“çš„æ—¶å€™ï¼Œéœ€è¦æ¸…ç©ºï¼
            ```
    
        *   å…¨éƒ¨åˆ†é¡µå•†å“ç¼“å­˜
    
            ```java
            æ¶‰åŠæ¥å£ï¼š/product/all
            ç¼“å­˜æ—¶é—´ï¼š1å°æ—¶
            ç¼“å­˜åˆ†åŒºï¼šlist.product #æ–¹ä¾¿åæœŸæ‰¹é‡ç§»é™¤
            ç¼“å­˜key: currentPage-pageSize  1-15  2-15
            å¤‡æ³¨ï¼š
                 è¿™ç§é›†åˆç¼“å­˜ï¼Œå½“ä¿®æ”¹å•†å“çš„æ—¶å€™ï¼Œéœ€è¦æ¸…ç©ºï¼
            ```
    
        *   ç±»åˆ«åˆ†é¡µå•†å“ç¼“å­˜
    
            ```java
            æ¶‰åŠæ¥å£ï¼š/product/bycategory
            ç¼“å­˜æ—¶é—´ï¼š1å°æ—¶
            ç¼“å­˜åˆ†åŒºï¼šlist.product #æ–¹ä¾¿åæœŸæ‰¹é‡ç§»é™¤
            ç¼“å­˜key: ç±»åˆ«ID-currentPage-pageSize
            å¤‡æ³¨ï¼š
                 è¿™ç§é›†åˆç¼“å­˜ï¼Œå½“ä¿®æ”¹å•†å“çš„æ—¶å€™ï¼Œéœ€è¦æ¸…ç©ºï¼
            ```
    
        *   å•†å“è¯¦æƒ…ç¼“å­˜
    
            ```java
            æ¶‰åŠæ¥å£ï¼š/product/detail
            ç¼“å­˜æ—¶é—´ï¼š1å°æ—¶
            ç¼“å­˜åˆ†åŒºï¼šproduct 
            ç¼“å­˜key: productID
            å¤‡æ³¨ï¼š
                 åŒºåˆ†é›†åˆç±»å‹ï¼Œåªæœ‰å¯¹åº”IDçš„å•†å“ä¿®æ”¹ï¼Œæ‰ä¿®æ”¹æ­¤ç¼“å­˜ï¼
            ```
    
        *   å•†å“å›¾ç‰‡ç¼“å­˜
    
            ```java
            æ¶‰åŠæ¥å£ï¼š/product/pictures
            ç¼“å­˜æ—¶é—´ï¼š1å°æ—¶
            ç¼“å­˜åˆ†åŒº: picture
            ç¼“å­˜key: productID
            å¤‡æ³¨ï¼š
                 
            ```
    
        *   ç±»åˆ«é›†åˆç¼“å­˜
    
            ```java
            æ¶‰åŠæ¥å£ï¼š/product/category/list
            ç¼“å­˜æ—¶é—´ï¼š1å°æ—¶
            ç¼“å­˜åˆ†åŒºï¼šlist.category
            ç¼“å­˜key: æ–¹æ³•å
            å¤‡æ³¨ï¼š
                 è¿™ç§é›†åˆç¼“å­˜ï¼Œå½“ä¿®æ”¹å•†å“çš„æ—¶å€™ï¼Œéœ€è¦æ¸…ç©ºï¼
            ```
    
    *   **å•†å“æœåŠ¡ç¼“å­˜å®ç°**
    
        *   å•ç±»åˆ«åçƒ­é—¨å•†å“ç¼“å­˜
    
            æ·»åŠ åˆ°ä¸šåŠ¡æ–¹æ³•ä¸­ï¼
    
            ```java
             /**
             * ç±»åˆ«åç§°,æŸ¥è¯¢å•†å“é›†åˆ,æœ€å¤šæŸ¥è¯¢7æ¡
             * @param categoryName
             * @return
             */
            @Cacheable(value = "list.product",key = "#categoryName")
            @Override
            public Object promo(String categoryName) {
    
            ```
    
        *   å¤šç±»åˆ«åçƒ­é—¨å•†å“ç¼“å­˜
    
            ```java
            /**
             * çƒ­é—¨å•†å“æŸ¥è¯¢,æœ€å¤šæŸ¥è¯¢7æ¡
             *
             * @param productParamsString
             * @return
             */
            @Cacheable(value = "list.product",key = "#productParamsString.categoryName")
            @Override
            public Object hots(ProductParamsString productParamsString) {
            ```
    
        *   å…¨éƒ¨åˆ†é¡µå•†å“ç¼“å­˜
    
            ```java
            /**
             * å…¨éƒ¨å•†å“æŸ¥è¯¢,å¯ä»¥è¿›è¡Œç±»åˆ«é›†åˆæ•°æ®æŸ¥è¯¢ä¸šåŠ¡å¤ç”¨
             *
             * @param productParamInteger
             * @return
             */
            @Cacheable(value = "list.product",key ="#productParamInteger.currentPage+" +
                            "'-'+#productParamInteger.pageSize")
            @Override
            public Object all(ProductParamInteger productParamInteger) {
            ```
    
        *   ç±»åˆ«åˆ†é¡µå•†å“ç¼“å­˜
    
            ```java
            /**
             * ç±»åˆ«å•†å“æŸ¥è¯¢ å‰ç«¯ä¼ é€’ç±»åˆ«é›†åˆ
             *
             * @param productParamInteger
             * @return
             */
            @Cacheable(value = "list.product",key = 
                                                "#productParamInteger.categoryID+" +
                                                "'-'+#productParamInteger.currentPage+" +
                                                "'-'+#productParamInteger.pageSize")
            @Override
            public Object byCategory(ProductParamInteger productParamInteger) {
            ```
    
        *   å•†å“è¯¦æƒ…ç¼“å­˜
    
            ```java
            /**
             * æŸ¥è¯¢å•†å“è¯¦æƒ…
             *
             * @param productID å•†å“id
             * @return
             */
            @Override
            @Cacheable(value = "product",key = "#productID")
            public Object detail(Integer productID) {
            ```
    
        *   å•†å“å›¾ç‰‡ç¼“å­˜
    
            ```java
            /**
             * æŸ¥è¯¢å•†å“å›¾ç‰‡
             *
             * @param productID
             * @return
             */
            @Cacheable(value = "picture",key = "#productID")
            @Override
            public Object pictures(Integer productID) {
            ```
    
        *   ç±»åˆ«é›†åˆç¼“å­˜
    
            ```java
            /**
             * æŸ¥è¯¢ç±»åˆ«æ•°æ®é›†åˆ!
             * æœ€å¤šè¿”å›12æ¡æ•°æ®
             *
             * @return
             */
    
            @Override
            @Cacheable(value = "list.category",key = "#root.methodName",)
            public Object clist() {
            ```
    
    *   **è½®æ’­å›¾æœåŠ¡ç¼“å­˜è®¾è®¡**
    
        *   è½®æ’­å›¾å±•ç¤ºç¼“å­˜
    
            ```java
            æ¶‰åŠæ¥å£ï¼š/carousel/list
            ç¼“å­˜æ—¶é—´ï¼š1å°æ—¶
            ç¼“å­˜åˆ†åŒºï¼šlist.carousel 
            ç¼“å­˜key: æ–¹æ³•å
            å¤‡æ³¨ï¼š
                 è¿™ç§é›†åˆç¼“å­˜ï¼Œå½“ä¿®æ”¹å•†å“çš„æ—¶å€™ï¼Œéœ€è¦æ¸…ç©ºï¼
            ```
    
    *   **è½®æ’­å›¾ç¼“å­˜å®ç°**
    
        *   è½®æ’­å›¾å±•ç¤ºå®ç°
    
            ```java
            /**
             * æŸ¥è¯¢ä¼˜å…ˆçº§æœ€é«˜çš„å››æ¡è½®æ’­å›¾æ•°æ®
             *
             * @return
             */
            @Cacheable(value = "list.carousel",key = "#root.methodName")
            @Override
            public Object list() {
            ```
    
    *   **å…¶ä»–æœåŠ¡ç¼“å­˜**

*   **æ”¶è—æœåŠ¡**

    *   ä»‹ç»

        > æ”¶è—åŠŸèƒ½å®ç°ï¼Œæ¶‰åŠæ”¶è—æ·»åŠ ï¼Œæ”¶è—è·å–å’Œæ”¶è—åˆ é™¤åŠŸèƒ½ï¼

    *   æœåŠ¡æ­å»º

        *   å¯¼å…¥æ•°æ®åº“

            [store\_collect.sql](file/store_collect_eMPC7l2wsH.sql)

            ```java
            # å°†æ•°æ®åº“è„šæœ¬å¤åˆ¶åˆ°æŸç›˜ç¬¦ä¸‹ï¼Œæ–¹ä¾¿å¯¼å…¥ï¼
            # æ‰§è¡Œæ•°æ®åº“è„šæœ¬å¯¼å…¥å‘½ä»¤ï¼æ³¨æ„ä¹±ç é—®é¢˜ï¼
            # æ­¥éª¤1:ä½¿ç”¨cmdå‘½ä»¤çª—å£ç™»å½•mysqlï¼Œé˜²æ­¢å¯¼å…¥ä¹±ç é—®é¢˜
            mysql -uè´¦å· -på¯†ç  --default-character-set=utf8  å›è½¦
            # æ­¥éª¤2:å¯¼å…¥æ•°æ®æ–‡ä»¶ æ³¨æ„ï¼Œè¦å†™ä½ è‡ªå·±çš„æ–‡ä»¶åœ°å€
            source d:\store_collect.sql  å›è½¦  
            # æ­¥éª¤3: æŸ¥çœ‹æ•°æ®åº“
            show databases;
            ```

        *   åˆ›å»ºæœåŠ¡

            æ¨¡å—åï¼šstore-front-collect

        *   å¯¼å…¥ä¾èµ–

            ```xml
            <dependencies>
                <dependency>
                    <groupId>org.springframework.boot</groupId>
                    <artifactId>spring-boot-starter-web</artifactId>
                </dependency>
                <dependency>
                    <groupId>mysql</groupId>
                    <artifactId>mysql-connector-java</artifactId>
                </dependency>
                <!--mybatis-->
                <dependency>
                    <groupId>org.mybatis.spring.boot</groupId>
                    <artifactId>mybatis-spring-boot-starter</artifactId>
                </dependency>
                <!-- nacoså®¢æˆ·ç«¯ä¾èµ–åŒ… -->
                <dependency>
                    <groupId>com.alibaba.cloud</groupId>
                    <artifactId>spring-cloud-starter-alibaba-nacos-discovery</artifactId>
                </dependency>
                <!--feignå®¢æˆ·ç«¯ä¾èµ–-->
                <dependency>
                    <groupId>org.springframework.cloud</groupId>
                    <artifactId>spring-cloud-starter-openfeign</artifactId>
                </dependency>
                <!--å¼•å…¥HttpClientä¾èµ–-->
                <dependency>
                    <groupId>io.github.openfeign</groupId>
                    <artifactId>feign-httpclient</artifactId>
                </dependency>

                <dependency>
                    <groupId>com.baomidou</groupId>
                    <artifactId>mybatis-plus-boot-starter</artifactId>
                </dependency>

                <dependency>
                    <groupId>com.alibaba</groupId>
                    <artifactId>druid-spring-boot-starter</artifactId>
                </dependency>

                <!-- æ­¤å¤„æ˜¯ä½ çš„store_common_feignæ¨¡å—çš„gav,å¦‚æœä¸ä¸€è‡´,éœ€è¦æ”¹è¿›,æ³¨æ„,éœ€è¦æ”¾å…¥mavenæœ¬åœ°åº“!-->
                <dependency>
                    <artifactId>store-commons</artifactId>
                    <groupId>com.atguigu</groupId>
                    <version>1.0.0</version>
                </dependency>

            </dependencies>
            ```

        *   å£°æ˜é…ç½®

            *   bootstrap.yml

                ```yaml
                spring:
                  application:
                    name: collect-service
                  cloud:
                    nacos:
                      server-addr: 124.221.70.206:8848 #æ³¨å†Œä¸­å¿ƒ
                server:
                  port: 3008

                ```

            *   application.yml

                ```yaml
                spring:
                  # è¿æ¥æ± é…ç½®
                  datasource:
                    url: jdbc:mysql://localhost:3306/store_collect?useSSL=false
                    username: root
                    password: 123456
                    driver-class-name: com.mysql.jdbc.Driver
                    type: com.alibaba.druid.pool.DruidDataSource
                mybatis-plus:
                  mapper-locations: classpath:mappers/*.xml
                  configuration:
                    map-underscore-to-camel-case: true
                    auto-mapping-behavior: full
                    lazy-loading-enabled: true
                    aggressive-lazy-loading: false
                  type-aliases-package: com.atguigu.pojo #è®¾ç½®åˆ«åa
                ribbon:
                  eager-load:
                    enabled: true #å¼€å¯é¥¥é¥¿åŠ è½½æå‡ç¬¬ä¸€æ¬¡è®¿é—®é€Ÿåº¦
                    clients:
                      - collect-service #æŒ‡å®šå¼€å¯æœåŠ¡
                feign:
                  httpclient:
                    enabled: true  # å¼€å¯httpClientå¼€å…³,å¯åŠ¨è¿æ¥æ± ,æå‡feignè¿æ¥æ•ˆç‡!
                    max-connections: 200  #æœ€å¤§è¿æ¥æ•°é‡
                    max-connections-per-route: 50  #å•è·¯å¾„æœ€å¤§è¿æ¥æ•°
                ```

        *   åˆ›å»ºå¯åŠ¨ç±»

            ```java
            @MapperScan(basePackages = "com.atguigu.collect.mapper")
            @SpringBootApplication
            public class CollectApplication {

                public static void main(String[] args) {
                    SpringApplication.run(CollectApplication.class,args);
                }
            }
            ```

        *   æ·»åŠ ç½‘å…³é…ç½® ã€store-gatewayã€‘

            ```xml
            - id: collect-service  # æ”¶è—æœåŠ¡
              uri: lb://collect-service
              predicates:
                - Path=/collect/**
            ```

    *   åŠŸèƒ½å®ç°

        *   æ·»åŠ æ”¶è—æ¥å£

            *   æ¥å£ä»‹ç»

                è¯·æ±‚URLï¼š/collect/save

                è¯·æ±‚æ–¹å¼ï¼šPOST

                è¯·æ±‚ç±»å‹:  JSON

                å‚æ•°è¯´æ˜ï¼š

                > {"user\_id":4573,"product\_id":2}

                | å‚æ•°          | æ˜¯å¦å¿…é€‰ | ç±»å‹  | è¯´æ˜   |
                | ----------- | ---- | --- | ---- |
                | product\_id | æ˜¯    | int | å•†å“id |
                | user\_id    | æ˜¯    | int | ç”¨æˆ·id |

                è¿”å›ç¤ºä¾‹:

                ```json
                {"code":"001","msg":"æ·»åŠ æ”¶è—æˆåŠŸ"}
                å¤±è´¥ è‡ªå·±å®šä¹‰ä¸€ä¸ªmap
                {"code":"004","msg":"è¯¥å•†å“å·²ç»æ·»åŠ æ”¶è—ï¼Œè¯·åˆ°æˆ‘çš„æ”¶è—æŸ¥çœ‹"}
                ```

            *   ä¸šåŠ¡ä»‹ç»

                1.  åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ”¶è—

                2.  å­˜åœ¨ï¼Œæç¤ºå¯¹åº”çš„é”™è¯¯

                3.  ä¸å­˜åœ¨ï¼Œæ·»åŠ ï¼Œå¹¶ä¸”æç¤ºæ·»åŠ æˆåŠŸå³å¯

            *   åŠŸèƒ½å®ç°

                *   CollectParam \[store-common-feign]

                    ```java
                    @JsonIgnoreProperties(ignoreUnknown = true)
                    @Data
                    public class CollectParam {

                        @JsonProperty("user_id")
                        private Integer userId;
                        @JsonProperty("product_id")
                        private Integer productId;
                    }

                    ```

                *   collect pojo&#x20;

                    ```java
                    @Data
                    public class Collect implements Serializable {

                        public static final Long serialVersionUID = 1L;

                        @TableId(type = IdType.AUTO)
                        private Integer id;
                        private Integer userId;
                        private Integer productId;
                        private Long    collectTime;
                    }
                    ```

                *   controller

                    ```java
                    @PostMapping("save")
                    public Object save(@RequestBody CollectParam collectParam){

                        return collectService.save(collectParam);
                    }
                    ```

                *   service

                    ```java
                    /**
                     * æ”¶è—ä¿å­˜æœåŠ¡
                     * @param collectParam
                     * @return
                     */
                    @Override
                    public Object save(CollectParam collectParam) {

                        //åˆ†è§£å‚æ•°
                        Integer userId = collectParam.getUserId();
                        Integer productId = collectParam.getProductId();
                        //æ•°æ®åº“æŸ¥è¯¢
                        QueryWrapper<Collect> queryWrapper
                                              = new QueryWrapper<>();
                        queryWrapper.eq("user_id",userId);
                        queryWrapper.eq("product_id",productId);
                        Long count = collectMapper.selectCount(queryWrapper);

                        if ( count> 0){
                            log.info("CollectServiceImpl.saveä¸šåŠ¡ç»“æŸï¼Œç»“æœ:{}",count);
                            return R.fail("å•†å“å·²åœ¨æ”¶è—å¤¹! æ— éœ€äºŒæ¬¡æ·»åŠ !");
                        }
                        //å®ä½“ç±»å°è£…
                        Collect collect = new Collect();
                        collect.setProductId(productId);
                        collect.setUserId(userId);
                        collect.setCollectTime(System.currentTimeMillis());
                        //æ•°æ®åº“æ’å…¥
                        int rows = collectMapper.insert(collect);
                        //ç»“æœå°è£…
                        return R.ok("å•†å“æ·»åŠ æˆåŠŸ!");
                    }

                    ```

                *   mapper

                    ```java
                    public interface CollectMapper extends BaseMapper<Collect> {
                    }
                    ```

        *   æŸ¥çœ‹æ”¶è—æ¥å£

            *   æ¥å£ä»‹ç»

                è¯·æ±‚URLï¼š/collect/list

                è¯·æ±‚æ–¹å¼ï¼šPOST

                è¯·æ±‚ç±»å‹: JSON

                å‚æ•°è¯´æ˜ï¼š

                > {"user\_id":4573}

                | å‚æ•°       | æ˜¯å¦å¿…é€‰ | ç±»å‹  | è¯´æ˜ |
                | -------- | ---- | --- | -- |
                | user\_id | æ˜¯    | int |    |

                è¿”å›ç¤ºä¾‹:

                ```json
                {
                  "code": "001",
                  "data": [
                    {
                      "product_id": 2,
                      "product_name": "Redmi K30 5G",
                      "category_id": 1,
                      "product_title": "åŒæ¨¡5G,120Hzæµé€Ÿå±",
                      "product_intro": "åŒæ¨¡5G / ä¸‰è·¯å¹¶å‘ / é«˜é€šéªé¾™765G / 7nm 5Gä½åŠŸè€—å¤„ç†å™¨ / 120Hzé«˜å¸§ç‡æµé€Ÿå± / 6.67'å°å­”å¾„å…¨é¢å± / ç´¢å°¼6400ä¸‡å‰åå…­æ‘„ / æœ€é«˜å¯é€‰8GB+256GBå¤§å­˜å‚¨ / 4500mAh+30Wå¿«å…… / 3Då››æ›²é¢ç»ç’ƒæœºèº« / å¤šåŠŸèƒ½NFC",
                      "product_picture": "public/imgs/phone/Redmi-k30-5G.png",
                      "product_price": 2599,
                      "product_selling_price": 2599,
                      "product_num": 10,
                      "product_sales": 0
                    }
                  ]
                }
                ```

            *   ä¸šåŠ¡ä»‹ç»

                1.  æ ¹æ®ç”¨æˆ·IDï¼ŒæŸ¥è¯¢ç”¨æˆ·çš„æ”¶è—çš„å•†å“ID

                2.  æ ¹æ®å•†å“IDè°ƒç”¨å•†å“æœåŠ¡ï¼ŒæŸ¥è¯¢å•†å“é›†åˆ

                3.  è¿›è¡Œç»“æœå°è£…å³å¯

            *   åŠŸèƒ½å®ç°

                *   productidsParam \[store-common-feign]

                    ```java
                    @Data
                    public class ProductIdsParam {

                        private List<Integer> productIds;
                    }
                    ```

                *   controller \[store-front-product]

                    ```java
                    /**
                     * ä¾›æ”¶è—æœåŠ¡ä½¿ç”¨,æ ¹æ®ä¼ å…¥çš„id,æŸ¥è¯¢å•†å“é›†åˆ!
                     * @return
                     */
                    @PostMapping("ids")
                    public List<Product> list(@RequestBody ProductIdsParam productIdsParam){

                        return productService.ids(productIdsParam);
                    }
                    ```

                *   service \[store-front-product]

                    ```java
                    /**
                     * æŸ¥è¯¢å•†å“é›†åˆ
                     * @param productIdsParam
                     * @return
                     */
                    @Cacheable(value = "list.product",key = "#productIdsParam.productIds")
                    @Override
                    public List<Product> ids(ProductIdsParam productIdsParam) {

                        List<Integer> productIds = productIdsParam.getProductIds();

                        QueryWrapper<Product> queryWrapper =
                                                        new QueryWrapper<>();
                        queryWrapper.in("product_id",productIds);

                        List<Product> productList = productMapper.selectList(queryWrapper);

                        return productList;
                    }
                    ```

                *   productClient \[store-common-feign]

                    ```java
                    @FeignClient(value = "product-service")
                    public interface ProductClient {

                        /**
                         * å•†å“å…¨éƒ¨æ•°æ®è°ƒç”¨
                         * @return
                         */
                        @GetMapping("/product/list")
                        List<Product> list();

                        /**
                         * æ”¶è—æ¨¡å—è°ƒç”¨
                         * @param productIdsParam
                         * @return
                         */
                        @PostMapping("/product/ids")
                        List<Product> ids(@RequestBody ProductIdsParam productIdsParam);
                    }
                    ```

                *   controller \[store-front-collect]

                    ```java
                    @PostMapping("list")
                    public Object list(@RequestBody CollectParam collectParam){

                        return collectService.list(collectParam);
                    }
                    ```

                *   service \[store-front-collect]

                    ```java
                    /**
                     * æŸ¥è¯¢æ”¶è—åˆ—è¡¨
                     *
                     * @param collectParam
                     * @return
                     */
                    @Override
                    public Object list(CollectParam collectParam) {

                        //è·å–ç”¨æˆ·id
                        Integer userId = collectParam.getUserId();

                        //æŸ¥è¯¢å•†å“id
                        QueryWrapper<Collect> queryWrapper = new QueryWrapper<>();
                        queryWrapper.in("user_id",userId);
                        queryWrapper.select("product_id");
                        List<Object> list = collectMapper.selectObjs(queryWrapper);

                        //ç»“æœå°è£…
                        Integer[] idsArray = list.toArray(new Integer[]{});
                        List<Integer> ids = new ArrayList<>();
                        ids = Arrays.asList(idsArray);

                        if (ids.size() == 0){
                            log.info("CollectServiceImpl.listä¸šåŠ¡ç»“æŸï¼Œç»“æœ:{}");
                            return R.ok(ids);
                        }
                        
                        //è°ƒç”¨å•†å“æœåŠ¡
                        ProductIdsParam productIdsParam = new ProductIdsParam();
                        productIdsParam.setProductIds(ids);
                        List<Product> productList = productClient.ids(productIdsParam);

                        //ç»“æœå°è£…
                        return R.ok(productList);
                    }
                    ```

                *   å¯åŠ¨ç±»ä¿®æ”¹ \[store-front-collect]

                    ```java
                    @MapperScan(basePackages = "com.atguigu.collect.mapper")
                    @SpringBootApplication
                    @EnableFeignClients(clients = {ProductClient.class})
                    public class CollectApplication {
        
                        public static void main(String[] args) {
                            SpringApplication.run(CollectApplication.class,args);
                        }
                    }
        
                    ```

        *   åˆ é™¤æ”¶è—æ¥å£

            *   æ¥å£ä»‹ç»

                è¯·æ±‚URLï¼š/collect/remove

                è¯·æ±‚æ–¹å¼ï¼šPOST

                è¯·æ±‚ç±»å‹: JSON

                å‚æ•°è¯´æ˜ï¼š

                > {"user\_id":1,"product\_id":10}

                | å‚æ•°          | æ˜¯å¦å¿…é€‰ | ç±»å‹  | è¯´æ˜   |
                | ----------- | ---- | --- | ---- |
                | user\_id    | æ˜¯    | int | ç”¨æˆ·id |
                | product\_id | æ˜¯    | int | å•†å“id |

                è¿”å›ç¤ºä¾‹:

                ```json
                {
                  "code": "001",
                   msg:"æ˜¯å¦åˆ é™¤æˆåŠŸï¼"
                }
                ```

            *   ä¸šåŠ¡ä»‹ç»

                1.  æ ¹æ®ç”¨æˆ·å’Œå•†å“IDï¼Œåˆ é™¤æ”¶è—æ•°æ®

                2.  è¿”å›åˆ é™¤ç»“æœå³å¯

            *   åŠŸèƒ½å®ç°

                *   controller

                    ```json
                    @PostMapping("remove")
                    public Object remove(@RequestBody CollectParam collectParam){

                        return collectService.remove(collectParam);
                    }
                    ```

                *   service

                    ```json
                    /**
                     * åˆ é™¤æ”¶è—ä¸šåŠ¡
                     *
                     * @param collectParam
                     * @return
                     */
                    @Override
                    public Object remove(CollectParam collectParam) {
            
                        //å‚æ•°å°è£…
                        QueryWrapper queryWrapper = new QueryWrapper();
                        queryWrapper.eq("user_id",collectParam.getUserId());
                        queryWrapper.eq("product_id",collectParam.getProductId());
            
                        int rows = collectMapper.delete(queryWrapper);
            
                        log.info("CollectServiceImpl.removeä¸šåŠ¡ç»“æŸï¼Œç»“æœ:{}",rows);
            
                        return R.ok("æ”¶è—ç§»é™¤æˆåŠŸ!");
                    }
                    ```

    *   postmanæµ‹è¯•

    *   å‰ç«¯è”è°ƒ

*   **è´­ç‰©è½¦æœåŠ¡**

    *   ä»‹ç»

        > å®Œæˆè´­ç‰©è½¦ç›¸å…³åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼šè´­ç‰©è½¦æ·»åŠ ï¼Œå±•ç¤ºï¼Œä¿®æ”¹æ•°é‡ç­‰ï¼

    *   æœåŠ¡æ­å»º

        *   å¯¼å…¥æ•°æ®åº“

            [store\_cart.sql](file/store_cart_OHMouXJnBl.sql)

            ```json
            # å°†æ•°æ®åº“è„šæœ¬å¤åˆ¶åˆ°æŸç›˜ç¬¦ä¸‹ï¼Œæ–¹ä¾¿å¯¼å…¥ï¼
            # æ‰§è¡Œæ•°æ®åº“è„šæœ¬å¯¼å…¥å‘½ä»¤ï¼æ³¨æ„ä¹±ç é—®é¢˜ï¼
            # æ­¥éª¤1:ä½¿ç”¨cmdå‘½ä»¤çª—å£ç™»å½•mysqlï¼Œé˜²æ­¢å¯¼å…¥ä¹±ç é—®é¢˜
            mysql -uè´¦å· -på¯†ç  --default-character-set=utf8  å›è½¦
            # æ­¥éª¤2:å¯¼å…¥æ•°æ®æ–‡ä»¶ æ³¨æ„ï¼Œè¦å†™ä½ è‡ªå·±çš„æ–‡ä»¶åœ°å€
            source d:\store_cart.sql  å›è½¦  
            # æ­¥éª¤3: æŸ¥çœ‹æ•°æ®åº“
            show databases;
            ```

        *   åˆ›å»ºæœåŠ¡

            æœåŠ¡åï¼šstore-front-cart

        *   å¯¼å…¥ä¾èµ–

            ```xml
            <dependencies>
                <dependency>
                    <groupId>org.springframework.boot</groupId>
                    <artifactId>spring-boot-starter-web</artifactId>
                </dependency>
                <dependency>
                    <groupId>mysql</groupId>
                    <artifactId>mysql-connector-java</artifactId>
                </dependency>
                <!--mybatis-->
                <dependency>
                    <groupId>org.mybatis.spring.boot</groupId>
                    <artifactId>mybatis-spring-boot-starter</artifactId>
                </dependency>
                <!-- nacoså®¢æˆ·ç«¯ä¾èµ–åŒ… -->
                <dependency>
                    <groupId>com.alibaba.cloud</groupId>
                    <artifactId>spring-cloud-starter-alibaba-nacos-discovery</artifactId>
                </dependency>
                <!--feignå®¢æˆ·ç«¯ä¾èµ–-->
                <dependency>
                    <groupId>org.springframework.cloud</groupId>
                    <artifactId>spring-cloud-starter-openfeign</artifactId>
                </dependency>
                <!--å¼•å…¥HttpClientä¾èµ–-->
                <dependency>
                    <groupId>io.github.openfeign</groupId>
                    <artifactId>feign-httpclient</artifactId>
                </dependency>

                <dependency>
                    <groupId>com.baomidou</groupId>
                    <artifactId>mybatis-plus-boot-starter</artifactId>
                </dependency>

                <dependency>
                    <groupId>com.alibaba</groupId>
                    <artifactId>druid-spring-boot-starter</artifactId>
                </dependency>

                <!-- æ­¤å¤„æ˜¯ä½ çš„store_common_feignæ¨¡å—çš„gav,å¦‚æœä¸ä¸€è‡´,éœ€è¦æ”¹è¿›,æ³¨æ„,éœ€è¦æ”¾å…¥mavenæœ¬åœ°åº“!-->
                <dependency>
                    <artifactId>store-commons</artifactId>
                    <groupId>com.atguigu</groupId>
                    <version>1.0.0</version>
                </dependency>
            </dependencies>
            ```

        *   æ·»åŠ é…ç½®

            *   bootstrap.yml

                ```yaml
                spring:
                  application:
                    name: cart-service
                  cloud:
                    nacos:
                      server-addr: 124.221.70.206:8848 #æ³¨å†Œä¸­å¿ƒ
                server:
                  port: 3009
                ```

            *   application.yml

                ```yaml
                spring:
                  # è¿æ¥æ± é…ç½®
                  datasource:
                    url: jdbc:mysql://localhost:3306/store_cart?useSSL=false
                    username: root
                    password: 123456
                    driver-class-name: com.mysql.jdbc.Driver
                    type: com.alibaba.druid.pool.DruidDataSource
                mybatis-plus:
                  mapper-locations: classpath:mappers/*.xml
                  configuration:
                    map-underscore-to-camel-case: true
                    auto-mapping-behavior: full
                    lazy-loading-enabled: true
                    aggressive-lazy-loading: false
                  type-aliases-package: com.atguigu.pojo #è®¾ç½®åˆ«åa
                ribbon:
                  eager-load:
                    enabled: true #å¼€å¯é¥¥é¥¿åŠ è½½æå‡ç¬¬ä¸€æ¬¡è®¿é—®é€Ÿåº¦
                    clients:
                      - cart-service #æŒ‡å®šå¼€å¯æœåŠ¡
                feign:
                  httpclient:
                    enabled: true  # å¼€å¯httpClientå¼€å…³,å¯åŠ¨è¿æ¥æ± ,æå‡feignè¿æ¥æ•ˆç‡!
                    max-connections: 200  #æœ€å¤§è¿æ¥æ•°é‡
                    max-connections-per-route: 50  #å•è·¯å¾„æœ€å¤§è¿æ¥æ•°
                ```

        *   å¯åŠ¨ç±»

            ```java
            @MapperScan(basePackages = "com.atguigu.cart.mapper")
            @SpringBootApplication
            public class CartApplication {

                public static void main(String[] args) {
                    SpringApplication.run(CartApplication.class,args);
                }
            }
            ```

        *   ç½‘å…³é…ç½®

            ```json
            - id: cart-service  # è´­ç‰©è½¦æœåŠ¡
                  uri: lb://cart-service
                  predicates:
                    - Path=/cart/**
            ```

    *   åŠŸèƒ½å®ç°

        *   æ·»åŠ è´­ç‰©è½¦æ¥å£

            *   æ¥å£ä»‹ç»

                è¯·æ±‚URLï¼š/cart/save

                è¯·æ±‚æ–¹å¼ï¼šPOST

                è¯·æ±‚ç±»å‹: JSON

                å‚æ•°è¯´æ˜ï¼š

                > {"user\_id":4573,"product\_id":3}

                | å‚æ•°          | æ˜¯å¦å¿…é€‰ | ç±»å‹  | è¯´æ˜          |
                | ----------- | ---- | --- | ----------- |
                | product\_id | æ˜¯    | int | å•†å“id,æŸ¥è¯¢å•†å“è¯¦æƒ… |
                | user\_id    | æ˜¯    | int | ç”¨æˆ·id!       |

                è¿”å›ç¤ºä¾‹:

                ```xml
                //æ·»åŠ æˆåŠŸ
                {"code":"001","msg":"æ·»åŠ è´­ç‰©è½¦æˆåŠŸ","data":
                {"id":11206,"productID":3,"productName":"å°ç±³CC9 Pro",
                "productImg":"public/imgs/phone/Mi-CC9.png",
                "price":2599,"num":1,"maxNum":10,"check":false}}

                //å·²ç»å­˜åœ¨
                {"code":"002","msg":"è¯¥å•†å“å·²åœ¨è´­ç‰©è½¦ï¼Œæ•°é‡ +1"}

                {"code":"003","msg":"è¯¥å•†å“å·²åœ¨è´­ç‰©è½¦ï¼Œæ•°é‡ +1"}

                ```

            *   ä¸šåŠ¡ä»‹ç»

                1.  è¿›è¡Œè´­ç‰©è½¦æ•°æ®ä¿å­˜

                2.  åˆæ¬¡ä¿å­˜ï¼Œè¿”å›çš„æ•°é‡ä¸º1

                3.  éåˆæ¬¡ä¿å­˜ï¼Œè¿”å›002çŠ¶æ€ç å³å¯ï¼Œæç¤ºå·²ç»æ·»åŠ è¿‡ï¼Œå‰ç«¯ä¼šè‡ªåŠ¨åŒ–æ•°é‡+1

                4.  å¦‚æœè¶…å‡ºè´­ç‰©ä¹°æ•°é‡ï¼Œè¿”å›003ï¼

            *   åŠŸèƒ½å®ç°

                *   pojo \[store-common-feign è®¢å•å¤ç”¨]

                    ```java
                    @TableName("cart")
                    @Data
                    public class Cart implements Serializable {

                        public static final Long serialVersionUID = 1L;

                        @TableId(type = IdType.AUTO)
                        private Integer id;
                        private Integer userId;
                        private Integer productId;
                        private Integer num;

                    }
                    ```

                *   vo \[store-common-feign è®¢å•å¤ç”¨]

                    ```java
                    @JsonIgnoreProperties(ignoreUnknown = true)
                    @Data
                    @NoArgsConstructor
                    public class CartVo implements Serializable {

                        private Integer id;  //è´­ç‰©è½¦id
                        private Integer productID;  //å•†å“id
                        private String  productName; //å•†å“åç§°
                        private String  productImg; //å•†å“æ˜¾ç¤ºå›¾ç‰‡
                        private Double price;  //å•†åŸä»·æ ¼
                        private Integer num;  //å•†å“è´­ä¹°æ•°é‡
                        private Integer maxNum; //å•†å“é™è´­æ•°é‡
                        private Boolean check = false; //æ˜¯å¦å‹¾é€‰

                        public CartVo(Product product, Cart cart) {
                            this.id = cart.getId();
                            this.productID = product.getProductId();
                            this.productName = product.getProductName();
                            this.productImg = product.getProductPicture();
                            this.price = product.getProductSellingPrice();
                            this.num = cart.getNum();
                            this.maxNum = product.getProductNum();
                            this.check = false;
                        }
                    }
                    ```

                *   param \[store-common-feign è®¢å•å¤ç”¨]

                    ```java
                    @Data
                    @JsonIgnoreProperties(ignoreUnknown = true)
                    public class CartParam {

                        @JsonProperty("user_id")
                        private Integer userId;
                        @JsonProperty("product_id")
                        private Integer productId;
                        private Integer num;
                    }
                    ```

                *   productClient \[store-common-feign]

                    **æ³¨æ„ï¼šå¤ç”¨æ­¤æœåŠ¡ï¼**

                    ```java
                    /**
                     * æ”¶è—æ¨¡å—è°ƒç”¨
                     * @param productIdsParam
                     * @return
                     */
                    @PostMapping("/product/ids")
                    List<Product> ids(@RequestBody ProductIdsParam productIdsParam);

                    ```

                *   controller

                    ```java
                    @PostMapping("save")
                    public R save(@RequestBody CartParam cartParam){

                        return cartService.save(cartParam);
                    }
                    ```

                *   service

                    ```java
                    /**
                     * æ·»åŠ è´­ç‰©è½¦
                     *
                     * @param cartParam
                     * @return
                     */
                    @Override
                    public R save(CartParam cartParam) {

                        //æŸ¥è¯¢å…³è”çš„å•†å“ä¿¡æ¯ å¤ç”¨å•†å“é›†åˆæŸ¥è¯¢
                        List<Integer> ids = new ArrayList<>();
                        ids.add(cartParam.getProductId());
                        ProductIdsParam productIdsParam = new ProductIdsParam();
                        productIdsParam.setProductIds(ids);
                        List<Product> productList = productClient.ids(productIdsParam);

                        if (productList == null || productList.size() == 0){
                            log.info("CartServiceImpl.saveä¸šåŠ¡å¼€å§‹ï¼Œå•†å“è¢«ç§»é™¤,æ— æ³•æ·»åŠ !");
                            return R.fail("å•†å“å·²ç»è¢«åˆ é™¤,æ— æ³•æ·»åŠ !");
                        }
                        //1.æ£€æŸ¥æ˜¯å¦å·²ç»è¾¾åˆ°æœ€å¤§åº“å­˜
                        Product product = productList.get(0);
                        int productNum = product.getProductNum();
                        if (productNum == 0){
                            R fail = R.fail("å·²ç»æ²¡æœ‰åº“å­˜,æ— æ³•è´­ä¹°!");
                            fail.setCode("003"); //æ²¡æœ‰åº“å­˜çš„é”™è¯¯ç 
                            return fail;
                        }
                        //2.æ£€æŸ¥æ˜¯ä¸æ˜¯ç¬¬ä¸€æ¬¡æ·»åŠ 
                        QueryWrapper<Cart> queryWrapper = new QueryWrapper<>();
                        queryWrapper.eq("user_id",cartParam.getUserId());
                        queryWrapper.eq("product_id",cartParam.getProductId());
                        Cart cart = cartMapper.selectOne(queryWrapper);
                        if (cart != null){
                            //ä¸æ˜¯ç¬¬ä¸€æ¬¡,ç›´æ¥è¿”å›å·²ç»æ·»åŠ è¿‡å³å¯!
                            //æ›´æ–°å±æ€§ + 1
                            cart.setNum(cart.getNum()+1);
                            cartMapper.updateById(cart);
                            R ok = R.ok("å•†å“å·²ç»åœ¨è´­ç‰©è½¦,æ•°é‡+1!");
                            ok.setCode("002");
                            return ok;
                        }
                        //3.ç¬¬ä¸€æ¬¡ç»“æœå°è£…
                        cart = new Cart();
                        cart.setNum(1);
                        cart.setProductId(cartParam.getProductId());
                        cart.setUserId(cartParam.getUserId());

                        cartMapper.insert(cart);

                        //ç»“æœå°è£…
                        CartVo cartVo = new CartVo(product,cart);
                        log.info("CartServiceImpl.saveä¸šåŠ¡ç»“æŸï¼Œç»“æœ:{}",cartVo);
                        return R.ok(cartVo);
                    }

                    ```

                *   mapper

                    ```java
                    public interface CartMapper extends BaseMapper<Cart> {
                    }
                    ```

        *   è´­ç‰©è½¦å±•ç¤ºæ¥å£

            *   æ¥å£åˆ†æ

                è¯·æ±‚URLï¼š/cart/list

                è¯·æ±‚æ–¹å¼ï¼šPOST

                è¯·æ±‚ç±»å‹: JSON

                å‚æ•°è¯´æ˜ï¼š

                > {"user\_id":10}

                | å‚æ•°       | æ˜¯å¦å¿…é€‰ | ç±»å‹  | è¯´æ˜   |
                | -------- | ---- | --- | ---- |
                | user\_id | æ˜¯    | int | ç”¨æˆ·id |

                è¿”å›ç»“æœï¼š

                ```json
                {
                  "code": "001",
                  "data": [  # æ³¨æ„ï¼Œå°±ç®—æ²¡æœ‰æ•°æ®ä¹Ÿè¦è¿”å›dataç©ºæ•°ç»„
                    {
                      "id": 11205,
                      "productID": 2,
                      "productName": "Redmi K30 5G",
                      "productImg": "public/imgs/phone/Redmi-k30-5G.png",
                      "price": 2599,
                      "num": 3,
                      "maxNum": 5,
                      "check": false
                    },
                    {
                      "id": 11206,
                      "productID": 3,
                      "productName": "å°ç±³CC9 Pro",
                      "productImg": "public/imgs/phone/Mi-CC9.png",
                      "price": 2599,
                      "num": 3,
                      "maxNum": 10,
                      "check": false
                    }
                  ]
                }
                ```

            *   ä¸šåŠ¡åˆ†æ

                1.  æŸ¥è¯¢ç”¨æˆ·å¯¹åº”çš„è´­ç‰©è½¦æ•°æ®

                2.  æŸ¥è¯¢è´­ç‰©è½¦å¯¹åº”çš„å•†å“æ•°æ®

                3.  è¿›è¡Œæ•°æ®å°è£…

                4.  è¿”å›ç»“æœå³å¯

            *   åŠŸèƒ½å®ç°

                *   controller

                    ```java
                    @PostMapping("list")
                    public R list(@RequestBody CartParam cartParam){

                        return cartService.list(cartParam);
                    }
                    ```

                *   service

                    ```java
                    /**
                     * æŸ¥è¯¢è´­ç‰©è½¦æ•°æ®é›†åˆ
                     *
                     * @param cartParam
                     * @return
                     */
                    @Override
                    public R list(CartParam cartParam) {
                        //è·å–ç”¨æˆ·id
                        Integer userId = cartParam.getUserId();
                        //æŸ¥è¯¢ç”¨æˆ·idå¯¹åº”çš„è´­ç‰©è½¦æ•°æ®
                        QueryWrapper<Cart> queryWrapper = new QueryWrapper<>();
                        queryWrapper.eq("user_id",userId);
                        List<Cart> cartList = cartMapper.selectList(queryWrapper);
                        if (cartList == null || cartList.size() == 0){
                            return R.ok("è´­ç‰©è½¦æ²¡æœ‰æ•°æ®!",cartList);
                        }
                        //å°è£…å•†å“é›†åˆ,æŸ¥è¯¢å•†å“æ•°æ®
                        List<Integer> ids = new ArrayList<>();
                        for (Cart cart : cartList) {
                            ids.add(cart.getProductId());
                        }
                        
                        ProductIdsParam productIdsParam = new ProductIdsParam();
                        productIdsParam.setProductIds(ids);
        
                        List<Product> productList = productClient.ids(productIdsParam);
                        //é›†åˆè½¬map!
                        Map<Integer, Product> map = productList.stream().
                        collect(Collectors.
                                toMap(Product::getProductId, v -> v));
                        System.out.println("map = " + map);
                        //ç»“æœå°è£…å³å¯
                        List<CartVo> list = new ArrayList<>(cartList.size());
                        for (Cart cart : cartList) {
                            CartVo cartVo = new CartVo(map.get(cart.getProductId()),cart);
                            list.add(cartVo);
                        }
        
                        R ok = R.ok(list);
                        log.info("CartServiceImpl.listä¸šåŠ¡ç»“æŸï¼Œç»“æœ:{}",ok);
                        return ok;
                    }
        
                    ```

        *   è´­ç‰©è½¦ä¿®æ”¹æ¥å£

            *   æ¥å£åˆ†æ

                è¯·æ±‚URLï¼š/cart/update

                è¯·æ±‚æ–¹å¼ï¼šPOST

                è¯·æ±‚ç±»å‹: JSON

                å‚æ•°è¯´æ˜ï¼š

                > {"user\_id":4573,"product\_id":3,"num":3}

                | å‚æ•°          | æ˜¯å¦å¿…é€‰ | ç±»å‹  | è¯´æ˜          |
                | ----------- | ---- | --- | ----------- |
                | product\_id | æ˜¯    | int | å•†å“id,æŸ¥è¯¢å•†å“è¯¦æƒ… |
                | user\_id    | æ˜¯    | int | ç”¨æˆ·id!       |
                | num         | æ˜¯    | int | ä¿®æ”¹åçš„æ•°é‡      |

                è¿”å›ç»“æœï¼š

                ```json
                {"code":"001","msg":"ä¿®æ”¹è´­ç‰©è½¦æ•°é‡æˆåŠŸ"}
                ```

            *   ä¸šåŠ¡åˆ†æ

                1.  æ£€æŸ¥ä¿®æ”¹åçš„æ•°é‡æ˜¯å¦è¶…å‡ºåº“å­˜

                2.  æ²¡æœ‰ï¼Œè¿›è¡Œä¿®æ”¹

                3.  ä¿®æ”¹æˆåŠŸï¼Œè¿›è¡Œç»“æœå¤„ç†

            *   åŠŸèƒ½å®ç°

                *   controller

                    ```java
                    @PostMapping("update")
                    public R update(@RequestBody CartParam cartParam){

                        return cartService.update(cartParam);
                    }
                    ```

                *   service

                    ```java
                    /**
                     * ä¿®æ”¹è´­ç‰©è½¦æ•°é‡
                     *
                     * @param cartParam
                     * @return
                     */
                    @Override
                    public R update(CartParam cartParam) {
        
                        //1.æŸ¥è¯¢å•†å“å¯¹åº”çš„è¯¦æƒ…
                        List<Integer> ids = new ArrayList<>();
                        ids.add(cartParam.getProductId());
                        ProductIdsParam productIdsParam = new ProductIdsParam();
                        productIdsParam.setProductIds(ids);
                        List<Product> productList = productClient.ids(productIdsParam);
        
                        if (productList == null || productList.size() == 0){
                            log.info("CartServiceImpl.updateä¸šåŠ¡å¼€å§‹ï¼Œå•†å“è¢«ç§»é™¤,æ— æ³•æ·»åŠ !");
                            return R.fail("å•†å“å·²ç»è¢«åˆ é™¤,æ— æ³•æ·»åŠ !");
                        }
                        //1.æ£€æŸ¥æ˜¯å¦å·²ç»è¾¾åˆ°æœ€å¤§åº“å­˜
                        Product product = productList.get(0);
                        int productNum = product.getProductNum();
                        //2.å¯¹æ¯”æ˜¯å¦è´­ä¹°æ•°é‡æ˜¯å¤Ÿè¶…å‡ºåº“å­˜
                        if (cartParam.getNum() > productNum){
                            R fail = R.fail("ä¿®æ”¹å¤±è´¥,è¶…å‡ºåº“å­˜æ•°é‡!");
                            log.info("CartServiceImpl.updateä¸šåŠ¡ç»“æŸï¼Œç»“æœ:{}",fail);
                            return fail;
                        }
        
                        //3.æ•°æ®ä¿®æ”¹
                        QueryWrapper<Cart> queryWrapper = new QueryWrapper<>();
                        queryWrapper.eq("user_id",cartParam.getUserId());
                        queryWrapper.eq("product_id",cartParam.getProductId());
                        Cart cart = cartMapper.selectOne(queryWrapper);
        
                        cart.setNum(cartParam.getNum());
        
                        cartMapper.updateById(cart);
                        //4.ç»“æœå°è£…
                        R ok = R.ok("è´­ç‰©è½¦æ•°é‡æ›´æ–°æˆåŠŸ!");
                        log.info("CartServiceImpl.updateä¸šåŠ¡ç»“æŸï¼Œç»“æœ:{}",ok);
                        return ok;
                    }
        
                    ```

        *   è´­ç‰©è½¦åˆ é™¤æ¥å£

            *   æ¥å£åˆ†æ

                è¯·æ±‚URLï¼š/cart/remove

                è¯·æ±‚æ–¹å¼ï¼šPOST

                è¯·æ±‚ç±»å‹: JSON

                å‚æ•°è¯´æ˜ï¼š

                > {"user\_id":4573,"product\_id":3}

                | å‚æ•°          | æ˜¯å¦å¿…é€‰ | ç±»å‹  | è¯´æ˜          |
                | ----------- | ---- | --- | ----------- |
                | product\_id | æ˜¯    | int | å•†å“id,æŸ¥è¯¢å•†å“è¯¦æƒ… |
                | user\_id    | æ˜¯    | int | ç”¨æˆ·id!       |

                è¿”å›ç¤ºä¾‹:

                ```json
                {"code":"001","msg":"åˆ é™¤è´­ç‰©è½¦æˆåŠŸ"}
                ```

            *   ä¸šåŠ¡åˆ†æ

                1.  æ ¹æ®ä¼ å…¥çš„ç”¨æˆ·IDå’Œå•†å“IDè¿›è¡Œè´­ç‰©è½¦åˆ é™¤

                2.  åˆ é™¤ä»¥åï¼Œè¿›è¡Œç»“æœå°è£…

            *   åŠŸèƒ½å®ç°

                *   controller

                    ```java
                    @PostMapping("remove")
                    public R remove(@RequestBody CartParam cartParam){

                        return cartService.remove(cartParam);
                    }
                    ```

                *   service

                    ```java
                    /**
                     * ç§»é™¤è´­ç‰©è½¦æ•°æ®
                     *
                     * @param cartParam
                     * @return
                     */
                    @Override
                    public R remove(CartParam cartParam) {
            
                        //åˆ é™¤å‚æ•°å°è£…
                        QueryWrapper<Cart> queryWrapper = new QueryWrapper<>();
                        queryWrapper.eq("user_id",cartParam.getUserId());
                        queryWrapper.eq("product_id",cartParam.getProductId());
                        //åˆ é™¤æ•°æ®
                        cartMapper.delete(queryWrapper);
                        return R.ok("åˆ é™¤æ•°æ®æˆåŠŸ!");
                    }
                    ```

    *   postmanæµ‹è¯•

    *   å‰åç«¯è”è°ƒ

*   **è®¢å•æœåŠ¡**

    *   ä»‹ç»

        > è®¢å•ç›¸å…³çš„åŠŸèƒ½å®ç°ï¼Œè®¢å•ç”Ÿæˆï¼Œè®¢å•å±•ç¤ºç­‰ï¼

    *   æœåŠ¡æ­å»º

        *   æ•°æ®åº“å¯¼å…¥

            [store\_order.sql](file/store_order_jn4NBm42Lu.sql)

            ```java
            # å°†æ•°æ®åº“è„šæœ¬å¤åˆ¶åˆ°æŸç›˜ç¬¦ä¸‹ï¼Œæ–¹ä¾¿å¯¼å…¥ï¼
            # æ‰§è¡Œæ•°æ®åº“è„šæœ¬å¯¼å…¥å‘½ä»¤ï¼æ³¨æ„ä¹±ç é—®é¢˜ï¼
            # æ­¥éª¤1:ä½¿ç”¨cmdå‘½ä»¤çª—å£ç™»å½•mysqlï¼Œé˜²æ­¢å¯¼å…¥ä¹±ç é—®é¢˜
            mysql -uè´¦å· -på¯†ç  --default-character-set=utf8  å›è½¦
            # æ­¥éª¤2:å¯¼å…¥æ•°æ®æ–‡ä»¶ æ³¨æ„ï¼Œè¦å†™ä½ è‡ªå·±çš„æ–‡ä»¶åœ°å€
            source d:\store_order.sql  å›è½¦  
            # æ­¥éª¤3: æŸ¥çœ‹æ•°æ®åº“
            show databases;
            ```

        *   æœåŠ¡åˆ›å»º

            æœåŠ¡åï¼šstore-front-order

        *   ä¾èµ–å¯¼å…¥

            ```xml
            <dependencies>
                <dependency>
                    <groupId>org.springframework.boot</groupId>
                    <artifactId>spring-boot-starter-web</artifactId>
                </dependency>
                <dependency>
                    <groupId>mysql</groupId>
                    <artifactId>mysql-connector-java</artifactId>
                </dependency>
                <!--mybatis-->
                <dependency>
                    <groupId>org.mybatis.spring.boot</groupId>
                    <artifactId>mybatis-spring-boot-starter</artifactId>
                </dependency>
                <!-- nacoså®¢æˆ·ç«¯ä¾èµ–åŒ… -->
                <dependency>
                    <groupId>com.alibaba.cloud</groupId>
                    <artifactId>spring-cloud-starter-alibaba-nacos-discovery</artifactId>
                </dependency>
                <!--feignå®¢æˆ·ç«¯ä¾èµ–-->
                <dependency>
                    <groupId>org.springframework.cloud</groupId>
                    <artifactId>spring-cloud-starter-openfeign</artifactId>
                </dependency>
                <!--å¼•å…¥HttpClientä¾èµ–-->
                <dependency>
                    <groupId>io.github.openfeign</groupId>
                    <artifactId>feign-httpclient</artifactId>
                </dependency>

                <dependency>
                <groupId>com.baomidou</groupId>
                    <artifactId>mybatis-plus-boot-starter</artifactId>
                </dependency>

                <dependency>
                    <groupId>com.alibaba</groupId>
                    <artifactId>druid-spring-boot-starter</artifactId>
                </dependency>

                <!-- æ­¤å¤„æ˜¯ä½ çš„store_common_feignæ¨¡å—çš„gav,å¦‚æœä¸ä¸€è‡´,éœ€è¦æ”¹è¿›,æ³¨æ„,éœ€è¦æ”¾å…¥mavenæœ¬åœ°åº“!-->
                <dependency>
                    <artifactId>store-commons</artifactId>
                    <groupId>com.atguigu</groupId>
                    <version>1.0.0</version>
                </dependency>

                <!--AMQPä¾èµ–ï¼ŒåŒ…å«RabbitMQ-->
                <dependency>
                    <groupId>org.springframework.boot</groupId>
                    <artifactId>spring-boot-starter-amqp</artifactId>
                </dependency>

            </dependencies>
            ```

        *   é…ç½®æ–‡ä»¶

            bootstrap.yml

            ```yaml
            spring:
              application:
                name: order-service
              cloud:
                nacos:
                  server-addr: 124.221.70.206:8848
            server:
              port: 3010
            ```

            application.yml

            ```yaml
            spring:
              # è¿æ¥æ± é…ç½®
              datasource:
                url: jdbc:mysql://localhost:3306/store_order?useSSL=false
                username: root
                password: 123456
                driver-class-name: com.mysql.jdbc.Driver
                type: com.alibaba.druid.pool.DruidDataSource
              profiles:
                active: mq # æ¿€æ´»ç¼“å­˜å’Œmqé…ç½®
            mybatis-plus:
              mapper-locations: classpath:mappers/*.xml
              configuration:
                map-underscore-to-camel-case: true
                auto-mapping-behavior: full
                lazy-loading-enabled: true
                aggressive-lazy-loading: false
              type-aliases-package: com.atguigu.pojo #è®¾ç½®åˆ«å

            ribbon:
              eager-load:
                enabled: true #å¼€å¯é¥¥é¥¿åŠ è½½æå‡ç¬¬ä¸€æ¬¡è®¿é—®é€Ÿåº¦
                clients:
                  - order-service #æŒ‡å®šå¼€å¯æœåŠ¡
            feign:
              httpclient:
                enabled: true  # å¼€å¯httpClientå¼€å…³,å¯åŠ¨è¿æ¥æ± ,æå‡feignè¿æ¥æ•ˆç‡!
                max-connections: 200  #æœ€å¤§è¿æ¥æ•°é‡
                max-connections-per-route: 50  #å•è·¯å¾„æœ€å¤§è¿æ¥æ•°
            ```

        *   é…ç½®ç±»

            ```java
            @Configuration
            public class OrderConfiguration {


                /**
                 * mqåºåˆ—åŒ–æ–¹å¼ï¼Œé€‰æ‹©jsonï¼
                 * @return
                 */
                @Bean
                public MessageConverter messageConverter(){
    
                    return new Jackson2JsonMessageConverter();
                }
            }
            ```
    
        *   å¯åŠ¨ç±»
    
            ```java
            @MapperScan(basePackages = "com.atguigu.order.mapper")
            @SpringBootApplication
            @EnableFeignClients(clients = {ProductClient.class})
            public class OrderApplication {
    
                public static void main(String[] args) {
                    SpringApplication.run(OrderApplication.class,args);
                }
            }
            ```
    
        *   ç½‘å…³é…ç½®&#x20;
    
            ```yaml
            - id: order-service  # è®¢å•æœåŠ¡
              uri: lb://order-service
              predicates:
                - Path=/order/**
            ```
    
    *   åŠŸèƒ½å®ç°
    
        *   è®¢å•ç”Ÿæˆ
    
            *   æ¥å£ä»‹ç»
    
                è¯·æ±‚URLï¼š/order/save
    
                è¯·æ±‚æ–¹å¼ï¼šPOST
    
                è¯·æ±‚ç±»å‹: JSON
    
                å‚æ•°è¯´æ˜ï¼š
    
                ```json
                {"user_id":4573,"products":
                    [{"id":11206,"productID":3,
                    "productName":"å°ç±³CC9 Pro",
                    "productImg":"public/imgs/phone/Mi-CC9.png",
                    "price":2599,"num":3,
                    "maxNum":10,
                    "check":true}]}
                ```
    
                è¿”å›ç¤ºä¾‹:
    
                ```json
                {"code":"001","msg":"è´­ä¹°æˆåŠŸ"}
                ```
    
            *   ä¸šåŠ¡ä»‹ç»
    
                1.  æ”¯ä»˜æˆåŠŸ
    
                2.  è¿›è¡Œè®¢å•æ•°æ®ä¿å­˜
    
                3.  å¼‚æ­¥æ¸…ç©ºå¯¹åº”çš„è´­ç‰©è½¦æ•°æ®
    
                4.  å¼‚æ­¥ä¿®æ”¹å•†å“çš„åº“å­˜å’Œé”€å”®ä¿¡æ¯
    
                5.  å•ä¸šåŠ¡æ¶‰åŠå¤šDMLè¯­å¥ï¼Œæ³¨æ„æ·»åŠ äº‹åŠ¡
    
            *   åŠŸèƒ½å®ç°
    
                *   paramå®šä¹‰ \[store-common-feign]
    
                    ```java
                    //è®¢å•å‚æ•°
                    @JsonIgnoreProperties(ignoreUnknown = true)
                    @Data
                    public class OrderParam implements Serializable {
    
                        public static final Long serialVersionUID = 1L;
    
                        @JsonProperty("user_id")
                        private Integer userId;
                        private List<CartVo> products;
    
                    }
    
                    //è°ƒç”¨productå‚æ•°
                    /**
                     * projectName: b2c-cloud-store
                     *
                     * @author: èµµä¼Ÿé£
                     * description: å•†å“åº“å­˜ä¿¡æ¯ä¿å­˜param
                     */
                    @Data
                    public class ProductNumberParam {
    
                        //å•†å“id
                        private Integer productId;
                        //è´­ä¹°æ•°é‡
                        private Integer productNum;
                    }
    
                    ```
    
                *   pojoå®šä¹‰  \[store-common-feign]
    
                    ```java
                    @JsonIgnoreProperties(ignoreUnknown = true)
                    @Data
                    @TableName("orders")
                    public class Order implements Serializable {
    
                        @TableId(type = IdType.AUTO)
                        private Integer id;
                        @JsonProperty("order_id")
                        private Long    orderId; //è®¢å•ç¼–å·,é€‰æ‹©ä½¿ç”¨æ—¶é—´æˆ³
                        @JsonProperty("user_id")
                        private Integer userId;
                        @JsonProperty("product_id")
                        private Integer productId;
                        @JsonProperty("product_num")
                        private Integer productNum;
                        @JsonProperty("product_price")
                        private Double  productPrice;
                        @JsonProperty("order_time")
                        private Long    orderTime;
                     }
                    ```
    
                *   orderVo  \[store-common-feign]
    
                    ```java
                    //æŸ¥è¯¢è®¢å•éœ€è¦è¿”å›ç»“æœ
                    @JsonIgnoreProperties(ignoreUnknown = true)
                    @Data
                    public class OrderVo extends Order {
    
                        @JsonProperty("product_name")
                        private String productName;
                        @JsonProperty("product_picture")
                        private String productPicture;
    
                    }
    
                    ```
    
                *   controller
    
                    ```java
                    @RequestMapping("/order")
                    public class OrderController {


                        @Autowired
                        private OrderService orderService;
    
                        /**
                         * è®¢å•æ•°æ®ä¿å­˜
                         * @param orderParam
                         * @return
                         */
                        @PostMapping("save")
                        public Object save(@RequestBody OrderParam orderParam){


                            return orderService.save(orderParam);
                        }
                    ```
    
                *   rabbitMQç»‘å®šå…³ç³»
    
                    ![](image/image_g3ClZiD5Mm.png)
    
                *   service
    
                    ```java
                    public interface OrderService extends IService<Order> {
    
                    @Slf4j
                    @Service
                    public class OrderServiceImpl  extends ServiceImpl<OrderMapper,Order> implements OrderService {
    
                        @Autowired
                        private ProductClient productClient;
    
                        /**
                         * æ¶ˆæ¯é˜Ÿåˆ—å‘é€
                         */
                        @Autowired
                        private RabbitTemplate rabbitTemplate;
    
                        //@Autowired
                        //private OrderMapper orderMapper;
    
                        /**
                         * è®¢å•ä¿å­˜ä¸šåŠ¡
                         * åº“å­˜å’Œè´­ç‰©è½¦ä½¿ç”¨mqå¼‚æ­¥,é¿å…åˆ†å¸ƒå¼äº‹åŠ¡!
                         * @param orderParam
                         * @return
                         */
                        @Transactional //æ·»åŠ äº‹åŠ¡
                        @Override
                        public Object save(OrderParam orderParam) {
    
                            //ä¿®æ”¹æ¸…ç©ºè´­ç‰©è½¦çš„å‚æ•°
                            List<Integer> cartIds = new ArrayList<>();
                            //ä¿®æ”¹æ‰¹é‡æ’å…¥æ•°æ®åº“çš„å‚æ•°
                            List<Order>  orderList = new ArrayList<>();
                            //å•†å“ä¿®æ”¹åº“å­˜å‚æ•°é›†åˆ
                            List<ProductNumberParam>  productNumberParamList  =
                                                                 new ArrayList<>();
    
                            Integer userId = orderParam.getUserId();
                            List<CartVo> products = orderParam.getProducts();
                            //å°è£…orderå®ä½“ç±»é›†åˆ
                            //ç»Ÿä¸€ç”Ÿæˆè®¢å•ç¼–å·å’Œåˆ›å»ºæ—¶é—´
                            //ä½¿ç”¨æ—¶é—´æˆ³ + åšè®¢å•ç¼–å·å’Œäº‹ä»¶
                            long ctime = System.currentTimeMillis();
    
                            for (CartVo cartVo : products) {
                                cartIds.add(cartVo.getId()); //è¿›è¡Œè´­ç‰©è½¦è®¢å•ä¿å­˜
                                //è®¢å•ä¿¡æ¯ä¿å­˜
                                Order order = new Order();
                                order.setOrderId(ctime);
                                order.setUserId(userId);
                                order.setOrderTime(ctime);
                                order.setProductId(cartVo.getProductID());
                                order.setProductNum(cartVo.getNum());
                                order.setProductPrice(cartVo.getPrice());
                                orderList.add(order); //æ·»åŠ ç”¨æˆ·ä¿¡æ¯
    
                                //ä¿®æ”¹ä¿¡æ¯å­˜å‚¨
                                ProductNumberParam productNumberParam = new ProductNumberParam();
                                productNumberParam.setProductId(cartVo.getProductID());
                                productNumberParam.setProductNum(cartVo.getNum());
                                productNumberParamList.add(productNumberParam); //æ·»åŠ é›†åˆ
                            }
                            //æ‰¹é‡æ•°æ®æ’å…¥//
                            this.saveBatch(orderList); //æ‰¹é‡ä¿å­˜
    
                            //ä¿®æ”¹å•†å“åº“å­˜ [product-service] [å¼‚æ­¥é€šçŸ¥]
                            /**
                             *  äº¤æ¢æœº: topic.ex
                             *  routingkey: sub.number
                             *  æ¶ˆæ¯: å•†å“idå’Œå‡åº“å­˜æ•°æ®é›†åˆ
                             */
                            rabbitTemplate.convertAndSend("topic.ex","sub.number",productNumberParamList);
                            //æ¸…ç©ºå¯¹åº”è´­ç‰©è½¦æ•°æ®å³å¯ [æ³¨æ„: ä¸æ˜¯æ¸…ç©ºç”¨æˆ·æ‰€æœ‰çš„è´­ç‰©è½¦æ•°æ®] [cart-service] [å¼‚æ­¥é€šçŸ¥]
                            /**
                             * äº¤æ¢æœº:topic.ex
                             * routingkey: clear.cart
                             * æ¶ˆæ¯: è¦æ¸…ç©ºçš„è´­ç‰©è½¦idé›†åˆ
                             */
                            rabbitTemplate.convertAndSend("topic.ex","clear.cart",cartIds);
    
                            R ok = R.ok("è®¢å•ç”ŸæˆæˆåŠŸ!");
                            log.info("OrderServiceImpl.saveä¸šåŠ¡ç»“æŸï¼Œç»“æœ:{}",ok);
                            return ok;
                        }
                     
                     }
    
                    ```
    
                *   mapper
    
                    ```java
                    public interface OrderMapper extends BaseMapper<Order> {
                    }
                    ```
    
                *   productListener \[store-front-product]
    
                    æ³¨æ„ï¼šå¼•å…¥mqçš„é…ç½®å’Œé…ç½®ç±»
    
                    ```java
                    @Component
                    public class ProductListener {
    
                        @Autowired
                        private ProductService productService;
    
                        /**
                         * ä¿®æ”¹åº“å­˜æ•°æ®
                         * @param productNumberParams
                         */
                        @RabbitListener(bindings = @QueueBinding(
                                value = @Queue(name = "sub.queue"),
                                exchange = @Exchange("topic.ex"),
                                key = "sub.number"
                        ))
                        public void subNumber(List<ProductNumberParam> productNumberParams){
                            System.err.println("ProductListener.subNumber");
                            System.err.println("productNumberParams = " + productNumberParams);
    
                            //è°ƒç”¨ä¸šåŠ¡ä¿®æ”¹åº“å­˜å³å¯
                            productService.batchNumber(productNumberParams);
                        }
    
                    }
    
                    //productService
                     /**
                     * ä¿®æ”¹å•†å“åº“å­˜
                     *
                     * @param productNumberParams
                     */
                    @Transactional
                    @Override
                    public void batchNumber(List<ProductNumberParam> productNumberParams) {
    
                        //å°†productNumberParamsè½¬æˆmap
                        //ä½¿ç”¨idä½œä¸ºkey, itemåšå€¼, æ¯”è¾ƒç›¸é‚»çš„ä¸¤æ¬¡key,å¦‚æœç›¸åŒ,å»æ‰é‡è¯»!
                        Map<Integer, ProductNumberParam> productNumberParamMap = productNumberParams.stream()
                                .collect(Collectors.toMap(ProductNumberParam::getProductId, v -> v));
    
                        //å°è£…å•†å“é›†åˆ
                        Set<Integer> productIds = productNumberParamMap.keySet();
    
                        //æŸ¥è¯¢
                        List<Product> productList = baseMapper.selectBatchIds(productIds);
                        //ä¿®æ”¹
    
                        for (Product product : productList) {
                            //è®¾ç½®æ–°åº“å­˜
                            product.setProductNum(product.getProductNum() -
                                    productNumberParamMap.get(product.getProductId()).getProductNum());
                            //è®¾ç½®é”€å”®é‡
                            product.setProductSales(product.getProductSales() +
                                    productNumberParamMap.get(product.getProductId()).getProductNum());
                        }
    
                        //æ‰¹é‡æ•°æ®æ›´æ–°
                        this.updateBatchById(productList);
                    }
    
                    ```
    
                *   cartListener \[store-fron-cart]
    
                    æ³¨æ„ï¼šå¼•å…¥mqçš„é…ç½®å’Œé…ç½®ç±»
    
                    ```java
                    @Component
                    public class CartListener {


                        @Autowired
                        private CartService cartService;
    
                        /**
                         * è´­ç‰©è½¦æ•°æ®æ¸…ç©ºç›‘å¬
                         * @param cartIds //è¦æ¸…ç©ºçš„è´­ç‰©è½¦æ•°æ®é›†åˆ
                         */
                        @RabbitListener(bindings = @QueueBinding(
                                value = @Queue(name = "clear.queue"),
                                exchange = @Exchange("topic.ex"),
                                key = "clear.cart"
                        ))
                        public void subNumber(List<Integer> cartIds){
                            System.out.println("CartListener.subNumber");
                            System.out.println("cartIds = " + cartIds);
    
                            //è°ƒç”¨ä¸šåŠ¡ä¿®æ”¹åº“å­˜å³å¯
                            cartService.removeBatchByIds(cartIds);
                        }
    
                    }


                    public class CartServiceImpl extends ServiceImpl<CartMapper,Cart> implements CartService {
    
                    ```
    
        *   è®¢å•å±•ç¤º
    
            *   æ¥å£ä»‹ç»
    
                è¯·æ±‚URLï¼š/order/list
    
                è¯·æ±‚æ–¹å¼ï¼šPOST
    
                è¯·æ±‚ç±»å‹: JSON
    
                å‚æ•°è¯´æ˜ï¼š
    
                > {"user\_id":4573}
    
                | å‚æ•°       | æ˜¯å¦å¿…é€‰ | ç±»å‹  | è¯´æ˜    |
                | -------- | ---- | --- | ----- |
                | user\_id | æ˜¯    | int | ç”¨æˆ·id! |
    
                è¿”å›ç»“æœï¼š
    
                ```json
                {
                  "code": "001",
                  "data": [
                    [
                      //æ³¨æ„ï¼š åŒä¸€ä¸ªè®¢å•é¡¹ï¼Œå†…å®¹æ·»åŠ åˆ°åŒä¸€ä¸ªé›†åˆä¸­ï¼
                      {
                        "id": 5807,
                        "order_id": 45731632152375070,
                        "user_id": 4573,
                        "product_id": 3,
                        "product_num": 3,
                        "product_price": 2599,
                        "order_time": 1632152375072,
                        "product_name": "å°ç±³CC9 Pro",
                        "product_picture": "public/imgs/phone/Mi-CC9.png"
                      }
                    ],
                    [
                      {
                        "id": 5805,
                        "order_id": 45731632141402664,
                        "user_id": 4573,
                        "product_id": 10,
                        "product_num": 4,
                        "product_price": 1899,
                        "order_time": 1632141402666,
                        "product_name": "å°ç±³å…¨é¢å±ç”µè§†E55A",
                        "product_picture": "public/imgs/appliance/MiTv-E55A.png"
                      }
                    ]
                  ]
                }
                ```
    
            *   ä¸šåŠ¡ä»‹ç»
    
                1.  æ¥å—ç”¨æˆ·ç¼–å·
    
                2.  æ ¹æ®ç”¨æˆ·ç¼–å·æŸ¥è¯¢è®¢å•æ•°æ®
    
                3.  è®¢å•åˆ†ç»„æŸ¥è¯¢ï¼Œæœ€åå°è£…æ•°æ®è¿”å›
    
                4.  éœ€è¦è°ƒç”¨å•†å“æœåŠ¡ï¼Œè¿›è¡Œå•†å“ä¿¡æ¯æŸ¥è¯¢
    
            *   åŠŸèƒ½å®ç°
    
                *   OrderVo
    
                    ```java
                    //æŸ¥è¯¢è®¢å•éœ€è¦è¿”å›ç»“æœ
                    @JsonIgnoreProperties(ignoreUnknown = true)
                    @Data
                    public class OrderVo extends Order {
    
                        @JsonProperty("product_name")
                        private String productName;
                        @JsonProperty("product_picture")
                        private String productPicture;
    
                    }
                    ```
    
                *   controller
    
                    ```java
                     /**
                     * è®¢å•é›†åˆæŸ¥è¯¢,æ³¨æ„,æŒ‰ç…§ç±»åˆ«æŸ¥è¯¢!
                     * @param orderParam
                     * @return
                     */
                    @PostMapping("/list")
                    public Object list(@RequestBody OrderParam orderParam){
    
                        return orderService.list(orderParam);
                    }
                    ```
    
                *   service
    
                    ```java
                    /**
                     * è®¢å•æ•°æ®æŸ¥è¯¢ä¸šåŠ¡
                     *
                     * @param orderParam
                     * @return
                     */
                    @Override
                    public Object list(OrderParam orderParam) {
    
                        Integer userId = orderParam.getUserId();
                        //æŸ¥è¯¢ç”¨æˆ·å¯¹åº”çš„å…¨éƒ¨è®¢å•æ•°æ®
                        QueryWrapper<Order> orderQueryWrapper = new QueryWrapper<>();
                        orderQueryWrapper.eq("user_id",userId);
                        List<Order> orderList = this.list(orderQueryWrapper);
    
                        Set<Integer> productIds = new HashSet<>();
                        for (Order order : orderList) {
                            productIds.add(order.getProductId());
                        }


                        //æ•°æ®æŒ‰è®¢å•åˆ†ç»„
                        Map<Long, List<Order>> listMap = orderList.stream().
                                collect(Collectors.groupingBy(Order::getOrderId));
    
                        //ç»“æœé›†å°è£…,è¿”å›å³å¯
                        ProductIdsParam productIdsParam = new ProductIdsParam();
                        productIdsParam.setProductIds(new ArrayList<>(productIds));
    
                        List<Product> productList = productClient.ids(productIdsParam);
                        //å•†å“æ•°æ®
                        Map<Integer, Product> productMap = productList.stream().collect(Collectors.toMap(Product::getProductId, v -> v));
    
                        //ç»“æœå°è£…
                        List<List<OrderVo>> result = new ArrayList<>();
    
                        for (List<Order> orders : listMap.values()) {
                            List<OrderVo> orderVos = new ArrayList<>();
                            for (Order order : orders) {
                                //è¿”å›voæ•°æ®å°è£…
                                OrderVo orderVo = new OrderVo();
                                Product product = productMap.get(order.getProductId());
                                orderVo.setProductName(product.getProductName());
                                orderVo.setProductPicture(product.getProductPicture());
                                orderVo.setId(order.getId());
                                orderVo.setOrderId(order.getOrderId());
                                orderVo.setOrderTime(order.getOrderTime());
                                orderVo.setProductNum(order.getProductNum());
                                orderVo.setProductId(order.getProductId());
                                orderVo.setProductPrice(order.getProductPrice());
                                orderVo.setUserId(order.getUserId());
                                orderVos.add(orderVo);
                            }
                            result.add(orderVos);
                        }
    
                        R ok = R.ok(result);
                        log.info("OrderServiceImpl.listä¸šåŠ¡ç»“æŸï¼Œç»“æœ:{}",ok);
                        return ok;
                    }
                    ```
    
    *   postmanæµ‹è¯•
    
    *   å‰åè”è°ƒ

### ä¸ƒã€åå°ç®¡ç†æœåŠ¡å¼€å‘

*   **å·¥ç¨‹æ­å»º**

    *   æ¨¡å—åï¼šstore-admin

*   **æ•°æ®åº“å¯¼å…¥**

    [store-admin.sql](file/store-admin_OaQiiiZYEf.sql)

    ```yaml
    # å°†æ•°æ®åº“è„šæœ¬å¤åˆ¶åˆ°æŸç›˜ç¬¦ä¸‹ï¼Œæ–¹ä¾¿å¯¼å…¥ï¼
    # æ‰§è¡Œæ•°æ®åº“è„šæœ¬å¯¼å…¥å‘½ä»¤ï¼æ³¨æ„ä¹±ç é—®é¢˜ï¼
    # æ­¥éª¤1:ä½¿ç”¨cmdå‘½ä»¤çª—å£ç™»å½•mysqlï¼Œé˜²æ­¢å¯¼å…¥ä¹±ç é—®é¢˜
    mysql -uè´¦å· -på¯†ç  --default-character-set=utf8  å›è½¦
    # æ­¥éª¤2:å¯¼å…¥æ•°æ®æ–‡ä»¶ æ³¨æ„ï¼Œè¦å†™ä½ è‡ªå·±çš„æ–‡ä»¶åœ°å€
    source d:\store_admin.sql  å›è½¦  
    # æ­¥éª¤3: æŸ¥çœ‹æ•°æ®åº“
    show databases;

    æ³¨æ„ï¼š é»˜è®¤è´¦å·å’Œå¯†ç ä¸º admin123
    ```

*   **ä¾èµ–å¯¼å…¥**

    ```xml
     <dependencies>
        <!--        éªŒè¯ç -->
        <dependency>
            <groupId>com.github.whvcse</groupId>
            <artifactId>easy-captcha</artifactId>
            <version>1.6.2</version>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-thymeleaf</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>
        <dependency>
            <groupId>mysql</groupId>
            <artifactId>mysql-connector-java</artifactId>
        </dependency>
        <!--mybatis-->
        <dependency>
            <groupId>org.mybatis.spring.boot</groupId>
            <artifactId>mybatis-spring-boot-starter</artifactId>
        </dependency>
        <!-- nacoså®¢æˆ·ç«¯ä¾èµ–åŒ… -->
        <dependency>
            <groupId>com.alibaba.cloud</groupId>
            <artifactId>spring-cloud-starter-alibaba-nacos-discovery</artifactId>
        </dependency>
        <!--feignå®¢æˆ·ç«¯ä¾èµ–-->
        <dependency>
            <groupId>org.springframework.cloud</groupId>
            <artifactId>spring-cloud-starter-openfeign</artifactId>
        </dependency>
        <!--å¼•å…¥HttpClientä¾èµ–-->
        <dependency>
            <groupId>io.github.openfeign</groupId>
            <artifactId>feign-httpclient</artifactId>
        </dependency>
    
        <dependency>
            <groupId>com.baomidou</groupId>
            <artifactId>mybatis-plus-boot-starter</artifactId>
        </dependency>
    
        <dependency>
            <groupId>com.alibaba</groupId>
            <artifactId>druid-spring-boot-starter</artifactId>
        </dependency>
    
        <!-- æ­¤å¤„æ˜¯ä½ çš„store_common_feignæ¨¡å—çš„gav,å¦‚æœä¸ä¸€è‡´,éœ€è¦æ”¹è¿›,æ³¨æ„,éœ€è¦æ”¾å…¥mavenæœ¬åœ°åº“!-->
        <dependency>
            <artifactId>store-commons</artifactId>
            <groupId>com.atguigu</groupId>
            <version>1.0.0</version>
        </dependency>
    
        <!--AMQPä¾èµ–ï¼ŒåŒ…å«RabbitMQ-->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-amqp</artifactId>
        </dependency>



        <!-- https://mvnrepository.com/artifact/org.hibernate.validator/hibernate-validator -->
        <dependency>
            <groupId>org.hibernate.validator</groupId>
            <artifactId>hibernate-validator</artifactId>
            <version>6.2.0.Final</version>
        </dependency>
        <!-- https://mvnrepository.com/artifact/org.hibernate.validator/hibernate-validator-annotation-processor -->
        <dependency>
            <groupId>org.hibernate.validator</groupId>
            <artifactId>hibernate-validator-annotation-processor</artifactId>
            <version>6.2.0.Final</version>
        </dependency>
    
        <!-- é˜¿é‡Œäº‘OSSæ–‡ä»¶ä¸Šä¼ å¼€å§‹ -->
        <!-- é˜¿é‡Œäº‘ OSS -->
        <dependency>
            <groupId>com.aliyun.oss</groupId>
            <artifactId>aliyun-sdk-oss</artifactId>
            <version>3.14.1</version>
        </dependency>
        <!--æ—¥æœŸæ—¶é—´å·¥å…·-->
        <dependency>
            <groupId>joda-time</groupId>
            <artifactId>joda-time</artifactId>
            <version>2.10.14</version>
        </dependency>
        <dependency>
            <groupId>commons-io</groupId>
            <artifactId>commons-io</artifactId>
            <version>2.4</version>
        </dependency>
    </dependencies>
    ```

*   **é…ç½®æ–‡ä»¶**

    *   bootstrap.yml

        ```yaml
        spring:
          application:
            name: admin-service
          cloud:
            nacos:
              server-addr: 124.221.70.206:8848 #æ³¨å†Œä¸­å¿ƒ
        server:
          port: 3011
        ```

    *   appliction.yml

        ```yaml
        spring:
          # è¿æ¥æ± é…ç½®
          datasource:
            url: jdbc:mysql://localhost:3306/store_admin?useSSL=false
            username: root
            password: 123456
            driver-class-name: com.mysql.jdbc.Driver
            type: com.alibaba.druid.pool.DruidDataSource
          profiles:
            active: cache,mq
          thymeleaf:
            cache: true  #å¼€å¯ç¼“å­˜
            check-template: true  #æ£€æŸ¥æ¨¡æ¿æ˜¯å¦å­˜åœ¨
            check-template-location: true # æ£€æŸ¥æ¨¡æ¿ä½ç½®æ­£ç¡®æ€§ é»˜è®¤æŸ¥æ‰¾ resources templatesæ–‡ä»¶å¤¹å†…
            servlet:
              content-type: text/html # ç›´æ¥åµŒå…¥åˆ°htmlæ–‡ä»¶ä¸­
            enabled: true
            encoding: UTF-8
    
        mybatis-plus:
          mapper-locations: classpath:mappers/*.xml
          configuration:
            map-underscore-to-camel-case: true
            auto-mapping-behavior: full
            lazy-loading-enabled: true
            aggressive-lazy-loading: false
          type-aliases-package: com.atguigu.pojo #è®¾ç½®åˆ«åa
        ribbon:
          ReadTimeout: 60000
          ConnectTimeout: 60000
          eager-load:
            enabled: true #å¼€å¯é¥¥é¥¿åŠ è½½æå‡ç¬¬ä¸€æ¬¡è®¿é—®é€Ÿåº¦
            clients:
              - store-service #æŒ‡å®šå¼€å¯æœåŠ¡
        feign:
          httpclient:
            enabled: true  # å¼€å¯httpClientå¼€å…³,å¯åŠ¨è¿æ¥æ± ,æå‡feignè¿æ¥æ•ˆç‡!
            max-connections: 200  #æœ€å¤§è¿æ¥æ•°é‡
            max-connections-per-route: 50  #å•è·¯å¾„æœ€å¤§è¿æ¥æ•°
          client: #é»˜è®¤ 1ç§’
            default: # è®¾ç½®è¿æ¥è¶…æ—¶æ—¶é—´
              ConnectTimeOut: 10000
              ReadTimeOut: 10000 #è®¾ç½®è¯»å–æ•°æ®è¶…æ—¶æ—¶é—´
    
        server:
          servlet:
            context-path: /admin
    
        #OSSé…ç½®
        aliyun:
          oss:
            file:
              # æ§åˆ¶å° - oss - ç‚¹å‡»å¯¹åº”æ¡¶ - æ¦‚è§ˆ - åœ°åŸŸèŠ‚ç‚¹
              endpoint: oss-cn-beijing.aliyuncs.com
              keyid: LTAI5t82cN3TfofxJywKvoj5
              keysecret: 7cPhJQBMNewuqXXnUiEjpj1l8YeONo
              bucketname: store-b2c
        ```

*   **é…ç½®ç±»**

    ```json
        ç»§æ‰¿ç¼“å­˜çš„é…ç½®ç±» spring-cache
        /**
         * mqåºåˆ—åŒ–æ–¹å¼ï¼Œé€‰æ‹©jsonï¼
         * @return
         */
        @Bean
        public MessageConverter messageConverter(){

            return new Jackson2JsonMessageConverter();
        }
        
        /**
         * æ–°çš„åˆ†é¡µæ’ä»¶,ä¸€ç¼“å’ŒäºŒç¼“éµå¾ªmybatisçš„è§„åˆ™,éœ€è¦è®¾ç½® MybatisConfiguration#useDeprecatedExecutor = false é¿å…ç¼“å­˜å‡ºç°é—®é¢˜(è¯¥å±æ€§ä¼šåœ¨æ—§æ’ä»¶ç§»é™¤åä¸€åŒç§»é™¤)
         */
        @Bean
        public MybatisPlusInterceptor mybatisPlusInterceptor() {
            MybatisPlusInterceptor interceptor = new MybatisPlusInterceptor();
            interceptor.addInnerInterceptor(new PaginationInnerInterceptor(DbType.MYSQL));
            return interceptor;
        }
    ```

*   **é™æ€èµ„æºå¯¼å…¥**

    > é™æ€èµ„æºå…¨éƒ¨å¯¼å…¥åˆ°**resources**åŒ…ä¸‹å³å¯

    *   é™æ€èµ„æº

        [static.zip](file/static_l7bTRXnX15.zip)

    *   thymeleafé¡µé¢

        [templates.zip](file/templates_Ssy-WhbfXo.zip)

*   **å¯åŠ¨ç±»é…ç½®**

    ```java
    @MapperScan("com.atguigu.admin.mapper")
    @SpringBootApplication
    @EnableCaching //å¼€å¯ç¼“å­˜æ”¯æŒ
    public class AdminApplication  {

        public static void main(String[] args) {
            SpringApplication.run(AdminApplication.class,args);
        }
    }

    ```

*   **ç½‘å…³é…ç½®**

    é…ç½®åå°ç®¡ç†ç½‘å…³ /admin/\*\*&#x20;

    ```java
    - id: admin-service  # åå°ç®¡ç†æœåŠ¡
      uri: lb://admin-service
      predicates:
        - Path=/admin/**
    ```

*   **åŠŸèƒ½å®ç°**

    *   è·³è½¬é¡µé¢controllerè®¾è®¡

        ```java
        package com.atguigu.controller;
        
        import com.atguigu.clients.CategoryClient;
        import com.atguigu.pojo.Category;
        import lombok.extern.slf4j.Slf4j;
        import org.springframework.beans.factory.annotation.Autowired;
        import org.springframework.stereotype.Controller;
        import org.springframework.ui.Model;
        import org.springframework.web.bind.annotation.GetMapping;
        import org.springframework.web.bind.annotation.RequestMapping;
        
        import java.util.List;
        
        /**
         * projectName: b2c-cloud-store
         *
         * @author: èµµä¼Ÿé£
         * description:  ä¸“é—¨ç”¨äºå­˜å‚¨,é¡µé¢è·³è½¬handleræ–¹æ³•çš„controller
         */
        @Slf4j
        @Controller
        @RequestMapping
        public class HtmlJumpController {
        
            @Autowired
            private CategoryClient categoryClient;
        
            /**
             *  è®¾è®¡æ¬¢è¿é¡µé¢è·³è½¬controller
              * @return login ç™»å½•é¡µé¢
             */
           @GetMapping({"/","index.html","index"})
           public String  welcome(){
               log.info("HtmlJumpController.welcome è·³è½¬ç™»å½•é¡µé¢!");
               return "login";
           }


            /**
             * ç™»å½•æˆåŠŸè·³è½¬åˆ°indexé¡µé¢!
             * @return
             */
           @GetMapping("/home")
           public String home(){
               log.info("HtmlJumpController.homeç™»å½•æˆåŠŸ,è·³è½¬ç¨‹åºé¦–é¡µ!indexé¡µé¢!");
               return "index";
           }
    
            /**
             * è·³è½¬ç”¨æˆ·ç®¡ç†é¡µé¢
             */
            @GetMapping("/user")
            public String user(){
                log.info("HtmlJumpController.user,è·³è½¬ç”¨æˆ·ç®¡ç†!useré¡µé¢!");
                return "user/user";
            }
    
            /**
             * è·³è½¬å•†å“ç®¡ç†é¡µé¢
             */
            @GetMapping("/product")
            public String product(){
                log.info("HtmlJumpController.product,è·³è½¬å•†å“ç®¡ç†!producté¡µé¢!");
                return "product/product";
            }


            /**
             * è·³è½¬ç±»åˆ«ç®¡ç†é¡µé¢
             */
            @GetMapping("/category")
            public String category(){
                log.info("HtmlJumpController.category,è·³è½¬ç”¨æˆ·ç®¡ç†!categoryé¡µé¢!");
                return "category/category";
            }


            /**
             * è·³è½¬è®¢å•ç®¡ç†é¡µé¢
             */
            @GetMapping("/order")
            public String order(){
                log.info("HtmlJumpController.order,è·³è½¬ç”¨æˆ·ç®¡ç†!orderé¡µé¢!");
                return "order/order";
            }
    
            /**
             * æ‰“å¼€ç¼–è¾‘ç”¨æˆ·é¡µé¢
             */
            @GetMapping("/user/update/html")
            public String userUpdateHtml(){
                log.info("HtmlJumpController.userUpdateHtmlä¸šåŠ¡ç»“æŸï¼Œç»“æœ:{}");
                return "user/edit";
            }


            /**
             * æ‰“å¼€ç¼–è¾‘ç”¨æˆ·é¡µé¢
             */
            @GetMapping("/user/save/html")
            public String userSaveHtml(){
                log.info("HtmlJumpController.userSaveHtmlä¸šåŠ¡ç»“æŸï¼Œç»“æœ:{}");
                return "user/add";
            }




            /**
             * æ‰“å¼€ç¼–è¾‘ç±»åˆ«é¡µé¢
             */
            @GetMapping("/category/update/html")
            public String categoryUpdateHtml(){
                log.info("HtmlJumpController.categoryUpdateHtmlä¸šåŠ¡ç»“æŸï¼Œç»“æœ:{}");
                return "category/edit";
            }
    
            @GetMapping("/category/save/html")
            public String categorySaveHtml(){
                log.info("HtmlJumpController.categorySaveHtmlç»“æŸï¼Œç»“æœ:{}");
                return "category/add";
            }


            /**
             * å•†å“ä¿å­˜é¡µé¢è·³è½¬
             * @return
             */
            @GetMapping("/product/save/html")
            public String productSaveHtml(Model model){
                log.info("HtmlJumpController.productSaveHtmlä¸šåŠ¡ç»“æŸï¼Œç»“æœ:{}");
    
                //æŸ¥è¯¢ç±»åˆ«åˆ—è¡¨,å­˜å…¥å…±äº«åŸŸ
                List<Category> list = categoryClient.list();
                model.addAttribute("clist",list);
                return "product/add";
            }
    
            /**
             * å•†å“ä¿å­˜é¡µé¢è·³è½¬
             * @return
             */
            @GetMapping("/product/update/html")
            public String productUpdateHtml(Model model){
                log.info("HtmlJumpController.productUpdateHtmlä¸šåŠ¡ç»“æŸï¼Œç»“æœ:{}");
    
                //æŸ¥è¯¢ç±»åˆ«åˆ—è¡¨,å­˜å…¥å…±äº«åŸŸ
                List<Category> list = categoryClient.list();
                model.addAttribute("clist",list);
                return "product/edit";
            }
        }
    
        ```
    
    *   ç®¡ç†ç”¨æˆ·ç™»å½•åŠŸèƒ½
    
        *   æ¥å£ä»‹ç»
    
            è¯·æ±‚URLï¼š/admin/user/login
    
            è¯·æ±‚æ–¹å¼ï¼špost
    
            è¯·æ±‚ç±»å‹:   formdata
    
            å‚æ•°è¯´æ˜ï¼š&#x20;
    
            | å‚æ•°           | æ˜¯å¦å¿…é€‰ | ç±»å‹     | è¯´æ˜  |
            | ------------ | ---- | ------ | --- |
            | userAccount  | æ˜¯    | string | è´¦å·  |
            | userPassword | æ˜¯    | string | å¯†ç   |
            | verCode      | æ˜¯    | string | éªŒè¯ç  |
    
            è¿”å›ç»“æœï¼š
    
            ```json
            {
               code:"001",
               msg: "ç™»å½•æˆåŠŸ"
            }
    
            éœ€è¦å°† userå¯¹è±¡ï¼Œå­˜å‚¨åˆ°session. key = userInfo 
            ```
    
        *   ä¸šåŠ¡åˆ†æ
    
            1.  å‰ç«¯ä¼ é€’çš„æ˜¯æ™®é€šå‚æ•°ç±»å‹
    
            2.  è¿›è¡Œå‚æ•°æ ¡éªŒï¼Œè¿›è¡ŒéªŒè¯ç æ ¡éªŒ
    
            3.  åˆç†ï¼Œè¿›è¡Œæ•°æ®åº“æ ¡éªŒ
    
            4.  åˆç†ï¼Œå°†æ•°æ®å­˜å‚¨åˆ°sessionå…±äº«åŸŸå³å¯ï¼Œ key = userInfo
    
        *   åŠŸèƒ½å®ç°
    
            *   éªŒè¯ç controller
    
                ```java
                @Controller
                @RequestMapping()
                public class CaptchaController {
    
                    @RequestMapping("/captcha")
                    @ResponseBody
                    public void captcha(HttpServletRequest request, HttpServletResponse response) throws Exception {
                        //é»˜è®¤å››ä¸ªå­—ç¬¦é•¿åº¦çš„éªŒè¯ç 
                        //é»˜è®¤æ”¾å…¥session key = captcha çš„ä½ç½®
                        CaptchaUtil.out(request, response);
                    }
    
                }
                ```
    
            *   AdminUserParam
    
                ```java
                @Data
                public class AdminUserParam {
    
                    @Length(min = 6)
                    private String userAccount; //è´¦å·
                    @Length(min = 6)
                    private String userPassword; //å¯†ç 
                    @NotBlank
                    private String verCode;  //éªŒè¯ç 
    
                }
                ```
    
            *   pojo
    
                ```java
                @Data
                @TableName("admin_user")
                public class AdminUser  implements Serializable {
    
                    @TableId(type = IdType.AUTO)
                    private Integer userId;
                    private String userName;
                    private String userAccount;
                    private String userPassword;
                    private String userPhone;
                    private Date   createTime;
                    private Integer userRole;
    
                }
                ```
    
            *   controller
    
                ```java
                @Slf4j
                @Controller
                @RequestMapping("/user")
                public class AdminUserController {


                    @Autowired
                    private AdminUserService adminUserService;
    
                    /**
                     * åå°ç™»å½•åŠŸèƒ½å®ç°
                     * @param adminUserParam
                     * @return
                     */
                    @PostMapping("login")
                    @ResponseBody
                    public Object login(@Validated AdminUserParam adminUserParam, BindingResult bindingResult, HttpSession session){
    
                        //å‚æ•°æ ¡éªŒ
                        if (bindingResult.hasErrors()) {
                            log.info("AdminUserController.loginä¸šåŠ¡,å‚æ•°å¼‚å¸¸!");
                            return R.fail("ç™»å½•å¤±è´¥,æ ¸å¿ƒå‚æ•°ä¸ºnull");
                        }
                        //æ ¡éªŒéªŒè¯ç 
                        String varCode = adminUserParam.getVerCode();
                        String captcha = (String) session.getAttribute("captcha");
                        if (!varCode.equalsIgnoreCase(captcha)){
    
                            return R.fail("ç™»å½•å¤±è´¥,éªŒè¯ç é”™è¯¯!");
                        }
                        //éªŒè¯ç é€šè¿‡éªŒè¯æ•°æ®
                        R r = adminUserService.login(adminUserParam);
    
                        //è·å–æ•°æ®å­˜å‚¨åˆ°sessionå…±äº«åŸŸ,åæœŸç™»å½•è®¿é—®åˆ¤æ–­
                        AdminUser adminUser = (AdminUser) r.getData();
                        //å­˜å‚¨åˆ°sessionå…±äº«åŸŸ  key = userInfo å…¶ä»–é¡µé¢å›ºå®šè¯»å–
                        session.setAttribute("userInfo",adminUser);
                        return r;
                    }




                }
                ```
    
            *   service
    
                ```java
                @Slf4j
                @Service
                public class AdminUserServiceImpl extends ServiceImpl<AdminUserMapper,AdminUser> implements AdminUserService {
    
                    /**
                     * åå°ç®¡ç†ç™»å½•é¡µé¢
                     * @param adminUserParam
                     * @return
                     */
                    @Override
                    public R login(AdminUserParam adminUserParam) {
                        //å¯†ç åŠ å¯†å¤„ç†
                        //ä»£ç åŠ å¯†å¤„ç†,æ³¨æ„åŠ ç›,ç”Ÿæˆå¸¸é‡
                        String newPwd = MD5Util.encode(adminUserParam.getUserPassword() +
                                UserConstants.USER_SLAT);
    
                        //æ•°æ®åº“ç™»å½•æŸ¥è¯¢
                        QueryWrapper<AdminUser> adminUserQueryWrapper =
                                new QueryWrapper<>();
    
                        adminUserQueryWrapper.eq("user_account",adminUserParam.getUserAccount());
                        adminUserQueryWrapper.eq("user_password",newPwd);
    
                        AdminUser adminUser = this.getOne(adminUserQueryWrapper);
                        //ç»“æœå°è£…
    
                        if (adminUser == null) {
                            return R.fail("è´¦å·æˆ–è€…å¯†ç é”™è¯¯!");
                        }
    
                        R ok = R.ok("ç”¨æˆ·ç™»å½•æˆåŠŸ!", adminUser);
                        log.info("AdminUserServiceImpl.loginä¸šåŠ¡ç»“æŸï¼Œç»“æœ:{}",ok);
    
                        return ok;
                    }
                }
                ```
    
            *   mapper
    
                ```java
                public interface AdminUserMapper extends BaseMapper<AdminUser> {
                }
                ```
    
    *   ç®¡ç†ç”¨æˆ·é€€å‡ºç™»å½•åŠŸèƒ½
    
        *   æ¥å£ä»‹ç»
    
            è¯·æ±‚URLï¼š/admin/user/logout
    
            è¯·æ±‚æ–¹å¼ï¼šget
    
            è¯·æ±‚ç±»å‹:   formdata
    
            å‚æ•°è¯´æ˜ï¼š æ— 
    
            è¿”å›ç»“æœï¼š
    
            ```json
            {
               code:"001",
               msg: "é€€å‡ºç™»å½•æˆåŠŸ"
            }
    
            ```
    
        *   ä¸šåŠ¡åˆ†æ
    
            1.  æ¸…ç©ºsessionæ•°æ®
    
            2.  è¿”å›ç™»å½•é€€å‡ºç™»å½•æˆåŠŸ
    
            3.  å‰ç«¯ä¼šåˆ¤æ–­ï¼Œè·³è½¬åˆ°ç™»å½•é¡µé¢
    
        *   åŠŸèƒ½å®ç°
    
            *   controller
    
                ```java
                @GetMapping("logout")
                @ResponseBody
                public Object logout(HttpSession session){
                    //æ¸…ç©ºsession
                    session.invalidate();
    
                    return R.ok("é€€å‡ºç™»å½•æˆåŠŸ!");
                }
                ```
    
    *   ç™»å½•ä¿æŠ¤åŠŸèƒ½&#x20;
    
        *   ä¸šåŠ¡ä»‹ç»
    
            1.  å®ç°ç®€å•çš„æƒé™ç®¡ç†
    
            2.  å¿…é¡»ç™»å½•ï¼Œå¹¶ä¸”åœ¨æœ‰æ•ˆæœŸå†…æ–¹å¯è¿›è¡Œåå°è®¿é—®
    
            3.  åˆ©ç”¨æ‹¦æˆªå™¨ï¼Œæ‹¦æˆªè¯·æ±‚ï¼Œæ£€æŸ¥sessionç”¨æˆ·ç™»å½•å‡­è¯
    
            4.  å­˜åœ¨ï¼Œæ–¹å½¢ï¼Œåä¹‹ï¼Œæ‹¦æˆªï¼
    
            5.  æ³¨æ„ã€‚ç™»å½•ï¼Œé€€å‡ºç™»å½•ï¼Œä»¥åŠé™æ€èµ„æºéœ€è¦æ”¾è¡Œå¤„ç†
    
        *   åŠŸèƒ½å®ç°
    
            *   ç™»å½•ä¿æŠ¤æ‹¦æˆªå™¨
    
                ```java
                public class LoginProtectInterceptor implements HandlerInterceptor {
    
                    @Override
                    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {
    
                        System.err.println("LoginProtectInterceptor.preHandle");


                        if (null == request.getSession().getAttribute("userInfo")) {
                            //å¯¹åº”æ‹¦æˆªè·¯å¾„,æ²¡æœ‰ç™»å½•,è·³è½¬åˆ°ç™»å½•é¡µé¢!
                            //request.getSession().setAttribute(Constants.USER_ERROR_MSG, "è¯·é‡æ–°ç™»é™†");
                            //é‡å®šå‘åˆ°ç™»å½•é¡µé¢
                            response.sendRedirect(request.getContextPath()+"/index.html");
                            return false;
                        } else {
                            //æ”¾è¡Œ
                            return true;
                        }
                    }
                }
                ```
    
            *   mvcé…ç½®æ³¨å†Œé…ç½®ç±»
    
                ```java
                @Configuration
                public class MvcConfiguration implements WebMvcConfigurer {
    
                    /**
                     * ç”¨æˆ·æ³¨å†Œæ‹¦æˆªå™¨
                     * @param registry
                     */
                    @Override
                    public void addInterceptors(InterceptorRegistry registry) {
                        //æ‹¦æˆªåå°ç®¡ç†æ¨¡å—çš„è·¯å¾„  æ’é™¤ç™»å½•å’Œèµ„æºè·¯å¾„
                        registry.addInterceptor(new LoginProtectInterceptor()).addPathPatterns("/**")
                                .excludePathPatterns("/","/index.html","/index","/static/**",
                                        "/user/login", "/user/logout",
                                        "/api/**", "/css/**", "/images/**",
                                        "/js/**", "/lib/**","/captcha"
                                );
                    }
                }
                ```
    
    *   ç”¨æˆ·ç®¡ç†åŠŸèƒ½
    
        *   ç”¨æˆ·æ•°æ®å±•ç¤º
    
            *   æ¥å£ä»‹ç»
    
                è¯·æ±‚URLï¼š/admin/user/list
    
                è¯·æ±‚æ–¹å¼ï¼šget
    
                è¯·æ±‚ç±»å‹:   formdata
    
                å‚æ•°è¯´æ˜ï¼š&#x20;
    
                | å‚æ•°              | æ˜¯å¦å¿…é€‰ | ç±»å‹  | è¯´æ˜  |
                | --------------- | ---- | --- | --- |
                | **currentPage** | æ˜¯    | int | å½“å‰é¡µ |
                | pageSize        | æ˜¯    | int | å¶å®¹é‡ |
    
                è¿”å›ç»“æœï¼š
    
                ```json
                {
                   code:"001",
                   msg: "æŸ¥è¯¢æˆåŠŸ"ï¼Œ
                   data:[
                   
                      {pu
                         user_id:1,
                         userName:"è´¦å·",
                         password:"å¯†ç ",
                         userPhonenumber:"æ‰‹æœºå·"
                      }
                   ],
                   total:10
                }
    
                ```
    
            *   ä¸šåŠ¡ä»‹ç»
    
                1.  store-front-useræœåŠ¡ã€‚æä¾›åˆ†é¡µæŸ¥è¯¢ä¸šåŠ¡ï¼ï¼
    
                2.  åå°ç®¡ç†æ¨¡å—ï¼Œè¿›è¡Œè¿œç¨‹æœåŠ¡è°ƒç”¨
    
                3.  æœ€ç»ˆè¿›è¡Œç»“æœå°è£…
    
                4.  éœ€è¦æä¾›ç¼“å­˜åŠŸèƒ½ï¼Œè¿›è¡Œæ•°æ®ç¼“å­˜ï¼
    
                5.  å¦‚æœæ¶‰åŠæ•°æ®ç¼“å­˜ï¼Œè¢«ç¼“å­˜çš„å®ä½“ç±»éœ€è¦å®ç°åºåˆ—åŒ–æ¥å£ï¼
    
            *   åŠŸèƒ½å®ç°
    
                *   pageParam \[store-common-feign]
    
                    ```java
                    @Data
                    public class PageParam {
    
                        private int    currentPage = 1;
                        private int    pageSize = 15;
                    }
                    ```
    
                *   userClient \[store-common-feign]
    
                    ```java
                    @FeignClient(value = "user-service")
                    public interface UserClient {
    
                        /**
                         * åå°ç®¡ç†,å±•ç¤ºç”¨æˆ·ä¿¡æ¯æ¥å£
                         * @param pageParam
                         * @return
                         */
                        @PostMapping("/user/list")
                        R listPage(@RequestBody PageParam pageParam);
    
                    }
                    ```
    
                *   controller \[store-front-user]
    
                    ```java
                     /**
                     * åå°ç®¡ç†è°ƒç”¨
                     * @param pageParam
                     * @return
                     */
                    @PostMapping("/list")
                    public Object listPage(@RequestBody PageParam pageParam){
    
                        return userService.listPage(pageParam);
                    }
                    ```
    
                *   service \[store-front-user]
    
                    ```java
                    /**
                     * åˆ†é¡µæ•°æ®æŸ¥è¯¢
                     *
                     * @param pageParam
                     * @return
                     */
                    @Override
                    public Object listPage(PageParam pageParam) {
    
                        int currentPage = pageParam.getCurrentPage();
                        int pageSize = pageParam.getPageSize();
    
                        //è®¾ç½®åˆ†é¡µå±æ€§
                        IPage<User> page = new Page<>(currentPage,pageSize);
                        page = userMapper.selectPage(page, null);
    
                        //ç»“æœå°è£…
                        long total = page.getTotal();
                        List<User> records = page.getRecords();
    
                        R ok = R.ok("æŸ¥è¯¢æˆåŠŸ!", records, total);
    
                        log.info("UserServiceImpl.listPageä¸šåŠ¡ç»“æŸï¼Œç»“æœ:{}",ok);
    
                        return ok;
                    }
                    ```
    
                *   controller \[store-admin]
    
                    ```java
                    @Controller
                    @RequestMapping("/user")
                    public class UserController {


                        @Autowired
                        private UserService userService;
    
                        @GetMapping("list")
                        @ResponseBody
                        public Object list(PageParam pageParam){
    
                            return userService.listPage(pageParam);
                        }
    
                    }
                    ```
    
                *   service \[store-admin]
    
                    ```java
                    @Service
                    @Slf4j
                    public class UserServiceImpl implements UserService {


                        @Autowired
                        private UserClient userClient;
    
                        /**
                         * åˆ†é¡µæ•°æ®æŸ¥è¯¢,ç”¨æˆ·æ¨¡å—
                         *
                         * @param pageParam
                         * @return
                         */
                        //æ·»åŠ ç¼“å­˜åŠŸèƒ½! ä¿®æ”¹ å’Œ åˆ é™¤ ä»¥åŠæ·»åŠ ç”¨æˆ· è¦æ¸…ç©º list.userå¯¹åº”ç¼“å­˜
                        @Cacheable(value = "list.user",key = "#pageParam.currentPage+'-'+#pageParam.pageSize")
                        @Override
                        public Object listPage(PageParam pageParam) {
    
                            R r = userClient.listPage(pageParam);
    
                            log.info("UserServiceImpl.listPageä¸šåŠ¡ç»“æŸï¼Œç»“æœ:{}",r);
    
                            return r;
                        }
                    }
                    ```
    
                *   å¯åŠ¨ç±»ä¿®æ”¹
    
                    ```java
                    @MapperScan("com.atguigu.admin.mapper")
                    @SpringBootApplication
                    @EnableFeignClients(clients = {UserClient.class})  //æ·»åŠ å®¢æˆ·ç«¯å¼•ç”¨
                    @EnableCaching //å¼€å¯ç¼“å­˜æ”¯æŒ
                    public class AdminApplication  {
    
                        public static void main(String[] args) {
                            SpringApplication.run(AdminApplication.class,args);
                        }
                    }
                    ```
    
        *   ç”¨æˆ·æ•°æ®åˆ é™¤
    
            *   æ¥å£ä»‹ç»
    
                è¯·æ±‚URLï¼š/admin/user/remove
    
                è¯·æ±‚æ–¹å¼ï¼špost
    
                è¯·æ±‚ç±»å‹:   formdata
    
                å‚æ•°è¯´æ˜ï¼š&#x20;
    
                | å‚æ•°         | æ˜¯å¦å¿…é€‰ | ç±»å‹  | è¯´æ˜      |
                | ---------- | ---- | --- | ------- |
                | **u**serId | æ˜¯    | int | åˆ é™¤çš„ç”¨æˆ·ID |
    
                è¿”å›ç»“æœï¼š
    
                ```json
                {
                   code:"001" / "004",
                   msg: "åˆ é™¤æˆåŠŸ"
                }
    
                ```
    
            *   ä¸šåŠ¡ä»‹ç»
    
                1.  æ ¹æ®ç”¨æˆ·IDï¼Œåˆ é™¤ç”¨æˆ·æ•°æ®
    
                2.  éœ€è¦è°ƒç”¨å‰ç«¯ç”¨æˆ·æœåŠ¡
    
                3.  æ¸…ç©ºç”¨æˆ·ç¼“å­˜é›†åˆï¼Œéœ€è¦æ¸…ç©ºå¯¹åº”ç”¨æˆ·IDçš„ç¼“å­˜
    
                4.  æœ€åéœ€è¦åˆ·æ–°table
    
            *   åŠŸèƒ½å®ç°
    
                *   controller \[store-front-user]
    
                    ```java
                    /**
                     * åå°ç®¡ç†è°ƒç”¨,åˆ é™¤ç”¨æˆ·æ•°æ®
                     * @param userId
                     * @return
                     */
                    @PostMapping("/remove")
                    public Object remove(@RequestBody Integer userId){
    
                        return userService.remove(userId);
                    }
                    ```
    
                *   service \[store-front-user]
    
                    ```java
                     /**
                     * åˆ é™¤ç”¨æˆ·æ•°æ®
                     *
                     * @param userId
                     * @return
                     */
                    @Override
                    public Object remove(Integer userId) {
    
                        int rows = userMapper.deleteById(userId);
    
                        log.info("UserServiceImpl.removeä¸šåŠ¡ç»“æŸï¼Œç»“æœ:{}",rows);
    
                        if (rows > 0){
                            return R.ok("åˆ é™¤ç”¨æˆ·æ•°æ®æˆåŠŸ!");
                        }
                        return R.fail("åˆ é™¤ç”¨æˆ·æ•°æ®å¤±è´¥!");
                    }
                    ```
    
                *   userClient \[store-common-feign]
    
                    ```java
                    @FeignClient(value = "user-service")
                    public interface UserClient {
    
                        /**
                         * åå°ç®¡ç†,å±•ç¤ºç”¨æˆ·ä¿¡æ¯æ¥å£
                         * @param pageParam
                         * @return
                         */
                        @PostMapping("/user/list")
                        R listPage(@RequestBody PageParam pageParam);
    
                        @PostMapping("/user/remove")
                        R remove(@RequestBody Integer userId);
                    ```
    
                *   controller \[store-admin]
    
                    ```java
                    @PostMapping("remove")
                    @ResponseBody
                    public Object remove(Integer userId){
    
                        if (userId == null){
                            return R.fail("åˆ é™¤å¤±è´¥!");
                        }
                        return userService.remove(userId);
                    }
                    ```
    
                *   service \[store-admin]
    
                    ```java
                    /**
                     * åˆ é™¤ç”¨æˆ·æ•°æ®
                     *
                     * @param userId
                     * @return
                     */
                    @Caching(
                         //åˆ é™¤,æ¸…ç©ºç¼“å­˜é›†åˆ
                         //åˆ é™¤,æ¸…ç©ºå¯¹åº”å•æ¡idçš„æ•°æ®
                         evict = {
                                 @CacheEvict(value = "list.user",allEntries = true),
                                 @CacheEvict(value = "user",key = "#userId" )
                         }
                    )
                    @Override
                    public Object remove(Integer userId) {
    
                        R r = userClient.remove(userId);
    
                        log.info("UserServiceImpl.removeä¸šåŠ¡ç»“æŸï¼Œç»“æœ:{}",r);
                        return r;
                    }
                    ```
    
        *   ç”¨æˆ·æ•°æ®ä¿®æ”¹
    
            *   æ¥å£ä»‹ç»
    
                è¯·æ±‚URLï¼š/admin/user/update
    
                è¯·æ±‚æ–¹å¼ï¼špost
    
                è¯·æ±‚ç±»å‹:   formdata
    
                å‚æ•°è¯´æ˜ï¼š&#x20;
    
                | å‚æ•°              | æ˜¯å¦å¿…é€‰ | ç±»å‹     | è¯´æ˜      |
                | --------------- | ---- | ------ | ------- |
                | **u**serId      | æ˜¯    | int    | åˆ é™¤çš„ç”¨æˆ·ID |
                | userName        | æ˜¯    | string | è´¦å·      |
                | password        | æ˜¯    | string | å¯†ç       |
                | userPhonenumber | å¦    | string | æ‰‹æœºå·     |
    
                è¿”å›ç»“æœï¼š
    
                ```json
                {
                   code:"001" / "004",
                   msg: "ä¿®æ”¹æˆåŠŸ"
                }
    
                ```
    
            *   ä¸šåŠ¡ä»‹ç»
    
                1.  ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯ï¼Œæ³¨æ„ï¼ŒIDå’Œè´¦å·ä¸å¯ä¿®æ”¹
    
                2.  éœ€è¦æ·»åŠ è·³è½¬ä¿®æ”¹é¡µé¢handleræ–¹æ³•
    
                3.  éœ€è¦è°ƒç”¨å‰ç«¯ç”¨æˆ·æ¨¡å—ä¿®æ”¹
    
                4.  éœ€è¦åˆ¤æ–­ç”¨æˆ·å¯†ç æ˜¯å¦ä¿®æ”¹ï¼Œéœ€è¦å…ˆæ ¡éªŒ
    
                5.  ä¿®æ”¹æˆåŠŸä¹Ÿåº”è¯¥æ¸…ç©ºç¼“å­˜
    
            *   åŠŸèƒ½å®ç°
    
                *   controller \[store-front-user]
    
                    ```java
                    /**
                     * åå°ç®¡ç†è°ƒç”¨,ä¿®æ”¹ç”¨æˆ·æ•°æ®
                     * @param user
                     * @return
                     */
                    @PostMapping("/update")
                    public  Object update(@RequestBody User user){
    
                        return userService.update(user);
                    }
                    ```
    
                *   userConstants \[store-common-feign]
    
                    ```java
                    public class UserConstants {
    
                        /**
                         * å¯†ç åŠ å¯†çš„ç›,æ·»åŠ åˆ°å¯†ç åé¢!
                         */
                        public static final String USER_SLAT = "b2c_cloud_store";
                    }
                    ```
    
                *   service \[store-front-user]
    
                    ```java
                    /**
                     * ä¿®æ”¹ç”¨æˆ·å¯†ç 
                     *
                     * @param user
                     * @return
                     */
                    @Override
                    public Object update(User user) {
    
                        //æ£€æŸ¥å¯†ç ,å¦‚æœå’Œæ•°æ®åº“ä¸€è‡´ ä¸éœ€è¦åŠ å¯†! è¯æ˜å¯†ç æ²¡æœ‰ä¿®æ”¹!
                        QueryWrapper<User> queryWrapper = new QueryWrapper<>();
                        queryWrapper.eq("user_id",user.getUserId());
                        queryWrapper.eq("password",user.getPassword());
                        Long total = userMapper.selectCount(queryWrapper);
    
                        if (total == 0){
                           //å¯†ç ä¸åŒ,å·²ç»ä¿®æ”¹! æ–°å¯†ç éœ€è¦åŠ å¯†
                           user.setPassword(MD5Util.encode(user.getPassword()+ com.atguigu.constants.UserConstants.USER_SLAT));
                        }
    
                        int rows = userMapper.updateById(user);
    
                        if (rows == 0){
                            return R.fail("ç”¨æˆ·ä¿®æ”¹å¤±è´¥!");
                        }
                        return R.fail("ç”¨æˆ·ä¿®æ”¹æˆåŠŸ");
                    }
                    ```
    
                *   userClient \[store-common-feign]
    
                    ```java
                    @FeignClient(value = "user-service")
                    public interface UserClient {
    
                        /**
                         * åå°ç®¡ç†,å±•ç¤ºç”¨æˆ·ä¿¡æ¯æ¥å£
                         * @param pageParam
                         * @return
                         */
                        @PostMapping("/user/list")
                        R listPage(@RequestBody PageParam pageParam);
    
                        @PostMapping("/user/remove")
                        R remove(@RequestBody Integer userId);
    
                        @PostMapping("/user/update")
                        R update(@RequestBody User user);
                    ```
    
                *   jumpController \[store-admin]
    
                    ```java
                    /**
                     * æ‰“å¼€ç¼–è¾‘ç”¨æˆ·é¡µé¢
                     */
                    @GetMapping("/user/update/html")
                    public String userUpdateHtml(){
                        log.info("HtmlJumpController.userUpdateHtmlä¸šåŠ¡ç»“æŸï¼Œç»“æœ:{}");
                        return "user/edit";
                    }
    
                    ```
    
                *   controller \[store-admin]
    
                    ```java
                    @PostMapping("update")
                    @ResponseBody
                    public Object update(User user){
    
                        return userService.update(user);
                    }
                    ```
    
                *   service \[store-admin]
    
                    ```java
                    /**
                     * ä¿®æ”¹ç”¨æˆ·æ•°æ®
                     *
                     * @param user
                     * @return
                     */
                    @Caching(
                            //åˆ é™¤,æ¸…ç©ºç¼“å­˜é›†åˆ
                            //åˆ é™¤,æ¸…ç©ºå¯¹åº”å•æ¡idçš„æ•°æ®
                            evict = {
                                    @CacheEvict(value = "list.user",allEntries = true),
                                    @CacheEvict(value = "user",key = "#user.userId" )
                            }
                    )
                    @Override
                    public Object update(User user) {
    
                        R r = userClient.update(user);
                        log.info("UserServiceImpl.updateä¸šåŠ¡ç»“æŸï¼Œç»“æœ:{}",r);
                        return r;
                    }
                    ```
    
        *   ç”¨æˆ·æ•°æ®æ·»åŠ 
    
            *   æ¥å£ä»‹ç»
    
                è¯·æ±‚URLï¼š/admin/user/save
    
                è¯·æ±‚æ–¹å¼ï¼špost
    
                è¯·æ±‚ç±»å‹:   formdata
    
                å‚æ•°è¯´æ˜ï¼š&#x20;
    
                | å‚æ•°              | æ˜¯å¦å¿…é€‰ | ç±»å‹     | è¯´æ˜  |
                | --------------- | ---- | ------ | --- |
                | userName        | æ˜¯    | string | è´¦å·  |
                | password        | æ˜¯    | string | å¯†ç   |
                | userPhonenumber | å¦    | string | æ‰‹æœºå· |
    
                è¿”å›ç»“æœï¼š
    
                ```json
                {
                   code:"001" / "004",
                   msg: "ä¿å­˜æˆåŠŸ"
                }
    
                ```
    
            *   ä¸šåŠ¡ä»‹ç»
    
                1.  ä¿å­˜ç”¨æˆ·ä¿¡æ¯
    
                2.  éœ€è¦æ·»åŠ è·³è½¬ä¿å­˜é¡µé¢handleræ–¹æ³•
    
                3.  éœ€è¦è°ƒç”¨å‰ç«¯ç”¨æˆ·æ¨¡å—åŸæœ‰çš„æ³¨å†Œä¸šåŠ¡
    
                4.  éœ€è¦è¿›è¡Œå¯†ç åŠ å¯†å¤„ç†
    
                5.  ä¿å­˜æˆåŠŸä¹Ÿåº”è¯¥æ¸…ç©ºé›†åˆç¼“å­˜
    
            *   åŠŸèƒ½å®ç°
    
                *   userClient \[store-common-feign]
    
                    ```java
                    @FeignClient(value = "user-service")
                    public interface UserClient {
    
                        /**
                         * åå°ç®¡ç†,å±•ç¤ºç”¨æˆ·ä¿¡æ¯æ¥å£
                         * @param pageParam
                         * @return
                         */
                        @PostMapping("/user/list")
                        R listPage(@RequestBody PageParam pageParam);
    
                        @PostMapping("/user/remove")
                        R remove(@RequestBody Integer userId);
    
                        @PostMapping("/user/update")
                        R update(@RequestBody User user);
    
                        @PostMapping("/user/register")
                        R save(@RequestBody User user);
                    }
                    ```
    
                *   jumpController \[store-admin]
    
                    ```java
                    /**
                     * æ‰“å¼€ç¼–è¾‘ç”¨æˆ·é¡µé¢
                     */
                    @GetMapping("/user/save/html")
                    public String userSaveHtml(){
                        log.info("HtmlJumpController.userSaveHtmlä¸šåŠ¡ç»“æŸï¼Œç»“æœ:{}");
                        return "user/add";
                    }
                    ```
    
                *   controller \[store-admin]
    
                    ```java
                    @PostMapping("save")
                    @ResponseBody
                    public Object save(User user){
    
                        return userService.save(user);
                    }
                    ```
    
                *   service \[store-admin]
    
                    ```java
                    /**
                     * ä¿å­˜ç”¨æˆ·æ•°æ®,ç”¨æˆ·æ³¨å†ŒåŠŸèƒ½
                     * æ¸…ç©ºä¿å­˜
                     * @param user
                     * @return
                     */
                    @Caching(
                            //åˆ é™¤,æ¸…ç©ºç¼“å­˜é›†åˆ
                            //åˆ é™¤,æ¸…ç©ºå¯¹åº”å•æ¡idçš„æ•°æ®
                            evict = {
                                    @CacheEvict(value = "list.user",allEntries = true)
                            }
                    )
                    @Override
                    public Object save(User user) {
    
                        R ok = userClient.save(user);
                        log.info("UserServiceImpl.saveä¸šåŠ¡ç»“æŸï¼Œç»“æœ:{}",ok);
                        return ok;
                    }
                    ```
    
    *   ç±»åˆ«ç®¡ç†åŠŸèƒ½
    
        *   ç±»åˆ«æ•°æ®å±•ç¤º
    
            *   æ¥å£ä»‹ç»
    
                è¯·æ±‚URLï¼š/admin/category/list
    
                è¯·æ±‚æ–¹å¼ï¼šget
    
                è¯·æ±‚ç±»å‹:   formdata
    
                å‚æ•°è¯´æ˜ï¼š&#x20;
    
                | å‚æ•°              | æ˜¯å¦å¿…é€‰ | ç±»å‹  | è¯´æ˜  |
                | --------------- | ---- | --- | --- |
                | **currentPage** | æ˜¯    | int | å½“å‰é¡µ |
                | pageSize        | æ˜¯    | int | å¶å®¹é‡ |
    
                è¿”å›ç»“æœï¼š
    
                ```json
                {
                   code:"001",
                   msg: "æŸ¥è¯¢æˆåŠŸ"ï¼Œ
                   data:[
                   
                      {
                         category_id:1,
                         category_name:"è´¦å·"
                      }
                   ],
                   total:10
                }
                ```
    
            *   ä¸šåŠ¡ä»‹ç»
    
                1.  åˆ†é¡µç±»åˆ«æ•°æ®æŸ¥è¯¢
    
                2.  åå°ç®¡ç†éœ€è¦è°ƒç”¨å‰ç«¯ç±»åˆ«æœåŠ¡
    
                3.  æ³¨æ„ï¼Œç¼“å­˜ï¼Œæé«˜æŸ¥è¯¢æ€§èƒ½
    
            *   åŠŸèƒ½å®ç°
    
                *   categoryClient \[store-common-feign]
    
                    ```java
                    @PostMapping("/category/admin/list")
                    R pageList(@RequestBody PageParam pageParam);
                    ```
    
                *   controller \[store-front-category]
    
                    ```java
                    ```
    
                *   service \[store-front-category]
    
                    ```java
                    /**
                     * åˆ†é¡µæŸ¥è¯¢
                     *
                     * @param pageParam
                     * @return
                     */
                    @Override
                    public R page(PageParam pageParam) {
    
                        //åˆ†é¡µå‚æ•°
                        IPage<Category> page = new Page<>(pageParam.getCurrentPage()
                                                ,pageParam.getPageSize());
                        //æŸ¥è¯¢å‚æ•°è·å–
                        page = categoryMapper.selectPage(page, null);
    
                        List<Category> records = page.getRecords();
                        long total = page.getTotal();
    
                        R r = R.ok("æŸ¥è¯¢ç±»åˆ«æ•°æ®æˆåŠŸ!", records, total);
    
                        log.info("CategoryServiceImpl.pageä¸šåŠ¡ç»“æŸï¼Œç»“æœ:{}",r);
    
                        return r;
                    }
                    ```
    
                *   controller \[store-admin]
    
                    ```java
                    @GetMapping("/list")
                    public Object list(PageParam pageParam){
    
                        return  categoryService.listPage(pageParam);
                    }
                    ```
    
                *   service \[store-admin]
    
                    ```java
                     /**
                     * åˆ†é¡µæ•°æ®æŸ¥è¯¢
                     * @param pageParam
                     * @return
                     */
                    @Cacheable(value="list.category",key = "#pageParam.currentPage+'-'+#pageParam.pageSize")
                    @Override
                    public Object listPage(PageParam pageParam) {
    
                        R r = categoryClient.pageList(pageParam);
    
                        log.info("CategoryServiceImpl.listPageä¸šåŠ¡ç»“æŸï¼Œç»“æœ:{}",r);
                        return r;
                    }
                    ```
    
                *   å¯åŠ¨ç±» \[store-admin]
    
                    ```java
                    @MapperScan("com.atguigu.mapper")
                    @SpringBootApplication
                    @EnableFeignClients(clients = {UserClient.class, CategoryClient.class})  //æ·»åŠ å®¢æˆ·ç«¯å¼•ç”¨
                    @EnableCaching //å¼€å¯ç¼“å­˜æ”¯æŒ
                    public class AdminApplication  {
    
                        public static void main(String[] args) {
                            SpringApplication.run(AdminApplication.class,args);
                        }
                    }
                    ```
    
        *   ç±»åˆ«æ•°æ®æ·»åŠ 
    
            *   æ¥å£ä»‹ç»
    
                è¯·æ±‚URLï¼š/admin/category/save
    
                è¯·æ±‚æ–¹å¼ï¼špost
    
                è¯·æ±‚ç±»å‹:   formdata
    
                å‚æ•°è¯´æ˜ï¼š&#x20;
    
                | å‚æ•°           | æ˜¯å¦å¿…é€‰ | ç±»å‹     | è¯´æ˜   |
                | ------------ | ---- | ------ | ---- |
                | categoryName | æ˜¯    | string | ç±»åˆ«åç§° |
    
                è¿”å›ç»“æœï¼š
    
                ```json
                {
                   code:"001" / "004",
                   msg: "ä¿å­˜æˆåŠŸ"
                }
    
                ```
    
            *   ä¸šåŠ¡ä»‹ç»
    
                1.  ä¿å­˜ç±»åˆ«ä¿¡æ¯
    
                2.  éœ€è¦æ·»åŠ è·³è½¬ä¿å­˜é¡µé¢handleræ–¹æ³•
    
                3.  éœ€è¦è°ƒç”¨å‰ç«¯ç±»åˆ«æ¨¡å—ä¿å­˜ä¸šåŠ¡
    
                4.  ä¿å­˜æˆåŠŸä¹Ÿåº”è¯¥æ¸…ç©ºé›†åˆç¼“å­˜
    
            *   åŠŸèƒ½å®ç°
    
                *   categoryClient \[store-common-feign]
    
                    ```java
                    @PostMapping("/category/admin/save")
                    R save(@RequestBody Category category);
                    ```
    
                *   jumpController \[store-admin]
    
                    ```java
                    @GetMapping("/category/save/html")
                    public String categorySaveHtml(){
                        log.info("HtmlJumpController.categorySaveHtmlç»“æŸï¼Œç»“æœ:{}");
                        return "category/add";
                    }
                    ```
    
                *   controller \[store-front-category]
    
                    ```java
                    @PostMapping("admin/save")
                    public R remove(@RequestBody Category category){
    
                        return categoryService.save(category);
                    }
                    ```
    
                *   service  \[store-front-category]
    
                    ```java
                    /**
                     * ä¿å­˜ç±»åˆ«æ•°æ®
                     *
                     * @param category
                     * @return
                     */
                    @Override
                    public R save(Category category) {
    
                        int rows = categoryMapper.insert(category);
    
                        if (rows > 0){
                            return R.ok("ç±»åˆ«ä¿å­˜æˆåŠŸ!");
                        }
    
                        return R.fail("ç±»åˆ«ä¿å­˜å¤±è´¥!");
                    }
                    ```
    
                *   controller \[store-admin]
    
                    ```java
                    @PostMapping("/save")
                    public Object save(Category category){
    
                      return categoryService.save(category);
                    }
                    ```
    
                *   service \[store-admin]
    
                    ```java
                    /**
                     * ç±»åˆ«æ•°æ®ä¿å­˜
                     *
                     * @param category
                     * @return
                     */
                    @CacheEvict(value = "list.category",allEntries = true)
                    @Override
                    public Object save(Category category) {
    
                        //ç±»åˆ«æ•°æ®ä¿å­˜
                        R r = categoryClient.save(category);
    
                        log.info("CategoryServiceImpl.saveä¸šåŠ¡ç»“æŸï¼Œç»“æœ:{}",r);
    
                        return r;
                    }
                    ```
    
        *   ç±»åˆ«æ•°æ®åˆ é™¤
    
            *   æ¥å£ä»‹ç»
    
                è¯·æ±‚URLï¼š/admin/user/remove
    
                è¯·æ±‚æ–¹å¼ï¼špost
    
                è¯·æ±‚ç±»å‹:   formdata
    
                å‚æ•°è¯´æ˜ï¼š&#x20;
    
                | å‚æ•°         | æ˜¯å¦å¿…é€‰ | ç±»å‹  | è¯´æ˜      |
                | ---------- | ---- | --- | ------- |
                | categoryId | æ˜¯    | int | åˆ é™¤çš„ç”¨æˆ·ID |
    
                è¿”å›ç»“æœï¼š
    
                ```json
                {
                   code:"001" / "004",
                   msg: "åˆ é™¤æˆåŠŸ"
                }
    
                ```
    
            *   ä¸šåŠ¡ä»‹ç»
    
                1.  æ ¹æ®ç±»åˆ«IDï¼Œåˆ é™¤ç±»åˆ«æ•°æ®
    
                2.  éœ€è¦è°ƒç”¨å‰ç«¯ç±»åˆ«ã€å•†å“æœåŠ¡
    
                3.  éœ€è¦æ£€æŸ¥æ˜¯å¦æœ‰å•†å“å¼•ç”¨ï¼Œæœ‰åˆ™ä¸èƒ½åˆ é™¤
    
                4.  æ¸…ç©ºç±»åˆ«ç¼“å­˜é›†åˆï¼ŒåŒæ—¶è¦æ¸…ç©ºIDå¯¹åº”ç±»åˆ«ç¼“å­˜
    
                5.  æœ€åéœ€è¦åˆ·æ–°table
    
            *   åŠŸèƒ½å®ç°
    
                *   categoryClient \[store-common-feign]
    
                    ```java
                    @PostMapping("/category/admin/remove")
                    R remove(@RequestBody Integer categoryId);
                    ```
    
                *   productClient \[store-common-feign]
    
                    ```java
                    @PostMapping("/product/category/count")
                    Long count(@RequestBody  Integer categoryId);
                    ```
    
                *   controller \[store-front-product]
    
                    ```java
                    /**
                     * ç±»åˆ«æœåŠ¡è°ƒç”¨ç®¡ç†è°ƒç”¨
                     */
                    @PostMapping("/category/count")
                    public Long categoryCount(@RequestBody Integer categoryId){
    
                        return productService.categoryCount(categoryId);
                    }
                    ```
    
                *   service \[store-front-product]
    
                    ```java
                    /**
                     * ç±»åˆ«å¯¹åº”å•†å“æ•°é‡
                     *
                     * @param categoryId
                     * @return
                     */
                    @Override
                    public Long categoryCount(Integer categoryId) {
                        
                        QueryWrapper<Product> queryWrapper  =
                                new QueryWrapper<>();
                        
                        queryWrapper.eq("category_id",categoryId);
    
                        Long count = productMapper.selectCount(queryWrapper);
                        
                        log.info("ProductServiceImpl.categoryCountä¸šåŠ¡ç»“æŸï¼Œç»“æœ:{}",count);
                        return count;
                    }
                    ```
    
                *   controller \[store-front-category]
    
                    ```java
                    @PostMapping("admin/remove")
                    public R remove(@RequestBody Integer categoryId){
    
                        return categoryService.remove(categoryId);
                    }
                    ```
    
                *   service \[store-front-user]
    
                    ```java
                     /**
                     * åˆ é™¤å¯¹åº”çš„ç±»åˆ«! éœ€è¦åˆ¤æ–­æ˜¯å¦è¢«å¼•ç”¨
                     *
                     * @param categoryId
                     * @return
                     */
                    @Override
                    public R remove(Integer categoryId) {
    
                        //è°ƒç”¨å•†å“æœåŠ¡,æŸ¥è¯¢ç±»åˆ«å¯¹åº”çš„å•†å“æ•°é‡
                        long count = productClient.count(categoryId);
                        //åˆ¤æ–­æ•°é‡,å¦‚æœæœ‰å¼•ç”¨,ä¸èƒ½åˆ é™¤,åä¹‹å¯ä»¥åˆ é™¤
                        if (count > 0){
    
                            return R.fail("æ— æ³•åˆ é™¤ç±»åˆ«,æœ‰:"+count+"ä»¶å•†å“å¼•ç”¨!");
                        }
    
                        int rows = categoryMapper.deleteById(categoryId);
    
                        if (rows == 0){
    
                            return R.fail("åˆ é™¤ç±»åˆ«å¤±è´¥!");
                        }
                        return R.ok("ç±»åˆ«åˆ é™¤æˆåŠŸ!");
                    }
                    ```
    
                *   controller \[store-admin]
    
                    ```java
                    @PostMapping("/remove")
                    public Object remove(Integer categoryId){
    
                        return categoryService.remove(categoryId);
                    }
                    ```
    
                *   service \[store-admin]
    
                    ```java
                    /**
                     * ç§»é™¤ç±»åˆ«æ•°æ®
                     * @param categoryId
                     * @return
                     */
                    @Caching(
                            evict = {
                                    @CacheEvict(value="list.category",allEntries = true),
                                    @CacheEvict(value = "category",key = "#categoryId")
                            }
                    )
                    @Override
                    public Object remove(Integer categoryId) {
    
                        R r = categoryClient.remove(categoryId);
                        log.info("CategoryServiceImpl.removeä¸šåŠ¡ç»“æŸï¼Œç»“æœ:{}",r);
                        return r;
                    }
                    ```
    
        *   ç±»åˆ«æ•°æ®ä¿®æ”¹
    
            *   æ¥å£ä»‹ç»
    
                è¯·æ±‚URLï¼š/admin/category/update
    
                è¯·æ±‚æ–¹å¼ï¼špost
    
                è¯·æ±‚ç±»å‹:   formdata
    
                å‚æ•°è¯´æ˜ï¼š&#x20;
    
                | å‚æ•°           | æ˜¯å¦å¿…é€‰ | ç±»å‹     | è¯´æ˜  |
                | ------------ | ---- | ------ | --- |
                | categoryId   | æ˜¯    | int    | ID  |
                | categoryName | æ˜¯    | string | ç±»åˆ«å |
    
                è¿”å›ç»“æœï¼š
    
                ```json
                {
                   code:"001" / "004",
                   msg: "ä¿®æ”¹æˆåŠŸ"
                }
    
                ```
    
            *   ä¸šåŠ¡ä»‹ç»
    
                1.  ä¿®æ”¹ç±»åˆ«ä¿¡æ¯ï¼Œæ³¨æ„ï¼ŒIDä¸å¯ä¿®æ”¹
    
                2.  éœ€è¦æ·»åŠ è·³è½¬ä¿®æ”¹é¡µé¢handleræ–¹æ³•
    
                3.  éœ€è¦è°ƒç”¨å‰ç«¯ç±»åˆ«æ¨¡å—ä¿®æ”¹
    
                4.  ä¿®æ”¹æˆåŠŸä¹Ÿåº”è¯¥æ¸…ç©ºç¼“å­˜
    
            *   åŠŸèƒ½å®ç°
    
                *   categoryClient \[store-common-feign]
    
                    ```java
                    @PostMapping("/category/admin/update")
                    R update(@RequestBody  Category category);
                    ```
    
                *   jumpController \[store-admin]
    
                    ```java
                    /**
                     * æ‰“å¼€ç¼–è¾‘ç±»åˆ«é¡µé¢
                     */
                    @GetMapping("/category/update/html")
                    public String categoryUpdateHtml(){
                        log.info("HtmlJumpController.categoryUpdateHtmlä¸šåŠ¡ç»“æŸï¼Œç»“æœ:{}");
                        return "category/edit";
                    }
    
                    ```
    
                *   controller \[store-front-category]
    
                    ```java
                    @PostMapping("admin/update")
                    public R update(@RequestBody Category category){
    
                        return categoryService.update(category);
                    }
                    ```
    
                *   service \[store-front-category]
    
                    ```java
                    /**
                     * ä¿®æ”¹ç±»åˆ«å
                     *
                     * @param category
                     * @return
                     */
                    @Override
                    public R update(Category category) {
    
                        int rows = categoryMapper.updateById(category);
    
                        if (rows > 0){
                            return R.ok("ç±»åˆ«ä¿®æ”¹æˆåŠŸ!");
                        }
    
                        return R.fail("ç±»åˆ«ä¿®æ”¹å¤±è´¥!");
                    }
                    ```
    
                *   controller \[store-admin]
    
                    ```java
                    @PostMapping("/update")
                    public Object update(Category category){
    
                        return categoryService.update(category);
                    }
                    ```
    
                *   service \[store-admin]
    
                    ```java
                    /**
                     * ç±»åˆ«æ•°æ®ä¿®æ”¹
                     *
                     * @param category
                     * @return
                     */
                    @Caching(
                            evict = {
                                    @CacheEvict(value="list.category",allEntries = true),
                                    @CacheEvict(value = "category",allEntries = true)
                            }
                    )
                    @Override
                    public Object update(Category category) {
    
                        R r = categoryClient.update(category);
                        log.info("CategoryServiceImpl.updateä¸šåŠ¡ç»“æŸï¼Œç»“æœ:{}",r);
    
                        return r;
                    }
                    ```
    
    *   å•†å“ç®¡ç†åŠŸèƒ½
    
        *   å•†å“æ•°æ®å±•ç¤º/æœç´¢
    
            *   æ¥å£ä»‹ç»
    
                è¯·æ±‚URLï¼š/admin/product/list
    
                è¯·æ±‚æ–¹å¼ï¼šget
    
                è¯·æ±‚ç±»å‹:   formdata
    
                å‚æ•°è¯´æ˜ï¼š&#x20;
    
                | å‚æ•°              | æ˜¯å¦å¿…é€‰ | ç±»å‹     | è¯´æ˜    |
                | --------------- | ---- | ------ | ----- |
                | **currentPage** | æ˜¯    | int    | å½“å‰é¡µ   |
                | pageSize        | æ˜¯    | int    | é¡µå®¹é‡   |
                | search          | å¦    | string | æœç´¢å…³é”®å­— |
    
                è¿”å›ç»“æœï¼š
    
                ```json
                {"code":"001",
                "data":[{"product_id":9,
                "product_name":"å°ç±³ç”µè§†4A 32è‹±å¯¸","category_id":"2","product_title":"äººå·¥æ™ºèƒ½ç³»ç»Ÿï¼Œé«˜æ¸…æ¶²æ™¶å±","product_intro":"å°ç±³ç”µè§†4A 32è‹±å¯¸ | 64ä½å››æ ¸å¤„ç†å™¨ | 1GB+4GBå¤§å†…å­˜ | äººå·¥æ™ºèƒ½ç³»ç»Ÿ","product_picture":"public/imgs/appliance/MiTv-4A-32.png","product_price":799.0,"product_selling_price":799.0,"product_num":8,"product_sales":2},{"product_id":33,"product_name":"å°ç±³9 SE è¡—å¤´é£ä¿æŠ¤å£³é»‘è‰²","category_id":"5","product_title":"ä¸ªæ€§æ—¶å°š,ç»†èŠ‚å‡ºä¼—","product_intro":"ä¸ªæ€§æ—¶å°š / ç»†èŠ‚å‡ºä¼— / çº¤è–„è½»å·§ / å¤šå½©æ—¶å°š","product_picture":"public/imgs/accessory/protectingShell-Mi-9SE.png","product_price":49.0,"product_selling_price":49.0,"product_num":20,"product_sales":0},{"product_id":34,"product_name":"å°ç±³9 è¡—å¤´é£ä¿æŠ¤å£³ çº¢è‰²","category_id":"5","product_title":"ä¸ªæ€§æ—¶å°š,ç»†èŠ‚å‡ºä¼—","product_intro":"æ—¶å°šå¤šå½© / ç»†èŠ‚å‡ºä¼— / çº¤è–„è½»å·§ / æ˜¯è…•å¸¦ä¹Ÿæ˜¯æ”¯æ¶","product_picture":"public/imgs/accessory/protectingShell-Mi-9-red.png","product_price":49.0,"product_selling_price":49.0,"product_num":20,"product_sales":0},{"product_id":21,"product_name":"å°ç±³CC9&å°ç±³CC9ç¾å›¾å®šåˆ¶ç‰ˆ æ ‡å‡†é«˜é€è´´è†œ","category_id":"6","product_title":"é«˜æ¸…é€äº®ï¼Œè€ç£¨æ€§å¼º","product_intro":"è€ç£¨æ€§å¼ºï¼Œé˜²æŠ¤æ›´å‡ºä¼— / ç–æ²¹ç–æ°´ï¼Œæœ‰æ•ˆæŠ—æ°´æŠ—è„æ±¡ / é«˜æ¸…é€äº®ï¼Œä¿ç•™äº†åŸç”Ÿå±å¹•çš„äº®ä¸½é¢œè‰²å’Œæ¸…æ™°åº¦ / æ“ä½œçµæ•ï¼Œæ™ºèƒ½å¸é™„ / è¿›å£é«˜ç«¯PETæè´¨ï¼Œè£¸æœºèˆ¬æ‰‹æ„Ÿ","product_picture":"public/imgs/accessory/protectingMen-Mi-CC9.png","product_price":19.0,"product_selling_price":19.0,"product_num":20,"product_sales":9},{"product_id":29,"product_name":"å°ç±³äºŒåˆä¸€ç§»åŠ¨ç”µæºï¼ˆå……ç”µå™¨ï¼‰","category_id":"7","product_title":"ä¸€ä¸ªè®¾å¤‡å¤šç§ç”¨é€”","product_intro":"5000mAhå……æ²›ç”µé‡ / å¤šåè®®å¿«å…… / USB å£è¾“å‡º","product_picture":"public/imgs/accessory/charger-tio.png","product_price":99.0,"product_selling_price":99.0,"product_num":20,"product_sales":0},{"product_id":20,"product_name":"å°ç±³9 ARE U OKä¿æŠ¤å£³","category_id":"5","product_title":"ä¸€ä¸ªä¸ä¼—ä¸åŒçš„ä¿æŠ¤å£³","product_intro":"å½°æ˜¾ç‹¬ç‰¹ä¸ªæ€§ / è½»è–„æ— è´Ÿæ‹… / ä¼˜é€‰PCææ–™ / è´´åˆæœºèº« / æ½®æµäº”è‰²","product_picture":"public/imgs/accessory/protectingShell-Mi-9.png","product_price":49.0,"product_selling_price":39.0,"product_num":20,"product_sales":10},{"product_id":24,"product_name":"å°ç±³USBå……ç”µå™¨å¿«å……ç‰ˆï¼ˆ18Wï¼‰","category_id":"7","product_title":"å®‰å“ã€è‹¹æœè®¾å¤‡å‡å¯ä½¿ç”¨","product_intro":"æ”¯æŒQC3.0è®¾å¤‡å……ç”µ / æ”¯æŒiOSè®¾å¤‡å……ç”µ/ ç¾è§‚è€ç”¨","product_picture":"public/imgs/accessory/charger-18w.png","product_price":29.0,"product_selling_price":29.0,"product_num":20,"product_sales":8},{"product_id":28,"product_name":"å°ç±³è½¦è½½å……ç”µå™¨å¿«å……ç‰ˆ(37W)","category_id":"7","product_title":"åŒå£å¿«å……ï¼Œè½¦è½½å……ç”µæ›´å®‰å…¨","product_intro":"å•å£27W å¿«å…… / åŒå£è¾“å‡º / å¤šé‡å®‰å…¨ä¿æŠ¤","product_picture":"public/imgs/accessory/charger-car-37w.png","product_price":49.0,"product_selling_price":49.0,"product_num":20,"product_sales":0},{"product_id":30,"product_name":"å°ç±³æ— çº¿å……ç”µå®é’æ˜¥ç‰ˆ10000mAh","category_id":"8","product_title":"èƒ½é‡æ»¡æ»¡ï¼Œæ— çº¿æœ‰çº¿éƒ½èƒ½å……","product_intro":"10000mAhå¤§å®¹é‡ / æ”¯æŒè¾¹å……è¾¹æ”¾ / æœ‰çº¿æ— çº¿éƒ½èƒ½å…… / åŒå‘å¿«å……","product_picture":"public/imgs/accessory/charger-10000mAh.png","product_price":129.0,"product_selling_price":129.0,"product_num":20,"product_sales":8},{"product_id":31,"product_name":"å°ç±³CC9 Pro/å°Šäº«ç‰ˆ æ’è‰²é£˜å¸¦ä¿æŠ¤å£³","category_id":"5","product_title":"å…¨é¢è´´åˆï¼Œæ— æ„Ÿæ›´èˆ’é€‚","product_intro":"ä¼˜é€‰ç¯ä¿PCæè´¨ï¼Œå¼ºéŸ§å¼ åŠ›ï¼Œå…¨é¢è´´åˆï¼Œæ— æ„Ÿæ›´èˆ’é€‚","product_picture":"public/imgs/accessory/protectingShell-Mi-CC9Pro.png","product_price":69.0,"product_selling_price":69.0,"product_num":20,"product_sales":0},{"product_id":27,"product_name":"å°ç±³è½¦è½½å……ç”µå™¨å¿«å……ç‰ˆ","category_id":"7","product_title":"è®©çˆ±è½¦æˆä¸ºç§»åŠ¨å……ç”µç«™","product_intro":"QC3.0 åŒå£è¾“å‡º / æ™ºèƒ½æ¸©åº¦æ§åˆ¶ / 5é‡å®‰å…¨ä¿æŠ¤ / å…¼å®¹iOS&Androidè®¾å¤‡","product_picture":"public/imgs/accessory/charger-car.png","product_price":69.0,"product_selling_price":69.0,"product_num":20,"product_sales":0},{"product_id":26,"product_name":"å°ç±³USBå……ç”µå™¨36Wå¿«å……ç‰ˆï¼ˆ2å£ï¼‰","category_id":"7","product_title":"6å¤šé‡å®‰å…¨ä¿æŠ¤ï¼Œå°å·§ä¾¿æº","product_intro":"åŒUSBè¾“å‡ºæ¥å£ / æ”¯æŒQC3.0å¿«å……åè®® / å¤šé‡å®‰å…¨ä¿æŠ¤ / å°å·§ä¾¿æº","product_picture":"public/imgs/accessory/charger-36w.png","product_price":59.0,"product_selling_price":59.0,"product_num":20,"product_sales":0},{"product_id":35,"product_name":"å°ç±³MIX 3 æç®€ä¿æŠ¤å£³è“è‰²","category_id":"5","product_title":"æ—¶å°šç®€çº¦è®¾è®¡ï¼Œæ‰‹æ„Ÿç»†è…»é¡ºæ»‘","product_intro":"æ—¶å°šç®€çº¦è®¾è®¡ï¼Œæ‰‹æ„Ÿç»†è…»é¡ºæ»‘ / ä¼˜è´¨ç¯ä¿PCåŸææ–™ï¼Œå¼ºéŸ§å¼ åŠ›ï¼Œç»ä¹…è€ç”¨ / è¶…è–„ 0.8MMåšåº¦","product_picture":"public/imgs/accessory/protectingShell-Mix-3.png","product_price":49.0,"product_selling_price":12.9,"product_num":20,"product_sales":0},{"product_id":14,"product_name":"å°ç±³ç”µè§†4A 65è‹±å¯¸","category_id":"2","product_title":"4K HDRï¼Œäººå·¥æ™ºèƒ½ç³»ç»Ÿ","product_intro":"äººå·¥æ™ºèƒ½ | å¤§å†…å­˜ | æœæ¯”éŸ³æ•ˆ | è¶…çª„è¾¹ | 4K HDR | æµ·é‡ç‰‡æº | çº¤è–„æœºèº«| é’¢ç´çƒ¤æ¼†","product_picture":"public/imgs/appliance/MiTv-4A-65.png","product_price":2999.0,"product_selling_price":2799.0,"product_num":10,"product_sales":0},{"product_id":23,"product_name":"å°ç±³USBå……ç”µå™¨30Wå¿«å……ç‰ˆï¼ˆ1A1Cï¼‰","category_id":"7","product_title":"å¤šä¸€ç§æ¥å£ï¼Œå¤šä¸€ç§é€‰æ‹©","product_intro":"åŒå£è¾“å‡º / 30W è¾“å‡º / å¯æŠ˜å æ’è„š / å°å·§ä¾¿æº","product_picture":"public/imgs/accessory/charger-30w.png","product_price":59.0,"product_selling_price":59.0,"product_num":20,"product_sales":8}],"total":23}
                ```
    
            *   ä¸šåŠ¡ä»‹ç»
    
                1.  å•†å“æ•°æ®æŸ¥è¯¢ï¼Œæ­¤æ¥å£å®ç°å…¨éƒ¨æŸ¥è¯¢å’Œå…³é”®å­—æŸ¥è¯¢
    
                2.  ç›´æ¥å¤ç”¨å‰ç«¯å•†å“æœç´¢æœåŠ¡ï¼Œä½¿ç”¨esè¿›è¡Œæœç´¢
    
                3.  å¦‚æœä¸è¾“å…¥ï¼Œé»˜è®¤æŸ¥è¯¢å…¨éƒ¨ï¼
    
            *   åŠŸèƒ½å®ç°
    
                *   productClient \[store-common-feign]
    
                    ```java
                    /**
                     * åå°ç®¡ç†è°ƒç”¨!
                     * @param paramsSearch
                     * @return
                     */
                    @PostMapping("/product/search")
                    R searchPage(@RequestBody ProductParamsSearch paramsSearch);
                    ```
    
                *   controller \[store-admin]
    
                    ```java
                    @RestController
                    @RequestMapping("product")
                    public class ProductController {
    
                        @Autowired
                        private ProductService productService;
    
                        @GetMapping("list")
                        public Object list(ProductParamsSearch productParamsSearch){
    
                            return productService.list(productParamsSearch);
                        }
                    }
                    ```
    
                *   service \[store-admin]
    
                    ```java
                    @Service
                    @Slf4j
                    public class ProductServiceImpl implements ProductService {
    
                        @Autowired
                        private ProductClient productClient;
    
                        /**
                         * å•†å“åˆ†é¡µ,å…³é”®å­—åˆ†é¡µæŸ¥è¯¢!
                         * @param productParamsSearch
                         * @return
                         */
                        @Override
                        public Object list(ProductParamsSearch productParamsSearch) {
    
                            R r = productClient.searchPage(productParamsSearch);
    
                            log.info("ProductServiceImpl.listä¸šåŠ¡ç»“æŸï¼Œç»“æœ:{}",r);
                            return r;
                        }
                    }
                    ```
    
                *   å¯åŠ¨ç±» \[store-admin]
    
                    ```java
                    @MapperScan("com.atguigu.mapper")
                    @SpringBootApplication
                    @EnableFeignClients(clients = {UserClient.class, CategoryClient.class, ProductClient.class})  //æ·»åŠ å®¢æˆ·ç«¯å¼•ç”¨
                    @EnableCaching //å¼€å¯ç¼“å­˜æ”¯æŒ
                    public class AdminApplication  {
    
                        public static void main(String[] args) {
                            SpringApplication.run(AdminApplication.class,args);
                        }
                    }
    
                    ```
    
        *   å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½
    
            *   æ¥å£ä»‹ç»
    
                è¯·æ±‚URLï¼š/admin/product/upload
    
                è¯·æ±‚æ–¹å¼ï¼špost
    
                è¯·æ±‚ç±»å‹:   multipart/form-data
    
                å‚æ•°è¯´æ˜ï¼š&#x20;
    
                | å‚æ•°      | æ˜¯å¦å¿…é€‰ | ç±»å‹ | è¯´æ˜  |
                | ------- | ---- | -- | --- |
                | **i**mg | æ˜¯    | æ–‡ä»¶ | å½“å‰é¡µ |
    
                è¿”å›ç»“æœï¼š
    
                ```json
                {
                   code:"001",
                   msg: "ä¸Šä¼ æˆåŠŸ"ï¼Œ
                   data: "å›¾ç‰‡åœ°å€"
                }
                ```
    
            *   ä¸šåŠ¡ä»‹ç»
    
                1.  å¼‚æ­¥ä¸Šä¼ æ–‡ä»¶ï¼Œè¿”å›å›¾ç‰‡åœ°å€
    
                2.  éœ€è¦ä½¿ç”¨ossæ–‡ä»¶ä¸Šä¼ 
    
            *   åŠŸèƒ½å®ç°
    
                *   **æŠ€æœ¯æ™®åŠossæ–‡ä»¶ä¸Šä¼ **
    
                    > å‚ç…§ossæ™®åŠï¼Œå¯¼å…¥ä¾èµ–ï¼Œå¯¼å…¥é…ç½®å’Œå·¥å…·ç±»ç­‰
    
                *   controller \[store-admin]
    
                    ```java
                    @PostMapping("upload")
                    public Object upload(MultipartFile img) throws Exception {
    
                        String filename = img.getOriginalFilename();
                        String contentType = img.getContentType();
                        long millis = System.currentTimeMillis();
    
                        filename = millis + filename; //é˜²æ­¢é‡å¤
    
                        String url = aliyunOSSUtils.uploadImage(filename, img.getBytes(), contentType, 1000);
                        System.out.println("url = " + url);
                        return R.ok("ä¸Šä¼ æˆåŠŸ",url);
    
                    }
                    ```
    
        *   å•†å“æ·»åŠ åŠŸèƒ½
    
            *   æ¥å£ä»‹ç»
    
                è¯·æ±‚URLï¼š/admin/product/save
    
                è¯·æ±‚æ–¹å¼ï¼špost
    
                è¯·æ±‚ç±»å‹:   formdata
    
                å‚æ•°è¯´æ˜ï¼š&#x20;
    
                | å‚æ•°       | æ˜¯å¦å¿…é€‰ | ç±»å‹     | è¯´æ˜          |
                | -------- | ---- | ------ | ----------- |
                | product  | æ˜¯    | å•†å“     | æ¶‰åŠå•†å“å…¨éƒ¨å±æ€§    |
                | pictures | æ˜¯    | string | è¯¦æƒ…å›¾ç‰‡åœ°å€ + æ‹¼æ¥ |
    
                è¿”å›ç»“æœï¼š
    
                ```json
                {
                   code:"001",
                   msg: "ä¿å­˜æˆåŠŸ"
                }
                ```
    
            *   ä¸šåŠ¡ä»‹ç»
    
                1.  å•†å“æ•°æ®ä¿å­˜ï¼Œä¹Ÿè¦ä¿å­˜å•†å“å¯¹åº”çš„å›¾ç‰‡ä¿¡æ¯ï¼
    
                2.  æ³¨æ„ï¼šå•†å“è¯¦æƒ…å›¾ç‰‡åœ°å€ä½¿ç”¨ + æ‹¼æ¥
    
                3.  éœ€è¦æ¸…ç©ºå•†å“ç¼“å­˜ä¿¡æ¯
    
                4.  éœ€è¦å¼‚æ­¥æ›´æ–°searchæœåŠ¡ï¼Œæ·»åŠ å•†å“æ•°æ®
    
            *   åŠŸèƒ½å®ç°
    
                *   productSaveParam \[store-common-feign]
    
                    ```java
                    @Data
                    public class ProductSaveParam extends Product {
    
                        //å•†å“è¯¦æƒ…å›¾ç‰‡åœ°å€, å¤šå›¾ç‰‡åœ°å€ä½¿ç”¨ + å·æ‹¼æ¥
                        private String pictures;
                    }
                    ```
    
                *   productClient \[store-common-feign]
    
                    ```java
                    @PostMapping("/product/save")
                    R save(@RequestBody ProductSaveParam saveParam);
                    ```
    
                *   controller \[store-front-product]
    
                    ```java
                    @PostMapping("save")
                    public R save(@RequestBody ProductSaveParam productSaveParam){
                        return productService.save(productSaveParam);
                    }
                    ```
    
                *   service \[store-front-product]
    
                    ```java
                    /**
                     * ä¿å­˜å•†å“ä¿¡æ¯
                     *   1.ä¿å­˜å•†å“ä¿¡æ¯
                     *   2.ä¿å­˜å•†å“å›¾ç‰‡ä¿¡æ¯
                     *   3.å‘é€æ¶ˆæ¯,esåº“è¿›è¡Œæ’å…¥
                     * @param productSaveParam
                     * @return
                     */
                    @Transactional
                    @Override
                    public R save(ProductSaveParam productSaveParam) {
    
                        Product product = new Product();
                        //å‚æ•°èµ‹å€¼
                        BeanUtils.copyProperties(productSaveParam,product);
    
                        //è¿›è¡ŒPictureå¯¹è±¡å°è£…
                        String pictures = productSaveParam.getPictures();
    
                        if (!StringUtils.isEmpty(pictures)){
                            //$ + - * | / ï¼Ÿ^ç¬¦å·åœ¨æ­£åˆ™è¡¨è¾¾ç¤ºä¸­æœ‰ç›¸åº”çš„ä¸åŒæ„ä¹‰ã€‚
                            //ä¸€èˆ¬æ¥è®²åªéœ€è¦åŠ []ã€æˆ–æ˜¯\\å³å¯
                            String[] pics = pictures.split("\\+");
                            for (String pic : pics) {
                                Picture picture = new Picture();
                                picture.setIntro(null);
                                picture.setProductId(product.getProductId());
                                picture.setProductPicture(pic);
                                //å› ä¸ºæ²¡æœ‰å¤ç”¨ä¸šåŠ¡,æ— æ³•ä½¿ç”¨mybatis-plusæ‰¹é‡æ’å…¥
                                pictureMapper.insert(picture);
                            }
                        }
    
                        //å•†å“æ•°æ®ä¿å­˜
                        int rows = productMapper.insert(product);
    
                        if (rows == 0){
                            return R.fail("å•†å“ä¿å­˜å¤±è´¥!");
                        }
    
                        //ä¿å­˜æˆåŠŸ,è¿›è¡Œå‘é€æ¶ˆæ¯,productæ’å…¥åˆ°esåº“ä¸­
                        rabbitTemplate.convertAndSend("topic.ex","insert.product",product);
                        return R.ok("å•†å“æ•°æ®ä¿å­˜æˆåŠŸ!");
                    }
                    ```
    
                *   controller \[store-admin]
    
                    ```java
                     /**
                       * å•†å“ä¿¡æ¯ä¿å­˜
                       * @param saveParam
                       * @return
                       */
                      @PostMapping("save")
                      public Object save(ProductSaveParam saveParam){
                          return productService.save(saveParam);
                      }
                    ```
    
                *   service \[store-admin]
    
                    ```java
                    /**
                     * ä¿å­˜å•†å“ä¸šåŠ¡!
                     * 1.ä¿å­˜å•†å“
                     * 2.ä¿å­˜å•†å“å›¾ç‰‡
                     * 3.å•†å“ç¼“å­˜æ•°æ®å¤„ç† [æ³¨è§£]
                     * 4.æŸ¥è¯¢ç¼“å­˜eså¤„ç† [å¼‚æ­¥]
                     *
                     * @param saveParam
                     * @return
                     */
                    @CacheEvict(value = "list.product", allEntries = true)
                    @Override
                    public Object save(ProductSaveParam saveParam) {
    
                        //ä¿å­˜ å•†å“å’Œå•†å“å›¾ç‰‡
                        R r = productClient.save(saveParam);
                        log.info("ProductServiceImpl.saveä¸šåŠ¡ç»“æŸï¼Œç»“æœ:{}",r);
                        return r;
                    }
                    ```
    
        *   å•†å“ä¿®æ”¹åŠŸèƒ½
    
            *   æ¥å£ä»‹ç»
    
                è¯·æ±‚URLï¼š/admin/product/update
    
                è¯·æ±‚æ–¹å¼ï¼špost
    
                è¯·æ±‚ç±»å‹:   formdata
    
                å‚æ•°è¯´æ˜ï¼š&#x20;
    
                | å‚æ•°        | æ˜¯å¦å¿…é€‰ | ç±»å‹      | è¯´æ˜     |
                | --------- | ---- | ------- | ------ |
                | productå®ä½“ | æ˜¯    | product | åŒ…å«å•†å“ä¿¡æ¯ |
    
                è¿”å›ç»“æœï¼š
    
                ```json
                {
                   code:"001",
                   msg: "ä¿®æ”¹æˆåŠŸ"
                }
                ```
    
            *   ä¸šåŠ¡ä»‹ç»
    
                1.  å•†å“æ•°æ®è¿›è¡Œæ›´æ–°
    
                2.  éœ€è¦æ¸…ç©ºå•†å“é›†åˆç¼“å­˜å’Œå¯¹åº”IDçš„ç¼“å­˜
    
                3.  ä¿®æ”¹æ›´æ–°esæœç´¢æœåŠ¡ï¼Œesç›´æ¥è¦†ç›–æ›´æ–°å³å¯
    
            *   åŠŸèƒ½å®ç°
    
                *   productClient \[store-common-feign]
    
                    ```java
                    @PostMapping("/product/update")
                    R update(@RequestBody  Product product);
                    ```
    
                *   controller \[store-front-product]
    
                    ```java
                    @PostMapping("update")
                    public R update(@RequestBody Product product){
                        return productService.update(product);
                    }
                    ```
    
                *   service \[store-front-product]
    
                    ```java
                    /**
                     * å•†å“æ•°æ®è¿›è¡Œæ›´æ–°
                     *   1.æ›´æ–°æ•°æ®
                     *   2.é€šçŸ¥esæœåŠ¡,è¿›è¡Œæ›´æ–°æ•°æ®
                     * @param product
                     * @return
                     */
                    @Override
                    public R update(Product product) {
    
                        int rows = baseMapper.updateById(product);
    
                        if (rows == 0){
                            return R.fail("å•†å“æ•°æ®æ›´æ–°å¤±è´¥!");
                        }
                        //esæ›´æ–°å°±æ˜¯æ’å…¥è¦†ç›–å³å¯~
                        rabbitTemplate.convertAndSend("topic.ex",
                                "insert.product",product);
    
                        return R.ok("å•†å“æ•°æ®æ›´æ–°æˆåŠŸ!");
                    }
    
                    ```
    
                *   controller \[store-admin]
    
                    ```java
                    /**
                     * ä¿®æ”¹å•†å“ä¿¡æ¯
                     * @param product
                     * @return
                     */
                    @PostMapping("update")
                    public Object update(Product product){
    
                        return productService.update(product);
                    }
                    ```
    
                *   service \[store-admin]
    
                    ```java
                    /**
                       * ä¿®æ”¹å•†å“ä¿¡æ¯
                       * 1.ä¿®æ”¹å•†å“ä¿¡æ¯
                       * 2.æ¸…ç©ºå•†å“ç¼“å­˜é›†åˆ
                       * 3.æ›´æ–°ç¼“å­˜eså¤„ç† [å¼‚æ­¥]
                       *
                       * @param product
                       * @return
                       */
                      @CacheEvict(value = "list.product",allEntries = true)
                      @CachePut(value = "product",key = "#product.productId")
                      @Override
                      public Object update(Product product) {
    
                          R r = productClient.update(product);
                          log.info("ProductServiceImpl.updateä¸šåŠ¡ç»“æŸï¼Œç»“æœ:{}",r);
                          return r;
                      }
                    ```
    
        *   å•†å“åˆ é™¤åŠŸèƒ½
    
            *   æ¥å£ä»‹ç»
    
                è¯·æ±‚URLï¼š/admin/product/remove
    
                è¯·æ±‚æ–¹å¼ï¼špost
    
                è¯·æ±‚ç±»å‹:   formdata
    
                å‚æ•°è¯´æ˜ï¼š&#x20;
    
                | å‚æ•°        | æ˜¯å¦å¿…é€‰ | ç±»å‹  | è¯´æ˜       |
                | --------- | ---- | --- | -------- |
                | productId | æ˜¯    | int | è¦åˆ é™¤çš„å•†å“ID |
    
                è¿”å›ç»“æœï¼š
    
                ```json
                {
                   code:"001",
                   msg: "åˆ é™¤æˆåŠŸ"
                }
                ```
    
            *   ä¸šåŠ¡ä»‹ç»
    
                1.  åˆ é™¤å•†å“æ•°æ®ï¼Œå•†å“å¯¹åº”çš„å›¾ç‰‡è¯¦æƒ…
    
                2.  è´­ç‰©è½¦ï¼Œè®¢å•å­˜åœ¨å¼•ç”¨ï¼Œä¸åˆ é™¤ï¼Œæ”¶è—å­˜åœ¨å…ˆæ¸…é™¤æ”¶è—
    
                3.  éœ€è¦æ¸…ç©ºå•†å“é›†åˆç¼“å­˜ï¼Œæ¸…ç©ºç‰¹å®šIDçš„ç¼“å­˜
    
                4.  åˆ é™¤esæœç´¢æœåŠ¡ä¸­çš„å¯¹åº”å•†å“
    
            *   åŠŸèƒ½å®ç°
    
                *   cartClient \[store-common-feign]
    
                    ```java
                    @FeignClient(value = "cart-service")
                    public interface CartClient {
    
                        /**
                         * æ£€æŸ¥å•†å“æœ‰æ²¡æœ‰è¢«å¼•ç”¨,æœ‰å–æ¶ˆåˆ é™¤!
                         * @param productId
                         * @return
                         */
                        @PostMapping("/cart/check")
                        R checkProduct(Integer productId);
                    }
                    ```
    
                *   orderClient \[store-common-feign]
    
                    ```java
                    @FeignClient(value = "order-service")
                    public interface OrderClient {


                        /**
                         * æ£€æŸ¥å•†å“æœ‰æ²¡æœ‰è¢«å¼•ç”¨,æœ‰å–æ¶ˆåˆ é™¤!
                         * @param productId
                         * @return
                         */
                        @PostMapping("/order/check")
                        R checkProduct(Integer productId);
    
                    }
                    ```
    
                *   collectClient \[store-common-feign]
    
                    ```java
                    @FeignClient(value = "collect-service")
                    public interface CollectClient {
    
                        @PostMapping("/collect/remove/bypid")
                        R removeByPID(@RequestBody Integer productId);
                    }
                    ```
    
                *   productClient\[store-common-feign]
    
                    ```java
                    @PostMapping("product/remove")
                    R remove(@RequestBody Integer productId);
                    ```
    
                *   controller \[store-front-cart]
    
                    ```java
                    /**
                     * æ£€æŸ¥æ˜¯å¦å­˜åœ¨å¯¹åº”å•†å“
                     * @param productId
                     * @return
                     */
                    @PostMapping("check")
                    public R check(@RequestBody Integer productId){
    
                        return cartService.check(productId);
                    }
                    ```
    
                *   service \[store-front-cart]
    
                    ```java
                    /**
                     * æ£€æŸ¥å•†å“æ˜¯å¦å­˜åœ¨
                     *
                     * @param productId
                     * @return
                     */
                    @Override
                    public R check(Integer productId) {
    
                        QueryWrapper<Cart> queryWrapper = new QueryWrapper<>();
                        queryWrapper.eq("product_id",productId);
                        Long total = cartMapper.selectCount(queryWrapper);
    
                        if (total == 0L){
                            return R.ok("è´­ç‰©è½¦ä¸­ä¸å­˜åœ¨è¦åˆ é™¤çš„å•†å“!");
                        }
    
                        return R.fail("è´­ç‰©è½¦ä¸­å­˜åœ¨è¦åˆ é™¤çš„å•†å“!");
                    }
                    ```
    
                *   controller \[store-front-order]
    
                    ```java
                    /**
                     * æ£€æŸ¥è®¢å•æ˜¯å¦åŒ…å«è¦åˆ é™¤çš„å•†å“
                     * @param productId
                     * @return
                     */
                    @PostMapping("/check")
                    public  Object check(@RequestBody Integer productId){
                        return orderService.check(productId);
                    }
    
                    ```
    
                *   service \[store-front-order]
    
                    ```java
                    /**
                     * æ£€æŸ¥è®¢å•æ˜¯å¦åŒ…å«è¦åˆ é™¤çš„å•†å“
                     *
                     * @param productId
                     * @return
                     */
                    @Override
                    public Object check(Integer productId) {
    
                        QueryWrapper<Order> queryWrapper
                                  = new QueryWrapper<>();
    
                        queryWrapper.eq("product_id",productId);
    
                        Long total = baseMapper.selectCount(queryWrapper);
    
                        if (total == 0){
    
                            return R.ok("è®¢å•ä¸­ä¸å­˜åœ¨è¦åˆ é™¤çš„å•†å“!");
                        }
    
                        return R.fail("è®¢å•ä¸­å­˜åœ¨è¦åˆ é™¤çš„å•†å“,åˆ é™¤å¤±è´¥!");
                    }
                    ```
    
                *   controller \[store-front-collect]
    
                    ```java
                    /**
                     * æ ¹æ®å•†å“idåˆ é™¤
                     * @param productId
                     * @return
                     */
                    @PostMapping("remove/bypid")
                    public Object removeByPid(@RequestBody Integer productId){
    
                        return collectService.removeByPid(productId);
                    }
                    ```
    
                *   service \[store-front-collect]
    
                    ```java
                    /**
                     * å•†å“å•†å“idå¯¹åº”çš„æ”¶è—ä¿¡æ¯
                     *
                     * @param productId
                     * @return
                     */
                    @Override
                    public Object removeByPid(Integer productId) {
    
                        QueryWrapper<Collect> queryWrapper = new QueryWrapper<>();
    
                        queryWrapper.eq("product_id",productId);
    
                        int rows = collectMapper.delete(queryWrapper);
    
                        return R.ok(rows);
                    }
                    ```
    
                *   controller \[store-front-product]
    
                    ```java
                    @PostMapping("remove")
                    public R remove(@RequestBody Integer productId){
    
                        return productService.remove(productId);
                    }
                    ```
    
                *   service \[store-front-product]
    
                    ```java
                    /**
                     * ç§»é™¤å•†å“ä¿¡æ¯
                     * 1.æ£€æŸ¥è´­ç‰©è½¦æ˜¯å¦å­˜åœ¨  å­˜åœ¨ ä¸åˆ é™¤
                     * 2.æ£€æŸ¥è´¦å•æ˜¯å¦å­˜åœ¨    å­˜åœ¨ ä¸åˆ é™¤
                     * 3.åˆ é™¤å•†å“æ•°æ® å’Œ åˆ é™¤å•†å“å¯¹åº”çš„å›¾ç‰‡è¯¦æƒ…
                     * 3.æ£€æŸ¥æ”¶è—å¤¹æ˜¯å¦å­˜åœ¨  åˆ é™¤ æ”¶è—å¤¹å•†å“
                     * 4.é€šçŸ¥esæœç´¢æœåŠ¡åˆ é™¤
                     * @param productId
                     * @return
                     */
                    @Transactional
                    @Override
                    public R remove(Integer productId) {
    
                        //1.æ£€æŸ¥è´­ç‰©è½¦æ˜¯å¦å­˜åœ¨
                        R r = cartClient.checkProduct(productId);
    
                        if ("004".equals(r.getCode())){
                            log.info("ProductServiceImpl.removeç»“æŸ,{}",r.getMsg());
                            return r;
                        }
    
                        //2.ç®€å•è´¦å•æ˜¯å¦å­˜åœ¨
                        R or = orderClient.checkProduct(productId);
                        if ("004".equals(or.getCode())){
                            log.info("ProductServiceImpl.removeç»“æŸ,{}",or.getMsg());
                            return or;
                        }
    
                        //åˆ é™¤å•†å“å›¾ç‰‡è¯¦æƒ…
                        QueryWrapper<Picture> wrapper = new QueryWrapper<>();
                        wrapper.eq("product_id",productId);
                        pictureMapper.delete(wrapper);
                        //åˆ é™¤æ”¶è—ä¸­çš„å•†å“
                        collectClient.removeByPID(productId);
    
                        //3.åˆ é™¤å•†å“æ•°æ® å’Œ åˆ é™¤å•†å“å¯¹åº”çš„å›¾ç‰‡æ•°æ®
                        int rows = productMapper.deleteById(productId);
    
                        if (rows == 0 ){
                            log.info("ProductServiceImpl.removeä¸šåŠ¡ç»“æŸï¼Œç»“æœ:{}","å•†å“åˆ é™¤å¤±è´¥!");
                            return R.fail("å•†å“åˆ é™¤å¤±è´¥!");
                        }


                        //åˆ é™¤esç¼“å­˜ä¸­å¯¹åº”å•†å“çš„æ•°æ®
                        rabbitTemplate.convertAndSend("topic.ex","delete.product",productId);


                        try {
                            Thread.sleep(500);
                        } catch (InterruptedException e) {
                            e.printStackTrace();
                        }
                        R ok = R.ok("å•†å“æ•°æ®åˆ é™¤æˆåŠŸ!");
                        log.info("ProductServiceImpl.removeä¸šåŠ¡ç»“æŸï¼Œç»“æœ:{}",ok);
                        return ok;
                    }
    
                    ```
    
                *   controller \[store-admin]
    
                    ```java
                    @PostMapping("remove")
                    public Object remove(Product product){
    
                        return productService.remove(product.getProductId());
                    }
    
                    ```
    
                *   service \[store-admin]
    
                    ```java
                    /**
                     * åˆ é™¤å•†å“æ•°æ®
                     *    æ¸…ç©ºç¼“å­˜
                     *    è°ƒç”¨å•†å“æœåŠ¡
                     * @param productId
                     * @return
                     */
                    @Caching(
                        evict = {
                           @CacheEvict(value = "list.product",allEntries = true),
                           @CacheEvict(value = "product",key = "#productId")
                        }
                    )
                    @Override
                    public Object remove(Integer productId) {
    
                        R r = productClient.remove(productId);
                        log.info("ProductServiceImpl.removeä¸šåŠ¡ç»“æŸï¼Œç»“æœ:{}",r);
                        return r;
                    }
                    ```
    
                *   å¯åŠ¨ç±» \[store-admin]
    
                    ```java
                    @MapperScan("com.atguigu.mapper")
                    @SpringBootApplication
                    @EnableFeignClients(clients = {UserClient.class, CategoryClient.class, ProductClient.class})  //æ·»åŠ å®¢æˆ·ç«¯å¼•ç”¨
                    @EnableCaching //å¼€å¯ç¼“å­˜æ”¯æŒ
                    public class AdminApplication  {
    
                        public static void main(String[] args) {
                            SpringApplication.run(AdminApplication.class,args);
                        }
                    }
    
                    ```
    
    *   è®¢å•ç®¡ç†åŠŸèƒ½
    
        *   è®¢å•å±•ç¤ºåŠŸèƒ½
    
            *   æ¥å£ä»‹ç»
    
                è¯·æ±‚URLï¼š/admin/order/list
    
                è¯·æ±‚æ–¹å¼ï¼šget
    
                è¯·æ±‚ç±»å‹:   formdata
    
                å‚æ•°è¯´æ˜ï¼š&#x20;
    
                | å‚æ•°              | æ˜¯å¦å¿…é€‰ | ç±»å‹  | è¯´æ˜  |
                | --------------- | ---- | --- | --- |
                | **currentPage** | æ˜¯    | int | å½“å‰é¡µ |
                | pageSize        | æ˜¯    | int | å¶å®¹é‡ |
    
                è¿”å›ç»“æœï¼š
    
                ```json
                {
                   code:"001" / "004",
                   msg: "æŸ¥è¯¢æˆåŠŸ",
                   total:20 ,
                   data:[
                      order_id: 111111,
                      user_id: 11,
                      product_num: 2, # è®¢å•å•†å“ç§ç±»
                      order_num: 20,  #è®¢å•å•†å“ä»¶æ•°é‡
                      order_price: 999.8, #è®¢å•æ€»é‡‘é¢
                      order_time: æ—¶é—´æˆ³ 
                   ]
                }
    
                ```
    
            *   ä¸šåŠ¡ä»‹ç»
    
                1.  æŸ¥è¯¢è®¢å•æ•°æ®ï¼Œè¿›è¡Œåå°å±•ç¤º
    
                2.  éœ€è¦è¿›è¡Œè®¢å•åˆ†ç»„æŸ¥è¯¢ï¼Œè¿”å›å¯¹åº”çš„æ ¼å¼
    
            *   åŠŸèƒ½å®ç°
    
                *   orderClient \[store-common-feign]
    
                    ```java
                    @PostMapping("order/admin/list")
                    R adminList(@RequestBody PageParam pageParam);
                    ```
    
                *   adminOrderVo \[store-common-feign]
    
                    ```java
                    @JsonIgnoreProperties(ignoreUnknown = true)
                    @Data
                    public class AdminOrderVo {
    
                        @JsonProperty("order_id")
                        private Long orderId;
                        @JsonProperty("user_id")
                        private Integer userId;
                        @JsonProperty("product_num")
                        private Integer productNum; //å•†å“ç§ç±»
                        @JsonProperty("order_num")
                        private Integer orderNum; //è®¢å•ä¸­å•†å“æ•°é‡
                        @JsonProperty("order_price")
                        private Double  orderPrice; //è®¢å•é‡‘é¢
                        @JsonProperty("order_time")
                        private Long    orderTime; //è®¢å•æ—¶é—´
                    }
                    ```
    
                *   controller \[store-front-order]
    
                    ```java
                    @PostMapping("/admin/list")
                    public Object adminList(@RequestBody PageParam pageParam){
    
                        return orderService.adminList(pageParam);
                    }
                    ```
    
                *   service \[store-front-order]
    
                    ```java
                    /**
                     * åˆ†é¡µæŸ¥è¯¢è®¢å•æ•°æ®
                     *
                     * @param pageParam
                     * @return
                     */
                    @Override
                    public Object adminList(PageParam pageParam) {
    
                        int offset = (pageParam.getCurrentPage()-1)*pageParam.getPageSize();
                        int number = pageParam.getPageSize();
    
                        //æŸ¥è¯¢æ•°é‡
                        Long total = orderMapper.selectCount(null);
                        //è‡ªå®šä¹‰æŸ¥è¯¢
                        List<AdminOrderVo> adminOrderVoList = orderMapper.selectAdminOrders(offset,number);


                        return R.ok("æŸ¥è¯¢æˆåŠŸ",adminOrderVoList,total);
                    }
                    ```
    
                *   mapper \[store-front-order]
    
                    ```java
                    public interface OrderMapper extends BaseMapper<Order> {
    
                        /**
                         * åˆ†é¡µæŸ¥è¯¢æ•°æ®,è¿”å›orderå°è£…vo
                         * @param offset
                         * @param number
                         * @return
                         */
                        List<AdminOrderVo> selectAdminOrders(@Param("offset") int offset, @Param("number")int number);
                    }


                    <?xml version="1.0" encoding="UTF-8" ?>
                    <!DOCTYPE mapper
                            PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
                            "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
                    <mapper namespace="com.atguigu.order.mapper.OrderMapper">
    
                        <select id="selectAdminOrders" resultType="com.atguigu.vo.AdminOrderVo">
                            SELECT order_id orderId, user_id userId , COUNT(product_id) productNum , SUM(product_num) orderNum,
                                        SUM(product_price) orderPrice, order_time orderTime
                                                FROM orders GROUP BY order_id LIMIT #{offset} , #{number};
                        </select>
    
                    </mapper>
    
                    ```
    
                *   controller \[store-admin]
    
                    ```java
                    @RestController
                    @RequestMapping("order")
                    public class OrderController
                    {
                        @Autowired
                        private OrderService orderService;
    
                        @GetMapping("list")
                        public Object list(PageParam pageParam){
    
                            return orderService.list(pageParam);
                        }
    
                    }
                    ```
    
                *   service \[store-admin]
    
                    ```java
                    @Service
                    @Slf4j
                    public class OrderServiceImpl implements OrderService {
    
                        @Autowired
                        private OrderClient orderClient;
    
                        /**
                         * åˆ†é¡µæŸ¥è¯¢è®¢å•æ•°æ®
                         *
                         * @param pageParam
                         * @return
                         */
                        @Override
                        public Object list(PageParam pageParam) {
    
                            R r = orderClient.adminList(pageParam);
    
                            log.info("OrderServiceImpl.listä¸šåŠ¡ç»“æŸï¼Œç»“æœ:{}",r);
    
                            return r;
                        }
                    }
                    ```

*   **åŠŸèƒ½æ‰©å±•**

    é¢„ç•™ä½œä¸šï¼Œæ·»åŠ è½®æ’­å›¾ç®¡ç†ï¼

### å…«ã€å¼€å‘ç¯å¢ƒæ­å»º

*   **jdkç¯å¢ƒå®‰è£…**

    *   ç¯å¢ƒå‡†å¤‡

    *   è½¯ä»¶å®‰è£…

        ç›´æ¥åŒå‡»å®‰è£…å³å¯! ç•™æ„å®‰è£…è·¯å¾„,åç»­éœ€è¦é…ç½®ç¯å¢ƒå˜é‡!

    *   ç¯å¢ƒé…ç½®

        *   ç¬¬ä¸€æ­¥: å³å‡»æˆ‘çš„ç”µè„‘->å±æ€§->é«˜çº§ç³»ç»Ÿè®¾ç½®->ç¯å¢ƒå˜é‡â†’ **ç³»ç»Ÿå˜é‡**

        *   ç¬¬äºŒæ­¥: JAVA\_HOMEå˜é‡

            ç‚¹å‡»æ–°å»º - è¾“å…¥ä¿¡æ¯ - ç¡®å®šå³å¯ ! æ³¨æ„:å˜é‡åå›ºå®š,å˜é‡å€¼ä¸ºå®‰è£…jdkçš„æ ¹è·¯å¾„!

            ![](image/image_rxpcpXv_qu.png)

        *   ç¬¬ä¸‰æ­¥: Pathå˜é‡

            ç³»ç»Ÿå˜é‡ - é€‰ä¸­Path - ç‚¹å‡»ç¼–è¾‘ - æ–°å»º - è¿½åŠ  **%JAVA\_HONE%\bin** - ç¡®å®š!

            ![](image/image_VYuTOcIqv0.png)

        *   é…ç½®æµ‹è¯•

            window + r  â†’ cmd  â†’ java -version å‡ºç°jdkç‰ˆæœ¬å³å¯!

*   \*\*ideaç¯å¢ƒå®‰è£… \*\*

    *   ideaä»‹ç»å’Œå…¶ä»–ç‰ˆæœ¬ä¸‹è½½ &#x20;

        > IntelliJ IDEA çš„æ¯ä¸ªæ–¹é¢éƒ½æ—¨åœ¨æœ€å¤§åŒ–å¼€å‘è€…ç”Ÿäº§åŠ›ã€‚ç»“åˆæ™ºèƒ½ç¼–ç è¾…åŠ©ä¸ç¬¦åˆäººä½“å·¥ç¨‹å­¦çš„è®¾è®¡ï¼Œè®©å¼€å‘ä¸ä»…é«˜æ•ˆï¼Œæ›´æˆä¸ºä¸€ç§äº«å—ã€‚

        [https://www.jetbrains.com.cn/idea/download/download-thanks.html](https://www.jetbrains.com.cn/idea/download/download-thanks.html "https://www.jetbrains.com.cn/idea/download/download-thanks.html")

    *   ç¯å¢ƒå‡†å¤‡

    *   ç¯å¢ƒå®‰è£…

        å³é”®ç›´æ¥å®‰è£…å³å¯,åªéœ€è¦è°ƒæ•´å®‰è£…åœ°å€å³å¯,å…¶ä»–æ— æ³¨æ„äº‹é¡¹!

    *   æµ‹è¯•å’Œæ¿€æ´»    &#x20;

        ideaå·¥å…·ä¸“ä¸šç‰ˆéœ€è¦ä»˜è´¹ä½¿ç”¨,æ–°ç”¨æˆ·å¯ä»¥æŒ‰ä¸€ä¸‹é€‰æ‹©,å…è´¹ä½¿ç”¨ä¸€ä¸ªæœˆ!

        ![](image/image_5-G2PYt9te.png)

*   **mavenç¯å¢ƒå®‰è£…**

    *   mavenä»‹ç»

        *   mavenæ˜¯ä¸€æ¬¾é¡¹ç›®æ„å»ºå’Œä¾èµ–ç®¡ç†çš„å·¥å…·

        *   å¯ä»¥ç®€åŒ–å¯¼å…¥jarçš„è¿‡ç¨‹

        *   mavenå¯ä»¥ä½¿ç”¨å‘½ä»¤ç®€åŒ–å¯¹é¡¹ç›®æ„å»º

    *   ç¯å¢ƒå‡†å¤‡

    *   è½¯ä»¶å®‰è£…

        æ³¨æ„: mavenä¾èµ–javaç¯å¢ƒ,è¦æ±‚æœ¬åœ°å¿…é¡»é…ç½®JAVA\_HOMEç¯å¢ƒå˜é‡

        å®‰è£…: mavenæ˜¯ç»¿è‰²è§£å‹ç‰ˆ,ç›´æ¥è§£å‹å³å¯,æ³¨æ„:æ‰€åœ¨çš„è·¯å¾„ä¸è¦æœ‰ä¸­æ–‡ç©ºæ ¼ç­‰å³å¯!

    *   ç¯å¢ƒå˜é‡

        mavenéœ€è¦é…ç½®maven\_homeå’Œ pathç¯å¢ƒå˜é‡é…ç½®æ–¹å¼å’ŒjdkåŸºæœ¬ç›¸åŒ!

        ```java
        MAVEN_HOMEé…ç½®: ç³»ç»Ÿå˜é‡  å˜é‡åMAVEN_HOME å˜é‡å€¼ mavenæ–‡ä»¶å¤¹æ ¹è·¯å¾„å³å¯

        Pathé…ç½®:  ç³»ç»Ÿå˜é‡ ä¿®æ”¹Pathå˜é‡, æ·»åŠ  %MAVEN_HOME%\bin å³å¯
        ```

    *   é…ç½®ä¿®æ”¹

        *   ä¿®æ”¹mavenæœ¬åœ°ä»“åº“

            > mavenä¼šæ ¹æ®é…ç½®ä¸‹è½½ä¾èµ–jaråŒ…,ç¼“å­˜åˆ°æœ¬åœ°ä»“åº“,é»˜è®¤å­˜å‚¨æ˜¯cç›˜/ç”¨æˆ·/.m2ä¸‹,é¿å…cç›˜å ç”¨è¿‡å¤§,ä¿®æ”¹mavençš„é…ç½®,ä¿®æ”¹mavençš„æœ¬åœ°ç¼“å­˜ä½ç½®!

            ä¿®æ”¹æ–‡ä»¶ä½ç½®:  maven/conf/settings.xml&#x20;

            ```xml
            <!-- å¤§æ¦‚55è¡Œå·¦å³,æ”¹ä¸ºæœ¬åœ°å…¶ä»–æ–‡ä»¶å¤¹å³å¯,å¦‚æœæ²¡æœ‰,ä¼šè‡ªåŠ¨åˆ›å»º! -->
            <localRepository>D:\repository</localRepository>
            ```

        *   ä¿®æ”¹mavené•œåƒåœ°å€

            > mavenä¼šè‡ªåŠ¨ä¸‹è½½jaråŒ…,é»˜è®¤å»ç½‘ç»œä¸­çš„ä¸­å¤®ä»“åº“ä¸‹è½½,ä¸­å¤®ä»“åº“åœ¨å¤–ç½‘,ä¸‹è½½é€Ÿåº¦è¾ƒæ…¢,å¯ä»¥åˆ‡æ¢æˆå›½å†…å¤§å‚æä¾›çš„ä»“åº“åœ°å€é•œåƒ! æˆ‘ä»¬æœ¬æ¬¡æ”¹ä¸ºé˜¿é‡Œé•œåƒ!

            ä¿®æ”¹æ–‡ä»¶ä½ç½®:  maven/conf/settings.xml&#x20;

            ```xml
              <mirrors>
               <!-- å¤§æ¦‚åœ¨148è¡Œä¸­,åœ¨mirrorsæ ‡ç­¾ä¸­æ·»åŠ ä»¥ä¸‹å‚æ•°çš„mirroræ ‡ç­¾å³å¯! -->
                 <mirror>
                    <id>alimaven</id>
                    <name>aliyun maven</name>
                    <url>http://maven.aliyun.com/nexus/content/groups/public/</url>
                    <mirrorOf>central</mirrorOf>
                </mirror>
              </mirrors>
            ```

        *   ä¿®æ”¹maven jdkç¼–è¯‘ç‰ˆæœ¬

            > æˆ‘ä»¬å°†ä½¿ç”¨mavenä½œä¸ºé¡¹ç›®æ„å»ºå·¥å…·,ç¼–è¯‘javaå·¥ç¨‹,é»˜è®¤mavené€‰æ‹©ä½¿ç”¨1.5ç‰ˆæœ¬è¿›è¡Œé¡¹ç›®æ„å»º,æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®æ”¹é…ç½®,è°ƒæ•´ä¸º1.8ç‰ˆæœ¬è¿›è¡Œé¡¹ç›®æ„å»º!

            ä¿®æ”¹æ–‡ä»¶ä½ç½®:  maven/conf/settings.xml&#x20;

            ```xml
            <!-- æ³¨æ„: æ˜¯åœ¨profilesæ ‡ç­¾ä¸­,æ·»åŠ æ­¤æ ‡ç­¾å†…å®¹! -->
            <profile>
               <id>jdk8</id>
               <activation>  
                 <activeByDefault>true</activeByDefault>  
                 <jdk>1.8</jdk>  
               </activation>  
               <properties>  
                 <maven.compiler.source>1.8</maven.compiler.source>  
                 <maven.compiler.target>1.8</maven.compiler.target>  
                 <maven.compiler.compilerVersion>1.8</maven.compiler.compilerVersion>  
               </properties>
            </profile>
            ```

    *   ideaé…ç½®

        > ideaè‡ªå¸¦maven,ä½†æ˜¯é…ç½®æ–‡ä»¶æ²¡æœ‰ä¿®æ”¹,æˆ‘ä»¬å°†ideaè‡ªå¸¦çš„mavenè°ƒæ•´æˆæˆ‘ä»¬å®‰è£…çš„maven!

        *   ideaæ‰“å¼€é…ç½®

            **æ³¨æ„: éœ€è¦é€‰ä¸­other settings è€Œä¸æ˜¯settings, other settingé…ç½®æ–°é¡¹ç›®éƒ½ç”Ÿæ•ˆ**

            ![](image/image_ysjy_0cwFd.png)

        *   ideaé€‰ä¸­æœ¬åœ°maven

            ![](image/image_XULLkWZGT5.png)

        *   æ ¡éªŒæˆåŠŸ

            local repositoryé€‰é¡¹è‡ªåŠ¨å˜æˆæˆ‘ä»¬é…ç½®çš„æœ¬åœ°ä»“åº“ä½ç½®,å³é…ç½®æˆåŠŸ!
            å¦‚æœä¸æ”¹å˜,å”¯ä¸€çš„åŸå› å°±æ˜¯ä¸Šä¸€æ­¥çš„ maven/conf/setting.xmlæ–‡ä»¶å†™é”™,å¯èƒ½æ ‡ç­¾å†…å®¹é”™è¯¯!ä»”ç»†æŸ¥çœ‹å³å¯!

*   **mysqlç¯å¢ƒå®‰è£…**

    *   ç¯å¢ƒå‡†å¤‡

        [https://downloads.mysql.com/archives/community/](https://downloads.mysql.com/archives/community/ "https://downloads.mysql.com/archives/community/")

        mysqlå®‰è£…åŒ…

        mysqlè¿è¡Œç³»ç»Ÿéœ€è¦çš„ç¯å¢ƒåŒ… \[æ³¨æ„:å®‰è£…å‡ºç°æŸç§é”™è¯¯æ‰éœ€è¦]

    *   ç¯å¢ƒå®‰è£…

        *   mysqlå®‰è£…

            ![](image/image_NPtoKQgeOQ.png)

            ![](image/image_669RmnbfRP.png)

            ![](image/image_GhOjb1RBZk.png)

            **æ³¨æ„:ç¼ºå°‘c++åº“,è¯·è¿è¡Œä¸‹é¢ç¯å¢ƒåŒ…å®‰è£…exeæ–‡ä»¶,ç‚¹å¼€æ‰§è¡Œå³å¯!**

            ![](image/image_6o7IZdXXU8.png)

            ![](image/image_g-PlhXwYLW.png)

            ä»¥ä¸‹æ­¥éª¤ä¸€è‡´nextå³å¯,ä¸éœ€è¦å¤„ç†,é»˜è®¤ç«¯å£å·3306

            ![](image/image_Ig9CzsT_np.png)

            è®¾ç½®rootè´¦å·çš„å¯†ç ,ä¸¤æ¬¡å¯†ç è¾“å…¥ä¸€è‡´å³å¯!

            ![](image/image_1W1EpuB7X_.png)

            æœåŠ¡å,è¦è®°ä½,åé¢è¦é‡å¯æœåŠ¡ä½¿ç”¨!

            ![](image/image_4mHlpl82I_.png)

            æ²¡æœ‰å…¶ä»–æ ¸å¿ƒæ­¥éª¤,excuteæ‰§è¡Œå³å¯,å…¨éƒ¨é€‰ä¸­ä»¥å,next,æœ€åfinishå³å¯!
            æ³¨æ„:ä¸­é—´æœ‰éæ ¸å¿ƒæ­¥éª¤,ç›´æ¥nextå³å¯!

        *   ç¯å¢ƒåŒ…å®‰è£…

    *   ç¼–ç é…ç½®

        *   æ•°æ®åº“æœåŠ¡å¼€å…³

            *   ç®¡ç†å‘˜æ¨¡å¼æ‰“å¼€cmd&#x20;

                ![](image/image_WnBgzdLZda.png)

            *   æœåŠ¡å¼€å…³å‘½ä»¤

                ```xml
                net stop å®‰è£…çš„æ—¶å€™æœåŠ¡åé»˜è®¤MySQL57   //å…³é—­æœåŠ¡
                net start æœåŠ¡å //å¼€å¯æœåŠ¡
                ```

        *   ä¿®æ”¹æ•°æ®åº“ç¼–ç æ ¼å¼é…ç½®

            å…³é—­mysqlæœåŠ¡,ä¿®æ”¹mysqlç¼–ç æ ¼å¼é…ç½®æ–‡ä»¶

            æ–‡ä»¶ä½ç½®:C:\ProgramData\MySQL\MySQL Server 5.7\my.ini

            æ³¨æ„: programdataä¸ºéšè—æ–‡ä»¶å¤¹! éœ€è®¾ç½®éšè—æ–‡ä»¶å¤¹å¯è§

            ```ini
            [mysql]
            no-beep
            # æœåŠ¡è®¾ç½®ç¼–ç æ ¼å¼
            default-character-set=utf8
            # default-character-set=
        
            [mysqld]
            default-storage-engine=INNODB
            # æœåŠ¡è®¾ç½®é©±åŠ¨ç¼–ç æ ¼å¼
            character-set-server=utf8
            collation-server=utf8_general_ci
            ```

    *   æœåŠ¡æµ‹è¯•

        *   å¯åŠ¨mysqlæœåŠ¡

            net start mysqlæœåŠ¡å

        *   æµ‹è¯•è¿æ¥

            ```ini
            //cmd
            mysql  -uè´¦å· -på¯†ç  -P 3306ç«¯å£å·  -h ipåœ°å€
            å¦‚æœæ˜¯æœ¬åœ°,ç«¯å£å·é»˜è®¤3306åªéœ€ç®€å†™
            mysql -uroot -på¯†ç  å›è½¦å³å¯
            
            ```

### ä¹ã€æŠ€æœ¯æ™®åŠ

*   **springbootåŸºæœ¬ä½¿ç”¨**

    *   springbootä»‹ç»

        å®˜æ–¹ï¼šspringboot makes it easy to create stand-alone, production-grade Spring based Applications that you can "just run".                                                                                                                       we take an opinionated view of the Spring platform and third-party libraries so you can get started with minimum fuss. Most Spring Boot applications need minimal Spring configuration.

        è§£é‡Šï¼šspringbootå¯ä»¥è½»æ¾åˆ›å»ºå•ä½“ã€ç”Ÿäº§çº§çš„ã€åŸºäºSpringçš„åº”ç”¨ç¨‹åºï¼Œæˆ‘ä»¬åªéœ€è¦è¿è¡Œå³å¯ï¼

        ç¬¬ä¸‰æ–¹ä¾èµ–éƒ½ä¼šæœ‰é»˜è®¤å¹¶ä¸”æœ€ä¼˜çš„é…ç½®ï¼Œæˆ‘ä»¬ç”šè‡³å¯ä»¥ä¸ç”¨åšä»»ä½•é…ç½®æ”¹åŠ¨ã€‚å¤§å¤šæ•°springbootå·¥ç¨‹åªéœ€è¦å°‘é‡çš„Springé…ç½®å³å¯å¯åŠ¨ç¨‹åºã€‚

        springbootæ˜¯å¿«é€Ÿå¯åŠ¨æ¡†æ¶ï¼ŒçœŸæ­£çš„å¼€å‘è¿˜æ˜¯ä½¿ç”¨ssmæ¡†æ¶ï¼

    *   springbootä¼˜åŠ¿

        *   çº¦å®šä¿—æˆï¼š

            *   springbootæœ‰å¾ˆå¤šçº¦å®šï¼Œåªè¦æŒ‰ç…§çº¦å®šå°±ä¸ç”¨å¯ä»¥å£°æ˜é…ç½®ï¼&#x20;

            *   ä¾‹å¦‚ï¼šcontroller/serviceç­‰ï¼Œåªè¦æ”¾åœ¨å¯åŠ¨ç±»æ‰€åœ¨çš„åŒ…æˆ–è€…å­åŒ…ä¸‹ï¼Œè‡ªåŠ¨æ‰«æï¼

        *   é›¶é…ç½®ï¼š

            *   springbootå¯¹å¾ˆå¤šé…ç½®ï¼Œéƒ½æœ‰é»˜è®¤å€¼ï¼Œä¸€èˆ¬é»˜è®¤å€¼éƒ½æ˜¯ç»è¿‡è€ƒé‡ï¼Œé¿å…é€ä¸€å£°æ˜

            *   ä¾‹å¦‚ï¼š å¯åŠ¨ç«¯å£å· server.port = 8080  | server.servlet.context-path = /

        *   ä¾èµ–å¯åŠ¨å™¨ï¼š

            *   springbootæ¨è¡Œå¯åŠ¨å™¨æœºåˆ¶ï¼Œä¾èµ–ä¸€ä¸ªå¯åŠ¨å™¨ï¼Œå°±è‡ªåŠ¨ä¾èµ–ä¸€ä¸ªæ–¹å‘çš„æ‰€æœ‰ä¾èµ–ï¼

            *   ä¾‹å¦‚ï¼šå¯¼å…¥starter-webï¼Œå°±ç›¸å½“äºmavenå·¥ç¨‹å¯¼å…¥ springmvc,servlet,jacksonç­‰ä¾èµ–

    *   springbooté…ç½®

        *   é…ç½®ä¼˜åŒ–

            *   springbootè§„é¿äº†ä¸€ä¸ªé¡¹ç›®å¤šä¸ªé…ç½®æ–‡ä»¶çš„éº»çƒ¦åœºæ™¯

            *   å°†æ‰€æœ‰çš„é…ç½®éƒ½è¿›è¡Œæ±‡æ€»åˆ°application.properties/application.yamlæ–‡ä»¶

            *   é…ç½®æ–‡ä»¶å°‘ï¼Œä»£ç ç»“æ„æ›´åŠ æ¸…æ™°

            *   é…ç½®ä½ç½®ç»Ÿä¸€ï¼Œæ–¹ä¾¿ä»£ç ç»´æŠ¤

            *   é…ç½®é”®springbootè§„åˆ™ç»Ÿä¸€ï¼Œæ–¹ä¾¿è®°å¿†å’Œå£°æ˜

        *   é…ç½®è§„åˆ™

            *   å‘½åå¿…é¡»æ˜¯application , æ–‡ä»¶æ ¼å¼å¯ä»¥æ˜¯properties | yaml |\*\* yml\*\*&#x20;

            *   ä½ç½®å¿…é¡»æ˜¯resourcesæ–‡ä»¶å¤¹çš„ç›´æ¥è·¯å¾„ä¸‹

            *   å…·ä½“é…ç½®ç¬¦åˆyamlå’Œpropertiesè¯­æ³•å³å¯

    *   springbooté¡¹ç›®å¿«é€Ÿæ„å»º

        *   éœ€æ±‚

            *   æ­å»ºåŸºäºspringboot çš„webé¡¹ç›®

            *   æä¾›controllerè¿›è¡Œè®¿é—®ï¼Œè¿”å›â€œhello springbootâ€

        *   é¡¹ç›®åˆ›å»º

            *   é¡¹ç›®åˆ›å»º

                ![](image/image_P8YIWfRLhD.png)

            *   é¡¹ç›®å‚æ•°

                ![](image/image_1h95Rj_7VG.png)

            *   ä¾èµ–å¯¼å…¥

                pom.xml

                ```xml
                 <!-- æ·»åŠ çˆ¶å·¥ç¨‹ä¾èµ–ï¼ä¾èµ–çš„æ˜¯springboot 2.3.7.RELEASE -->
                <parent>
                    <groupId>org.springframework.boot</groupId>
                    <artifactId>spring-boot-starter-parent</artifactId>
                    <version>2.3.7.RELEASE</version>
                    <relativePath/>
                </parent>
                
                <!-- è®¾ç½®mavenç¼–è¯‘ç‰ˆæœ¬-->
                <properties>
                    <java.version>1.8</java.version>
                    <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
                    <project.reporting.outputEncoding>UTF-8</project.reporting.outputEncoding>
                </properties>


                <!-- å¯¼å…¥é¡¹ç›® -->
                <dependencies>
                    <!-- thymeleafå¯åŠ¨å™¨ä¾èµ–å¯¼å…¥ -->
                    <dependency>
                        <groupId>org.springframework.boot</groupId>
                        <artifactId>spring-boot-starter-thymeleaf</artifactId>
                    </dependency>
                    <!-- javaWebç›¸å…³èµ·æ¥å¯¼å…¥ -->
                    <dependency>
                        <groupId>org.springframework.boot</groupId>
                        <artifactId>spring-boot-starter-web</artifactId>
                    </dependency>
                    <!-- æµ‹è¯•åŒ… -->
                    <dependency>
                        <groupId>org.springframework.boot</groupId>
                        <artifactId>spring-boot-starter-test</artifactId>
                    </dependency>
                </dependencies>
                ```
    
            *   å£°æ˜controller
    
                ä½ç½®ï¼šcom.atguigu.personblog.controlleråŒ…
    
                ```java
                /**
                 * projectName: blogexpends
                 *
                 * @author: èµµä¼Ÿé£
                 * description:
                 */
                @RestController
                public class HelloController {
                    
                    @GetMapping("say/hi")
                    public String  hello(){
                        return "hi!!";
                    }
                }
                ```
    
        *   åŸºç¡€é…ç½®
    
            springbootå¾ˆå°‘é…ç½®å³å¯å¯åŠ¨
    
            ```.properties
            # åº”ç”¨åç§°
            spring.application.name=01_springboot
            server.port=8080
            ```
    
        *   å¯åŠ¨é¡¹ç›®
    
            æ‰§è¡Œ**Application**å¯åŠ¨ç±»ï¼Œmainæ–¹æ³•å³å¯ï¼
    
        *   è®¿é—®æµ‹è¯•
    
            http\://localhost:8080/say/hi

*   **springboot+mybatisä½¿ç”¨**

    *   mybatisä»‹ç»

        > MyBatis æ˜¯ä¸€æ¬¾ä¼˜ç§€çš„æŒä¹…å±‚æ¡†æ¶ï¼Œå®ƒæ”¯æŒè‡ªå®šä¹‰ SQLã€å­˜å‚¨è¿‡ç¨‹ä»¥åŠé«˜çº§æ˜ å°„ã€‚MyBatis å…é™¤äº†å‡ ä¹æ‰€æœ‰çš„ JDBC ä»£ç ä»¥åŠè®¾ç½®å‚æ•°å’Œè·å–ç»“æœé›†çš„å·¥ä½œã€‚MyBatis å¯ä»¥é€šè¿‡ç®€å•çš„ XML æˆ–æ³¨è§£æ¥é…ç½®å’Œæ˜ å°„åŸå§‹ç±»å‹ã€æ¥å£å’Œ Java POJOï¼ˆPlain Old Java Objectsï¼Œæ™®é€šè€å¼ Java å¯¹è±¡ï¼‰ä¸ºæ•°æ®åº“ä¸­çš„è®°å½•ã€‚

    *   å¯¼å…¥ä¾èµ–

        ```xml
         <!-- mybaitsç›¸å…³ä¾èµ–å¯¼å…¥-->
        <dependency>
            <groupId>org.mybatis.spring.boot</groupId>
            <artifactId>mybatis-spring-boot-starter</artifactId>
            <version>1.3.2</version>
        </dependency>
        
        <dependency>
            <groupId>mysql</groupId>
            <artifactId>mysql-connector-java</artifactId>
            <version>5.1.47</version>
        </dependency>


        <dependency>
            <groupId>com.alibaba</groupId>
            <artifactId>druid-spring-boot-starter</artifactId>
            <version>1.2.5</version>
        </dependency>
    
        ```
    
    *   mybatisé…ç½®
    
        é…ç½®ä½ç½®: resources/application.yml
    
        ```.properties
        mybatis-plus:
          mapper-locations: classpath:mappers/*.xml
          configuration:
            map-underscore-to-camel-case: true
            auto-mapping-behavior: full
            lazy-loading-enabled: true
            aggressive-lazy-loading: false
          type-aliases-package: com.atguigu.pojo #è®¾ç½®åˆ«å
    
        spring:
          # è¿æ¥æ± é…ç½®
          datasource:
            url: jdbc:mysql://localhost:3306/store_user?useSSL=false
            username: root
            password: 123456
            driver-class-name: com.mysql.jdbc.Driver
            type: com.alibaba.druid.pool.DruidDataSource
    
        ```
    
    *   å¯åŠ¨ç±»æ·»åŠ æ³¨è§£
    
        ```java
        //mybatis mapperæ¥å£æ‰€åœ¨åŒ…æ‰«æä½ç½®!
        @MapperScan("com.atguigu.personblog.mapper")
        @SpringBootApplication
        public class PersonblogApplication {
            public static void main(String[] args) {
                SpringApplication.run(PersonblogApplication.class, args);
            }
        }
    
        ```

*   **springboot+mybatis-plus+druidä½¿ç”¨**

    *   mybatis-plusä»‹ç»

        [MyBatis-Plus (opens new window)](https://github.com/baomidou/mybatis-plus "MyBatis-Plus (opens new window)")ï¼ˆç®€ç§° MPï¼‰æ˜¯ä¸€ä¸ª [MyBatis (opens new window)](https://www.mybatis.org/mybatis-3/ "MyBatis (opens new window)")çš„å¢å¼ºå·¥å…·ï¼Œåœ¨ MyBatis çš„åŸºç¡€ä¸Šåªåšå¢å¼ºä¸åšæ”¹å˜ï¼Œä¸ºç®€åŒ–å¼€å‘ã€æé«˜æ•ˆç‡è€Œç”Ÿã€‚

    *   å¯¼å…¥ä¾èµ–

        ```xml
        <dependency>
            <groupId>com.baomidou</groupId>
            <artifactId>mybatis-plus-boot-starter</artifactId>
            <version>3.5.2</version>
        </dependency>

        <dependency>
            <groupId>mysql</groupId>
            <artifactId>mysql-connector-java</artifactId>
            <version>5.1.47</version>
        </dependency>

        <dependency>
            <groupId>com.alibaba</groupId>
            <artifactId>druid-spring-boot-starter</artifactId>
            <version>1.2.5</version>
        </dependency>

        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-test</artifactId>
        </dependency>

        <dependency>
            <groupId>org.projectlombok</groupId>
            <artifactId>lombok</artifactId>
        </dependency>

        ```

    *   mybatisé…ç½®

        é…ç½®ä½ç½®: resources/application.yml

        ```.properties
        mybatis-plus:
          mapper-locations: classpath:mappers/*.xml
          configuration:
            map-underscore-to-camel-case: true
            auto-mapping-behavior: full
            lazy-loading-enabled: true
            aggressive-lazy-loading: false
          type-aliases-package: com.atguigu.pojo #è®¾ç½®åˆ«å

        spring:
          # è¿æ¥æ± é…ç½®
          datasource:
            url: jdbc:mysql://localhost:3306/store_user?useSSL=false
            username: root
            password: 123456
            driver-class-name: com.mysql.jdbc.Driver
            type: com.alibaba.druid.pool.DruidDataSource
        ```

    *   å‡†å¤‡æ•°æ®åº“

        ```sql
        DROP TABLE IF EXISTS user;

        CREATE TABLE user
        (
            id BIGINT(20) NOT NULL COMMENT 'ä¸»é”®ID',
            name VARCHAR(30) NULL DEFAULT NULL COMMENT 'å§“å',
            age INT(11) NULL DEFAULT NULL COMMENT 'å¹´é¾„',
            email VARCHAR(50) NULL DEFAULT NULL COMMENT 'é‚®ç®±',
            PRIMARY KEY (id)
        );

        DELETE FROM user;

        INSERT INTO user (id, name, age, email) VALUES
        (1, 'Jone', 18, 'test1@baomidou.com'),
        (2, 'Jack', 20, 'test2@baomidou.com'),
        (3, 'Tom', 28, 'test3@baomidou.com'),
        (4, 'Sandy', 21, 'test4@baomidou.com'),
        (5, 'Billie', 24, 'test5@baomidou.com');

        ```

    *   ç¼–å†™pojo

        ```java
        @Data
        public class User {
            private Long id;
            private String name;
            private Integer age;
            private String email;
        }
        ```

    *   ç¼–å†™mapper

        ```java
        public interface UserMapper extends BaseMapper<User> {

        }
        ```

    *   æµ‹è¯•ç±»

        ```java
        @SpringBootTest
        public class SampleTest {

            @Autowired
            private UserMapper userMapper;

            @Test
            public void testSelect() {
                System.out.println(("----- selectAll method test ------"));
                List<User> userList = userMapper.selectList(null);
                Assert.assertEquals(5, userList.size());
                userList.forEach(System.out::println);
            }

        }
        ```

    *   å¯åŠ¨ç±»

        ```java
        @SpringBootApplication
        @MapperScan("com.baomidou.mybatisplus.samples.quickstart.mapper")
        public class Application {
    
            public static void main(String[] args) {
                SpringApplication.run(Application.class, args);
            }
    
        }
        ```

*   **springboot+thymeleafä½¿ç”¨**

    *   &#x20;thymeleafä»‹ç»

        Thymeleaf æ˜¯æ–°ä¸€ä»£ Java æ¨¡æ¿å¼•æ“ï¼Œæ”¯æŒ HTML åŸå‹ï¼Œä»¥ç›´æ¥è¢«æµè§ˆå™¨æ‰“å¼€ï¼Œæ­¤æ—¶æµè§ˆå™¨ä¼šå¿½ç•¥æœªå®šä¹‰çš„ Thymeleaf æ ‡ç­¾å±æ€§ï¼Œå±•ç¤º thymeleaf æ¨¡æ¿çš„é™æ€é¡µé¢æ•ˆæœã€‚å½“åœ¨åº”ç”¨ç¨‹åºä¸­ä¼šåŠ¨æ€åœ°æ›¿æ¢æ‰é¡µé¢è®¾ç½®çš„æ ‡ç­¾å±æ€§ã€‚

    *   å¯¼å…¥ä¾èµ–

        ```xml
        <!-- thymeleafå¯åŠ¨å™¨ä¾èµ–å¯¼å…¥ -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-thymeleaf</artifactId>
        </dependency>
        ```

    *   thymeleafé…ç½®

        ```.properties
        # æ¸…ç©ºç¼“å­˜
        # thymeleafçš„æ–‡ä»¶æ”¾åœ¨resources/templatesä¼šè‡ªåŠ¨æŸ¥æ‰¾!
        # å¦‚æœå…¶ä»–ä½ç½®éœ€è¦æŒ‡å®š
        #spring.thymeleaf.prefix= é»˜è®¤å€¼ classpath /templates
        #spring.thymeleaf.suffix= é»˜è®¤å€¼ .html
        spring.thymeleaf.mode=HTML
        spring.thymeleaf.encoding=utf-8
        spring.thymeleaf.cache=false
        ```

*   **lombokåŸºæœ¬ä½¿ç”¨**

    *   ä»‹ç»

        Lomboké¡¹ç›®æ˜¯ä¸€ä¸ªjavaåº“ï¼Œå®ƒå¯ä»¥è‡ªåŠ¨æ’å…¥åˆ°ç¼–è¾‘å™¨å’Œæ„å»ºå·¥å…·ä¸­ï¼Œå¢å¼ºjavaçš„æ€§èƒ½ã€‚ä¸éœ€è¦å†å†™getterã€setteræˆ–equalsæ–¹æ³•ï¼Œåªè¦æœ‰ä¸€ä¸ª[æ³¨è§£](https://baike.baidu.com/item/æ³¨è§£/22344968?fromModule=lemma_inlink "æ³¨è§£")ï¼Œä½ çš„ç±»å°±æœ‰ä¸€ä¸ªåŠŸèƒ½é½å…¨çš„æ„å»ºå™¨ã€è‡ªåŠ¨è®°å½•å˜é‡ç­‰ç­‰ã€‚

    *   å¼•å…¥

        *   ideaæ’ä»¶ä¸‹è½½

            ![](image/image_f8XpNqX54Q.png)

        *   lombokä¾èµ–å¯¼å…¥

            ```xml
            <dependency>
                <groupId>org.projectlombok</groupId>
                <artifactId>lombok</artifactId>
                <version>1.18.24</version>
            </dependency>
            ```

    *   å¸¸ç”¨æ³¨è§£

        éœ€è¦ç®€åŒ–ç±»ä¸Šæ·»åŠ ä»¥ä¸‹æ³¨è§£å³å¯!

        ```java
        @Setter æ³¨è§£åœ¨ç±»æˆ–å­—æ®µï¼Œæ³¨è§£åœ¨ç±»æ—¶ä¸ºæ‰€æœ‰å­—æ®µç”Ÿæˆsetteræ–¹æ³•ï¼Œæ³¨è§£åœ¨å­—æ®µä¸Šæ—¶åªä¸ºè¯¥å­—æ®µç”Ÿæˆsetteræ–¹æ³•ã€‚
        @Getter ä½¿ç”¨æ–¹æ³•åŒä¸Šï¼ŒåŒºåˆ«åœ¨äºç”Ÿæˆçš„æ˜¯getteræ–¹æ³•ã€‚
        @ToString æ³¨è§£åœ¨ç±»ï¼Œæ·»åŠ toStringæ–¹æ³•ã€‚
        @EqualsAndHashCode æ³¨è§£åœ¨ç±»ï¼Œç”ŸæˆhashCodeå’Œequalsæ–¹æ³•ã€‚
        @NoArgsConstructor æ³¨è§£åœ¨ç±»ï¼Œç”Ÿæˆæ— å‚çš„æ„é€ æ–¹æ³•ã€‚
        @RequiredArgsConstructor æ³¨è§£åœ¨ç±»ï¼Œä¸ºç±»ä¸­éœ€è¦ç‰¹æ®Šå¤„ç†çš„å­—æ®µç”Ÿæˆæ„é€ æ–¹æ³•ï¼Œæ¯”å¦‚finalå’Œè¢«@NonNullæ³¨è§£çš„å­—æ®µã€‚
        @AllArgsConstructor æ³¨è§£åœ¨ç±»ï¼Œç”ŸæˆåŒ…å«ç±»ä¸­æ‰€æœ‰å­—æ®µçš„æ„é€ æ–¹æ³•ã€‚
        @Data æ³¨è§£åœ¨ç±»ï¼Œç”Ÿæˆsetter/getterã€equalsã€canEqualã€hashCodeã€toStringæ–¹æ³•ï¼Œå¦‚ä¸ºfinalå±æ€§ï¼Œåˆ™ä¸ä¼šä¸ºè¯¥å±æ€§ç”Ÿæˆsetteræ–¹æ³•ã€‚
        @Slf4j æ³¨è§£åœ¨ç±»ï¼Œç”Ÿæˆlogå˜é‡ï¼Œä¸¥æ ¼æ„ä¹‰æ¥è¯´æ˜¯å¸¸é‡ã€‚private static final Logger log = LoggerFactory.getLogger(UserController.class);
        ```

*   **é˜¿é‡Œossäº‘æ–‡ä»¶å­˜å‚¨**

    *   ä»€ä¹ˆæ˜¯å¯¹è±¡å­˜å‚¨OSS?

        é˜¿é‡Œäº‘å¯¹è±¡å­˜å‚¨OSSï¼ˆObject Storage Serviceï¼‰æ˜¯é˜¿é‡Œäº‘æä¾›çš„æµ·é‡ã€å®‰å…¨ã€ä½æˆæœ¬ã€é«˜æŒä¹…çš„äº‘å­˜å‚¨æœåŠ¡ã€‚å…¶æ•°æ®è®¾è®¡æŒä¹…æ€§ä¸ä½äº99.9999999999%ï¼ˆ12ä¸ª9ï¼‰ï¼ŒæœåŠ¡å¯ç”¨æ€§ï¼ˆæˆ–ä¸šåŠ¡è¿ç»­æ€§ï¼‰ä¸ä½äº99.995%ã€‚

    *   å¯¹è±¡å­˜å‚¨OSSä½œç”¨

        é˜¿é‡Œäº‘å¯¹è±¡å­˜å‚¨OSSç®€å•çš„è¯´å°±æ˜¯æˆ‘ä»¬èŠ±é’±åœ¨é˜¿é‡Œè´­ä¹°å­˜å‚¨ç©ºé—´

        ç„¶åæˆ‘ä»¬å¯ä»¥å°†é¡¹ç›®ä¸­çš„å›¾ç‰‡æ–‡ä»¶ç­‰èµ„æºå­˜å‚¨åœ¨å¯¹è±¡å­˜å‚¨OSSæœåŠ¡å™¨ä¸Š

        å¯¹è±¡å­˜å‚¨OSSæä¾›å¯¹æ–‡ä»¶çš„ä¸Šä¼ ,ä¸‹è½½, åˆ é™¤ç­‰ç®¡ç†æ“ä½œ

        è¿™æ ·æˆ‘ä»¬å°±çœå»äº†è´­ä¹°å­˜å‚¨æœåŠ¡å™¨, æ­å»ºå­˜å‚¨æœåŠ¡å™¨, è¿è¥ç®¡ç†å­˜å‚¨æœåŠ¡å™¨çš„ç¹çæ“ä½œ.

    *   å¯¹è±¡å­˜å‚¨OSSä¸­çš„æ¦‚å¿µ

        *   å­˜å‚¨ç±»å‹ï¼ˆStorage Classï¼‰

            OSSæä¾›æ ‡å‡†ã€ä½é¢‘è®¿é—®ã€å½’æ¡£ã€å†·å½’æ¡£å››ç§å­˜å‚¨ç±»å‹ï¼Œå…¨é¢è¦†ç›–ä»çƒ­åˆ°å†·çš„å„ç§æ•°æ®å­˜å‚¨åœºæ™¯ã€‚å…¶ä¸­æ ‡å‡†å­˜å‚¨ç±»å‹æä¾›é«˜æŒä¹…ã€é«˜å¯ç”¨ã€é«˜æ€§èƒ½çš„å¯¹è±¡å­˜å‚¨æœåŠ¡ï¼Œèƒ½å¤Ÿæ”¯æŒé¢‘ç¹çš„æ•°æ®è®¿é—®ï¼›ä½é¢‘è®¿é—®å­˜å‚¨ç±»å‹é€‚åˆé•¿æœŸä¿å­˜ä¸ç»å¸¸è®¿é—®çš„æ•°æ®ï¼ˆå¹³å‡æ¯æœˆè®¿é—®é¢‘ç‡1åˆ°2æ¬¡ï¼‰ï¼Œå­˜å‚¨å•ä»·ä½äºæ ‡å‡†ç±»å‹ï¼›å½’æ¡£å­˜å‚¨ç±»å‹é€‚åˆéœ€è¦é•¿æœŸä¿å­˜ï¼ˆå»ºè®®åŠå¹´ä»¥ä¸Šï¼‰çš„å½’æ¡£æ•°æ®ï¼›å†·å½’æ¡£å­˜å‚¨é€‚åˆéœ€è¦è¶…é•¿æ—¶é—´å­˜æ”¾çš„æå†·æ•°æ®ã€‚

        *   å­˜å‚¨ç©ºé—´ï¼ˆBucketï¼‰

            å­˜å‚¨ç©ºé—´æ˜¯æ‚¨ç”¨äºå­˜å‚¨å¯¹è±¡ï¼ˆObjectï¼‰çš„å®¹å™¨ï¼Œæ‰€æœ‰çš„å¯¹è±¡éƒ½å¿…é¡»éš¶å±äºæŸä¸ªå­˜å‚¨ç©ºé—´ã€‚å­˜å‚¨ç©ºé—´å…·æœ‰å„ç§é…ç½®å±æ€§ï¼ŒåŒ…æ‹¬åœ°åŸŸã€è®¿é—®æƒé™ã€å­˜å‚¨ç±»å‹ç­‰ã€‚æ‚¨å¯ä»¥æ ¹æ®å®é™…éœ€æ±‚ï¼Œåˆ›å»ºä¸åŒç±»å‹çš„å­˜å‚¨ç©ºé—´æ¥å­˜å‚¨ä¸åŒçš„æ•°æ®ã€‚

        *   å¯¹è±¡ï¼ˆObjectï¼‰

            å¯¹è±¡æ˜¯OSSå­˜å‚¨æ•°æ®çš„åŸºæœ¬å•å…ƒï¼Œä¹Ÿè¢«ç§°ä¸ºOSSçš„æ–‡ä»¶ã€‚å¯¹è±¡ç”±å…ƒä¿¡æ¯ï¼ˆObject Metaï¼‰ã€ç”¨æˆ·æ•°æ®ï¼ˆDataï¼‰å’Œæ–‡ä»¶åï¼ˆKeyï¼‰ç»„æˆã€‚å¯¹è±¡ç”±å­˜å‚¨ç©ºé—´å†…éƒ¨å”¯ä¸€çš„Keyæ¥æ ‡è¯†ã€‚å¯¹è±¡å…ƒä¿¡æ¯æ˜¯ä¸€ç»„é”®å€¼å¯¹ï¼Œè¡¨ç¤ºäº†å¯¹è±¡çš„ä¸€äº›å±æ€§ï¼Œä¾‹å¦‚æœ€åä¿®æ”¹æ—¶é—´ã€å¤§å°ç­‰ä¿¡æ¯ï¼ŒåŒæ—¶æ‚¨ä¹Ÿå¯ä»¥åœ¨å…ƒä¿¡æ¯ä¸­å­˜å‚¨ä¸€äº›è‡ªå®šä¹‰çš„ä¿¡æ¯ã€‚

        *   åœ°åŸŸï¼ˆRegionï¼‰

            åœ°åŸŸè¡¨ç¤ºOSSçš„æ•°æ®ä¸­å¿ƒæ‰€åœ¨ç‰©ç†ä½ç½®ã€‚æ‚¨å¯ä»¥æ ¹æ®è´¹ç”¨ã€è¯·æ±‚æ¥æºç­‰é€‰æ‹©åˆé€‚çš„åœ°åŸŸåˆ›å»ºBucketã€‚

        *   è®¿é—®åŸŸåï¼ˆEndpointï¼‰

            Endpointè¡¨ç¤ºOSSå¯¹å¤–æœåŠ¡çš„è®¿é—®åŸŸåã€‚OSSä»¥HTTP RESTful APIçš„å½¢å¼å¯¹å¤–æä¾›æœåŠ¡ï¼Œå½“è®¿é—®ä¸åŒåœ°åŸŸçš„æ—¶å€™ï¼Œéœ€è¦ä¸åŒçš„åŸŸåã€‚é€šè¿‡å†…ç½‘å’Œå¤–ç½‘è®¿é—®åŒä¸€ä¸ªåœ°åŸŸæ‰€éœ€è¦çš„åŸŸåä¹Ÿæ˜¯ä¸åŒçš„ã€‚

        *   è®¿é—®å¯†é’¥ï¼ˆAccessKeyï¼‰

            AccessKeyç®€ç§°AKï¼ŒæŒ‡çš„æ˜¯è®¿é—®èº«ä»½éªŒè¯ä¸­ç”¨åˆ°çš„AccessKey IDå’ŒAccessKey Secretã€‚OSSé€šè¿‡ä½¿ç”¨AccessKey IDå’ŒAccessKey Secretå¯¹ç§°åŠ å¯†çš„æ–¹æ³•æ¥éªŒè¯æŸä¸ªè¯·æ±‚çš„å‘é€è€…èº«ä»½ã€‚AccessKey IDç”¨äºæ ‡è¯†ç”¨æˆ·ï¼›AccessKey Secretæ˜¯ç”¨æˆ·ç”¨äºåŠ å¯†ç­¾åå­—ç¬¦ä¸²å’ŒOSSç”¨æ¥éªŒè¯ç­¾åå­—ç¬¦ä¸²çš„å¯†é’¥ï¼Œå¿…é¡»ä¿å¯†ã€‚

    *   ç½‘ç«™ä»‹ç»

        é˜¿é‡Œäº‘å¯¹è±¡å­˜å‚¨OSS \[å®˜ç½‘]

        [https://cn.aliyun.com/product/oss](https://cn.aliyun.com/product/oss "https://cn.aliyun.com/product/oss")

        é˜¿é‡Œäº‘å¯¹è±¡å­˜å‚¨OSSåœ¨çº¿æ–‡æ¡£åœ°å€:

        [https://help.aliyun.com/product/31815.html?spm=5176.19720258.J\_2686872250.3.54212c4ac3QCCP](https://help.aliyun.com/product/31815.html?spm=5176.19720258.J_2686872250.3.54212c4ac3QCCP "https://help.aliyun.com/product/31815.html?spm=5176.19720258.J_2686872250.3.54212c4ac3QCCP")

    *   **è®¿é—®å¼€é€šæµç¨‹**

        ![](image/image_z-Bt9BYD6A.png)

        ![](image/image_GM2puHsfTf.png)

        ![](image/image_vEafaORo8W.png)

    *   è·å–AccessKey

        å†™ä»£ç çš„æ—¶å€™, éœ€è¦åœ¨é¡¹ç›®é…ç½®æ–‡ä»¶ä¸­é…ç½®è‡ªå·±é˜¿é‡Œäº‘æœåŠ¡çš„è´¦å·å’Œå¯†ç ,å¦‚æœå†™çœŸå®çš„æ”¯ä»˜å®è´¦å·å¯†ç ä¼šé€ æˆè´¦å·å¯†ç æ³„éœ², ä¸å®‰å…¨

        æ‰€ä»¥åˆ›å»ºAccessKeyä¹Ÿå°±æ˜¯åœ¨å½“å‰è´¦æˆ·ä¸‹, åˆ›å»ºå­è´¦æˆ·å’Œå¯†ç ä½¿ç”¨, å¯ä»¥éšæ—¶æ›´æ¢, å¯ç”¨, åœç”¨!ç”¨æ¥æ›¿ä»£è´¦å·ï¼

        ![](image/image_zc_efRuzkc.png)

    *   springBootå·¥ç¨‹æ–‡ä»¶ä¸Šä¼ å®æˆ˜

        *   å¯¼å…¥ä¾èµ–

            ```xml
             <!-- é˜¿é‡Œäº‘OSSæ–‡ä»¶ä¸Šä¼ å¼€å§‹ -->
            <!-- é˜¿é‡Œäº‘ OSS -->
            <dependency>
                <groupId>com.aliyun.oss</groupId>
                <artifactId>aliyun-sdk-oss</artifactId>
                <version>3.14.1</version>
            </dependency>
            <!--æ—¥æœŸæ—¶é—´å·¥å…·-->
            <dependency>
                <groupId>joda-time</groupId>
                <artifactId>joda-time</artifactId>
                <version>2.10.14</version>
            </dependency>
            <dependency>
                <groupId>commons-io</groupId>
                <artifactId>commons-io</artifactId>
                <version>2.4</version>
            </dependency>
            </dependencies>
            ```

        *   å£°æ˜é…ç½®

            ```java
            #OSSé…ç½®
            aliyun:
              oss:
                file:
                  # æ§åˆ¶å° - oss - ç‚¹å‡»å¯¹åº”æ¡¶ - æ¦‚è§ˆ - åœ°åŸŸèŠ‚ç‚¹
                  endpoint: ä½ çš„åœ°ç‹±èŠ‚ç‚¹
                  keyid: ä½ çš„accesskey
                  keysecret: ä½ çš„accesssecret
                  bucketname: ä½ çš„æ¡¶å
            ```

        *   å¯¼å…¥å·¥å…·ç±»

            éœ€è¦åŠ å…¥åˆ°iocå®¹å™¨ï¼Œæ³¨æ„ä½ç½®ï¼

            ```java
            package com.atguigu.config;
            
            import com.aliyun.oss.OSS;
            import com.aliyun.oss.OSSClientBuilder;
            import com.aliyun.oss.model.GetObjectRequest;
            import com.aliyun.oss.model.ObjectMetadata;
            import lombok.Data;
            import org.springframework.boot.context.properties.ConfigurationProperties;
            import org.springframework.stereotype.Component;
            
            import java.io.ByteArrayInputStream;
            import java.io.File;
            import java.util.Date;
            
            /**
             * projectName: b2c-cloud-store
             *
             * @author: èµµä¼Ÿé£
             * description:
             */
            @Component
            @Data
            @ConfigurationProperties(prefix = "aliyun.oss.file")
            public class AliyunOSSUtils {
            
                //åŸºæœ¬å±æ€§ è¯»å–é…ç½®æ–‡ä»¶
                private  String endPoint;
                private  String keyId;
                private  String keySecret;
                private  String bucketName;



                /**
                 * byteæ•°ç»„æ ¼å¼ä¸Šä¼ æ–‡ä»¶å¹¶è¿”å›ä¸Šä¼ åçš„URLåœ°å€
                 * @param objectName        å®Œæ•´æ–‡ä»¶å, ä¾‹å¦‚abc/efg/123.jpg
                 * @param content           æ–‡ä»¶å†…å®¹, byteæ•°ç»„æ ¼å¼
                 * @param contentType       æ–‡ä»¶ç±»å‹   image/png  image/jpeg
                 * @param hours             è¿‡æœŸæ—¶é—´   å•ä½å°æ—¶
                 * @Author zhaoweifeng
                 */
                public  String uploadImage(String objectName,
                                                 byte[] content,String contentType,int hours)  throws Exception {
                    // åˆ›å»ºOSSClientå®ä¾‹ã€‚
                    OSS ossClient = new OSSClientBuilder().build(endPoint, keyId, keySecret);
                    // åˆ›å»ºä¸Šä¼ æ–‡ä»¶çš„å…ƒä¿¡æ¯ï¼Œå¯ä»¥é€šè¿‡æ–‡ä»¶å…ƒä¿¡æ¯è®¾ç½®HTTP header(è®¾ç½®äº†æ‰èƒ½é€šè¿‡è¿”å›çš„é“¾æ¥ç›´æ¥è®¿é—®)ã€‚
                    ObjectMetadata objectMetadata = new ObjectMetadata();
                    objectMetadata.setContentType(contentType);
                    // æ–‡ä»¶ä¸Šä¼ 
                    ossClient.putObject(bucketName, objectName, new ByteArrayInputStream(content), objectMetadata);
                    // è®¾ç½®URLè¿‡æœŸæ—¶é—´ä¸ºhourså°æ—¶ã€‚
                    Date expiration = new Date(System.currentTimeMillis() + 3600 * 1000 * 300 * hours);
                    //è¿”å›urlåœ°å€
                    String url = ossClient.generatePresignedUrl(bucketName, objectName, expiration).toString();
                    //å…³é—­OSSClientã€‚
                    ossClient.shutdown();
                    return url;
                }
    
                /**
                 * ä¸‹è½½æ–‡ä»¶åˆ°æœ¬åœ°
                 * @param objectName        å®Œæ•´æ–‡ä»¶å, ä¾‹å¦‚abc/efg/123.jpg
                 * @param localFile         ä¸‹è½½åˆ°æœ¬åœ°æ–‡ä»¶ç›®å½•
                 * @Author zhaoweifeng
                 */
                public  void downFile(String objectName,
                                            String localFile) throws Exception {
                    // åˆ›å»ºOSSClientå®ä¾‹ã€‚
                    OSS ossClient = new OSSClientBuilder().build(endPoint, keyId, keySecret);
    
                    // ä¸‹è½½OSSæ–‡ä»¶åˆ°æœ¬åœ°æ–‡ä»¶ã€‚å¦‚æœæŒ‡å®šçš„æœ¬åœ°æ–‡ä»¶å­˜åœ¨ä¼šè¦†ç›–ï¼Œä¸å­˜åœ¨åˆ™æ–°å»ºã€‚
                    ossClient.getObject(new GetObjectRequest(bucketName, objectName), new File(localFile));
    
                    // å…³é—­OSSClientã€‚
                    ossClient.shutdown();
                }
    
                /**
                 * åˆ é™¤æ–‡ä»¶
                 * @param objectName        å®Œæ•´æ–‡ä»¶å, ä¾‹å¦‚abc/efg/123.jpg
                 * @Author zhaoweifeng
                 */
                public  void deleteFile(String objectName) {
                    // åˆ›å»ºOSSClientå®ä¾‹ã€‚
                    OSS ossClient = new OSSClientBuilder().build(endPoint, keyId, keySecret);
    
                    // åˆ é™¤æ–‡ä»¶ã€‚å¦‚éœ€åˆ é™¤æ–‡ä»¶å¤¹ï¼Œè¯·å°†ObjectNameè®¾ç½®ä¸ºå¯¹åº”çš„æ–‡ä»¶å¤¹åç§°ã€‚å¦‚æœæ–‡ä»¶å¤¹éç©ºï¼Œåˆ™éœ€è¦å°†æ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰objectåˆ é™¤åæ‰èƒ½åˆ é™¤è¯¥æ–‡ä»¶å¤¹ã€‚
                    ossClient.deleteObject(bucketName, objectName);
    
                    // å…³é—­OSSClientã€‚
                    ossClient.shutdown();
                }
    
            }
    
            ```
    
        *   å®æˆ˜ä»£ç 
    
            ```java
            @PostMapping("upload")
            public Object upload(MultipartFile img) throws Exception {
    
                String filename = img.getOriginalFilename();
                String contentType = img.getContentType();
                long millis = System.currentTimeMillis();
    
                filename = millis + filename; //é˜²æ­¢é‡å¤
    
                String url = aliyunOSSUtils.uploadImage(filename, img.getBytes(), contentType, 1000);
                System.out.println("url = " + url);
                return R.ok("ä¸Šä¼ æˆåŠŸ",url);
    
            }
            ```

*   **springboot+springCache+redisç¼“å­˜ä¸­é—´ä»¶ä½¿ç”¨**

    *   ç¼“å­˜ä½œç”¨

        > ä¸¾ä¸ªä¾‹å­ï¼šåœ¨æˆ‘ä»¬ç¨‹åºä¸­ï¼Œå¾ˆå¤šé…ç½®æ•°æ®ï¼ˆä¾‹å¦‚ä¸€ä¸ªå•†å“ä¿¡æ¯ã€ä¸€ä¸ªç™½åå•ã€ä¸€ä¸ªç¬¬ä¸‰æ–¹å®¢æˆ·çš„å›è°ƒæ¥å£ï¼‰ï¼Œè¿™äº›æ•°æ®å­˜åœ¨æˆ‘ä»¬çš„DBä¸Šï¼Œæ•°æ®é‡æ¯”è¾ƒå°‘ï¼Œä½†æ˜¯ç¨‹åºè®¿é—®å¾ˆé¢‘ç¹ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œå°†æ•°æ®æ”¾ä¸€ä»½åˆ°æˆ‘ä»¬çš„å†…å­˜ç¼“å­˜ä¸­å°†å¤§å¤§æå‡æˆ‘ä»¬ç³»ç»Ÿçš„è®¿é—®æ•ˆç‡ï¼Œå› ä¸ºå‡å°‘äº†æ•°æ®åº“è®¿é—®ï¼Œæœ‰å¯èƒ½å‡å°‘äº†æ•°æ®åº“å»ºè¿æ—¶é—´ã€ç½‘ç»œæ•°æ®ä¼ è¾“æ—¶é—´ã€æ•°æ®åº“ç£ç›˜å¯»å€æ—¶é—´â€¦â€¦

        æ€»çš„æ¥è¯´ï¼Œæ¶‰åŠæŸ¥è¯¢åœºæ™¯éƒ½å¯ä»¥è€ƒè™‘ä½¿ç”¨ç¼“å­˜ä¼˜åŒ–æ€§èƒ½ï¼š1ã€æŸ¥æ•°æ®åº“2ã€è¯»å–æ–‡ä»¶3ã€ç½‘ç»œè®¿é—®ï¼Œç‰¹åˆ«æ˜¯è°ƒç”¨ç¬¬ä¸‰æ–¹æœåŠ¡æŸ¥è¯¢æ¥å£ï¼

        **æ³¨æ„ï¼šå¹¶ä¸æ˜¯ç¼“å­˜è®¾è®¡çš„å¤šï¼Œæ€§èƒ½å°±ä¸€å®šå¥½ï¼Œå¯¹æ›´æ–°é¢‘ç¹çš„æ•°æ®ï¼Œä¸æ¨èç¼“å­˜ï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§æ˜¯ç¼“å­˜çš„å‰æï¼**

        ä¸€è‡´æ€§è§£é‡Šï¼šç¼“å­˜æ•°æ®å’Œæ•°æ®åº“æ•°æ®ä¸€è‡´ï¼Œé¿å…è„ï¼ˆé”™è¯¯ï¼‰æ•°æ®ï¼

    *   SpringCacheæ¦‚å¿µ

        > Spring Cache æ˜¯Spring æä¾›çš„ä¸€æ•´å¥—çš„ç¼“å­˜è§£å†³æ–¹æ¡ˆï¼Œå®ƒä¸æ˜¯å…·ä½“çš„ç¼“å­˜å®ç°ï¼Œå®ƒåªæä¾›ä¸€æ•´å¥—çš„æ¥å£å’Œä»£ç è§„èŒƒã€é…ç½®ã€æ³¨è§£ç­‰ï¼Œç”¨äºæ•´åˆå„ç§ç¼“å­˜æ–¹æ¡ˆï¼Œæ¯”å¦‚Redisã€Caffeineã€Guava Cacheã€Ehcacheã€‚ä½¿ç”¨æ³¨è§£æ–¹å¼æ›¿ä»£åŸæœ‰ç¡¬ç¼–ç æ–¹å¼ç¼“å­˜ï¼Œè¯­æ³•æ›´åŠ ç®€å•ä¼˜é›…ï¼

        SpringCacheä½¿ç”¨ä¸‰æ­¥éª¤ï¼š å¯¼å…¥ä¾èµ–  ç¼“å­˜é…ç½®  æ·»åŠ æ³¨è§£

    *   SpringCacheä¾èµ–å¯¼å…¥

        > ç¼“å­˜å…·ä½“å®ç°æŠ€æœ¯ï¼Œæˆ‘ä»¬é€‰æ‹©redis

        ```xml
        <!--spring-cache-->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-cache</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-data-redis</artifactId>
        </dependency>
        <!-- redisè¿æ¥æ± -->
        <dependency>
            <groupId>redis.clients</groupId>
            <artifactId>jedis</artifactId>
        </dependency>

        ```

    *   SpringCacheé…ç½®

        *   application.yml&#x20;

            > é…ç½®ç¼“å­˜å›ºå®šçš„è¿æ¥ä¿¡æ¯ç­‰é…ç½®ï¼

            ```yaml
            spring:  
              cache:
                type: redis  # ç¼“å­˜è®¾ç½®ä¸ºRedisç±»å‹
              redis:  # è®¾ç½®Redisè¿æ¥ä¿¡æ¯
                host: 124.221.70.206
                port: 6379
                jedis: # è®¾ç½®Redisè¿æ¥æ± 
                  pool:
                    max-wait: 2000ms
                    min-idle: 2
                    max-idle: 8
                    max-active: 10
            ```

        *   é…ç½®ç±»

            > å£°æ˜ç¼“å­˜é…ç½®åºåˆ—åŒ–æ–¹å¼ã€jsonã€‘ï¼Œé…ç½®ç¼“å­˜æ—¶é—´å¤šæ ·åŒ–é…ç½®

            ```java
             //é…ç½®ç¼“å­˜manager
            @Bean
            @Primary  //åŒç±»å‹,å¤šä¸ªbean,é»˜è®¤ç”Ÿæ•ˆ! é»˜è®¤ç¼“å­˜æ—¶é—´1å°æ—¶!  å¯ä»¥é€‰æ‹©!
            public RedisCacheManager cacheManagerHour(RedisConnectionFactory redisConnectionFactory){
            
                RedisCacheConfiguration instanceConfig = instanceConfig(1 * 3600L);//ç¼“å­˜æ—¶é—´1å°æ—¶
            
                //æ„å»ºç¼“å­˜å¯¹è±¡
                return RedisCacheManager.builder(redisConnectionFactory)
                        .cacheDefaults(instanceConfig)
                        .transactionAware()
                        .build();
            }
            
            //ç¼“å­˜ä¸€å°æ—¶é…ç½®
            @Bean
            public RedisCacheManager cacheManagerDay(RedisConnectionFactory redisConnectionFactory){
            
                RedisCacheConfiguration instanceConfig = instanceConfig(24 * 3600L);//ç¼“å­˜æ—¶é—´1å°æ—¶
            
                //æ„å»ºç¼“å­˜å¯¹è±¡
                return RedisCacheManager.builder(redisConnectionFactory)
                        .cacheDefaults(instanceConfig)
                        .transactionAware()
                        .build();
            }


            /**
             * å®ä¾‹åŒ–å…·ä½“çš„ç¼“å­˜é…ç½®!
             *    è®¾ç½®ç¼“å­˜æ–¹å¼JSON
             *    è®¾ç½®ç¼“å­˜æ—¶é—´ å•ä½ç§’
             * @param ttl
             * @return
             */
            private RedisCacheConfiguration instanceConfig(Long ttl){
                
                //è®¾ç½®jacksonåºåˆ—åŒ–å·¥å…·
                Jackson2JsonRedisSerializer<Object> jackson2JsonRedisSerializer 
                        = new Jackson2JsonRedisSerializer<Object>(Object.class);
                
                //å¸¸è§jacksonçš„å¯¹è±¡æ˜ å°„å™¨,å¹¶è®¾ç½®ä¸€äº›åŸºæœ¬å±æ€§
                ObjectMapper objectMapper = new ObjectMapper();
                objectMapper.disable(SerializationFeature.WRITE_DATES_AS_TIMESTAMPS);
                objectMapper.registerModule(new JavaTimeModule());
                objectMapper.configure(MapperFeature.USE_ANNOTATIONS,false);
                objectMapper.setSerializationInclusion(JsonInclude.Include.NON_NULL);
                objectMapper.activateDefaultTyping(LaissezFaireSubTypeValidator.instance,
                        ObjectMapper.DefaultTyping.NON_FINAL, JsonTypeInfo.As.PROPERTY);
                
                jackson2JsonRedisSerializer.setObjectMapper(objectMapper);
                
                return RedisCacheConfiguration.defaultCacheConfig()
                        .entryTtl(Duration.ofSeconds(ttl)) //è®¾ç½®ç¼“å­˜æ—¶é—´
                        .disableCachingNullValues()
                        .serializeValuesWith(RedisSerializationContext.SerializationPair.fromSerializer(jackson2JsonRedisSerializer));
            }
            ```
    
    *   SpringCache æ³¨è§£
    
        *   @EnableCaching
    
            æ·»åŠ åˆ°å¯åŠ¨ç±»ï¼Œå¼€å¯ç¼“å­˜æ”¯æŒï¼
    
            ```java
            @SpringBootApplication
            @MapperScan(basePackages = "com.atguigu.product.mapper")
            //å¼€å¯feignå®¢æˆ·ç«¯,å¼•å…¥å¯¹åº”çš„å®¢æˆ·ç«¯
            @EnableFeignClients(clients = {CategoryClient.class})
            @EnableCaching //å¼€å¯ç¼“å­˜æ”¯æŒ
            public class ProductApplication {
    
                public static void main(String[] args) {
                    SpringApplication.run(ProductApplication.class,args);
                }
    
            }
            ```
    
        *   @Cacheable
    
            ```java
            ä½ç½®ï¼šæ·»åŠ åˆ°æ–¹æ³•å’Œç±»ä¸Š
            ä½œç”¨ï¼šè°ƒç”¨æ–¹æ³•ï¼ŒæŸ¥è¯¢æ˜¯å¦æœ‰ç¼“å­˜ï¼Œæœ‰ç›´æ¥èµ°ç¼“å­˜ï¼Œæ²¡æœ‰èµ°æ–¹æ³•ï¼Œå°†æ–¹æ³•çš„è¿”å›å€¼è¿›è¡Œç¼“å­˜ï¼
            å‚æ•°ï¼š
                 value = String{} é…ç½®ç¼“å­˜çš„ é…ç½®ç¼“å­˜â€˜åˆ†åŒºâ€™ï¼Œç›¸å½“äºç¼“å­˜çš„æ ‡ç¤ºï¼
                 key   = String   é…ç½®ç¼“å­˜çš„ â€˜åˆ†åŒºâ€™ä¸‹çš„å…·ä½“è¡¨ç¤ºï¼Œæ­¤å¤„æ”¯æŒSpringELè¡¨è¾¾å¼ï¼ŒåŠ¨æ€å‘½å
                 cacheManager = String é€‰æ‹©é…ç½®ç±»ä¸­çš„ç¼“å­˜é…ç½®å¯¹è±¡beannameï¼Œä¸é€‰èµ°é»˜è®¤ï¼
                 condition = String æ³¨è§£ç”Ÿæ•ˆæ¡ä»¶ï¼Œ æ”¯æŒSpringElè¡¨è¾¾å¼ ä¾‹å¦‚ï¼š "#result != null"
                                        ç»“æœä¸ä¸ºnullï¼Œè¿›è¡Œç¼“å­˜ï¼
            ä¾‹å¦‚ï¼š
                @Cacheable(value = "product",key = "#root.methodName+" +
                                                    "'-'+#productParamInteger.categoryID+" +
                                                    "'-'+#productParamInteger.currentPage+" +
                                                    "'-'+#productParamInteger.pageSize",cacheManager = "cacheManagerbean")
                                                    
            SpringELè¡¨è¾¾å¼ç®€å•äº†è§£ï¼š
                
                #å¼€å¤´
                #root.method è¢«è°ƒç”¨çš„æ–¹æ³•
                #root.methodName è¢«è°ƒç”¨çš„æ–¹æ³•åç§°
                #root.target è°ƒç”¨æ–¹æ³•çš„å¯¹è±¡
                #root.args  æ–¹æ³•çš„å‚æ•°å¯¹è±¡æ•°ç»„ æ”¯æŒ[index]è·å–å…·ä½“å‚æ•°
                #result æ–¹æ³•æ‰§è¡Œåçš„ç»“æœ
                #å½¢å‚å  ç›´æ¥è·å–è¡Œå‚æ•°åç§° æ”¯æŒognlå‘ä¸‹ç»§ç»­è¯»å–
             
            æ³¨æ„ï¼š
                ç¼“å­˜ä¹Ÿåˆ†ä¸ºcurd
                æ‰€ä»¥ï¼Œè®¾è®¡ç¼“å­˜valueå’Œkeyçš„æ—¶å€™ï¼Œå¤šæ€è€ƒï¼ŒåæœŸè¿˜éœ€è¦è¿›è¡Œåˆ é™¤å’Œæ›¿æ¢åŠ¨ä½œï¼   
    
            ```
    
        *   @CachePut
    
            ```java
            ä½ç½®ï¼šæ·»åŠ åˆ°æ–¹æ³•å’Œç±»ä¸Š
            ä½œç”¨ï¼šä¸å½±å“æ–¹æ³•ä½¿ç”¨ï¼Œå°†æ–¹æ³•çš„è¿”å›å€¼ï¼Œè¿›è¡ŒæŒ‡å®šçš„keyæ›´æ–°ï¼Œé€šå¸¸æ·»åŠ åˆ°ä¿®æ”¹æ–¹æ³•ä¸Šï¼
            å‚æ•°ï¼š
                 value = String{} é…ç½®ç¼“å­˜çš„ é…ç½®ç¼“å­˜â€˜åˆ†åŒºâ€™ï¼Œç›¸å½“äºç¼“å­˜çš„æ ‡ç¤ºï¼
                 key   = String   é…ç½®ç¼“å­˜çš„ â€˜åˆ†åŒºâ€™ä¸‹çš„å…·ä½“è¡¨ç¤ºï¼Œæ­¤å¤„æ”¯æŒSpringELè¡¨è¾¾å¼ï¼ŒåŠ¨æ€å‘½å
                 cacheManager = String é€‰æ‹©é…ç½®ç±»ä¸­çš„ç¼“å­˜é…ç½®å¯¹è±¡beannameï¼Œä¸é€‰èµ°é»˜è®¤ï¼
                 condition = String æ³¨è§£ç”Ÿæ•ˆæ¡ä»¶ï¼Œ æ”¯æŒSpringElè¡¨è¾¾å¼ ä¾‹å¦‚ï¼š "#result != null"
                                        ç»“æœä¸ä¸ºnullï¼Œè¿›è¡Œæ›´æ–°ï¼
            ä¾‹å¦‚ï¼š
                @CachePut(key = "#id", condition = "#result != null"),
    
            ```
    
        *   @CacheEvict
    
            ```java
            ä½ç½®ï¼šæ·»åŠ åˆ°æ–¹æ³•å’Œç±»ä¸Š
            ä½œç”¨ï¼šä¸å½±å“æ–¹æ³•ä½¿ç”¨ï¼Œå°†æ–¹æ³•çš„è¿”å›å€¼ï¼Œè¿›è¡ŒæŒ‡å®šçš„keyå¤±æ•ˆï¼Œé€šå¸¸æ·»åŠ åˆ°åˆ é™¤æ–¹æ³•ä¸Šï¼
            å‚æ•°ï¼š
                 value = String{} é…ç½®ç¼“å­˜çš„ é…ç½®ç¼“å­˜â€˜åˆ†åŒºâ€™ï¼Œç›¸å½“äºç¼“å­˜çš„æ ‡ç¤ºï¼
                 key   = String   é…ç½®ç¼“å­˜çš„ â€˜åˆ†åŒºâ€™ä¸‹çš„å…·ä½“è¡¨ç¤ºï¼Œæ­¤å¤„æ”¯æŒSpringELè¡¨è¾¾å¼ï¼ŒåŠ¨æ€å‘½å
                 cacheManager = String é€‰æ‹©é…ç½®ç±»ä¸­çš„ç¼“å­˜é…ç½®å¯¹è±¡beannameï¼Œä¸é€‰èµ°é»˜è®¤ï¼
                 condition = String æ³¨è§£ç”Ÿæ•ˆæ¡ä»¶ï¼Œ æ”¯æŒSpringElè¡¨è¾¾å¼ ä¾‹å¦‚ï¼š "#result != null"
                                        ç»“æœä¸ä¸ºnullï¼Œè¿›è¡Œå¤±æ•ˆï¼
            ä¾‹å¦‚ï¼š
               //å•ä¸€å¤±æ•ˆ
               @CacheEvict(value = "student", key = "'saveCache01'")
               //allEntries = true åˆ é™¤åˆ†åŒºæ‰€æœ‰çš„æ•°æ®
               @CacheEvict(value = "list.product",allEntries = true)
               //å¤šç‚¹å¤±æ•ˆ
               @Caching(evict = {
                        @CacheEvict(value = "student", key = "'saveCache01'"),
                        @CacheEvict(value = "student", key = "'saveCache02'")
                }ï¼‰
    
            ```
    
        *   @Caching
    
            ```java
            ä½ç½®ï¼šæ·»åŠ æ–¹æ³•å’Œç±»ä¸Š
            ä½œç”¨ï¼šå¤šåŒ…æ¶µæ³¨è§£ï¼Œå¯ä»¥åŒ…å«ä¸Šé¢ä¸‰ä¸ªæ³¨è§£ï¼Œç”¨äºå¤æ‚çš„ç¼“å­˜ç­–ç•¥ï¼
            å‚æ•°ï¼š
                Cacheable [] cacheable é…ç½®å¤šä¸ªç¼“å­˜
                CachePut []  put é…ç½®å¤šä¸ªæ›´æ–°
                CacheEvict [] evict() é…ç½®å¤šä¸ªç¼“å­˜
    
            ä¾‹å¦‚ï¼š
               è®¢å•æ¨¡å—
               è®¢å•æ”¯ä»˜ï¼Œéœ€è¦æ›´æ–°è®¢å•ç¼“å­˜ï¼Œè¿˜è¦æ¸…ç©ºçƒ­é—¨å•†å“ç¼“å­˜ï¼
            ```
    
    *   **å¤šæœåŠ¡ç¼“å­˜é…ç½®**ä¼˜åŒ–
    
        > æå–ç¼“å­˜é…ç½®å’Œé…ç½®æ–‡ä»¶ï¼Œå‡å°‘ä»£ç å†—ä½™ï¼
    
        *   å¯¼å…¥ä¾èµ–
    
            store-common-feign
    
            ```xml
            <!-- ç¼“å­˜ä¾èµ– -->
            <!--spring-cache-->
            <dependency>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-starter-cache</artifactId>
            </dependency>
            <dependency>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-starter-data-redis</artifactId>
            </dependency>
            <!-- redisè¿æ¥æ± -->
            <dependency>
                <groupId>redis.clients</groupId>
                <artifactId>jedis</artifactId>
            </dependency>
    
            <dependency>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-starter-web</artifactId>
            </dependency>
            ```
    
        *   å¯¼å…¥é…ç½®ç±»
    
            store-common-feign
    
            ```java
            /**
             * projectName: b2c-cloud-store
             *
             * @author: èµµä¼Ÿé£
             * description: ç¼“å­˜é…ç½®ç±» æ”¾ç½®é…ç½®çš„æ–¹æ³•,å­æ¨¡æ¿ç»§æ‰¿å’Œå¤ç”¨
             */
            public class CacheConfiguration {


                //é…ç½®ç¼“å­˜manager
                @Bean
                @Primary  //åŒç±»å‹,å¤šä¸ªbean,é»˜è®¤ç”Ÿæ•ˆ! é»˜è®¤ç¼“å­˜æ—¶é—´1å°æ—¶!  å¯ä»¥é€‰æ‹©!
                public RedisCacheManager cacheManagerHour(RedisConnectionFactory redisConnectionFactory){
    
                    RedisCacheConfiguration instanceConfig = instanceConfig(1 * 3600L);//ç¼“å­˜æ—¶é—´1å°æ—¶
    
                    //æ„å»ºç¼“å­˜å¯¹è±¡
                    return RedisCacheManager.builder(redisConnectionFactory)
                            .cacheDefaults(instanceConfig)
                            .transactionAware()
                            .build();
                }
    
                //ç¼“å­˜ä¸€å°æ—¶é…ç½®
                @Bean
                public RedisCacheManager cacheManagerDay(RedisConnectionFactory redisConnectionFactory){
    
                    RedisCacheConfiguration instanceConfig = instanceConfig(24 * 3600L);//ç¼“å­˜æ—¶é—´1å°æ—¶
    
                    //æ„å»ºç¼“å­˜å¯¹è±¡
                    return RedisCacheManager.builder(redisConnectionFactory)
                            .cacheDefaults(instanceConfig)
                            .transactionAware()
                            .build();
                }


                /**
                 * å®ä¾‹åŒ–å…·ä½“çš„ç¼“å­˜é…ç½®!
                 *    è®¾ç½®ç¼“å­˜æ–¹å¼JSON
                 *    è®¾ç½®ç¼“å­˜æ—¶é—´ å•ä½ç§’
                 * @param ttl
                 * @return
                 */
                private RedisCacheConfiguration instanceConfig(Long ttl){
    
                    //è®¾ç½®jacksonåºåˆ—åŒ–å·¥å…·
                    Jackson2JsonRedisSerializer<Object> jackson2JsonRedisSerializer
                            = new Jackson2JsonRedisSerializer<Object>(Object.class);
    
                    //å¸¸è§jacksonçš„å¯¹è±¡æ˜ å°„å™¨,å¹¶è®¾ç½®ä¸€äº›åŸºæœ¬å±æ€§
                    ObjectMapper objectMapper = new ObjectMapper();
                    objectMapper.disable(SerializationFeature.WRITE_DATES_AS_TIMESTAMPS);
                    objectMapper.registerModule(new JavaTimeModule());
                    objectMapper.configure(MapperFeature.USE_ANNOTATIONS,false);
                    objectMapper.setSerializationInclusion(JsonInclude.Include.NON_NULL);
                    objectMapper.activateDefaultTyping(LaissezFaireSubTypeValidator.instance,
                            ObjectMapper.DefaultTyping.NON_FINAL, JsonTypeInfo.As.PROPERTY);
    
                    jackson2JsonRedisSerializer.setObjectMapper(objectMapper);
    
                    return RedisCacheConfiguration.defaultCacheConfig()
                            .entryTtl(Duration.ofSeconds(ttl)) //è®¾ç½®ç¼“å­˜æ—¶é—´
                            .disableCachingNullValues()
                            .serializeValuesWith(RedisSerializationContext.SerializationPair.fromSerializer(jackson2JsonRedisSerializer));
                }
    
            }
    
            ```
    
        *   å£°æ˜ç¼“å­˜é…ç½®
    
            application-cache.yml
    
            æŒ‡å®šç¯å¢ƒé…ç½®å˜é‡ï¼Œåº”ç”¨æ¨¡å—åªéœ€è¦æ¿€æ´»ï¼Œä¸ç”¨é‡å¤å†™ï¼
    
            ```yaml
            spring:
              cache:
                type: redis
              redis:
                host: 124.221.70.206
                port: 6379
                jedis: # è®¾ç½®Redisè¿æ¥æ± 
                  pool:
                    max-wait: 2000ms
                    min-idle: 2
                    max-idle: 8
                    max-active: 10
            ```
    
        *   ç”Ÿæ•ˆæœåŠ¡æ¿€æ´»cacheé…ç½®
    
            ä½¿ç”¨ç¼“å­˜çš„æ¨¡å—å’ŒæœåŠ¡
    
            ```yaml
            spring:
              # è¿æ¥æ± é…ç½®
              datasource:
                url: jdbc:mysql://localhost:3306/store_product?useSSL=false
                username: root
                password: 123456
                driver-class-name: com.mysql.jdbc.Driver
                type: com.alibaba.druid.pool.DruidDataSource
              profiles:
                active: cache  #æ¿€æ´»store-commonæ¨¡å—çš„ç¼“å­˜é…ç½®
            ```
    
        *   ç”Ÿæ•ˆæœåŠ¡å³æˆé…ç½®ç±»
    
            ```java
            @Configuration
            public class ProductConfiguration extends CacheConfiguration {
            ```

*   **springboot+es æœç´¢ä¸­é—´ä»¶ä½¿ç”¨**

    *   ä»‹ç»

        springboot,æ•´åˆesï¼Œè¿›è¡Œæ•°æ®åˆå§‹åŒ–å’Œæ•°æ®æŸ¥è¯¢ï¼

    *   å¯¼å…¥ä¾èµ–

        ```xml
        <!-- å¯¼å…¥esä¾èµ– -->
        <dependency>
            <groupId>org.elasticsearch.client</groupId>
            <artifactId>elasticsearch-rest-high-level-client</artifactId>
        </dependency>

        ```

    *   å£°æ˜é…ç½® ã€åˆå§‹åŒ–apiå¯¹è±¡ã€‘

        ```java
        @Configuration
        public class SearchConfiguration {
            /**
             * eså®¢æˆ·ç«¯æ·»åŠ åˆ°iocå®¹å™¨
             * @return
             */
            @Bean
            public RestHighLevelClient restHighLevelClient(){
                RestHighLevelClient client =
                        new RestHighLevelClient(
                                RestClient.builder(HttpHost.create("http://124.221.70.206:9200")));
        
                return client;
            }


        }
        ```
    
    *   ä½¿ç”¨
    
        ```java
         /**
         * æ›´æ–°å’Œæ’å…¥æ•°æ®åŒä¸€ä¸ª!
         */
        @RabbitListener(bindings = @QueueBinding(
                value = @Queue(name = "insert.queue"),
                exchange = @Exchange("topic.ex"),
                key = "insert.product"
        ))
        public void insert(Product product) throws IOException {
    
            IndexRequest indexRequest = new IndexRequest("product")
                    .id(product.getProductId().toString());
    
            ProductDoc productDoc = new ProductDoc(product);
    
            ObjectMapper objectMapper = new ObjectMapper();
            String json  = objectMapper.writeValueAsString(productDoc);
    
            indexRequest.source(json, XContentType.JSON);
    
            client.index(indexRequest, RequestOptions.DEFAULT);
    
        }


        /**
         * åˆ é™¤æ•°æ®
         * @param productId
         */
        @RabbitListener(bindings = @QueueBinding(
                value = @Queue(name = "delete.queue"),
                exchange = @Exchange("topic.ex"),
                key = "delete.product"
        ))
        public void remove(Integer productId) throws IOException {
    
            System.out.println("RabbitMQListener.remove");
            System.out.println("productId = " + productId);
            DeleteRequest request = new DeleteRequest("product")
                    .id(productId.toString());
    
            client.delete(request,RequestOptions.DEFAULT);
        }
        ```

*   **springboot+rabbitMQ æ¶ˆæ¯é˜Ÿåˆ—ä¸­é—´ä»¶ä½¿ç”¨**

    *   ä»‹ç»

        è¿›è¡ŒæœåŠ¡ä¹‹é—´å¼‚æ­¥é€šä¿¡ã€‚ä¾‹å¦‚ï¼Œç”Ÿæˆè®¢å•ï¼Œä¿®æ”¹åº“å­˜å’Œåˆ é™¤è´­ç‰©è½¦æ•°æ®ï¼

    *   å¯¼å…¥ä¾èµ–

        ```java
        <!--AMQPä¾èµ–ï¼ŒåŒ…å«RabbitMQ-->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-amqp</artifactId>
        </dependency>

        ```

    *   é…ç½®æ–‡ä»¶

        ```yaml
        spring:
          rabbitmq:
            host: 124.221.70.206
            port: 5672
            virtual-host: /
            username: root
            password: 123456
            listener:
              simple:
                prefetch: 1   # é¢„å…ˆåˆ†é…1ä¸ª èƒ½è€…å¤šåŠ³
        ```

    *   é…ç½®ç±»

        ```java
        @Configuration
        public class MqAndIPageConfiguration {
            /**
             * æ·»åŠ rabbitmqçš„æ•°æ®åºåˆ—åŒ–æ–¹å¼ä½¿ç”¨JSON
             * @return
             */
            @Bean
            public MessageConverter messageConverter(){

                return new Jackson2JsonMessageConverter();
            }
        }
        ```

    *   åŸºæœ¬ä½¿ç”¨

        *   æ¶ˆæ¯æµç¨‹

            ç”Ÿäº§è€… - äº¤æ¢æœº - key - æ¶ˆæ¯é˜Ÿåˆ— - æ¶ˆè´¹è€…

            ![](image/image_0LbNmD3acb.png)

        *   ç”Ÿäº§è€…

            ```java
            @Autowired
            private RabbitTemplate rabbitTemplate;

            //å‘é€æ¶ˆæ¯å³å¯
            rabbitTemplate.convertAndSend("topic.ex","delete.product",productId);

            ```

        *   æ¶ˆè´¹è€…

            ```java
            @Component
            public class RabbitMQListener {
            
                /**
                 * ç›‘å¬æŒ‡å®šçš„äº¤æ¢æœºå’Œkey
                 * æœ‰å¯¹åº”çš„æ¶ˆæ¯ï¼Œå³å¯æ¥å—ï¼
                 */
                @RabbitListener(bindings = @QueueBinding(
                        value = @Queue(name = "insert.queue"),
                        exchange = @Exchange("topic.ex"),
                        key = "insert.product"
                ))
                public void insert(Product product) throws IOException {
            
                   æ¥æ”¶åä¸šåŠ¡ä»£ç ï¼
                }
            ```
